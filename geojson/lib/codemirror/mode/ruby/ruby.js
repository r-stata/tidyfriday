CodeMirror.defineMode("ruby",function(i){function e(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}var u,o=e(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"]),a=e(["def","class","case","for","while","do","module","then","catch","loop","proc","begin"]),l=e(["end","until"]),d={"[":"]","{":"}","(":")"};function s(e,t,n){return n.tokenize.push(e),e(t,n)}function c(e,t){if(u=null,e.sol()&&e.match("=begin")&&e.eol())return t.tokenize.push(f),"comment";if(e.eatSpace())return null;var n,r,i,o,a=e.next();if("`"==a||"'"==a||'"'==a)return s(p(a,"string",'"'==a||"`"==a),e,t);if("/"!=a||e.eol()||" "==e.peek()){if("%"==a)return r=!(n="string"),e.eat("s")?n="atom":e.eat(/[WQ]/)?(n="string",r=!0):e.eat(/[r]/)?(n="string-2",r=!0):e.eat(/[wxq]/)&&(n="string"),(i=e.eat(/[^\w\s]/))?s(p(i=d.propertyIsEnumerable(i)?d[i]:i,n,r,!0),e,t):"operator";if("#"==a)return e.skipToEnd(),"comment";if("<"==a&&(i=e.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/)))return s((o=i[1],function(e,t){return e.match(o)?t.tokenize.pop():e.skipToEnd(),"string"}),e,t);if("0"==a)return e.eat("x")?e.eatWhile(/[\da-fA-F]/):e.eat("b")?e.eatWhile(/[01]/):e.eatWhile(/[0-7]/),"number";if(/\d/.test(a))return e.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/),"number";if("?"!=a)return":"==a?e.eat("'")?s(p("'","atom",!1),e,t):e.eat('"')?s(p('"',"atom",!0),e,t):e.eat(/[\<\>]/)?(e.eat(/[\<\>]/),"atom"):e.eat(/[\+\-\*\/\&\|\:\!]/)?"atom":e.eat(/[a-zA-Z$@_]/)?(e.eatWhile(/[\w]/),e.eat(/[\?\!\=]/),"atom"):"operator":"@"==a&&e.match(/^@?[a-zA-Z_]/)?(e.eat("@"),e.eatWhile(/[\w]/),"variable-2"):"$"==a?(e.eat(/[a-zA-Z_]/)?e.eatWhile(/[\w]/):e.eat(/\d/)?e.eat(/\d/):e.next(),"variable-3"):/[a-zA-Z_]/.test(a)?(e.eatWhile(/[\w]/),e.eat(/[\?\!]/),e.eat(":")?"atom":"ident"):"|"!=a||!t.varList&&"{"!=t.lastTok&&"do"!=t.lastTok?/[\(\)\[\]{}\\;]/.test(a)?(u=a,null):"-"==a&&e.eat(">")?"arrow":/[=+\-\/*:\.^%<>~|]/.test(a)?(e.eatWhile(/[=+\-\/*:\.^%<>~|]/),"operator"):null:(u="|",null);for(;e.match(/^\\[CM]-/););return e.eat("\\")?e.eatWhile(/\w/):e.next(),"string"}return s(p(a,"string-2",!0),e,t)}function p(i,o,a,u){return function(e,t){var n,r=!1;for("read-quoted-paused"===t.context.type&&(t.context=t.context.prev,e.eat("}"));null!=(n=e.next());){if(n==i&&(u||!r)){t.tokenize.pop();break}if(a&&"#"==n&&!r){if(e.eat("{")){"}"==i&&(t.context={prev:t.context,type:"read-quoted-paused"}),t.tokenize.push(function(){var n=1;return function(e,t){if("}"==e.peek()){if(0==--n)return t.tokenize.pop(),t.tokenize[t.tokenize.length-1](e,t)}else"{"==e.peek()&&n++;return c(e,t)}}());break}if(/[@\$]/.test(e.peek())){t.tokenize.push(function(){var n=!1;return function(e,t){return n?(t.tokenize.pop(),t.tokenize[t.tokenize.length-1](e,t)):(n=!0,c(e,t))}}());break}}r=!r&&"\\"==n}return o}}function f(e,t){return e.sol()&&e.match("=end")&&e.eol()&&t.tokenize.pop(),e.skipToEnd(),"comment"}return{startState:function(){return{tokenize:[c],indented:0,context:{type:"top",indented:-i.indentUnit},continuedLine:!1,lastTok:null,varList:!1}},token:function(e,t){e.sol()&&(t.indented=e.indentation());var n,r,i=t.tokenize[t.tokenize.length-1](e,t);return"ident"==i&&(r=e.current(),i=o.propertyIsEnumerable(e.current())?"keyword":/^[A-Z]/.test(r)?"tag":"def"==t.lastTok||"class"==t.lastTok||t.varList?"def":"variable",a.propertyIsEnumerable(r)?n="indent":l.propertyIsEnumerable(r)?n="dedent":"if"!=r&&"unless"!=r||e.column()!=e.indentation()||(n="indent")),(u||i&&"comment"!=i)&&(t.lastTok=r||u||i),"|"==u&&(t.varList=!t.varList),"indent"==n||/[\(\[\{]/.test(u)?t.context={prev:t.context,type:u||i,indented:t.indented}:("dedent"==n||/[\)\]\}]/.test(u))&&t.context.prev&&(t.context=t.context.prev),e.eol()&&(t.continuedLine="\\"==u||"operator"==i),i},indent:function(e,t){var n,r;return e.tokenize[e.tokenize.length-1]!=c?0:(r=t&&t.charAt(0),r=(n=e.context).type==d[r]||"keyword"==n.type&&/^(?:end|until|else|elsif|when|rescue)\b/.test(t),n.indented+(r?0:i.indentUnit)+(e.continuedLine?i.indentUnit:0))},electricChars:"}de",lineComment:"#"}}),CodeMirror.defineMIME("text/x-ruby","ruby");