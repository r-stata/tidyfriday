var code=" wOrd1 (#%\n word3] \naopop pop 0 1 2 3 4\n (a) [b] {c} \nint getchar(void) {\n  static char buf[BUFSIZ];\n  static char *bufp = buf;\n  if (n == 0) {  /* buffer is empty */\n    n = read(0, buf, sizeof buf);\n    bufp = buf;\n  }\n\n  return (--n >= 0) ? (unsigned char) *bufp++ : EOF;\n \n}\n",lines=function(){lineText=code.split("\n");for(var e=[],t=0;t<lineText.length;t++)e[t]={line:t,length:lineText[t].length,lineText:lineText[t],textStart:/^\s*/.exec(lineText[t])[0].length};return e}(),endOfDocument=makeCursor(lines.length-1,lines[lines.length-1].length),wordLine=lines[0],bigWordLine=lines[1],charLine=lines[2],bracesLine=lines[3],seekBraceLine=lines[4],word1={start:{line:wordLine.line,ch:1},end:{line:wordLine.line,ch:5}},word2={start:{line:wordLine.line,ch:word1.end.ch+2},end:{line:wordLine.line,ch:word1.end.ch+4}},word3={start:{line:bigWordLine.line,ch:1},end:{line:bigWordLine.line,ch:5}},bigWord1=word1,bigWord2=word2,bigWord3={start:{line:bigWordLine.line,ch:1},end:{line:bigWordLine.line,ch:7}},bigWord4={start:{line:bigWordLine.line,ch:bigWord1.end.ch+3},end:{line:bigWordLine.line,ch:bigWord1.end.ch+7}},oChars=[{line:charLine.line,ch:1},{line:charLine.line,ch:3},{line:charLine.line,ch:7}],pChars=[{line:charLine.line,ch:2},{line:charLine.line,ch:4},{line:charLine.line,ch:6},{line:charLine.line,ch:8}],numChars=[{line:charLine.line,ch:10},{line:charLine.line,ch:12},{line:charLine.line,ch:14},{line:charLine.line,ch:16},{line:charLine.line,ch:18}],parens1={start:{line:bracesLine.line,ch:1},end:{line:bracesLine.line,ch:3}},squares1={start:{line:bracesLine.line,ch:5},end:{line:bracesLine.line,ch:7}},curlys1={start:{line:bracesLine.line,ch:9},end:{line:bracesLine.line,ch:11}},seekOutside={start:{line:seekBraceLine.line,ch:1},end:{line:seekBraceLine.line,ch:16}},seekInside={start:{line:seekBraceLine.line,ch:14},end:{line:seekBraceLine.line,ch:11}};function copyCursor(e){return{ch:e.ch,line:e.line}}function testVim(e,d,t,s){var r,l={lineNumbers:!0,keyMap:"vim",showCursorWhenSelecting:!0,value:code};for(r in t)t.hasOwnProperty(r)&&(l[r]=t[r]);return test("vim_"+e,function(){var e=document.getElementById("testground"),t=CodeMirror(e,l),s=(CodeMirror.Vim.maybeInitState(t),t.vimState);var r,o,n,a,u={doKeys:function(e){e instanceof Array&&(arguments=e);for(var t=0;t<arguments.length;t++)CodeMirror.Vim.handleKey(a,arguments[t])},doInsertModeKeys:function(e){function t(e){return"string"==typeof e?CodeMirror.commands[e](n):e(n),!0}e instanceof Array&&(arguments=e);for(var s=0;s<arguments.length;s++){var r,o=arguments[s];!0!==CodeMirror.lookupKey(o,["vim-insert"],t)||!n.vimState.insertMode||"Esc"==arguments[s]||(r=CodeMirror.Vim.getVimGlobalState_().macroModeState.lastInsertModeChanges)&&r.changes.push(new CodeMirror.Vim.InsertModeKey(o))}},doEx:function(e){o.openDialog=u.fakeOpenDialog(e),u.doKeys(":")},assertCursorAt:(r=o=n=a=t,function(e,t){e=null==t&&"number"==typeof e.line?e:makeCursor(e,t);eqPos(e,r.getCursor())}),fakeOpenDialog:function(s){return function(e,t){return t(s)}},getRegisterController:function(){return CodeMirror.Vim.getRegisterController()}},i=(CodeMirror.Vim.clearVimGlobalState_(),!1);try{d(t,s,u),i=!0}finally{debug&&!i||verbose?e.style.visibility="visible":e.removeChild(t.getWrapperElement())}},s)}testVim("qq@q",function(e,t,s){e.setCursor(0,0),s.doKeys("q","q","l","l","q"),s.assertCursorAt(0,2),s.doKeys("@","q"),s.assertCursorAt(0,4)},{value:"            "}),testVim("@@",function(e,t,s){e.setCursor(0,0),s.doKeys("q","q","l","l","q"),s.assertCursorAt(0,2),s.doKeys("@","q"),s.assertCursorAt(0,4),s.doKeys("@","@"),s.assertCursorAt(0,6)},{value:"            "});var jumplistScene="word\n(word)\n{word\nword.\n\nword search\n}word\nword\nword\n";function testJumplist(e,r,o,n,a){o=makeCursor(o[0],o[1]),n=makeCursor(n[0],n[1]),testVim(e,function(e,t,s){CodeMirror.Vim.clearVimGlobalState_(),a&&(e.openDialog=s.fakeOpenDialog("word")),e.setCursor(n),s.doKeys.apply(null,r),s.assertCursorAt(o)},{value:jumplistScene})}function testMotion(e,r,o,n){testVim(e,function(e,t,s){n=n||{line:0,ch:0},e.setCursor(n),s.doKeys(r),s.assertCursorAt(o)})}function makeCursor(e,t){return{line:e,ch:t}}function offsetCursor(e,t,s){return{line:e.line+t,ch:e.ch+s}}function testEdit(e,r,o,n,a){return testVim(e,function(e,t,s){e.setCursor(0,r.search(o)),s.doKeys.apply(this,n.split("")),eq(a,e.getValue())},{value:r})}testJumplist("jumplist_H",["H","<C-o>"],[5,2],[5,2]),testJumplist("jumplist_M",["M","<C-o>"],[2,2],[2,2]),testJumplist("jumplist_L",["L","<C-o>"],[2,2],[2,2]),testJumplist("jumplist_[[",["[","[","<C-o>"],[5,2],[5,2]),testJumplist("jumplist_]]",["]","]","<C-o>"],[2,2],[2,2]),testJumplist("jumplist_G",["G","<C-o>"],[5,2],[5,2]),testJumplist("jumplist_gg",["g","g","<C-o>"],[5,2],[5,2]),testJumplist("jumplist_%",["%","<C-o>"],[1,5],[1,5]),testJumplist("jumplist_{",["{","<C-o>"],[1,5],[1,5]),testJumplist("jumplist_}",["}","<C-o>"],[1,5],[1,5]),testJumplist("jumplist_'",["m","a","h","'","a","h","<C-i>"],[1,5],[1,5]),testJumplist("jumplist_`",["m","a","h","`","a","h","<C-i>"],[1,5],[1,5]),testJumplist("jumplist_*_cachedCursor",["*","<C-o>"],[1,3],[1,3]),testJumplist("jumplist_#_cachedCursor",["#","<C-o>"],[1,3],[1,3]),testJumplist("jumplist_n",["#","n","<C-o>"],[1,1],[2,3]),testJumplist("jumplist_N",["#","N","<C-o>"],[1,1],[2,3]),testJumplist("jumplist_repeat_<c-o>",["*","*","*","3","<C-o>"],[2,3],[2,3]),testJumplist("jumplist_repeat_<c-i>",["*","*","*","3","<C-o>","2","<C-i>"],[5,0],[2,3]),testJumplist("jumplist_repeated_motion",["3","*","<C-o>"],[2,3],[2,3]),testJumplist("jumplist_/",["/","<C-o>"],[2,3],[2,3],"dialog"),testJumplist("jumplist_?",["?","<C-o>"],[2,3],[2,3],"dialog"),testJumplist("jumplist_skip_delted_mark<c-o>",["*","n","n","k","d","k","<C-o>","<C-o>","<C-o>"],[0,2],[0,2]),testJumplist("jumplist_skip_delted_mark<c-i>",["*","n","n","k","d","k","<C-o>","<C-i>","<C-i>"],[1,0],[0,2]),testMotion("|","|",makeCursor(0,0),makeCursor(0,4)),testMotion("|_repeat",["3","|"],makeCursor(0,2),makeCursor(0,4)),testMotion("h","h",makeCursor(0,0),word1.start),testMotion("h_repeat",["3","h"],offsetCursor(word1.end,0,-3),word1.end),testMotion("l","l",makeCursor(0,1)),testMotion("l_repeat",["2","l"],makeCursor(0,2)),testMotion("j","j",offsetCursor(word1.end,1,0),word1.end),testMotion("j_repeat",["2","j"],offsetCursor(word1.end,2,0),word1.end),testMotion("k","k",offsetCursor(word3.end,-1,0),word3.end),testMotion("k_repeat",["2","k"],makeCursor(0,4),makeCursor(2,4)),testMotion("w","w",word1.start),testMotion("w_multiple_newlines_no_space","w",makeCursor(12,2),makeCursor(11,2)),testMotion("w_multiple_newlines_with_space","w",makeCursor(14,0),makeCursor(12,51)),testMotion("w_repeat",["2","w"],word2.start),testMotion("w_wrap",["w"],word3.start,word2.start),testMotion("w_endOfDocument","w",endOfDocument,endOfDocument),testMotion("w_start_to_end",["1000","w"],endOfDocument,makeCursor(0,0)),testMotion("W","W",bigWord1.start),testMotion("W_repeat",["2","W"],bigWord3.start,bigWord1.start),testMotion("e","e",word1.end),testMotion("e_repeat",["2","e"],word2.end),testMotion("e_wrap","e",word3.end,word2.end),testMotion("e_endOfDocument","e",endOfDocument,endOfDocument),testMotion("e_start_to_end",["1000","e"],endOfDocument,makeCursor(0,0)),testMotion("b","b",word3.start,word3.end),testMotion("b_repeat",["2","b"],word2.start,word3.end),testMotion("b_wrap","b",word2.start,word3.start),testMotion("b_startOfDocument","b",makeCursor(0,0),makeCursor(0,0)),testMotion("b_end_to_start",["1000","b"],makeCursor(0,0),endOfDocument),testMotion("ge",["g","e"],word2.end,word3.end),testMotion("ge_repeat",["2","g","e"],word1.end,word3.start),testMotion("ge_wrap",["g","e"],word2.end,word3.start),testMotion("ge_startOfDocument",["g","e"],makeCursor(0,0),makeCursor(0,0)),testMotion("ge_end_to_start",["1000","g","e"],makeCursor(0,0),endOfDocument),testMotion("gg",["g","g"],makeCursor(lines[0].line,lines[0].textStart),makeCursor(3,1)),testMotion("gg_repeat",["3","g","g"],makeCursor(lines[2].line,lines[2].textStart)),testMotion("G","G",makeCursor(lines[lines.length-1].line,lines[lines.length-1].textStart),makeCursor(3,1)),testMotion("G_repeat",["3","G"],makeCursor(lines[2].line,lines[2].textStart)),testMotion("0","0",makeCursor(0,0),makeCursor(0,8)),testMotion("^","^",makeCursor(0,lines[0].textStart),makeCursor(0,8)),testMotion("+","+",makeCursor(1,lines[1].textStart),makeCursor(0,8)),testMotion("-","-",makeCursor(0,lines[0].textStart),makeCursor(1,4)),testMotion("_",["6","_"],makeCursor(5,lines[5].textStart),makeCursor(0,8)),testMotion("$","$",makeCursor(0,lines[0].length-1),makeCursor(0,1)),testMotion("$_repeat",["2","$"],makeCursor(1,lines[1].length-1),makeCursor(0,3)),testMotion("f",["f","p"],pChars[0],makeCursor(charLine.line,0)),testMotion("f_repeat",["2","f","p"],pChars[2],pChars[0]),testMotion("f_num",["f","2"],numChars[2],makeCursor(charLine.line,0)),testMotion("t",["t","p"],offsetCursor(pChars[0],0,-1),makeCursor(charLine.line,0)),testMotion("t_repeat",["2","t","p"],offsetCursor(pChars[2],0,-1),pChars[0]),testMotion("F",["F","p"],pChars[0],pChars[1]),testMotion("F_repeat",["2","F","p"],pChars[0],pChars[2]),testMotion("T",["T","p"],offsetCursor(pChars[0],0,1),pChars[1]),testMotion("T_repeat",["2","T","p"],offsetCursor(pChars[0],0,1),pChars[2]),testMotion("%_parens",["%"],parens1.end,parens1.start),testMotion("%_squares",["%"],squares1.end,squares1.start),testMotion("%_braces",["%"],curlys1.end,curlys1.start),testMotion("%_seek_outside",["%"],seekOutside.end,seekOutside.start),testMotion("%_seek_inside",["%"],seekInside.end,seekInside.start),testVim("%_seek_skip",function(e,t,s){e.setCursor(0,0),s.doKeys(["%"]),s.assertCursorAt(0,9)},{value:'01234"("()'}),testVim("%_skip_string",function(e,t,s){e.setCursor(0,0),s.doKeys(["%"]),s.assertCursorAt(0,4),e.setCursor(0,2),s.doKeys(["%"]),s.assertCursorAt(0,0)},{value:'(")")'}),testVim("%_skip_comment",function(e,t,s){e.setCursor(0,0),s.doKeys(["%"]),s.assertCursorAt(0,6),e.setCursor(0,3),s.doKeys(["%"]),s.assertCursorAt(0,0)},{value:"(/*)*/)"}),testVim("Changing lines after Eol operation",function(e,t,s){e.setCursor(0,0),s.doKeys(["$"]),s.doKeys(["j"]),s.assertCursorAt({line:1,ch:lines[1].length-1}),s.doKeys(["j"]),s.assertCursorAt({line:2,ch:lines[2].length-1}),s.doKeys(["h"]),s.doKeys(["j"]),s.assertCursorAt({line:3,ch:lines[3].length-1}),s.doKeys(["j"]),s.doKeys(["j"]),s.assertCursorAt({line:5,ch:lines[2].length-2})}),testVim("gj_gk_clipping",function(e,t,s){e.setCursor(0,1),s.doKeys("g","j","g","j"),s.assertCursorAt(2,1),s.doKeys("g","k","g","k"),s.assertCursorAt(0,1)},{value:"line 1\n\nline 2"}),testVim("j_k_and_gj_gk",function(e,t,s){e.setSize(120),e.setCursor(0,0),s.doKeys("$"),s.doKeys("g","k");var r=e.getCursor();eq(r.line,0),is(r.ch<176,"gk didn't move cursor back (1)"),s.doKeys("g","j"),s.assertCursorAt(0,176),s.doKeys("j"),s.doKeys("3","g","k"),r=e.getCursor(),eq(r.line,1),is(r.ch<176,"gk didn't move cursor back (2)"),s.doKeys("g","j","2","g","j"),s.doKeys("k"),s.assertCursorAt(0,176)},{lineWrapping:!0,value:"This line is intentially long to test movement of gj and gk over wrapped lines. I will start on the end of this line, then make a step up and back to set the origin for j and k.\nThis line is supposed to be even longer than the previous. I will jump here and make another wiggle with gj and gk, before I jump back to the line above. Both wiggles should not change my cursor's target character but both j/k and gj/gk change each other's reference position."}),testVim("gj_gk",function(e,t,s){var r;phantom||(e.setSize(120),e.setCursor(0,4),s.doKeys("g","j"),s.doKeys("10","g","k"),s.assertCursorAt(0,4),s.doKeys("g","j"),r={line:0,ch:2*(e.getCursor().ch-4)+4},s.doKeys("g","j"),s.assertCursorAt(r),e.setCursor(0,0),s.doKeys("h"),s.doKeys("100","g","j"),r=e.getCursor(),is(0!=r,"gj should not be on wrapped line 0"),s=e.charCoords(makeCursor(0,0)),e=e.charCoords(r),is(s.left==e.left,"gj should end up on column 0"))},{lineNumbers:!1,lineWrapping:!0,value:"Thislineisintentiallylongtotestmovementofgjandgkoverwrappedlines."}),testVim("}",function(e,t,s){e.setCursor(0,0),s.doKeys("}"),s.assertCursorAt(1,0),e.setCursor(0,0),s.doKeys("2","}"),s.assertCursorAt(4,0),e.setCursor(0,0),s.doKeys("6","}"),s.assertCursorAt(5,0)},{value:"a\n\nb\nc\n\nd"}),testVim("{",function(e,t,s){e.setCursor(5,0),s.doKeys("{"),s.assertCursorAt(4,0),e.setCursor(5,0),s.doKeys("2","{"),s.assertCursorAt(1,0),e.setCursor(5,0),s.doKeys("6","{"),s.assertCursorAt(0,0)},{value:"a\n\nb\nc\n\nd"}),testVim("dl",function(e,t,s){var r=makeCursor(0,0),s=(e.setCursor(r),s.doKeys("d","l"),eq("word1 ",e.getValue()),s.getRegisterController().getRegister());eq(" ",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1 "}),testVim("dl_eol",function(e,t,s){var r=makeCursor(0,6),r=(e.setCursor(r),s.doKeys("d","l"),eq(" word1",e.getValue()),s.getRegisterController().getRegister());eq(" ",r.text),is(!r.linewise),s.assertCursorAt(0,6)},{value:" word1 "}),testVim("dl_repeat",function(e,t,s){var r=makeCursor(0,0),s=(e.setCursor(r),s.doKeys("2","d","l"),eq("ord1 ",e.getValue()),s.getRegisterController().getRegister());eq(" w",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1 "}),testVim("dh",function(e,t,s){var r=makeCursor(0,3),s=(e.setCursor(r),s.doKeys("d","h"),eq(" wrd1 ",e.getValue()),s.getRegisterController().getRegister());eq("o",s.text),is(!s.linewise),eqPos(offsetCursor(r,0,-1),e.getCursor())},{value:" word1 "}),testVim("dj",function(e,t,s){var r=makeCursor(0,3),r=(e.setCursor(r),s.doKeys("d","j"),eq(" word3",e.getValue()),s.getRegisterController().getRegister());eq(" word1\nword2\n",r.text),is(r.linewise),s.assertCursorAt(0,1)},{value:" word1\nword2\n word3"}),testVim("dj_end_of_document",function(e,t,s){var r=makeCursor(0,3),r=(e.setCursor(r),s.doKeys("d","j"),eq(" word1 ",e.getValue()),s.getRegisterController().getRegister());eq("",r.text),is(!r.linewise),s.assertCursorAt(0,3)},{value:" word1 "}),testVim("dk",function(e,t,s){var r=makeCursor(1,3),r=(e.setCursor(r),s.doKeys("d","k"),eq(" word3",e.getValue()),s.getRegisterController().getRegister());eq(" word1\nword2\n",r.text),is(r.linewise),s.assertCursorAt(0,1)},{value:" word1\nword2\n word3"}),testVim("dk_start_of_document",function(e,t,s){var r=makeCursor(0,3),r=(e.setCursor(r),s.doKeys("d","k"),eq(" word1 ",e.getValue()),s.getRegisterController().getRegister());eq("",r.text),is(!r.linewise),s.assertCursorAt(0,3)},{value:" word1 "}),testVim("dw_space",function(e,t,s){var r=makeCursor(0,0),s=(e.setCursor(r),s.doKeys("d","w"),eq("word1 ",e.getValue()),s.getRegisterController().getRegister());eq(" ",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1 "}),testVim("dw_word",function(e,t,s){var r=makeCursor(0,1),s=(e.setCursor(r),s.doKeys("d","w"),eq(" word2",e.getValue()),s.getRegisterController().getRegister());eq("word1 ",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1 word2"}),testVim("dw_only_word",function(e,t,s){var r=makeCursor(0,1),s=(e.setCursor(r),s.doKeys("d","w"),eq(" ",e.getValue()),s.getRegisterController().getRegister());eq("word1 ",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1 "}),testVim("dw_eol",function(e,t,s){var r=makeCursor(0,1),s=(e.setCursor(r),s.doKeys("d","w"),eq(" \nword2",e.getValue()),s.getRegisterController().getRegister());eq("word1",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1\nword2"}),testVim("dw_eol_with_multiple_newlines",function(e,t,s){var r=makeCursor(0,1),s=(e.setCursor(r),s.doKeys("d","w"),eq(" \n\nword2",e.getValue()),s.getRegisterController().getRegister());eq("word1",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1\n\nword2"}),testVim("dw_empty_line_followed_by_whitespace",function(e,t,s){e.setCursor(0,0),s.doKeys("d","w"),eq("  \nword",e.getValue())},{value:"\n  \nword"}),testVim("dw_empty_line_followed_by_word",function(e,t,s){e.setCursor(0,0),s.doKeys("d","w"),eq("word",e.getValue())},{value:"\nword"}),testVim("dw_empty_line_followed_by_empty_line",function(e,t,s){e.setCursor(0,0),s.doKeys("d","w"),eq("\n",e.getValue())},{value:"\n\n"}),testVim("dw_whitespace_followed_by_whitespace",function(e,t,s){e.setCursor(0,0),s.doKeys("d","w"),eq("\n   \n",e.getValue())},{value:"  \n   \n"}),testVim("dw_whitespace_followed_by_empty_line",function(e,t,s){e.setCursor(0,0),s.doKeys("d","w"),eq("\n\n",e.getValue())},{value:"  \n\n"}),testVim("dw_word_whitespace_word",function(e,t,s){e.setCursor(0,0),s.doKeys("d","w"),eq("\n   \nword2",e.getValue())},{value:"word1\n   \nword2"}),testVim("dw_end_of_document",function(e,t,s){e.setCursor(1,2),s.doKeys("d","w"),eq("\nab",e.getValue())},{value:"\nabc"}),testVim("dw_repeat",function(e,t,s){var r=makeCursor(0,1),s=(e.setCursor(r),s.doKeys("d","2","w"),eq(" ",e.getValue()),s.getRegisterController().getRegister());eq("word1\nword2",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1\nword2"}),testVim("de_word_start_and_empty_lines",function(e,t,s){e.setCursor(0,0),s.doKeys("d","e"),eq("\n\n",e.getValue())},{value:"word\n\n"}),testVim("de_word_end_and_empty_lines",function(e,t,s){e.setCursor(0,3),s.doKeys("d","e"),eq("wor",e.getValue())},{value:"word\n\n\n"}),testVim("de_whitespace_and_empty_lines",function(e,t,s){e.setCursor(0,0),s.doKeys("d","e"),eq("",e.getValue())},{value:"   \n\n\n"}),testVim("de_end_of_document",function(e,t,s){e.setCursor(1,2),s.doKeys("d","e"),eq("\nab",e.getValue())},{value:"\nabc"}),testVim("db_empty_lines",function(e,t,s){e.setCursor(2,0),s.doKeys("d","b"),eq("\n\n",e.getValue())},{value:"\n\n\n"}),testVim("db_word_start_and_empty_lines",function(e,t,s){e.setCursor(2,0),s.doKeys("d","b"),eq("\nword",e.getValue())},{value:"\n\nword"}),testVim("db_word_end_and_empty_lines",function(e,t,s){e.setCursor(2,3),s.doKeys("d","b"),eq("\n\nd",e.getValue())},{value:"\n\nword"}),testVim("db_whitespace_and_empty_lines",function(e,t,s){e.setCursor(2,0),s.doKeys("d","b"),eq("",e.getValue())},{value:"\n   \n"}),testVim("db_start_of_document",function(e,t,s){e.setCursor(0,0),s.doKeys("d","b"),eq("abc\n",e.getValue())},{value:"abc\n"}),testVim("dge_empty_lines",function(e,t,s){e.setCursor(1,0),s.doKeys("d","g","e"),eq("\n",e.getValue())},{value:"\n\n"}),testVim("dge_word_and_empty_lines",function(e,t,s){e.setCursor(1,0),s.doKeys("d","g","e"),eq("wor\n",e.getValue())},{value:"word\n\n"}),testVim("dge_whitespace_and_empty_lines",function(e,t,s){e.setCursor(2,0),s.doKeys("d","g","e"),eq("",e.getValue())},{value:"\n  \n"}),testVim("dge_start_of_document",function(e,t,s){e.setCursor(0,0),s.doKeys("d","g","e"),eq("bc\n",e.getValue())},{value:"abc\n"}),testVim("d_inclusive",function(e,t,s){var r=makeCursor(0,1),s=(e.setCursor(r),s.doKeys("d","e"),eq("  ",e.getValue()),s.getRegisterController().getRegister());eq("word1",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1 "}),testVim("d_reverse",function(e,t,s){e.setCursor(1,0),s.doKeys("d","b"),eq(" word2 ",e.getValue());e=s.getRegisterController().getRegister();eq("word1\n",e.text),is(!e.linewise),s.assertCursorAt(0,1)},{value:" word1\nword2 "}),testVim("dd",function(e,t,s){e.setCursor(0,3);var r=e.getRange({line:0,ch:0},{line:1,ch:0}),o=e.lineCount()-1,o=(s.doKeys("d","d"),eq(o,e.lineCount()),s.getRegisterController().getRegister());eq(r,o.text),is(o.linewise),s.assertCursorAt(0,lines[1].textStart)}),testVim("dd_prefix_repeat",function(e,t,s){e.setCursor(0,3);var r=e.getRange({line:0,ch:0},{line:2,ch:0}),o=e.lineCount()-2,o=(s.doKeys("2","d","d"),eq(o,e.lineCount()),s.getRegisterController().getRegister());eq(r,o.text),is(o.linewise),s.assertCursorAt(0,lines[2].textStart)}),testVim("dd_motion_repeat",function(e,t,s){e.setCursor(0,3);var r=e.getRange({line:0,ch:0},{line:2,ch:0}),o=e.lineCount()-2,o=(s.doKeys("d","2","d"),eq(o,e.lineCount()),s.getRegisterController().getRegister());eq(r,o.text),is(o.linewise),s.assertCursorAt(0,lines[2].textStart)}),testVim("dd_multiply_repeat",function(e,t,s){e.setCursor(0,3);var r=e.getRange({line:0,ch:0},{line:6,ch:0}),o=e.lineCount()-6,o=(s.doKeys("2","d","3","d"),eq(o,e.lineCount()),s.getRegisterController().getRegister());eq(r,o.text),is(o.linewise),s.assertCursorAt(0,lines[6].textStart)}),testVim("dd_lastline",function(e,t,s){e.setCursor(e.lineCount(),0);var r=e.lineCount()-1;s.doKeys("d","d"),eq(r,e.lineCount()),s.assertCursorAt(e.lineCount()-1,0)}),testVim("cw",function(e,t,s){e.setCursor(0,0),s.doKeys("c","2","w"),eq(" word3",e.getValue()),s.assertCursorAt(0,0)},{value:"word1 word2 word3"}),testVim("yw_repeat",function(e,t,s){var r=makeCursor(0,1),s=(e.setCursor(r),s.doKeys("y","2","w"),eq(" word1\nword2",e.getValue()),s.getRegisterController().getRegister());eq("word1\nword2",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1\nword2"}),testVim("yy_multiply_repeat",function(e,t,s){var r=makeCursor(0,3),o=(e.setCursor(r),e.getRange({line:0,ch:0},{line:6,ch:0})),n=e.lineCount(),n=(s.doKeys("2","y","3","y"),eq(n,e.lineCount()),s.getRegisterController().getRegister());eq(o,n.text),is(n.linewise),eqPos(r,e.getCursor())}),testVim("cw_repeat",function(e,t,s){var r=makeCursor(0,1),s=(e.setCursor(r),s.doKeys("c","2","w"),eq(" ",e.getValue()),s.getRegisterController().getRegister());eq("word1\nword2",s.text),is(!s.linewise),eqPos(r,e.getCursor()),eq("vim-insert",e.getOption("keyMap"))},{value:" word1\nword2"}),testVim("cc_multiply_repeat",function(e,t,s){e.setCursor(0,3);var r=e.getRange({line:0,ch:0},{line:6,ch:0}),o=e.lineCount()-5,o=(s.doKeys("2","c","3","c"),eq(o,e.lineCount()),s.getRegisterController().getRegister());eq(r,o.text),is(o.linewise),s.assertCursorAt(0,lines[0].textStart),eq("vim-insert",e.getOption("keyMap"))}),testVim("g~w_repeat",function(e,t,s){var r=makeCursor(0,1),s=(e.setCursor(r),s.doKeys("g","~","2","w"),eq(" WORD1\nWORD2",e.getValue()),s.getRegisterController().getRegister());eq("",s.text),is(!s.linewise),eqPos(r,e.getCursor())},{value:" word1\nword2"}),testVim("g~g~",function(e,t,s){var r=makeCursor(0,3),o=(e.setCursor(r),e.lineCount(),e.getValue().toUpperCase()),o=(s.doKeys("2","g","~","3","g","~"),eq(o,e.getValue()),s.getRegisterController().getRegister());eq("",o.text),is(!o.linewise),eqPos(r,e.getCursor())},{value:" word1\nword2\nword3\nword4\nword5\nword6"}),testVim(">{motion}",function(e,t,s){e.setCursor(1,3);e.lineCount();s.doKeys(">","k"),eq("   word1\n  word2\nword3 ",e.getValue());e=s.getRegisterController().getRegister();eq("",e.text),is(!e.linewise),s.assertCursorAt(0,3)},{value:" word1\nword2\nword3 ",indentUnit:2}),testVim(">>",function(e,t,s){e.setCursor(0,3);e.lineCount();s.doKeys("2",">",">"),eq("   word1\n  word2\nword3 ",e.getValue());e=s.getRegisterController().getRegister();eq("",e.text),is(!e.linewise),s.assertCursorAt(0,3)},{value:" word1\nword2\nword3 ",indentUnit:2}),testVim("<{motion}",function(e,t,s){e.setCursor(1,3);e.lineCount();s.doKeys("<","k"),eq(" word1\nword2\nword3 ",e.getValue());e=s.getRegisterController().getRegister();eq("",e.text),is(!e.linewise),s.assertCursorAt(0,1)},{value:"   word1\n  word2\nword3 ",indentUnit:2}),testVim("<<",function(e,t,s){e.setCursor(0,3);e.lineCount();s.doKeys("2","<","<"),eq(" word1\nword2\nword3 ",e.getValue());e=s.getRegisterController().getRegister();eq("",e.text),is(!e.linewise),s.assertCursorAt(0,1)},{value:"   word1\n  word2\nword3 ",indentUnit:2}),testEdit("diw_mid_spc","foo \tbAr\t baz",/A/,"diw","foo \t\t baz"),testEdit("daw_mid_spc","foo \tbAr\t baz",/A/,"daw","foo \tbaz"),testEdit("diw_mid_punct","foo \tbAr.\t baz",/A/,"diw","foo \t.\t baz"),testEdit("daw_mid_punct","foo \tbAr.\t baz",/A/,"daw","foo.\t baz"),testEdit("diw_mid_punct2","foo \t,bAr.\t baz",/A/,"diw","foo \t,.\t baz"),testEdit("daw_mid_punct2","foo \t,bAr.\t baz",/A/,"daw","foo \t,.\t baz"),testEdit("diw_start_spc","bAr \tbaz",/A/,"diw"," \tbaz"),testEdit("daw_start_spc","bAr \tbaz",/A/,"daw","baz"),testEdit("diw_start_punct","bAr. \tbaz",/A/,"diw",". \tbaz"),testEdit("daw_start_punct","bAr. \tbaz",/A/,"daw",". \tbaz"),testEdit("diw_end_spc","foo \tbAr",/A/,"diw","foo \t"),testEdit("daw_end_spc","foo \tbAr",/A/,"daw","foo"),testEdit("diw_end_punct","foo \tbAr.",/A/,"diw","foo \t."),testEdit("daw_end_punct","foo \tbAr.",/A/,"daw","foo."),testEdit("diW_mid_spc","foo \tbAr\t baz",/A/,"diW","foo \t\t baz"),testEdit("daW_mid_spc","foo \tbAr\t baz",/A/,"daW","foo \tbaz"),testEdit("diW_mid_punct","foo \tbAr.\t baz",/A/,"diW","foo \t\t baz"),testEdit("daW_mid_punct","foo \tbAr.\t baz",/A/,"daW","foo \tbaz"),testEdit("diW_mid_punct2","foo \t,bAr.\t baz",/A/,"diW","foo \t\t baz"),testEdit("daW_mid_punct2","foo \t,bAr.\t baz",/A/,"daW","foo \tbaz"),testEdit("diW_start_spc","bAr\t baz",/A/,"diW","\t baz"),testEdit("daW_start_spc","bAr\t baz",/A/,"daW","baz"),testEdit("diW_start_punct","bAr.\t baz",/A/,"diW","\t baz"),testEdit("daW_start_punct","bAr.\t baz",/A/,"daW","baz"),testEdit("diW_end_spc","foo \tbAr",/A/,"diW","foo \t"),testEdit("daW_end_spc","foo \tbAr",/A/,"daW","foo"),testEdit("diW_end_punct","foo \tbAr.",/A/,"diW","foo \t"),testEdit("daW_end_punct","foo \tbAr.",/A/,"daW","foo"),testVim("D",function(e,t,s){var r=makeCursor(0,3),r=(e.setCursor(r),s.doKeys("D"),eq(" wo\nword2\n word3",e.getValue()),s.getRegisterController().getRegister());eq("rd1",r.text),is(!r.linewise),s.assertCursorAt(0,3)},{value:" word1\nword2\n word3"}),testVim("C",function(e,t,s){var r=makeCursor(0,3),r=(e.setCursor(r),s.doKeys("C"),eq(" wo\nword2\n word3",e.getValue()),s.getRegisterController().getRegister());eq("rd1",r.text),is(!r.linewise),s.assertCursorAt(0,3),eq("vim-insert",e.getOption("keyMap"))},{value:" word1\nword2\n word3"}),testVim("Y",function(e,t,s){var r=makeCursor(0,3),r=(e.setCursor(r),s.doKeys("Y"),eq(" word1\nword2\n word3",e.getValue()),s.getRegisterController().getRegister());eq("rd1",r.text),is(!r.linewise),s.assertCursorAt(0,3)},{value:" word1\nword2\n word3"}),testVim("ctrl-a",function(e,t,s){e.setCursor(0,0),s.doKeys("<C-a>"),eq("-9",e.getValue()),s.assertCursorAt(0,1),s.doKeys("2","<C-a>"),eq("-7",e.getValue())},{value:"-10"}),testVim("ctrl-x",function(e,t,s){e.setCursor(0,0),s.doKeys("<C-x>"),eq("-1",e.getValue()),s.assertCursorAt(0,1),s.doKeys("2","<C-x>"),eq("-3",e.getValue())},{value:"0"}),testVim("<C-x>/<C-a> search forward",function(t,e,s){["<C-x>","<C-a>"].forEach(function(e){t.setCursor(0,0),s.doKeys(e),s.assertCursorAt(0,5),s.doKeys("l"),s.doKeys(e),s.assertCursorAt(0,10),t.setCursor(0,11),s.doKeys(e),s.assertCursorAt(0,11)})},{value:"__jmp1 jmp2 jmp"}),testVim("a",function(e,t,s){e.setCursor(0,1),s.doKeys("a"),s.assertCursorAt(0,2),eq("vim-insert",e.getOption("keyMap"))}),testVim("a_eol",function(e,t,s){e.setCursor(0,lines[0].length-1),s.doKeys("a"),s.assertCursorAt(0,lines[0].length),eq("vim-insert",e.getOption("keyMap"))}),testVim("i",function(e,t,s){e.setCursor(0,1),s.doKeys("i"),s.assertCursorAt(0,1),eq("vim-insert",e.getOption("keyMap"))}),testVim("i_repeat",function(e,t,s){s.doKeys("3","i"),e.replaceRange("test",e.getCursor()),s.doInsertModeKeys("Esc"),eq("testtesttest",e.getValue()),s.assertCursorAt(0,11)},{value:""}),testVim("i_repeat_delete",function(e,t,s){e.setCursor(0,4),s.doKeys("2","i"),e.replaceRange("z",e.getCursor()),s.doInsertModeKeys("Backspace","Backspace","Esc"),eq("abe",e.getValue()),s.assertCursorAt(0,1)},{value:"abcde"}),testVim("A",function(e,t,s){s.doKeys("A"),s.assertCursorAt(0,lines[0].length),eq("vim-insert",e.getOption("keyMap"))}),testVim("I",function(e,t,s){e.setCursor(0,4),s.doKeys("I"),s.assertCursorAt(0,lines[0].textStart),eq("vim-insert",e.getOption("keyMap"))}),testVim("I_repeat",function(e,t,s){e.setCursor(0,1),s.doKeys("3","I"),e.replaceRange("test",e.getCursor()),s.doInsertModeKeys("Esc"),eq("testtesttestblah",e.getValue()),s.assertCursorAt(0,11)},{value:"blah"}),testVim("o",function(e,t,s){e.setCursor(0,4),s.doKeys("o"),eq("word1\n\nword2",e.getValue()),s.assertCursorAt(1,0),eq("vim-insert",e.getOption("keyMap"))},{value:"word1\nword2"}),testVim("o_repeat",function(e,t,s){e.setCursor(0,0),s.doKeys("3","o"),e.replaceRange("test",e.getCursor()),s.doInsertModeKeys("Esc"),eq("\ntest\ntest\ntest",e.getValue()),s.assertCursorAt(3,3)},{value:""}),testVim("O",function(e,t,s){e.setCursor(0,4),s.doKeys("O"),eq("\nword1\nword2",e.getValue()),s.assertCursorAt(0,0),eq("vim-insert",e.getOption("keyMap"))},{value:"word1\nword2"}),testVim("J",function(e,t,s){e.setCursor(0,4),s.doKeys("J");var r="word1  word2\nword3\n word4";eq(r,e.getValue()),s.assertCursorAt(0,r.indexOf("word2")-1)},{value:"word1 \n    word2\nword3\n word4"}),testVim("J_repeat",function(e,t,s){e.setCursor(0,4),s.doKeys("3","J");var r="word1  word2 word3\n word4";eq(r,e.getValue()),s.assertCursorAt(0,r.indexOf("word3")-1)},{value:"word1 \n    word2\nword3\n word4"}),testVim("p",function(e,t,s){e.setCursor(0,1),s.getRegisterController().pushText('"',"yank","abc\ndef",!1),s.doKeys("p"),eq("__abc\ndef_",e.getValue()),s.assertCursorAt(1,2)},{value:"___"}),testVim("p_register",function(e,t,s){e.setCursor(0,1),s.getRegisterController().getRegister("a").set("abc\ndef",!1),s.doKeys('"',"a","p"),eq("__abc\ndef_",e.getValue()),s.assertCursorAt(1,2)},{value:"___"}),testVim("p_wrong_register",function(e,t,s){e.setCursor(0,1),s.getRegisterController().getRegister("a").set("abc\ndef",!1),s.doKeys("p"),eq("___",e.getValue()),s.assertCursorAt(0,1)},{value:"___"}),testVim("p_line",function(e,t,s){e.setCursor(0,1),s.getRegisterController().pushText('"',"yank","  a\nd\n",!0),s.doKeys("2","p"),eq("___\n  a\nd\n  a\nd",e.getValue()),s.assertCursorAt(1,2)},{value:"___"}),testVim("P",function(e,t,s){e.setCursor(0,1),s.getRegisterController().pushText('"',"yank","abc\ndef",!1),s.doKeys("P"),eq("_abc\ndef__",e.getValue()),s.assertCursorAt(1,3)},{value:"___"}),testVim("P_line",function(e,t,s){e.setCursor(0,1),s.getRegisterController().pushText('"',"yank","  a\nd\n",!0),s.doKeys("2","P"),eq("  a\nd\n  a\nd\n___",e.getValue()),s.assertCursorAt(0,2)},{value:"___"}),testVim("r",function(e,t,s){e.setCursor(0,1),s.doKeys("3","r","u"),eq("wuuuet\nanother",e.getValue(),"3r failed"),s.assertCursorAt(0,3),e.setCursor(0,4),s.doKeys("v","j","h","r","<Space>"),eq("wuuu  \n    her",e.getValue(),"Replacing selection by space-characters failed")},{value:"wordet\nanother"}),testVim("R",function(e,t,s){e.setCursor(0,1),s.doKeys("R"),s.assertCursorAt(0,1),eq("vim-replace",e.getOption("keyMap")),is(e.state.overwrite,"Setting overwrite state failed")}),testVim("mark",function(e,t,s){e.setCursor(2,2),s.doKeys("m","t"),e.setCursor(0,0),s.doKeys("'","t"),s.assertCursorAt(2,2),e.setCursor(0,0),s.doKeys("`","t"),s.assertCursorAt(2,2)}),testVim("jumpToMark_next",function(e,t,s){e.setCursor(2,2),s.doKeys("m","t"),e.setCursor(0,0),s.doKeys("]","`"),s.assertCursorAt(2,2),e.setCursor(0,0),s.doKeys("]","'"),s.assertCursorAt(2,0)}),testVim("jumpToMark_next_repeat",function(e,t,s){e.setCursor(2,2),s.doKeys("m","a"),e.setCursor(3,2),s.doKeys("m","b"),e.setCursor(4,2),s.doKeys("m","c"),e.setCursor(0,0),s.doKeys("2","]","`"),s.assertCursorAt(3,2),e.setCursor(0,0),s.doKeys("2","]","'"),s.assertCursorAt(3,1)}),testVim("jumpToMark_next_sameline",function(e,t,s){e.setCursor(2,0),s.doKeys("m","a"),e.setCursor(2,4),s.doKeys("m","b"),e.setCursor(2,2),s.doKeys("]","`"),s.assertCursorAt(2,4)}),testVim("jumpToMark_next_onlyprev",function(e,t,s){e.setCursor(2,0),s.doKeys("m","a"),e.setCursor(4,0),s.doKeys("]","`"),s.assertCursorAt(4,0)}),testVim("jumpToMark_next_nomark",function(e,t,s){e.setCursor(2,2),s.doKeys("]","`"),s.assertCursorAt(2,2),s.doKeys("]","'"),s.assertCursorAt(2,0)}),testVim("jumpToMark_next_linewise_over",function(e,t,s){e.setCursor(2,2),s.doKeys("m","a"),e.setCursor(3,4),s.doKeys("m","b"),e.setCursor(2,1),s.doKeys("]","'"),s.assertCursorAt(3,1)}),testVim("jumpToMark_next_action",function(e,t,s){e.setCursor(2,2),s.doKeys("m","t"),e.setCursor(0,0),s.doKeys("d","]","`"),s.assertCursorAt(0,0);s=e.getLine(0);eq(s,"pop pop 0 1 2 3 4","Deleting while jumping to the next mark failed.")}),testVim("jumpToMark_next_line_action",function(e,t,s){e.setCursor(2,2),s.doKeys("m","t"),e.setCursor(0,0),s.doKeys("d","]","'"),s.assertCursorAt(0,1);s=e.getLine(0);eq(s," (a) [b] {c} ","Deleting while jumping to the next mark line failed.")}),testVim("jumpToMark_prev",function(e,t,s){e.setCursor(2,2),s.doKeys("m","t"),e.setCursor(4,0),s.doKeys("[","`"),s.assertCursorAt(2,2),e.setCursor(4,0),s.doKeys("[","'"),s.assertCursorAt(2,0)}),testVim("jumpToMark_prev_repeat",function(e,t,s){e.setCursor(2,2),s.doKeys("m","a"),e.setCursor(3,2),s.doKeys("m","b"),e.setCursor(4,2),s.doKeys("m","c"),e.setCursor(5,0),s.doKeys("2","[","`"),s.assertCursorAt(3,2),e.setCursor(5,0),s.doKeys("2","[","'"),s.assertCursorAt(3,1)}),testVim("jumpToMark_prev_sameline",function(e,t,s){e.setCursor(2,0),s.doKeys("m","a"),e.setCursor(2,4),s.doKeys("m","b"),e.setCursor(2,2),s.doKeys("[","`"),s.assertCursorAt(2,0)}),testVim("jumpToMark_prev_onlynext",function(e,t,s){e.setCursor(4,4),s.doKeys("m","a"),e.setCursor(2,0),s.doKeys("[","`"),s.assertCursorAt(2,0)}),testVim("jumpToMark_prev_nomark",function(e,t,s){e.setCursor(2,2),s.doKeys("[","`"),s.assertCursorAt(2,2),s.doKeys("[","'"),s.assertCursorAt(2,0)}),testVim("jumpToMark_prev_linewise_over",function(e,t,s){e.setCursor(2,2),s.doKeys("m","a"),e.setCursor(3,4),s.doKeys("m","b"),e.setCursor(3,6),s.doKeys("[","'"),s.assertCursorAt(2,0)}),testVim("delmark_single",function(e,t,s){e.setCursor(1,2),s.doKeys("m","t"),s.doEx("delmarks t"),e.setCursor(0,0),s.doKeys("`","t"),s.assertCursorAt(0,0)}),testVim("delmark_range",function(e,t,s){e.setCursor(1,2),s.doKeys("m","a"),e.setCursor(2,2),s.doKeys("m","b"),e.setCursor(3,2),s.doKeys("m","c"),e.setCursor(4,2),s.doKeys("m","d"),e.setCursor(5,2),s.doKeys("m","e"),s.doEx("delmarks b-d"),e.setCursor(0,0),s.doKeys("`","a"),s.assertCursorAt(1,2),s.doKeys("`","b"),s.assertCursorAt(1,2),s.doKeys("`","c"),s.assertCursorAt(1,2),s.doKeys("`","d"),s.assertCursorAt(1,2),s.doKeys("`","e"),s.assertCursorAt(5,2)}),testVim("delmark_multi",function(e,t,s){e.setCursor(1,2),s.doKeys("m","a"),e.setCursor(2,2),s.doKeys("m","b"),e.setCursor(3,2),s.doKeys("m","c"),e.setCursor(4,2),s.doKeys("m","d"),e.setCursor(5,2),s.doKeys("m","e"),s.doEx("delmarks bcd"),e.setCursor(0,0),s.doKeys("`","a"),s.assertCursorAt(1,2),s.doKeys("`","b"),s.assertCursorAt(1,2),s.doKeys("`","c"),s.assertCursorAt(1,2),s.doKeys("`","d"),s.assertCursorAt(1,2),s.doKeys("`","e"),s.assertCursorAt(5,2)}),testVim("delmark_multi_space",function(e,t,s){e.setCursor(1,2),s.doKeys("m","a"),e.setCursor(2,2),s.doKeys("m","b"),e.setCursor(3,2),s.doKeys("m","c"),e.setCursor(4,2),s.doKeys("m","d"),e.setCursor(5,2),s.doKeys("m","e"),s.doEx("delmarks b c d"),e.setCursor(0,0),s.doKeys("`","a"),s.assertCursorAt(1,2),s.doKeys("`","b"),s.assertCursorAt(1,2),s.doKeys("`","c"),s.assertCursorAt(1,2),s.doKeys("`","d"),s.assertCursorAt(1,2),s.doKeys("`","e"),s.assertCursorAt(5,2)}),testVim("delmark_all",function(e,t,s){e.setCursor(1,2),s.doKeys("m","a"),e.setCursor(2,2),s.doKeys("m","b"),e.setCursor(3,2),s.doKeys("m","c"),e.setCursor(4,2),s.doKeys("m","d"),e.setCursor(5,2),s.doKeys("m","e"),s.doEx("delmarks a b-de"),e.setCursor(0,0),s.doKeys("`","a"),s.assertCursorAt(0,0),s.doKeys("`","b"),s.assertCursorAt(0,0),s.doKeys("`","c"),s.assertCursorAt(0,0),s.doKeys("`","d"),s.assertCursorAt(0,0),s.doKeys("`","e"),s.assertCursorAt(0,0)}),testVim("visual",function(e,t,s){s.doKeys("l","v","l","l"),s.assertCursorAt(0,3),eqPos(makeCursor(0,1),e.getCursor("anchor")),s.doKeys("d"),eq("15",e.getValue())},{value:"12345"}),testVim("visual_line",function(e,t,s){s.doKeys("l","V","l","j","j","d"),eq(" 4\n 5",e.getValue())},{value:" 1\n 2\n 3\n 4\n 5"}),testVim("visual_marks",function(e,t,s){s.doKeys("l","v","l","l","v"),e.setCursor(0,0),s.doKeys("'","<"),s.assertCursorAt(0,1),s.doKeys("'",">"),s.assertCursorAt(0,3)}),testVim("visual_join",function(e,t,s){s.doKeys("l","V","l","j","j","J"),eq(" 1 2 3\n 4\n 5",e.getValue())},{value:" 1\n 2\n 3\n 4\n 5"}),testVim("/ and n/N",function(e,t,s){e.openDialog=s.fakeOpenDialog("match"),s.doKeys("/"),s.assertCursorAt(0,11),s.doKeys("n"),s.assertCursorAt(1,6),s.doKeys("N"),s.assertCursorAt(0,11),e.setCursor(0,0),s.doKeys("2","/"),s.assertCursorAt(1,6)},{value:"match nope match \n nope Match"}),testVim("/_case",function(e,t,s){e.openDialog=s.fakeOpenDialog("Match"),s.doKeys("/"),s.assertCursorAt(1,6)},{value:"match nope match \n nope Match"}),testVim("/_nongreedy",function(e,t,s){e.openDialog=s.fakeOpenDialog("aa"),s.doKeys("/"),s.assertCursorAt(0,4),s.doKeys("n"),s.assertCursorAt(1,3),s.doKeys("n"),s.assertCursorAt(0,0)},{value:"aaa aa \n a aa"}),testVim("?_nongreedy",function(e,t,s){e.openDialog=s.fakeOpenDialog("aa"),s.doKeys("?"),s.assertCursorAt(1,3),s.doKeys("n"),s.assertCursorAt(0,4),s.doKeys("n"),s.assertCursorAt(0,0)},{value:"aaa aa \n a aa"}),testVim("/_greedy",function(e,t,s){e.openDialog=s.fakeOpenDialog("a+"),s.doKeys("/"),s.assertCursorAt(0,4),s.doKeys("n"),s.assertCursorAt(1,1),s.doKeys("n"),s.assertCursorAt(1,3),s.doKeys("n"),s.assertCursorAt(0,0)},{value:"aaa aa \n a aa"}),testVim("?_greedy",function(e,t,s){e.openDialog=s.fakeOpenDialog("a+"),s.doKeys("?"),s.assertCursorAt(1,3),s.doKeys("n"),s.assertCursorAt(1,1),s.doKeys("n"),s.assertCursorAt(0,4),s.doKeys("n"),s.assertCursorAt(0,0)},{value:"aaa aa \n a aa"}),testVim("/_greedy_0_or_more",function(e,t,s){e.openDialog=s.fakeOpenDialog("a*"),s.doKeys("/"),s.assertCursorAt(0,3),s.doKeys("n"),s.assertCursorAt(0,4),s.doKeys("n"),s.assertCursorAt(0,5),s.doKeys("n"),s.assertCursorAt(1,0),s.doKeys("n"),s.assertCursorAt(1,1),s.doKeys("n"),s.assertCursorAt(0,0)},{value:"aaa  aa\n aa"}),testVim("?_greedy_0_or_more",function(e,t,s){e.openDialog=s.fakeOpenDialog("a*"),s.doKeys("?"),s.assertCursorAt(1,1),s.doKeys("n"),s.assertCursorAt(1,0),s.doKeys("n"),s.assertCursorAt(0,5),s.doKeys("n"),s.assertCursorAt(0,4),s.doKeys("n"),s.assertCursorAt(0,3),s.doKeys("n"),s.assertCursorAt(0,0)},{value:"aaa  aa\n aa"}),testVim("? and n/N",function(e,t,s){e.openDialog=s.fakeOpenDialog("match"),s.doKeys("?"),s.assertCursorAt(1,6),s.doKeys("n"),s.assertCursorAt(0,11),s.doKeys("N"),s.assertCursorAt(1,6),e.setCursor(0,0),s.doKeys("2","?"),s.assertCursorAt(0,11)},{value:"match nope match \n nope Match"}),testVim("*",function(e,t,s){e.setCursor(0,9),s.doKeys("*"),s.assertCursorAt(0,22),e.setCursor(0,9),s.doKeys("2","*"),s.assertCursorAt(1,8)},{value:"nomatch match nomatch match \nnomatch Match"}),testVim("*_no_word",function(e,t,s){e.setCursor(0,0),s.doKeys("*"),s.assertCursorAt(0,0)},{value:" \n match \n"}),testVim("*_symbol",function(e,t,s){e.setCursor(0,0),s.doKeys("*"),s.assertCursorAt(1,0)},{value:" /}\n/} match \n"}),testVim("#",function(e,t,s){e.setCursor(0,9),s.doKeys("#"),s.assertCursorAt(1,8),e.setCursor(0,9),s.doKeys("2","#"),s.assertCursorAt(0,22)},{value:"nomatch match nomatch match \nnomatch Match"}),testVim("*_seek",function(e,t,s){e.setCursor(0,3),s.doKeys("*"),s.assertCursorAt(0,22)},{value:"    :=  match nomatch match \nnomatch Match"}),testVim("#",function(e,t,s){e.setCursor(0,3),s.doKeys("#"),s.assertCursorAt(1,8)},{value:"    :=  match nomatch match \nnomatch Match"}),testVim(".",function(e,t,s){e.setCursor(0,0),s.doKeys("2","d","w"),s.doKeys("."),eq("5 6",e.getValue())},{value:"1 2 3 4 5 6"}),testVim("._repeat",function(e,t,s){e.setCursor(0,0),s.doKeys("2","d","w"),s.doKeys("3","."),eq("6",e.getValue())},{value:"1 2 3 4 5 6"}),testVim("._insert",function(e,t,s){s.doKeys("i"),e.replaceRange("test",e.getCursor()),s.doInsertModeKeys("Esc"),s.doKeys("."),eq("testestt",e.getValue()),s.assertCursorAt(0,6)},{value:""}),testVim("._insert_repeat",function(e,t,s){s.doKeys("i"),e.replaceRange("test",e.getCursor()),e.setCursor(0,4),s.doInsertModeKeys("Esc"),s.doKeys("2","."),eq("testesttestt",e.getValue()),s.assertCursorAt(0,10)},{value:""}),testVim("._repeat_insert",function(e,t,s){s.doKeys("3","i"),e.replaceRange("te",e.getCursor()),e.setCursor(0,2),s.doInsertModeKeys("Esc"),s.doKeys("."),eq("tetettetetee",e.getValue()),s.assertCursorAt(0,10)},{value:""}),testVim("._insert_o",function(e,t,s){s.doKeys("o"),e.replaceRange("z",e.getCursor()),e.setCursor(1,1),s.doInsertModeKeys("Esc"),s.doKeys("."),eq("\nz\nz",e.getValue()),s.assertCursorAt(2,0)},{value:""}),testVim("._insert_o_repeat",function(e,t,s){s.doKeys("o"),e.replaceRange("z",e.getCursor()),s.doInsertModeKeys("Esc"),e.setCursor(1,0),s.doKeys("2","."),eq("\nz\nz\nz",e.getValue()),s.assertCursorAt(3,0)},{value:""}),testVim("._insert_o_indent",function(e,t,s){s.doKeys("o"),e.replaceRange("z",e.getCursor()),s.doInsertModeKeys("Esc"),e.setCursor(1,2),s.doKeys("."),eq("{\n  z\n  z",e.getValue()),s.assertCursorAt(2,2)},{value:"{"}),testVim("._insert_cw",function(e,t,s){s.doKeys("c","w"),e.replaceRange("test",e.getCursor()),s.doInsertModeKeys("Esc"),e.setCursor(0,3),s.doKeys("2","l"),s.doKeys("."),eq("test test word3",e.getValue()),s.assertCursorAt(0,8)},{value:"word1 word2 word3"}),testVim("._insert_cw_repeat",function(e,t,s){s.doKeys("c","w"),e.replaceRange("test",e.getCursor()),s.doInsertModeKeys("Esc"),e.setCursor(0,4),s.doKeys("l"),s.doKeys("2","."),eq("test test",e.getValue()),s.assertCursorAt(0,8)},{value:"word1 word2 word3"}),testVim("._delete",function(e,t,s){e.setCursor(0,5),s.doKeys("i"),s.doInsertModeKeys("Backspace","Esc"),s.doKeys("."),eq("zace",e.getValue()),s.assertCursorAt(0,1)},{value:"zabcde"}),testVim("._delete_repeat",function(e,t,s){e.setCursor(0,6),s.doKeys("i"),s.doInsertModeKeys("Backspace","Esc"),s.doKeys("2","."),eq("zzce",e.getValue()),s.assertCursorAt(0,1)},{value:"zzabcde"}),testVim("f;",function(e,t,s){e.setCursor(0,0),s.doKeys("f","x"),s.doKeys(";"),s.doKeys("2",";"),eq(9,e.getCursor().ch)},{value:"01x3xx678x"}),testVim("F;",function(e,t,s){e.setCursor(0,8),s.doKeys("F","x"),s.doKeys(";"),s.doKeys("2",";"),eq(2,e.getCursor().ch)},{value:"01x3xx6x8x"}),testVim("t;",function(e,t,s){e.setCursor(0,0),s.doKeys("t","x"),s.doKeys(";"),s.doKeys("2",";"),eq(8,e.getCursor().ch)},{value:"01x3xx678x"}),testVim("T;",function(e,t,s){e.setCursor(0,9),s.doKeys("T","x"),s.doKeys(";"),s.doKeys("2",";"),eq(2,e.getCursor().ch)},{value:"0xx3xx678x"}),testVim("f,",function(e,t,s){e.setCursor(0,6),s.doKeys("f","x"),s.doKeys(","),s.doKeys("2",","),eq(2,e.getCursor().ch)},{value:"01x3xx678x"}),testVim("F,",function(e,t,s){e.setCursor(0,3),s.doKeys("F","x"),s.doKeys(","),s.doKeys("2",","),eq(9,e.getCursor().ch)},{value:"01x3xx678x"}),testVim("t,",function(e,t,s){e.setCursor(0,6),s.doKeys("t","x"),s.doKeys(","),s.doKeys("2",","),eq(3,e.getCursor().ch)},{value:"01x3xx678x"}),testVim("T,",function(e,t,s){e.setCursor(0,4),s.doKeys("T","x"),s.doKeys(","),s.doKeys("2",","),eq(8,e.getCursor().ch)},{value:"01x3xx67xx"}),testVim("fd,;",function(e,t,s){e.setCursor(0,0),s.doKeys("f","4"),e.setCursor(0,0),s.doKeys("d",";"),eq("56789",e.getValue()),s.doKeys("u"),e.setCursor(0,9),s.doKeys("d",","),eq("01239",e.getValue())},{value:"0123456789"}),testVim("Fd,;",function(e,t,s){e.setCursor(0,9),s.doKeys("F","4"),e.setCursor(0,9),s.doKeys("d",";"),eq("01239",e.getValue()),s.doKeys("u"),e.setCursor(0,0),s.doKeys("d",","),eq("56789",e.getValue())},{value:"0123456789"}),testVim("td,;",function(e,t,s){e.setCursor(0,0),s.doKeys("t","4"),e.setCursor(0,0),s.doKeys("d",";"),eq("456789",e.getValue()),s.doKeys("u"),e.setCursor(0,9),s.doKeys("d",","),eq("012349",e.getValue())},{value:"0123456789"}),testVim("Td,;",function(e,t,s){e.setCursor(0,9),s.doKeys("T","4"),e.setCursor(0,9),s.doKeys("d",";"),eq("012349",e.getValue()),s.doKeys("u"),e.setCursor(0,0),s.doKeys("d",","),eq("456789",e.getValue())},{value:"0123456789"}),testVim("fc,;",function(e,t,s){e.setCursor(0,0),s.doKeys("f","4"),e.setCursor(0,0),s.doKeys("c",";","Esc"),eq("56789",e.getValue()),s.doKeys("u"),e.setCursor(0,9),s.doKeys("c",","),eq("01239",e.getValue())},{value:"0123456789"}),testVim("Fc,;",function(e,t,s){e.setCursor(0,9),s.doKeys("F","4"),e.setCursor(0,9),s.doKeys("c",";","Esc"),eq("01239",e.getValue()),s.doKeys("u"),e.setCursor(0,0),s.doKeys("c",","),eq("56789",e.getValue())},{value:"0123456789"}),testVim("tc,;",function(e,t,s){e.setCursor(0,0),s.doKeys("t","4"),e.setCursor(0,0),s.doKeys("c",";","Esc"),eq("456789",e.getValue()),s.doKeys("u"),e.setCursor(0,9),s.doKeys("c",","),eq("012349",e.getValue())},{value:"0123456789"}),testVim("Tc,;",function(e,t,s){e.setCursor(0,9),s.doKeys("T","4"),e.setCursor(0,9),s.doKeys("c",";","Esc"),eq("012349",e.getValue()),s.doKeys("u"),e.setCursor(0,0),s.doKeys("c",","),eq("456789",e.getValue())},{value:"0123456789"}),testVim("fy,;",function(e,t,s){e.setCursor(0,0),s.doKeys("f","4"),e.setCursor(0,0),s.doKeys("y",";","P"),eq("012340123456789",e.getValue()),s.doKeys("u"),e.setCursor(0,9),s.doKeys("y",",","P"),eq("012345678456789",e.getValue())},{value:"0123456789"}),testVim("Fy,;",function(e,t,s){e.setCursor(0,9),s.doKeys("F","4"),e.setCursor(0,9),s.doKeys("y",";","p"),eq("012345678945678",e.getValue()),s.doKeys("u"),e.setCursor(0,0),s.doKeys("y",",","P"),eq("012340123456789",e.getValue())},{value:"0123456789"}),testVim("ty,;",function(e,t,s){e.setCursor(0,0),s.doKeys("t","4"),e.setCursor(0,0),s.doKeys("y",";","P"),eq("01230123456789",e.getValue()),s.doKeys("u"),e.setCursor(0,9),s.doKeys("y",",","p"),eq("01234567895678",e.getValue())},{value:"0123456789"}),testVim("Ty,;",function(e,t,s){e.setCursor(0,9),s.doKeys("T","4"),e.setCursor(0,9),s.doKeys("y",";","p"),eq("01234567895678",e.getValue()),s.doKeys("u"),e.setCursor(0,0),s.doKeys("y",",","P"),eq("01230123456789",e.getValue())},{value:"0123456789"}),testVim("HML",function(e,t,s){var r=e.defaultTextHeight();e.setSize(600,35*r),e.setCursor(120,0),s.doKeys("H"),s.assertCursorAt(86,2),s.doKeys("L"),s.assertCursorAt(120,4),s.doKeys("M"),s.assertCursorAt(103,4)},{value:function(){var e=new Array(100);return e.join("  xx\n")+e.join("    xx\n")}()});var zVals=["zb","zz","zt","z-","z.","z<CR>"].map(function(a,u){testVim(a,function(e,t,s){var r=a[0],o=a.substring(1),n=e.defaultTextHeight();e.setSize(600,35*n),e.setCursor(250,0),s.doKeys(r,o),zVals[u]=e.getScrollInfo().top},{value:new Array(500).join("\n")})}),squareBracketMotionSandbox=(testVim("zb<zz",function(e,t,s){eq(zVals[0]<zVals[1],!0)}),testVim("zz<zt",function(e,t,s){eq(zVals[1]<zVals[2],!0)}),testVim("zb==z-",function(e,t,s){eq(zVals[0],zVals[3])}),testVim("zz==z.",function(e,t,s){eq(zVals[1],zVals[4])}),testVim("zt==z<CR>",function(e,t,s){eq(zVals[2],zVals[5])}),"({\n  ({\n  /*comment {\n            */(\n#else                \n  /*       )\n#if        }\n  )}*/\n)}\n{}\n#else {{\n{}\n}\n{\n#endif\n}\n}\n#else");function testSubstituteConfirm(e,l,t,C,c,m){testVim(e,function(e,t,s){var r,o,n=e.openDialog,a=CodeMirror.keyName,u=!0;function i(){u=!0}e.openDialog=function(e,t,s){o=t},s.doKeys(":"),e.openDialog=function(e,t,s){r=s.onKeyDown,u=!1},o(l),CodeMirror.keyName=function(e){return e.key},c=c.toUpperCase();for(var d=0;d<c.length;d++)is(!u),r({key:c.charAt(d)},"",i);try{eq(C,e.getValue()),s.assertCursorAt(m),is(u)}catch(e){throw e}finally{CodeMirror.keyName=a,e.openDialog=n}},{value:t})}testVim("[[, ]]",function(e,t,s){e.setCursor(0,0),s.doKeys("]","]"),s.assertCursorAt(9,0),s.doKeys("2","]","]"),s.assertCursorAt(13,0),s.doKeys("]","]"),s.assertCursorAt(17,0),s.doKeys("[","["),s.assertCursorAt(13,0),s.doKeys("2","[","["),s.assertCursorAt(9,0),s.doKeys("[","["),s.assertCursorAt(0,0)},{value:squareBracketMotionSandbox}),testVim("[], ][",function(e,t,s){e.setCursor(0,0),s.doKeys("]","["),s.assertCursorAt(12,0),s.doKeys("2","]","["),s.assertCursorAt(16,0),s.doKeys("]","["),s.assertCursorAt(17,0),s.doKeys("[","]"),s.assertCursorAt(16,0),s.doKeys("2","[","]"),s.assertCursorAt(12,0),s.doKeys("[","]"),s.assertCursorAt(0,0)},{value:squareBracketMotionSandbox}),testVim("[{, ]}",function(e,t,s){e.setCursor(4,10),s.doKeys("[","{"),s.assertCursorAt(2,12),s.doKeys("2","[","{"),s.assertCursorAt(0,1),e.setCursor(4,10),s.doKeys("]","}"),s.assertCursorAt(6,11),s.doKeys("2","]","}"),s.assertCursorAt(8,1),e.setCursor(0,1),s.doKeys("]","}"),s.assertCursorAt(8,1),s.doKeys("[","{"),s.assertCursorAt(0,1)},{value:squareBracketMotionSandbox}),testVim("[(, ])",function(e,t,s){e.setCursor(4,10),s.doKeys("[","("),s.assertCursorAt(3,14),s.doKeys("2","[","("),s.assertCursorAt(0,0),e.setCursor(4,10),s.doKeys("]",")"),s.assertCursorAt(5,11),s.doKeys("2","]",")"),s.assertCursorAt(8,0),s.doKeys("[","("),s.assertCursorAt(0,0),s.doKeys("]",")"),s.assertCursorAt(8,0)},{value:squareBracketMotionSandbox}),testVim("[*, ]*, [/, ]/",function(t,e,s){["*","/"].forEach(function(e){t.setCursor(7,0),s.doKeys("2","[",e),s.assertCursorAt(2,2),s.doKeys("2","]",e),s.assertCursorAt(7,5)})},{value:squareBracketMotionSandbox}),testVim("[#, ]#",function(e,t,s){e.setCursor(10,3),s.doKeys("2","[","#"),s.assertCursorAt(4,0),s.doKeys("5","]","#"),s.assertCursorAt(17,0),e.setCursor(10,3),s.doKeys("]","#"),s.assertCursorAt(14,0)},{value:squareBracketMotionSandbox}),testVim("[m, ]m, [M, ]M",function(e,t,s){e.setCursor(11,0),s.doKeys("[","m"),s.assertCursorAt(10,7),s.doKeys("4","[","m"),s.assertCursorAt(1,3),s.doKeys("5","]","m"),s.assertCursorAt(11,0),s.doKeys("[","M"),s.assertCursorAt(9,1),s.doKeys("3","]","M"),s.assertCursorAt(15,0),s.doKeys("5","[","M"),s.assertCursorAt(7,3)},{value:squareBracketMotionSandbox}),testVim("ex_go_to_line",function(e,t,s){e.setCursor(0,0),s.doEx("4"),s.assertCursorAt(3,0)},{value:"a\nb\nc\nd\ne\n"}),testVim("ex_write",function(e,t,s){for(var r,o,n=CodeMirror.commands.save,a=(CodeMirror.commands.save=function(e){r=!0,o=e},1);a<"write".length;a++)r=!1,o=null,s.doEx("write".substring(0,a)),eq(r,!0),eq(o,e);CodeMirror.commands.save=n}),testVim("ex_sort",function(e,t,s){s.doEx("sort"),eq("Z\na\nb\nc\nd",e.getValue())},{value:"b\nZ\nd\nc\na"}),testVim("ex_sort_reverse",function(e,t,s){s.doEx("sort!"),eq("d\nc\nb\na",e.getValue())},{value:"b\nd\nc\na"}),testVim("ex_sort_range",function(e,t,s){s.doEx("2,3sort"),eq("b\nc\nd\na",e.getValue())},{value:"b\nd\nc\na"}),testVim("ex_sort_oneline",function(e,t,s){s.doEx("2sort"),eq("b\nd\nc\na",e.getValue())},{value:"b\nd\nc\na"}),testVim("ex_sort_ignoreCase",function(e,t,s){s.doEx("sort i"),eq("a\nb\nc\nd\nZ",e.getValue())},{value:"b\nZ\nd\nc\na"}),testVim("ex_sort_unique",function(e,t,s){s.doEx("sort u"),eq("Z\na\nb\nc\nd",e.getValue())},{value:"b\nZ\na\na\nd\na\nc\na"}),testVim("ex_sort_decimal",function(e,t,s){s.doEx("sort d"),eq("d3\n s5\n6\n.9",e.getValue())},{value:"6\nd3\n s5\n.9"}),testVim("ex_sort_decimal_negative",function(e,t,s){s.doEx("sort d"),eq("z-9\nd3\n s5\n6\n.9",e.getValue())},{value:"6\nd3\n s5\n.9\nz-9"}),testVim("ex_sort_decimal_reverse",function(e,t,s){s.doEx("sort! d"),eq(".9\n6\n s5\nd3",e.getValue())},{value:"6\nd3\n s5\n.9"}),testVim("ex_sort_hex",function(e,t,s){s.doEx("sort x"),eq(" s5\n6\n.9\n&0xB\nd3",e.getValue())},{value:"6\nd3\n s5\n&0xB\n.9"}),testVim("ex_sort_octal",function(e,t,s){s.doEx("sort o"),eq(".8\n.9\nd3\n s5\n6",e.getValue())},{value:"6\nd3\n s5\n.9\n.8"}),testVim("ex_sort_decimal_mixed",function(e,t,s){s.doEx("sort d"),eq("y\nz\nc1\nb2\na3",e.getValue())},{value:"a3\nz\nc1\ny\nb2"}),testVim("ex_sort_decimal_mixed_reverse",function(e,t,s){s.doEx("sort! d"),eq("a3\nb2\nc1\nz\ny",e.getValue())},{value:"a3\nz\nc1\ny\nb2"}),testVim("ex_substitute_same_line",function(e,t,s){e.setCursor(1,0),s.doEx("s/one/two"),eq("one one\n two two",e.getValue())},{value:"one one\n one one"}),testVim("ex_substitute_global",function(e,t,s){e.setCursor(1,0),s.doEx("%s/one/two"),eq("two two\n two two",e.getValue())},{value:"one one\n one one"}),testVim("ex_substitute_input_range",function(e,t,s){e.setCursor(1,0),s.doEx("1,3s/\\d/0"),eq("0\n0\n0\n4",e.getValue())},{value:"1\n2\n3\n4"}),testVim("ex_substitute_visual_range",function(e,t,s){e.setCursor(1,0),s.doKeys("V","2","j","v"),s.doEx("'<,'>s/\\d/0"),eq("1\n0\n0\n0\n5",e.getValue())},{value:"1\n2\n3\n4\n5"}),testVim("ex_substitute_capture",function(e,t,s){e.setCursor(1,0),s.doEx("s/(\\d+)/$1$1/"),eq("a1111 a1212 a1313",e.getValue())},{value:"a11 a12 a13"}),testVim("ex_substitute_empty_query",function(e,t,s){e.setCursor(1,0),e.openDialog=s.fakeOpenDialog("1"),s.doKeys("/"),s.doEx("s//b"),eq("abb ab2 ab3",e.getValue())},{value:"a11 a12 a13"}),testVim("ex_substitute_count",function(e,t,s){e.setCursor(1,0),s.doEx("s/\\d/0/i 2"),eq("1\n0\n0\n4",e.getValue())},{value:"1\n2\n3\n4"}),testVim("ex_substitute_count_with_range",function(e,t,s){e.setCursor(1,0),s.doEx("1,3s/\\d/0/ 3"),eq("1\n2\n0\n0",e.getValue())},{value:"1\n2\n3\n4"}),testSubstituteConfirm("ex_substitute_confirm_emptydoc","%s/x/b/c","","","",makeCursor(0,0)),testSubstituteConfirm("ex_substitute_confirm_nomatch","%s/x/b/c","ba a\nbab","ba a\nbab","",makeCursor(0,0)),testSubstituteConfirm("ex_substitute_confirm_accept","%s/a/b/c","ba a\nbab","bb b\nbbb","yyy",makeCursor(1,1)),testSubstituteConfirm("ex_substitute_confirm_random_keys","%s/a/b/c","ba a\nbab","bb b\nbbb","ysdkywerty",makeCursor(1,1)),testSubstituteConfirm("ex_substitute_confirm_some","%s/a/b/c","ba a\nbab","bb a\nbbb","yny",makeCursor(1,1)),testSubstituteConfirm("ex_substitute_confirm_all","%s/a/b/c","ba a\nbab","bb b\nbbb","a",makeCursor(1,1)),testSubstituteConfirm("ex_substitute_confirm_accept_then_all","%s/a/b/c","ba a\nbab","bb b\nbbb","ya",makeCursor(1,1)),testSubstituteConfirm("ex_substitute_confirm_quit","%s/a/b/c","ba a\nbab","bb a\nbab","yq",makeCursor(0,3)),testSubstituteConfirm("ex_substitute_confirm_last","%s/a/b/c","ba a\nbab","bb b\nbab","yl",makeCursor(0,3)),testSubstituteConfirm("ex_substitute_confirm_oneline","1s/a/b/c","ba a\nbab","bb b\nbab","yl",makeCursor(0,3)),testSubstituteConfirm("ex_substitute_confirm_range_accept","1,2s/a/b/c","aa\na \na\na","bb\nb \na\na","yyy",makeCursor(1,0)),testSubstituteConfirm("ex_substitute_confirm_range_some","1,3s/a/b/c","aa\na \na\na","ba\nb \nb\na","ynyy",makeCursor(2,0)),testSubstituteConfirm("ex_substitute_confirm_range_all","1,3s/a/b/c","aa\na \na\na","bb\nb \nb\na","a",makeCursor(2,0)),testSubstituteConfirm("ex_substitute_confirm_range_last","1,3s/a/b/c","aa\na \na\na","bb\nb \na\na","yyl",makeCursor(1,0)),testVim("ex_noh_clearSearchHighlight",function(e,t,s){e.openDialog=s.fakeOpenDialog("match"),s.doKeys("?"),s.doEx("noh"),eq(t.searchState_.getOverlay(),null,"match-highlighting wasn't cleared"),s.doKeys("n"),s.assertCursorAt(0,11,"can't resume search after clearing highlighting")},{value:"match nope match \n nope Match"}),testVim("ex_map_key2key",function(e,t,s){s.doEx("map a x"),s.doKeys("a"),s.assertCursorAt(0,0),eq("bc",e.getValue())},{value:"abc"}),testVim("ex_map_key2key_to_colon",function(e,t,s){s.doEx("map ; :");var r=!1;e.openDialog=function(){r=!0},s.doKeys(";"),eq(r,!0)}),testVim("ex_map_ex2key:",function(e,t,s){s.doEx("map :del x"),s.doEx("del"),s.assertCursorAt(0,0),eq("bc",e.getValue())},{value:"abc"}),testVim("ex_map_ex2ex",function(e,t,s){s.doEx("map :del :w");var r,o=CodeMirror.commands.save,n=!1;CodeMirror.commands.save=function(e){n=!0,r=e},s.doEx("del"),CodeMirror.commands.save=o,eq(n,!0),eq(r,e)}),testVim("ex_map_key2ex",function(e,t,s){s.doEx("map a :w");var r,o=CodeMirror.commands.save,n=!1;CodeMirror.commands.save=function(e){n=!0,r=e},s.doKeys("a"),CodeMirror.commands.save=o,eq(n,!0),eq(r,e)}),testVim("ex_api_test",function(e,t,s){var r=!1,o="from";CodeMirror.Vim.defineEx("extest","ext",function(e,t){t.args?o=t.args[0]:r=!0}),s.doEx(":ext to"),eq(o,"to","Defining ex-command failed"),CodeMirror.Vim.map("<C-CR><Space>",":ext"),s.doKeys("<C-CR>","<Space>"),is(r,"Mapping to key failed")}),testVim("ex_map_key2key_from_colon",function(e,t,s){s.doEx("map : x"),s.doKeys(":"),s.assertCursorAt(0,0),eq("bc",e.getValue())},{value:"abc"});