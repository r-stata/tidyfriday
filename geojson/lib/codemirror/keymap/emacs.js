!function(){"use strict";var c=CodeMirror.Pos;function a(t,e){return t.line==e.line&&t.ch==e.ch}var i=[];function l(t){i.push(t),50<i.length&&i.shift()}function n(t){return i[i.length-(t?Math.min(t,1):1)]||""}var u=null;function o(t,e,n,r,o){null==o&&(o=t.getRange(e,n)),(r&&u&&u.cm==t&&a(e,u.pos)&&t.isClean(u.gen)?function(t){if(!i.length)return l(t);i[i.length-1]+=t}:l)(o),t.replaceRange("",e,n,"+delete"),u=r?{cm:t,pos:e,gen:t.changeGeneration()}:null}function e(t,e,n){return t.findPosH(e,n,"char",!0)}function r(t,e,n){return t.findPosH(e,n,"word",!0)}function t(t,e,n){return t.findPosV(e,n,"line",t.doc.sel.goalColumn)}function f(t,e,n){return t.findPosV(e,n,"page",t.doc.sel.goalColumn)}function s(t,e,n){for(var r=e.line,o=t.getLine(r),i=/\S/.test(n<0?o.slice(0,e.ch):o.slice(e.ch)),l=t.firstLine(),a=t.lastLine();;){if((r+=n)<l||a<r)return t.clipPos(c(r-n,n<0?0:null));o=t.getLine(r);if(/\S/.test(o))i=!0;else if(i)return c(r,0)}}function g(t,e,n){for(var r=e.line,o=e.ch,i=t.getLine(e.line),l=!1;;){var a=i.charAt(o+(n<0?-1:0));if(a){if(l&&/[!?.]/.test(a))return c(r,o+(0<n?1:0));l=l||/\w/.test(a),o+=n}else{if(r==(n<0?t.firstLine():t.lastLine()))return c(r,o);if(i=t.getLine(r+n),!/\S/.test(i))return c(r,o);r+=n,o=n<0?i.length:0}}}function C(t,e,n){var r;if(t.findMatchingBracket&&(r=t.findMatchingBracket(e,!0))&&r.match&&(r.forward?1:-1)==n)return 0<n?c(r.to.line,r.to.ch+1):r.to;for(var o=!0;;o=!1){var i=t.getTokenAt(e),l=c(e.line,n<0?i.start:i.end);if(!(o&&0<n&&i.end==e.ch)&&/\w/.test(i.string))return l;i=t.findPosH(l,n,"char");if(a(l,i))return e;e=i}}function p(t,e){var n=t.state.emacsPrefix;return n?(L(t),"-"==n?-1:Number(n)):e?null:1}function d(e){var r="string"==typeof e?function(t){t.execCommand(e)}:e;return function(t){var e=p(t);r(t);for(var n=1;n<e;++n)r(t)}}function h(t,e,n){var r=t.getCursor(),o=p(t);o<0&&(n=-n,o=-o);for(var i=0;i<o;++i){var l=e(t,r,n);if(a(l,r))break;r=l}return r}function A(e,n){function t(t){t.extendSelection(h(t,e,n))}return t.motion=!0,t}function m(t,e,n){o(t,t.getCursor(),h(t,e,n),!0)}function v(t,e){t.state.emacsPrefix?"-"!=e&&(t.state.emacsPrefix+=e):(t.state.emacsPrefix=e,t.on("keyHandled",P),t.on("inputRead",M))}var S={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0};function P(t,e){t.state.emacsPrefixMap||S.hasOwnProperty(e)||L(t)}function L(t){t.state.emacsPrefix=null,t.off("keyHandled",P),t.off("inputRead",M)}function M(t,e){var n=p(t);if(1<n&&"+input"==e.origin){for(var r=e.text.join("\n"),o="",i=1;i<n;++i)o+=r;t.replaceSelection(o,"end","+input")}}function k(t,e){"string"==typeof e&&(/^\d$/.test(e)||"Ctrl-U"==e)||(t.removeKeyMap(w),t.state.emacsPrefixMap=!1,t.off("keyHandled",k),t.off("inputRead",k))}function y(t){t.setCursor(t.getCursor()),t.setExtending(!0),t.on("change",function(){t.setExtending(!1)})}function R(t,e){var n=t.getCursor(),r=t.findPosH(n,1,"word");t.replaceRange(e(t.getRange(n,r)),n,r),t.setCursor(r)}var x=CodeMirror.keyMap.emacs={"Ctrl-W":function(t){o(t,t.getCursor("start"),t.getCursor("end"))},"Ctrl-K":d(function(t){var e=t.getCursor(),n=t.clipPos(c(e.line)),r=t.getRange(e,n);/\S/.test(r)||(r+="\n",n=c(e.line+1,0)),o(t,e,n,!0,r)}),"Alt-W":function(t){l(t.getSelection())},"Ctrl-Y":function(t){var e=t.getCursor();t.replaceRange(n(p(t)),e,e,"paste"),t.setSelection(e,t.getCursor())},"Alt-Y":function(t){t.replaceSelection((1<i.length&&i.pop(),n()))},"Ctrl-Space":y,"Ctrl-Shift-2":y,"Ctrl-F":A(e,1),"Ctrl-B":A(e,-1),Right:A(e,1),Left:A(e,-1),"Ctrl-D":function(t){m(t,e,1)},Delete:function(t){m(t,e,1)},"Ctrl-H":function(t){m(t,e,-1)},Backspace:function(t){m(t,e,-1)},"Alt-F":A(r,1),"Alt-B":A(r,-1),"Alt-D":function(t){m(t,r,1)},"Alt-Backspace":function(t){m(t,r,-1)},"Ctrl-N":A(t,1),"Ctrl-P":A(t,-1),Down:A(t,1),Up:A(t,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":A(f,-1),"Ctrl-V":A(f,1),PageUp:A(f,-1),PageDown:A(f,1),"Ctrl-Up":A(s,-1),"Ctrl-Down":A(s,1),"Alt-A":A(g,-1),"Alt-E":A(g,1),"Alt-K":function(t){m(t,g,1)},"Ctrl-Alt-K":function(t){m(t,C,1)},"Ctrl-Alt-Backspace":function(t){m(t,C,-1)},"Ctrl-Alt-F":A(C,1),"Ctrl-Alt-B":A(C,-1),"Shift-Ctrl-Alt-2":function(t){t.setSelection(h(t,C,1),t.getCursor())},"Ctrl-Alt-T":function(t){var e=C(t,t.getCursor(),-1),n=C(t,e,1),r=C(t,n,1),o=C(t,r,-1);t.replaceRange(t.getRange(o,r)+t.getRange(n,o)+t.getRange(e,n),e,r)},"Ctrl-Alt-U":d(function(t){for(var e=t.getCursor(),n=e.line,r=e.ch,o=[];n>=t.firstLine();){for(var i=t.getLine(n),l=null==r?i.length:r;0<l;)if(")"==(r=i.charAt(--l)))o.push("(");else if("]"==r)o.push("[");else if("}"==r)o.push("{");else if(/[\(\{\[]/.test(r)&&(!o.length||o.pop()!=r))return t.extendSelection(c(n,l));--n,r=null}}),"Alt-Space":function(t){for(var e=t.getCursor(),n=e.ch,r=e.ch,o=t.getLine(e.line);n&&/\s/.test(o.charAt(n-1));)--n;for(;r<o.length&&/\s/.test(o.charAt(r));)++r;t.replaceRange(" ",c(e.line,n),c(e.line,r))},"Ctrl-O":d(function(t){t.replaceSelection("\n","start")}),"Ctrl-T":d(function(t){var e=t.getCursor(),n=(e.ch<t.getLine(e.line).length&&(e=c(e.line,e.ch+1)),t.findPosH(e,-2,"char")),r=t.getRange(n,e);2==r.length&&(t.setSelection(n,e),t.replaceSelection(r.charAt(1)+r.charAt(0),"end"))}),"Alt-C":d(function(t){R(t,function(t){var e=t.search(/\w/);return-1==e?t:t.slice(0,e)+t.charAt(e).toUpperCase()+t.slice(e+1).toLowerCase()})}),"Alt-U":d(function(t){R(t,function(t){return t.toUpperCase()})}),"Alt-L":d(function(t){R(t,function(t){return t.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":d("undo"),"Shift-Ctrl--":d("undo"),"Ctrl-Z":d("undo"),"Cmd-Z":d("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":"clearSearch","Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:!1,Tab:"indentAuto","Alt-G":function(t){t.setOption("keyMap","emacs-Alt-G")},"Ctrl-X":function(t){t.setOption("keyMap","emacs-Ctrl-X")},"Ctrl-Q":function(t){t.setOption("keyMap","emacs-Ctrl-Q")},"Ctrl-U":function(t){t.state.emacsPrefixMap=!0,t.addKeyMap(w),t.on("keyHandled",k),t.on("inputRead",k)}},w=(CodeMirror.keyMap["emacs-Ctrl-X"]={Tab:function(t){t.indentSelection(p(t,!0)||t.getOption("indentUnit"))},"Ctrl-X":function(t){t.setSelection(t.getCursor("head"),t.getCursor("anchor"))},"Ctrl-S":"save","Ctrl-W":"save",S:"saveAll",F:"open",U:d("undo"),K:"close",Delete:function(t){o(t,t.getCursor(),sentenceEnd(t,1),!0)},auto:"emacs",nofallthrough:!0,disableInput:!0},CodeMirror.keyMap["emacs-Alt-G"]={G:function(e){var t,n,r=p(e,!0);if(null!=r&&0<r)return e.setCursor(r-1);r="Goto line",n=function(t){t&&!isNaN(t=Number(t))&&t==t|0&&0<t&&e.setCursor(t-1)},(t=e).openDialog?t.openDialog(r+': <input type="text" style="width: 10em"/>',n,{bottom:!0}):n(prompt(r,""))},auto:"emacs",nofallthrough:!0,disableInput:!0},CodeMirror.keyMap["emacs-Ctrl-Q"]={Tab:d("insertTab"),auto:"emacs",nofallthrough:!0},{"Ctrl-G":L});function U(e){w[e]=function(t){v(t,e)},x["Ctrl-"+e]=function(t){v(t,e)},S["Ctrl-"+e]=!0}for(var D=0;D<10;++D)U(String(D));U("-")}();