"use strict";L.Browser.svg?L.Path.include({_resetTransform:function(){this._container.setAttributeNS(null,"transform","")},_applyTransform:function(t){this._container.setAttributeNS(null,"transform","matrix("+t.join(" ")+")")}}):L.Path.include({_resetTransform:function(){this._skew&&(this._skew.on=!1,this._container.removeChild(this._skew),this._skew=null)},_applyTransform:function(t){var e=this._skew,i=(e||(e=this._createElement("skew"),this._container.appendChild(e),e.style.behavior="url(#default#VML)",this._skew=e),t[0].toFixed(8)+" "+t[1].toFixed(8)+" "+t[2].toFixed(8)+" "+t[3].toFixed(8)+" 0 0"),t=Math.floor(t[4]).toFixed()+", "+Math.floor(t[5]).toFixed(),r=this._container.style,a=parseFloat(r.left),o=parseFloat(r.top),s=parseFloat(r.width),r=parseFloat(r.height),a=(isNaN(a)&&(a=0),isNaN(o)&&(o=0),!isNaN(s)&&s||(s=1),!isNaN(r)&&r||(r=1),(-a/s-.5).toFixed(8)+" "+(-o/r-.5).toFixed(8));e.on="f",e.matrix=i,e.origin=a,e.offset=t,e.on=!0}}),L.Path.include({_onMouseClick:function(t){this.dragging&&this.dragging.moved()||this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)}}),L.Handler.PathDrag=L.Handler.extend({statics:{DRAGGABLE_CLS:"leaflet-path-draggable"},initialize:function(t){this._path=t,this._matrix=null,this._startPoint=null,this._dragStartPoint=null,this._dragInProgress=!1,this._dragMoved=!1},addHooks:function(){var t=L.Handler.PathDrag.DRAGGABLE_CLS,e=this._path._path;this._path.on("mousedown",this._onDragStart,this),this._path.options.className=(this._path.options.className||"")+" "+t,!L.Path.CANVAS&&e&&L.DomUtil.addClass(e,t)},removeHooks:function(){var t=L.Handler.PathDrag.DRAGGABLE_CLS,e=this._path._path;this._path.off("mousedown",this._onDragStart,this),this._path.options.className=(this._path.options.className||"").replace(t,""),!L.Path.CANVAS&&e&&L.DomUtil.removeClass(e,t),this._dragMoved=!1},moved:function(){return this._dragMoved},inProgress:function(){return this._dragInProgress},_onDragStart:function(t){this._dragInProgress=!0,this._startPoint=t.containerPoint.clone(),this._dragStartPoint=t.containerPoint.clone(),this._matrix=[1,0,0,1,0,0],this._path._point&&(this._point=this._path._point.clone()),this._path._map.on("mousemove",this._onDrag,this).on("mouseup",this._onDragEnd,this),this._dragMoved=!1},_onDrag:function(t){var e=t.containerPoint.x,i=t.containerPoint.y,r=this._matrix,a=this._path,o=this._startPoint,s=e-o.x,n=i-o.y;this._dragMoved||!s&&!n||(this._dragMoved=!0,a.fire("dragstart"),a._popup&&(a._popup._close(),a.off("click",a._openPopup,a))),r[4]+=s,r[5]+=n,o.x=e,o.y=i,a._applyTransform(r),a._point&&(a._point.x=this._point.x+r[4],a._point.y=this._point.y+r[5]),a.fire("drag"),L.DomEvent.stop(t.originalEvent)},_onDragEnd:function(t){L.DomEvent.stop(t),L.DomEvent._fakeStop({type:"click"}),this._dragInProgress=!1,this._path._resetTransform(),this._transformPoints(this._matrix),this._path._map.off("mousemove",this._onDrag,this).off("mouseup",this._onDragEnd,this),this._path.fire("dragend",{distance:Math.sqrt(L.LineUtil._sqDist(this._dragStartPoint,t.containerPoint))}),this._path._popup&&L.Util.requestAnimFrame(function(){this._path.on("click",this._path._openPopup,this._path)},this),this._matrix=null,this._startPoint=null,this._point=null,this._dragStartPoint=null},_transformPoint:function(t,e){var i=this._path,e=L.point(e[4],e[5]),r=i._map.options.crs,a=r.transformation,i=r.scale(i._map.getZoom()),r=r.projection,e=a.untransform(e,i).subtract(a.untransform(L.point(0,0),i));return r.unproject(r.project(t)._add(e))},_transformPoints:function(t){var e,i,r,a=this._path,o=L.point(t[4],t[5]),t=a._map.options.crs,s=t.transformation,n=t.scale(a._map.getZoom()),h=t.projection,_=s.untransform(o,n).subtract(s.untransform(L.point(0,0),n));if(a._point)a._latlng=h.unproject(h.project(a._latlng)._add(_)),a._point=this._point._add(o);else if(a._originalPoints)for(e=0,i=a._originalPoints.length;e<i;e++)r=a._latlngs[e],a._latlngs[e]=h.unproject(h.project(r)._add(_)),a._originalPoints[e]._add(o);if(a._holes)for(e=0,i=a._holes.length;e<i;e++)for(var g=0,p=a._holes[e].length;g<p;g++)r=a._holes[e][g],a._holes[e][g]=h.unproject(h.project(r)._add(_)),a._holePoints[e][g]._add(o);a._updatePath()}}),L.Path.addInitHook(function(){this.options.draggable?(this.dragging||(this.dragging=new L.Handler.PathDrag(this)),this.dragging.enable()):this.dragging&&this.dragging.disable()}),L.Circle.prototype._getLatLng=L.Circle.prototype.getLatLng,L.Circle.prototype.getLatLng=function(){return this.dragging&&this.dragging.inProgress()?this.dragging._transformPoint(this._latlng,this.dragging._matrix):this._getLatLng()},L.Polyline.prototype._getLatLngs=L.Polyline.prototype.getLatLngs,L.Polyline.prototype.getLatLngs=function(){if(this.dragging&&this.dragging.inProgress()){for(var t=this.dragging._matrix,e=this._getLatLngs(),i=0,r=e.length;i<r;i++)e[i]=this.dragging._transformPoint(e[i],t);return e}return this._getLatLngs()},function(){function t(t,e,i){for(var r=0,a=t.length;r<a;r++){var o=t[r];o.prototype["_"+e]=o.prototype[e],o.prototype[e]=i}}L.FeatureGroup.EVENTS+=" dragstart",t([L.MultiPolygon,L.MultiPolyline],"addLayer",function(t){return this.hasLayer(t)?this:(t.on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._addLayer.call(this,t))}),t([L.MultiPolygon,L.MultiPolyline],"removeLayer",function(t){return this.hasLayer(t)?(t.off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._removeLayer.call(this,t)):this});var e={_onDrag:function(t){var e=t.target;this.eachLayer(function(t){t!==e&&t._applyTransform(e.dragging._matrix)}),this._propagateEvent(t)},_onDragEnd:function(t){var e=t.target;this.eachLayer(function(t){t!==e&&(t._resetTransform(),t.dragging._transformPoints(e.dragging._matrix))}),this._propagateEvent(t)}};L.MultiPolygon.include(e),L.MultiPolyline.include(e)}(),L.Polygon.include(L.Polygon.prototype.getCenter?{}:{getCenter:function(){for(var t,e,i,r,a,o=this._originalPoints,s=r=a=0,n=0,h=o.length,_=h-1;n<h;_=n++)t=o[n],e=o[_],i=t.y*e.x-e.y*t.x,r+=(t.x+e.x)*i,a+=(t.y+e.y)*i,s+=3*i;return this._map.layerPointToLatLng([r/s,a/s])}}),L.EditToolbar.Edit.MOVE_MARKERS=!1,L.EditToolbar.Edit.include({initialize:function(t,e){L.EditToolbar.Edit.MOVE_MARKERS=!!e.selectedPathOptions.moveMarkers,this._initialize(t,e)},_initialize:L.EditToolbar.Edit.prototype.initialize}),L.Edit.SimpleShape.include({_updateMoveMarker:function(){this._moveMarker&&this._moveMarker.setLatLng(this._getShapeCenter())},_getShapeCenter:function(){return this._shape.getBounds().getCenter()},_createMoveMarker:function(){L.EditToolbar.Edit.MOVE_MARKERS&&(this._moveMarker=this._createMarker(this._getShapeCenter(),this.options.moveIcon))}}),L.Edit.SimpleShape.mergeOptions({moveMarker:!1}),L.Edit.Circle.include({addHooks:function(){this._shape._map&&(this._map=this._shape._map,this._markerGroup||(this._enableDragging(),this._initMarkers()),this._shape._map.addLayer(this._markerGroup))},removeHooks:function(){if(this._shape._map){for(var t=0,e=this._resizeMarkers.length;t<e;t++)this._unbindMarker(this._resizeMarkers[t]);this._disableDragging(),this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},_createMoveMarker:L.Edit.SimpleShape.prototype._createMoveMarker,_resize:function(t){t=this._shape.getLatLng().distanceTo(t);this._shape.setRadius(t),this._updateMoveMarker(),this._map.fire("draw:editresize",{layer:this._shape})},_enableDragging:function(){this._shape.dragging||(this._shape.dragging=new L.Handler.PathDrag(this._shape)),this._shape.dragging.enable(),this._shape.on("dragstart",this._onStartDragFeature,this).on("dragend",this._onStopDragFeature,this)},_disableDragging:function(){this._shape.dragging.disable(),this._shape.off("dragstart",this._onStartDragFeature,this).off("dragend",this._onStopDragFeature,this)},_onStartDragFeature:function(){this._shape._map.removeLayer(this._markerGroup),this._shape.fire("editstart")},_onStopDragFeature:function(){var t=this._shape.getLatLng();this._resizeMarkers[0].setLatLng(this._getResizeMarkerPoint(t)),this._shape._map.addLayer(this._markerGroup),this._updateMoveMarker(),this._fireEdit()}}),L.Edit.Rectangle.include({addHooks:function(){this._shape._map&&(this._markerGroup||(this._enableDragging(),this._initMarkers()),this._shape._map.addLayer(this._markerGroup))},removeHooks:function(){this._shape._map&&(this._shape._map.removeLayer(this._markerGroup),this._disableDragging(),delete this._markerGroup,delete this._markers)},_resize:function(t){this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),this._updateMoveMarker(),this._map.fire("draw:editresize",{layer:this._shape})},_onMarkerDragEnd:function(t){this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_enableDragging:function(){this._shape.dragging||(this._shape.dragging=new L.Handler.PathDrag(this._shape)),this._shape.dragging.enable(),this._shape.on("dragstart",this._onStartDragFeature,this).on("dragend",this._onStopDragFeature,this)},_disableDragging:function(){this._shape.dragging.disable(),this._shape.off("dragstart",this._onStartDragFeature,this).off("dragend",this._onStopDragFeature,this)},_onStartDragFeature:function(){this._shape._map.removeLayer(this._markerGroup),this._shape.fire("editstart")},_onStopDragFeature:function(){for(var t=this._shape,e=0,i=t._latlngs.length;e<i;e++){var r=this._resizeMarkers[e];r.setLatLng(t._latlngs[e]),r._origLatLng=t._latlngs[e],r._middleLeft&&r._middleLeft.setLatLng(this._getMiddleLatLng(r._prev,r)),r._middleRight&&r._middleRight.setLatLng(this._getMiddleLatLng(r,r._next))}this._shape._map.addLayer(this._markerGroup),this._updateMoveMarker(),this._repositionCornerMarkers(),this._fireEdit()}}),L.Edit.Poly.include({__createMarker:L.Edit.Poly.prototype._createMarker,__removeMarker:L.Edit.Poly.prototype._removeMarker,addHooks:function(){this._poly._map&&(this._markerGroup||(this._enableDragging(),this._initMarkers(),this._createMoveMarker()),this._poly._map.addLayer(this._markerGroup))},_createMoveMarker:function(){L.EditToolbar.Edit.MOVE_MARKERS&&this._poly instanceof L.Polygon&&(this._moveMarker=new L.Marker(this._getShapeCenter(),{icon:this.options.moveIcon}),this._moveMarker.on("mousedown",this._delegateToShape,this),this._markerGroup.addLayer(this._moveMarker))},_delegateToShape:function(t){var e=this._shape||this._poly,i=t.target;e.fire("mousedown",L.Util.extend(t,{containerPoint:L.DomUtil.getPosition(i._icon).add(e._map._getMapPanePos())}))},_getShapeCenter:function(){return this._poly.getCenter()},removeHooks:function(){this._poly._map&&(this._poly._map.removeLayer(this._markerGroup),this._disableDragging(),delete this._markerGroup,delete this._markers)},_enableDragging:function(){this._poly.dragging||(this._poly.dragging=new L.Handler.PathDrag(this._poly)),this._poly.dragging.enable(),this._poly.on("dragstart",this._onStartDragFeature,this).on("dragend",this._onStopDragFeature,this)},_disableDragging:function(){this._poly.dragging.disable(),this._poly.off("dragstart",this._onStartDragFeature,this).off("dragend",this._onStopDragFeature,this)},_onStartDragFeature:function(t){this._poly._map.removeLayer(this._markerGroup),this._poly.fire("editstart")},_onStopDragFeature:function(t){for(var e=this._poly,i=0,r=e._latlngs.length;i<r;i++){var a=this._markers[i];a.setLatLng(e._latlngs[i]),a._origLatLng=e._latlngs[i],a._middleLeft&&a._middleLeft.setLatLng(this._getMiddleLatLng(a._prev,a)),a._middleRight&&a._middleRight.setLatLng(this._getMiddleLatLng(a,a._next))}this._poly._map.addLayer(this._markerGroup),L.Edit.SimpleShape.prototype._updateMoveMarker.call(this),this._fireEdit()},_updateMoveMarker:L.Edit.SimpleShape.prototype._updateMoveMarker,_createMarker:function(t,e){t=this.__createMarker(t,e);return t.on("dragstart",this._hideMoveMarker,this).on("dragend",this._showUpdateMoveMarker,this),t},_removeMarker:function(t){this.__removeMarker(t),t.off("dragstart",this._hideMoveMarker,this).off("dragend",this._showUpdateMoveMarker,this)},_hideMoveMarker:function(){this._moveMarker&&this._markerGroup.removeLayer(this._moveMarker)},_showUpdateMoveMarker:function(){this._moveMarker&&(this._markerGroup.addLayer(this._moveMarker),this._updateMoveMarker())}}),L.Edit.Poly.prototype.options.moveIcon=new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),L.Edit.Poly.mergeOptions({moveMarker:!1});