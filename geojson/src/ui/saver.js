var flash=require("./flash");module.exports=function(n){function a(t,e){if(t)return flash(n.container,t.toString());var a,s,i,t=n.data.get("type");"gist"===t||"gist"===e.type?(a="Changes to this map saved to Gist: ",s=e.html_url,i=e.id):"github"===t?(a="Changes committed to GitHub: ",s=e.commit.html_url,i=e.commit.sha.substring(0,10)):a="Changes saved to disk.",flash(n.container,a+(s?'<a href="'+s+'">'+i+"</a>":"")),n.container.select(".map").classed("loading",!1),n.data.parse(e)}d3.event&&d3.event.preventDefault();n.data.get("meta");var t=n.data.get("map"),t=t&&t.geometry||t.features&&t.features.length,e=n.data.get("type");if(!t)return flash(n.container,"Add a feature to the map to save it");n.container.select(".map").classed("loading",!0),"github"===e?n.repo.details(function(t,e){!t&&e.permissions.push?(t=prompt("Commit Message"))?(n.commitMessage=t,n.data.save(a)):n.container.select(".map").classed("loading",!1):n.data.save(a)}):n.data.save(a)};