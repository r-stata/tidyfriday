var qs=require("qs-hash"),xtend=require("xtend");module.exports=function(e){var n={};function t(){var n,t=d3.event.oldURL.split("#")[1]||"",i=d3.event.newURL.split("#")[1]||"",s=qs.stringQs(t),i=qs.stringQs(i);0!==(n=t).indexOf("gist")&&0!==n.indexOf("github")&&isNaN(parseInt(n,10))?i.id!==s.id&&e.dispatch.route(i):(n=t,isNaN(parseInt(n,10))?(s=n.split(":"),location.hash="#id="+(0===s[1].indexOf("/")?[s[0],s[1].substring(1)].join(":"):n)):location.hash="#id=gist:/"+n)}function i(){var n=s(),t=(t=s(),xtend(t,{id:e.data.get("route")}));t.id&&n.id!==t.id&&(location.hash="#"+qs.qsString(t))}function s(){return qs.stringQs(window.location.hash.substring(1))}return n.on=function(){return d3.select(window).on("hashchange.router",t),e.dispatch.on("change.route",i),e.dispatch.route(s()),n},n.off=function(){return d3.select(window).on("hashchange.router",null),n},n};