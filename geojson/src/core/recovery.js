var zoomextent=require("../lib/zoomextent"),qs=require("qs-hash");module.exports=function(e){d3.select(window).on("unload",function(){if("local"===e.data.get("type")&&e.data.hasFeatures())try{e.storage.set("recover",e.data.all())}catch(e){}else e.storage.remove("recover")}),e.dispatch.on("change",function(){"local"!==e.data.get("type")&&e.storage.remove("recover")});var t=qs.stringQs(location.hash.split("#")[1]||"");"#new"===location.hash||t.id||t.data||((t=e.storage.get("recover"))&&confirm("recover your map from the last time you edited?")?(e.data.set(t),setTimeout(function(){zoomextent(e)},100)):e.storage.remove("recover"))};