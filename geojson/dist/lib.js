var Blob;function bucket(){var e,o=d3.dispatch("chosen");return{deposit:function(){return function(t){(e=t).each(function(){var t=d3.select(this);t.attr("data-text",t.text())})}},store:function(){var n,t;function r(){o.chosen(e.filter(function(){return d3.select(this).classed("filled")}).map(function(t){return t.map(function(t){return d3.select(t).text()})})[0])}var i=d3.behavior.drag().origin(function(){return{x:this.offsetLeft,y:this.offsetTop}}).on("dragstart",function(){n=d3.select(this.parentNode.insertBefore(this.cloneNode(!0),this)),d3.select(this).style("position","absolute").style("pointer-events","none"),t=[this.offsetWidth,this.offsetHeight]}).on("drag",function(){d3.select(this).style("left",d3.event.x-t[0]/2+"px").style("top",d3.event.y-t[1]/2+"px")}).on("dragend",function(){var t=d3.select(this),e=d3.select(d3.event.sourceEvent.target);e.classed("bucket")?(e.text(t.text()).classed("filled",!0),e.append("span").classed("remove-button",!0).on("click",function(){e.text(e.attr("data-text")).classed("filled",!1),r()}),t.remove(),n.call(i),r()):(t.remove(),n.call(i))});return d3.rebind(function(t){t.each(function(){var t=d3.select(this).call(i);t.attr("data-text",t.text())})},o,"on")}}}!function(){var A={version:"3.4.11"};function z(e,n){try{for(var t in n)Object.defineProperty(e.prototype,t,{value:n[t],enumerable:!1})}catch(t){e.prototype=n}}function I(){}A.entries=function(t){var e,n=[];for(e in t)n.push({key:e,value:t[e]});return n},A.map=function(t){var n=new I;if(t instanceof I)t.forEach(function(t,e){n.set(t,e)});else for(var e in t)n.set(e,t[e]);return n},z(I,{has:G,get:function(t){return this[R+t]},set:function(t,e){return this[R+t]=e},remove:function(t){return(t=R+t)in this&&delete this[t]},keys:U,values:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n},entries:function(){var n=[];return this.forEach(function(t,e){n.push({key:t,value:e})}),n},size:W,empty:B,forEach:function(t){for(var e in this)e.charCodeAt(0)===F&&t.call(this,e.substring(1),this[e])}});var R="\0",F=R.charCodeAt(0);function G(t){return R+t in this}function U(){var e=[];return this.forEach(function(t){e.push(t)}),e}function W(){var t,e=0;for(t in this)t.charCodeAt(0)===F&&++e;return e}function B(){for(var t in this)if(t.charCodeAt(0)===F)return!1;return!0}function j(){}A.set=function(t){var e=new j;if(t)for(var n=0,r=t.length;n<r;++n)e.add(t[n]);return e},z(j,{has:G,add:function(t){return this[R+t]=!0,t},remove:function(t){return(t=R+t)in this&&delete this[t]},values:U,size:W,empty:B,forEach:function(t){for(var e in this)e.charCodeAt(0)===F&&t.call(this,e.substring(1))}}),A.pairs=function(t){for(var e=0,n=t.length-1,r=t[0],i=new Array(n<0?0:n);e<n;)i[e]=[r,r=t[++e]];return i};var P=Math.abs;A.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n==1/0)throw new Error("infinite range");var r,i=[],o=function(t){var e=1;for(;t*e%1;)e*=10;return e}(P(n)),a=-1;if(t*=o,e*=o,(n*=o)<0)for(;(r=t+n*++a)>e;)i.push(r/o);else for(;(r=t+n*++a)<e;)i.push(r/o);return i};var V=[].slice,Y=function(t){return V.call(t)},q=document,w=q.documentElement,k=window;try{Y(w.childNodes)[0].nodeType}catch(t){Y=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}function K(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.substring(1);for(var n=0,r=X.length;n<r;++n){var i=X[n]+e;if(i in t)return i}}A.rebind=function(t,e){for(var n,r=1,i=arguments.length;++r<i;)t[n=arguments[r]]=function(e,n,r){return function(){var t=r.apply(n,arguments);return t===n?e:t}}(t,e,e[n]);return t};var X=["webkit","ms","moz","Moz","o","O"];function l(){}function $(){}function Z(i){var o=[],r=new I;function t(){for(var t,e=o,n=-1,r=e.length;++n<r;)(t=e[n].on)&&t.apply(this,arguments);return i}return t.on=function(t,e){var n=r.get(t);return arguments.length<2?n&&n.on:(n&&(n.on=null,o=o.slice(0,n=o.indexOf(n)).concat(o.slice(n+1)),r.remove(t)),e&&o.push(r.set(t,{on:e})),i)},t}function J(){A.event.preventDefault()}function Q(){for(var t,e=A.event;t=e.sourceEvent;)e=t;return e}A.dispatch=function(){for(var t=new $,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=Z(t);return t},$.prototype.on=function(t,e){var n=t.indexOf("."),r="";if(0<=n&&(r=t.substring(n+1),t=t.substring(0,n)),t)return arguments.length<2?this[t].on(r):this[t].on(r,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(r,null);return this}},A.event=null,A.requote=function(t){return t.replace(tt,"\\$&")};var tt=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,et={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]};function nt(t){return et(t,n),t}var rt=function(t,e){return e.querySelector(t)},it=function(t,e){return e.querySelectorAll(t)},ot=w.matches||w[K(w,"matchesSelector")],at=function(t,e){return ot.call(t,e)},n=("function"==typeof Sizzle&&(rt=function(t,e){return Sizzle(t,e)[0]||null},at=(it=Sizzle).matchesSelector),A.selection=function(){return Ct},A.selection.prototype=[]);function st(t){return"function"==typeof t?t:function(){return rt(t,this)}}function lt(t){return"function"==typeof t?t:function(){return it(t,this)}}n.select=function(t){var e,n,r,i,o=[];t=st(t);for(var a=-1,s=this.length;++a<s;){o.push(e=[]),e.parentNode=(r=this[a]).parentNode;for(var l=-1,u=r.length;++l<u;)(i=r[l])?(e.push(n=t.call(i,i.__data__,l,a)),n&&"__data__"in i&&(n.__data__=i.__data__)):e.push(null)}return nt(o)},n.selectAll=function(t){var e,n,r=[];t=lt(t);for(var i=-1,o=this.length;++i<o;)for(var a=this[i],s=-1,l=a.length;++s<l;)(n=a[s])&&(r.push(e=Y(t.call(n,n.__data__,s,i))),e.parentNode=n);return nt(r)};var ut={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ht(e,n){return e=A.ns.qualify(e),null==n?e.local?function(){this.removeAttributeNS(e.space,e.local)}:function(){this.removeAttribute(e)}:"function"==typeof n?e.local?function(){var t=n.apply(this,arguments);null==t?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,t)}:function(){var t=n.apply(this,arguments);null==t?this.removeAttribute(e):this.setAttribute(e,t)}:e.local?function(){this.setAttributeNS(e.space,e.local,n)}:function(){this.setAttribute(e,n)}}function ct(t){return t.trim().replace(/\s+/g," ")}function ft(t){return new RegExp("(?:^|\\s+)"+A.requote(t)+"(?:\\s+|$)","g")}function dt(t){return(t+"").trim().split(/^|\s+/)}function pt(n,r){var i=(n=dt(n).map(gt)).length;return"function"==typeof r?function(){for(var t=-1,e=r.apply(this,arguments);++t<i;)n[t](this,e)}:function(){for(var t=-1;++t<i;)n[t](this,r)}}function gt(r){var i=ft(r);return function(t,e){if(n=t.classList)return e?n.add(r):n.remove(r);var n=t.getAttribute("class")||"";e?(i.lastIndex=0,i.test(n)||t.setAttribute("class",ct(n+" "+r))):t.setAttribute("class",ct(n.replace(i," ")))}}function mt(e,n,r){return null==n?function(){this.style.removeProperty(e)}:"function"==typeof n?function(){var t=n.apply(this,arguments);null==t?this.style.removeProperty(e):this.style.setProperty(e,t,r)}:function(){this.style.setProperty(e,n,r)}}function vt(e,n){return null==n?function(){delete this[e]}:"function"==typeof n?function(){var t=n.apply(this,arguments);null==t?delete this[e]:this[e]=t}:function(){this[e]=n}}function yt(t){return"function"==typeof t?t:(t=A.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,t)}}function _t(t){return{__data__:t}}function Lt(t){return function(){return at(this,t)}}function bt(t,e){return t<e?-1:e<t?1:e<=t?0:NaN}function wt(t,e){for(var n=0,r=t.length;n<r;n++)for(var i,o=t[n],a=0,s=o.length;a<s;a++)(i=o[a])&&e(i,a,n);return t}function kt(t){return et(t,xt),t}A.ns={prefix:ut,qualify:function(t){var e=t.indexOf(":"),n=t;return 0<=e&&(n=t.substring(0,e),t=t.substring(e+1)),ut.hasOwnProperty(n)?{space:ut[n],local:t}:t}},n.attr=function(t,e){if(arguments.length<2){var n;if("string"==typeof t)return n=this.node(),(t=A.ns.qualify(t)).local?n.getAttributeNS(t.space,t.local):n.getAttribute(t);for(e in t)this.each(ht(e,t[e]));return this}return this.each(ht(t,e))},n.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),r=(t=dt(t)).length,i=-1;if(e=n.classList){for(;++i<r;)if(!e.contains(t[i]))return!1}else for(e=n.getAttribute("class");++i<r;)if(!ft(t[i]).test(e))return!1;return!0}for(e in t)this.each(pt(e,t[e]));return this}return this.each(pt(t,e))},n.style=function(t,e,n){var r=arguments.length;if(r<3){if("string"!=typeof t){for(n in r<2&&(e=""),t)this.each(mt(n,t[n],e));return this}if(r<2)return k.getComputedStyle(this.node(),null).getPropertyValue(t);n=""}return this.each(mt(t,e,n))},n.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(vt(e,t[e]));return this}return this.each(vt(t,e))},n.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},n.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},n.append=function(t){return t=yt(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},n.insert=function(t,e){return t=yt(t),e=st(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},n.remove=function(){return this.each(function(){var t=this.parentNode;t&&t.removeChild(this)})},n.data=function(t,g){var e,n,r=-1,i=this.length;if(!arguments.length){for(t=new Array(i=(e=this[0]).length);++r<i;)(n=e[r])&&(t[r]=n.__data__);return t}function o(t,e){var n,r,i=t.length,o=e.length,a=Math.min(i,o),s=new Array(o),l=new Array(o),u=new Array(i);if(g){for(var h,c=new I,f=new I,d=[],p=-1;++p<i;)h=g.call(n=t[p],n.__data__,p),c.has(h)?u[p]=n:c.set(h,n),d.push(h);for(p=-1;++p<o;)h=g.call(e,r=e[p],p),(n=c.get(h))?(s[p]=n).__data__=r:f.has(h)||(l[p]=_t(r)),f.set(h,r),c.remove(h);for(p=-1;++p<i;)c.has(d[p])&&(u[p]=t[p])}else{for(p=-1;++p<a;)n=t[p],r=e[p],n?(n.__data__=r,s[p]=n):l[p]=_t(r);for(;p<o;++p)l[p]=_t(e[p]);for(;p<i;++p)u[p]=t[p]}l.update=s,l.parentNode=s.parentNode=u.parentNode=t.parentNode,m.push(l),v.push(s),y.push(u)}var m=kt([]),v=nt([]),y=nt([]);if("function"==typeof t)for(;++r<i;)o(e=this[r],t.call(e,e.parentNode.__data__,r));else for(;++r<i;)o(e=this[r],t);return v.enter=function(){return m},v.exit=function(){return y},v},n.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},n.filter=function(t){var e,n,r,i=[];"function"!=typeof t&&(t=Lt(t));for(var o=0,a=this.length;o<a;o++){i.push(e=[]),e.parentNode=(n=this[o]).parentNode;for(var s=0,l=n.length;s<l;s++)(r=n[s])&&t.call(r,r.__data__,s,o)&&e.push(r)}return nt(i)},n.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,r=this[t],i=r.length-1,o=r[i];0<=--i;)(n=r[i])&&(o&&o!==n.nextSibling&&o.parentNode.insertBefore(n,o),o=n);return this},A.ascending=bt,n.sort=function(t){t=function(n){arguments.length||(n=bt);return function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},n.each=function(r){return wt(this,function(t,e,n){r.call(t,t.__data__,e,n)})},n.call=function(t){var e=Y(arguments);return t.apply(e[0]=this,e),this},n.empty=function(){return!this.node()},n.node=function(){for(var t=0,e=this.length;t<e;t++)for(var n=this[t],r=0,i=n.length;r<i;r++){var o=n[r];if(o)return o}return null},n.size=function(){var t=0;return this.each(function(){++t}),t};var xt=[];function Mt(){var t=this.__transition__;t&&++t.active}A.selection.enter=kt,(A.selection.enter.prototype=xt).append=n.append,xt.empty=n.empty,xt.node=n.node,xt.call=n.call,xt.size=n.size,xt.select=function(t){for(var e,n,r,i,o,a=[],s=-1,l=this.length;++s<l;){r=(i=this[s]).update,a.push(e=[]),e.parentNode=i.parentNode;for(var u=-1,h=i.length;++u<h;)(o=i[u])?(e.push(r[u]=n=t.call(i.parentNode,o.__data__,u,s)),n.__data__=o.__data__):e.push(null)}return nt(a)},xt.insert=function(t,e){var a,s,l;return arguments.length<2&&(a=this,e=function(t,e,n){var r,i=a[n].update,o=i.length;for(n!=l&&(l=n,s=0),s<=e&&(s=e+1);!(r=i[s])&&++s<o;);return r}),n.insert.call(this,t,e)},n.transition=function(){for(var t,e,n=ce||++de,r=[],i=fe||{time:Date.now(),ease:oe,delay:0,duration:250},o=-1,a=this.length;++o<a;){r.push(t=[]);for(var s=this[o],l=-1,u=s.length;++l<u;)(e=s[l])&&qe(e,l,n,i),t.push(e)}return he(r,n)},n.interrupt=function(){return this.each(Mt)},A.select=function(t){t=["string"==typeof t?rt(t,q):t];return t.parentNode=w,nt([t])},A.selectAll=function(t){t=Y("string"==typeof t?it(t,q):t);return t.parentNode=w,nt([t])};var Ct=A.select(w);function St(i,e,n){var r="__on"+i,t=i.indexOf("."),o=Dt,a=(0<t&&(i=i.substring(0,t)),Et.get(i));function s(){var t=this[r];t&&(this.removeEventListener(i,t,t.$),delete this[r])}return a&&(i=a,o=Tt),t?e?function(){var t=o(e,Y(arguments));s.call(this),this.addEventListener(i,this[r]=t,t.$=n),t._=e}:s:e?l:function(){var t,e,n,r=new RegExp("^__on([^.]+)"+A.requote(i)+"$");for(e in this)(t=e.match(r))&&(n=this[e],this.removeEventListener(t[1],n,n.$),delete this[e])}}n.on=function(t,e,n){var r=arguments.length;if(r<3){if("string"!=typeof t){for(n in r<2&&(e=!1),t)this.each(St(n,t[n],e));return this}if(r<2)return(r=this.node()["__on"+t])&&r._;n=!1}return this.each(St(t,e,n))};var Et=A.map({mouseenter:"mouseover",mouseleave:"mouseout"});function Dt(n,r){return function(t){var e=A.event;A.event=t,r[0]=this.__data__;try{n.apply(this,r)}finally{A.event=e}}}function Tt(t,e){var n=Dt(t,e);return function(t){var e=t.relatedTarget;e&&(e===this||8&e.compareDocumentPosition(this))||n.call(this,t)}}Et.forEach(function(t){"on"+t in q&&Et.remove(t)});var At="onselectstart"in q?null:K(w.style,"userSelect"),Pt=0;A.mouse=function(t){return Ot(t,Q())};var Nt=/WebKit/.test(k.navigator.userAgent)?-1:0;function Ot(t,e){e.changedTouches&&(e=e.changedTouches[0]);var n,r,i=t.ownerSVGElement||t;return i.createSVGPoint?(n=i.createSVGPoint(),Nt<0&&(k.scrollX||k.scrollY)&&(r=(i=A.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM(),Nt=!(r.f||r.e),i.remove()),Nt?(n.x=e.pageX,n.y=e.pageY):(n.x=e.clientX,n.y=e.clientY),[(n=n.matrixTransform(t.getScreenCTM().inverse())).x,n.y]):(r=t.getBoundingClientRect(),[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop])}function Ht(){return A.event.changedTouches[0].identifier}function zt(){return A.event.target}function It(){return k}function Rt(){return!0}A.touches=function(n,t){return(t=arguments.length<2?Q().touches:t)?Y(t).map(function(t){var e=Ot(n,t);return e.identifier=t.identifier,e}):[]},A.behavior={},A.behavior.drag=function(){var L=function(i){for(var o=new $,t=0,e=arguments.length;++t<e;)o[arguments[t]]=Z(o);return o.of=function(n,r){return function(t){try{var e=t.sourceEvent=A.event;t.target=i,A.event=t,o[t.type].apply(n,r)}finally{A.event=e}}},o}(n,"drag","dragstart","dragend"),b=null,t=r(l,A.mouse,It,"mousemove","mouseup"),e=r(Ht,A.touch,zt,"touchmove","touchend");function n(){this.on("mousedown.drag",t).on("touchstart.drag",e)}function r(g,m,v,y,_){return function(){var r,n,i,o,a,s,t=A.event.target,l=this.parentNode,u=L.of(this,arguments),h=0,c=g(),e=".drag"+(null==c?"":"-"+c),f=A.select(v()).on(y+e,function(){var t,e,n=m(l,c);n&&(t=n[0]-p[0],e=n[1]-p[1],h|=t|e,u({type:"drag",x:(p=n)[0]+r[0],y:n[1]+r[1],dx:t,dy:e}))}).on(_+e,function(){m(l,c)&&(f.on(y+e,null).on(_+e,null),d(h&&A.event.target===t),u({type:"dragend"}))}),d=(o=".dragsuppress-"+ ++Pt,a="click"+o,s=A.select(k).on("touchmove"+o,J).on("dragstart"+o,J).on("selectstart"+o,J),At&&(n=w.style,i=n[At],n[At]="none"),function(t){function e(){s.on(a,null)}s.on(o,null),At&&(n[At]=i),t&&(s.on(a,function(){J(),e()},!0),setTimeout(e,0))}),p=m(l,c);r=b?[(r=b.apply(this,arguments)).x-p[0],r.y-p[1]]:[0,0],u({type:"dragstart"})}}return n.origin=function(t){return arguments.length?(b=t,n):b},A.rebind(n,L,"on")},A.functor=function(t){return"function"==typeof t?t:function(){return t}};var Ft,Gt,Ut,Wt,m,Bt=k[K(k,"requestAnimationFrame")]||function(t){setTimeout(t,17)};function jt(){var t=Vt(),t=Yt()-t;24<t?(isFinite(t)&&(clearTimeout(Wt),Wt=setTimeout(jt,t)),Ut=0):(Ut=1,Bt(jt))}function Vt(){var t=Date.now();for(m=Ft;m;)t>=m.t&&(m.f=m.c(t-m.t)),m=m.n;return t}function Yt(){for(var t,e=Ft,n=1/0;e;)e=e.f?t?t.n=e.n:Ft=e.n:(e.t<n&&(n=e.t),(t=e).n);return Gt=t,n}function qt(t){return t}A.timer=function(t,e,n){var r=arguments.length;r<2&&(e=0);r={c:t,t:(n=r<3?Date.now():n)+e,f:!1,n:null};Gt?Gt.n=r:Ft=r,Gt=r,Ut||(Wt=clearTimeout(Wt),Ut=1,Bt(jt))},A.timer.flush=function(){Vt(),Yt()};var M=Math.PI,C=2*M,p=M/2,N=1e-6,Kt=N*N,x=M/180,S=180/M;function Xt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function $t(t){return 1<t?0:t<-1?M:Math.acos(t)}function Zt(t){return 1<t?p:t<-1?-p:Math.asin(t)}function Jt(){return qt}var Qt=A.map({linear:Jt,poly:function(e){return function(t){return Math.pow(t,e)}},quad:function(){return re},cubic:function(){return ie},sin:function(){return ae},exp:function(){return se},circle:function(){return le},elastic:function(e,n){var r;arguments.length<2&&(n=.45);r=arguments.length?n/C*Math.asin(1/e):(e=1,n/4);return function(t){return 1+e*Math.pow(2,-10*t)*Math.sin((t-r)*C/n)}},back:function(e){e=e||1.70158;return function(t){return t*t*((e+1)*t-e)}},bounce:function(){return ue}}),te=A.map({in:qt,out:ee,"in-out":ne,"out-in":function(t){return ne(ee(t))}});function ee(e){return function(t){return 1-e(1-t)}}function ne(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function re(t){return t*t}function ie(t){return t*t*t}function oe(t){var e,n;return t<=0?0:1<=t?1:(n=(e=t*t)*t,4*(t<.5?n:3*(t-e)+n-.75))}function ae(t){return 1-Math.cos(t*p)}function se(t){return Math.pow(2,10*(t-1))}function le(t){return 1-Math.sqrt(1-t*t)}function ue(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function he(t,e){return et(t,r),t.id=e,t}A.ease=function(t){var e,n=t.indexOf("-"),r=0<=n?t.substring(0,n):t,n=0<=n?t.substring(n+1):"in",r=Qt.get(r)||Jt,n=te.get(n)||qt;return e=n(r.apply(null,V.call(arguments,1))),function(t){return t<=0?0:1<=t?1:e(t)}};var ce,fe,r=[],de=0;function pe(){}function u(t,e,n){return this instanceof u?(this.h=+t,this.s=+e,void(this.l=+n)):arguments.length<2?t instanceof u?new u(t.h,t.s,t.l):Se(""+t,Ee,u):new u(t,e,n)}r.call=n.call,r.empty=n.empty,r.node=n.node,r.size=n.size,A.transition=function(t){return arguments.length?ce?t.transition():t:Ct.transition()},(A.transition.prototype=r).select=function(t){var e,n,r,i=this.id,o=[];t=st(t);for(var a=-1,s=this.length;++a<s;){o.push(e=[]);for(var l=this[a],u=-1,h=l.length;++u<h;)(r=l[u])&&(n=t.call(r,r.__data__,u,a))?("__data__"in r&&(n.__data__=r.__data__),qe(n,u,i,r.__transition__[i]),e.push(n)):e.push(null)}return he(o,i)},r.selectAll=function(t){var e,n,r,i,o,a=this.id,s=[];t=lt(t);for(var l=-1,u=this.length;++l<u;)for(var h=this[l],c=-1,f=h.length;++c<f;)if(r=h[c]){o=r.__transition__[a],n=t.call(r,r.__data__,c,l),s.push(e=[]);for(var d=-1,p=n.length;++d<p;)(i=n[d])&&qe(i,d,a,o),e.push(i)}return he(s,a)},r.filter=function(t){var e,n,r=[];"function"!=typeof t&&(t=Lt(t));for(var i=0,o=this.length;i<o;i++){r.push(e=[]);for(var a,s=0,l=(a=this[i]).length;s<l;s++)(n=a[s])&&t.call(n,n.__data__,s,i)&&e.push(n)}return he(r,this.id)},(A.color=pe).prototype.toString=function(){return this.rgb()+""};var t=(A.hsl=u).prototype=new pe;function ge(t,e,n){var r,i;function o(t){return Math.round(255*(360<(t=t)?t-=360:t<0&&(t+=360),t<60?r+(i-r)*t/60:t<180?i:t<240?r+(i-r)*(240-t)/60:r))}return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)||e<0?0:1<e?1:e,r=2*(n=n<0?0:1<n?1:n)-(i=n<=.5?n*(1+e):n+e-n*e),new a(o(t+120),o(t),o(t-120))}function i(t,e,n){return this instanceof i?(this.h=+t,this.c=+e,void(this.l=+n)):arguments.length<2?t instanceof i?new i(t.h,t.c,t.l):be((t instanceof o?t:t=De((t=A.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new i(t,e,n)}t.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new u(this.h,this.s,this.l/t)},t.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new u(this.h,this.s,t*this.l)},t.rgb=function(){return ge(this.h,this.s,this.l)};t=(A.hcl=i).prototype=new pe;function me(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new o(n,Math.cos(t*=x)*e,Math.sin(t)*e)}function o(t,e,n){return this instanceof o?(this.l=+t,this.a=+e,void(this.b=+n)):arguments.length<2?t instanceof o?new o(t.l,t.a,t.b):t instanceof i?me(t.l,t.c,t.h):De((t=a(t)).r,t.g,t.b):new o(t,e,n)}t.brighter=function(t){return new i(this.h,this.c,Math.min(100,this.l+ve*(arguments.length?t:1)))},t.darker=function(t){return new i(this.h,this.c,Math.max(0,this.l-ve*(arguments.length?t:1)))},t.rgb=function(){return me(this.h,this.c,this.l).rgb()},A.lab=o;var ve=18,ye=.95047,_e=1,Le=1.08883,t=o.prototype=new pe;function be(t,e,n){return 0<t?new i(Math.atan2(n,e)*S,Math.sqrt(e*e+n*n),t):new i(NaN,NaN,t)}function we(t){return.206893034<t?t*t*t:(t-4/29)/7.787037}function ke(t){return.008856<t?Math.pow(t,1/3):7.787037*t+4/29}function xe(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function a(t,e,n){return this instanceof a?(this.r=~~t,this.g=~~e,void(this.b=~~n)):arguments.length<2?t instanceof a?new a(t.r,t.g,t.b):Se(""+t,a,ge):new a(t,e,n)}function Me(t){return new a(t>>16,t>>8&255,255&t)}t.brighter=function(t){return new o(Math.min(100,this.l+ve*(arguments.length?t:1)),this.a,this.b)},t.darker=function(t){return new o(Math.max(0,this.l-ve*(arguments.length?t:1)),this.a,this.b)},t.rgb=function(){var t=this.l,e=this.a,n=this.b;return n=(t=(t+16)/116)-n/200,e=we(e=t+e/500)*ye,t=we(t)*_e,n=we(n)*Le,new a(xe(3.2404542*e-1.5371385*t-.4985314*n),xe(-.969266*e+1.8760108*t+.041556*n),xe(.0556434*e-.2040259*t+1.0572252*n))};t=(A.rgb=a).prototype=new pe;function Ce(t){return t<16?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function Se(t,e,n){var r,i=0,o=0,a=0,s=/([a-z]+)\((.*)\)/i.exec(t);if(s)switch(r=s[2].split(","),s[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return e(Ae(r[0]),Ae(r[1]),Ae(r[2]))}return(s=Pe.get(t))?e(s.r,s.g,s.b):(null==t||"#"!==t.charAt(0)||isNaN(s=parseInt(t.substring(1),16))||(4===t.length?(i=(3840&s)>>4,i|=i>>4,o=240&s,o|=o>>4,a=15&s,a|=a<<4):7===t.length&&(i=(16711680&s)>>16,o=(65280&s)>>8,a=255&s)),e(i,o,a))}function Ee(t,e,n){var r,i,o=Math.min(t/=255,e/=255,n/=255),a=Math.max(t,e,n),s=a-o,l=(a+o)/2;return s?(i=l<.5?s/(a+o):s/(2-a-o),r=t==a?(e-n)/s+(e<n?6:0):e==a?(n-t)/s+2:(t-e)/s+4,r*=60):(r=NaN,i=0<l&&l<1?0:r),new u(r,i,l)}function De(t,e,n){var r=ke((.4124564*(t=Te(t))+.3575761*(e=Te(e))+.1804375*(n=Te(n)))/ye),i=ke((.2126729*t+.7151522*e+.072175*n)/_e);return o(116*i-16,500*(r-i),200*(i-ke((.0193339*t+.119192*e+.9503041*n)/Le)))}function Te(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ae(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}t.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,r=this.b;return e||n||r?(e&&e<30&&(e=30),n&&n<30&&(n=30),r&&r<30&&(r=30),new a(Math.min(255,e/t),Math.min(255,n/t),Math.min(255,r/t))):new a(30,30,30)},t.darker=function(t){return new a((t=Math.pow(.7,arguments.length?t:1))*this.r,t*this.g,t*this.b)},t.hsl=function(){return Ee(this.r,this.g,this.b)},t.toString=function(){return"#"+Ce(this.r)+Ce(this.g)+Ce(this.b)};var Pe=A.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});function Ne(t,e){t=A.rgb(t),e=A.rgb(e);var n=t.r,r=t.g,i=t.b,o=e.r-n,a=e.g-r,s=e.b-i;return function(t){return"#"+Ce(Math.round(n+o*t))+Ce(Math.round(r+a*t))+Ce(Math.round(i+s*t))}}function Oe(t,e){var n,r={},i={};for(n in t)n in e?r[n]=Fe(t[n],e[n]):i[n]=t[n];for(n in e)n in t||(i[n]=e[n]);return function(t){for(n in r)i[n]=r[n](t);return i}}function He(t,e){for(var n=[],r=[],i=t.length,o=e.length,a=Math.min(t.length,e.length),s=0;s<a;++s)n.push(Fe(t[s],e[s]));for(;s<i;++s)r[s]=t[s];for(;s<o;++s)r[s]=e[s];return function(t){for(s=0;s<a;++s)r[s]=n[s](t);return r}}function c(e,n){return n-=e=+e,function(t){return e+n*t}}function ze(t,r){var e,n,i,o=Ie.lastIndex=Re.lastIndex=0,a=-1,s=[],l=[];for(t+="",r+="";(e=Ie.exec(t))&&(n=Re.exec(r));)(i=n.index)>o&&(i=r.substring(o,i),s[a]?s[a]+=i:s[++a]=i),(e=e[0])===(n=n[0])?s[a]?s[a]+=n:s[++a]=n:(s[++a]=null,l.push({i:a,x:c(e,n)})),o=Re.lastIndex;return o<r.length&&(i=r.substring(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?l[0]?(r=l[0].x,function(t){return r(t)+""}):function(){return r}:(r=l.length,function(t){for(var e,n=0;n<r;++n)s[(e=l[n]).i]=e.x(t);return s.join("")})}Pe.forEach(function(t,e){Pe.set(t,Me(e))}),A.interpolateRgb=Ne,A.interpolateObject=Oe,A.interpolateArray=He,A.interpolateNumber=c,A.interpolateString=ze;var Ie=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Re=new RegExp(Ie.source,"g");function Fe(t,e){for(var n,r=A.interpolators.length;0<=--r&&!(n=A.interpolators[r](t,e)););return n}function Ge(t){var e,n,r=[t.a,t.b],i=[t.c,t.d],o=We(r),a=Ue(r,i),s=We(((e=i)[0]+=(s=-a)*(n=r)[0],e[1]+=s*n[1],e))||0;r[0]*i[1]<i[0]*r[1]&&(r[0]*=-1,r[1]*=-1,o*=-1,a*=-1),this.rotate=(o?Math.atan2(r[1],r[0]):Math.atan2(-i[0],i[1]))*S,this.translate=[t.e,t.f],this.scale=[o,s],this.skew=s?Math.atan2(a,s)*S:0}function Ue(t,e){return t[0]*e[0]+t[1]*e[1]}function We(t){var e=Math.sqrt(Ue(t,t));return e&&(t[0]/=e,t[1]/=e),e}A.interpolate=Fe,A.interpolators=[function(t,e){var n=typeof e;return("string"==n?Pe.has(e)||/^(#|rgb\(|hsl\()/.test(e)?Ne:ze:e instanceof pe?Ne:Array.isArray(e)?He:"object"==n&&isNaN(e)?Oe:c)(t,e)}],A.transform=function(t){var n=q.createElementNS(A.ns.prefix.svg,"g");return(A.transform=function(t){var e;return null!=t&&(n.setAttribute("transform",t),e=n.transform.baseVal.consolidate()),new Ge(e?e.matrix:Be)})(t)},Ge.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var Be={a:1,b:0,c:0,d:1,e:0,f:0};function je(t,e){var r,i=[],o=[],t=A.transform(t),e=A.transform(e),n=t.translate,a=e.translate,s=t.rotate,l=e.rotate,u=t.skew,h=e.skew,t=t.scale,e=e.scale;return n[0]!=a[0]||n[1]!=a[1]?(i.push("translate(",null,",",null,")"),o.push({i:1,x:c(n[0],a[0])},{i:3,x:c(n[1],a[1])})):a[0]||a[1]?i.push("translate("+a+")"):i.push(""),s!=l?(180<s-l?l+=360:180<l-s&&(s+=360),o.push({i:i.push(i.pop()+"rotate(",null,")")-2,x:c(s,l)})):l&&i.push(i.pop()+"rotate("+l+")"),u!=h?o.push({i:i.push(i.pop()+"skewX(",null,")")-2,x:c(u,h)}):h&&i.push(i.pop()+"skewX("+h+")"),t[0]!=e[0]||t[1]!=e[1]?(r=i.push(i.pop()+"scale(",null,",",null,")"),o.push({i:r-4,x:c(t[0],e[0])},{i:r-2,x:c(t[1],e[1])})):1==e[0]&&1==e[1]||i.push(i.pop()+"scale("+e+")"),r=o.length,function(t){for(var e,n=-1;++n<r;)i[(e=o[n]).i]=e.x(t);return i.join("")}}function Ve(t,r,i,o){var a=t.id;return wt(t,"function"==typeof i?function(t,e,n){t.__transition__[a].tween.set(r,o(i.call(t,t.__data__,e,n)))}:(i=o(i),function(t){t.__transition__[a].tween.set(r,i)}))}function Ye(t){return null==t&&(t=""),function(){this.textContent=t}}function qe(h,c,f,t){var d,p=h.__transition__||(h.__transition__={active:0,count:0}),g=p[f];g||(d=t.time,g=p[f]={tween:new I,time:d,ease:t.ease,delay:t.delay,duration:t.duration},++p.count,A.timer(function(t){var r=h.__data__,i=g.ease,e=g.delay,o=g.duration,n=m,a=[];if(n.t=e+d,e<=t)return s(t-e);function s(t){if(p.active>f)return u();p.active=f,g.event&&g.event.start.call(h,r,c),g.tween.forEach(function(t,e){(e=e.call(h,r,c))&&a.push(e)}),A.timer(function(){return n.c=l(t||1)?Rt:l,1},0,d)}function l(t){if(p.active!==f)return u();for(var t=t/o,e=i(t),n=a.length;0<n;)a[--n].call(h,e);return 1<=t?(g.event&&g.event.end.call(h,r,c),u()):void 0}function u(){return--p.count?delete p[f]:delete h.__transition__,1}n.c=s},0,d))}function Ke(r){return function(t,e,n){return 2===arguments.length&&"function"==typeof e&&(n=e,e=null),Xe(t,e,r,n)}}function Xe(i,o,n,t){var r,a={},s=A.dispatch("beforesend","progress","load","error"),l={},u=new XMLHttpRequest,h=null;function e(){var t,e=u.status;if(!e&&u.responseText||200<=e&&e<300||304===e){try{t=n.call(a,u)}catch(t){return void s.error.call(a,t)}s.load.call(a,t)}else s.error.call(a,u)}return"onload"in(u=!k.XDomainRequest||"withCredentials"in u||!/^(http(s)?:)?\/\//.test(i)?u:new XDomainRequest)?u.onload=u.onerror=e:u.onreadystatechange=function(){3<u.readyState&&e()},u.onprogress=function(t){var e=A.event;A.event=t;try{s.progress.call(a,u)}finally{A.event=e}},a.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?l[t]:(null==e?delete l[t]:l[t]=e+"",a)},a.mimeType=function(t){return arguments.length?(o=null==t?null:t+"",a):o},a.responseType=function(t){return arguments.length?(h=t,a):h},a.response=function(t){return n=t,a},["get","post"].forEach(function(t){a[t]=function(){return a.send.apply(a,[t].concat(Y(arguments)))}}),a.send=function(t,e,n){if(2===arguments.length&&"function"==typeof e&&(n=e,e=null),u.open(t,i,!0),null==o||"accept"in l||(l.accept=o+",*/*"),u.setRequestHeader)for(var r in l)u.setRequestHeader(r,l[r]);return null!=o&&u.overrideMimeType&&u.overrideMimeType(o),null!=h&&(u.responseType=h),null!=n&&a.on("error",n).on("load",function(t){n(null,t)}),s.beforesend.call(a,u),u.send(null==e?null:e),a},a.abort=function(){return u.abort(),a},A.rebind(a,s,"on"),null==t?a:a.get(1===(r=t).length?function(t,e){r(null==t?e:null)}:r)}function $e(t){return JSON.parse(t.responseText)}A.interpolateTransform=je,r.tween=function(e,n){var r=this.id;return arguments.length<2?this.node().__transition__[r].tween.get(e):wt(this,null==n?function(t){t.__transition__[r].tween.remove(e)}:function(t){t.__transition__[r].tween.set(e,n)})},r.attr=function(t,e){if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var r="transform"==t?je:Fe,i=A.ns.qualify(t);function o(){this.removeAttribute(i)}function a(){this.removeAttributeNS(i.space,i.local)}return Ve(this,"attr."+t,e,i.local?function(n){return null==n?a:(n+="",function(){var e,t=this.getAttributeNS(i.space,i.local);return t!==n&&(e=r(t,n),function(t){this.setAttributeNS(i.space,i.local,e(t))})})}:function(n){return null==n?o:(n+="",function(){var e,t=this.getAttribute(i);return t!==n&&(e=r(t,n),function(t){this.setAttribute(i,e(t))})})})},r.attrTween=function(t,r){var i=A.ns.qualify(t);return this.tween("attr."+t,i.local?function(t,e){var n=r.call(this,t,e,this.getAttributeNS(i.space,i.local));return n&&function(t){this.setAttributeNS(i.space,i.local,n(t))}}:function(t,e){var n=r.call(this,t,e,this.getAttribute(i));return n&&function(t){this.setAttribute(i,n(t))}})},r.style=function(r,t,i){var e=arguments.length;if(e<3){if("string"!=typeof r){for(i in e<2&&(t=""),r)this.style(i,r[i],t);return this}i=""}function o(){this.style.removeProperty(r)}return Ve(this,"style."+r,t,function(n){return null==n?o:(n+="",function(){var e,t=k.getComputedStyle(this,null).getPropertyValue(r);return t!==n&&(e=Fe(t,n),function(t){this.style.setProperty(r,e(t),i)})})})},r.styleTween=function(r,i,o){return arguments.length<3&&(o=""),this.tween("style."+r,function(t,e){var n=i.call(this,t,e,k.getComputedStyle(this,null).getPropertyValue(r));return n&&function(t){this.style.setProperty(r,n(t),o)}})},r.text=function(t){return Ve(this,"text",t,Ye)},r.remove=function(){return this.each("end.transition",function(){var t;this.__transition__.count<2&&(t=this.parentNode)&&t.removeChild(this)})},r.ease=function(e){var n=this.id;return arguments.length<1?this.node().__transition__[n].ease:("function"!=typeof e&&(e=A.ease.apply(A,arguments)),wt(this,function(t){t.__transition__[n].ease=e}))},r.delay=function(r){var i=this.id;return arguments.length<1?this.node().__transition__[i].delay:wt(this,"function"==typeof r?function(t,e,n){t.__transition__[i].delay=+r.call(t,t.__data__,e,n)}:(r=+r,function(t){t.__transition__[i].delay=r}))},r.duration=function(r){var i=this.id;return arguments.length<1?this.node().__transition__[i].duration:wt(this,"function"==typeof r?function(t,e,n){t.__transition__[i].duration=Math.max(1,r.call(t,t.__data__,e,n))}:(r=Math.max(1,r),function(t){t.__transition__[i].duration=r}))},r.transition=function(){for(var t,e,n,r=this.id,i=++de,o=[],a=0,s=this.length;a<s;a++){o.push(t=[]);for(var l,u=0,h=(l=this[a]).length;u<h;u++)(e=l[u])&&((n=Object.create(e.__transition__[r])).delay+=n.duration,qe(e,u,i,n)),t.push(e)}return he(o,i)},r.each=function(r,e){var t,n,i=this.id;return arguments.length<2?(t=fe,n=ce,ce=i,wt(this,function(t,e,n){fe=t.__transition__[i],r.call(t,t.__data__,e,n)}),fe=t,ce=n):wt(this,function(t){t=t.__transition__[i];(t.event||(t.event=A.dispatch("start","end"))).on(r,e)}),this},A.xhr=Ke(qt),A.json=function(t,e){return Xe(t,"application/json",$e,e)};var E=A.time={},D=Date;function Ze(){this._=new Date(1<arguments.length?Date.UTC.apply(this,arguments):arguments[0])}Ze.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){e.setUTCDate.apply(this._,arguments)},setDay:function(){e.setUTCDay.apply(this._,arguments)},setFullYear:function(){e.setUTCFullYear.apply(this._,arguments)},setHours:function(){e.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){e.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){e.setUTCMinutes.apply(this._,arguments)},setMonth:function(){e.setUTCMonth.apply(this._,arguments)},setSeconds:function(){e.setUTCSeconds.apply(this._,arguments)},setTime:function(){e.setTime.apply(this._,arguments)}};var e=Date.prototype;function Je(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}A.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var Qe=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(function(t,e){var n=Math.pow(10,3*P(8-e));return{scale:8<e?function(t){return t/n}:function(t){return t*n},symbol:t}});A.formatPrefix=function(t,e){var n=0;return t&&(t<0&&(t*=-1),e&&(t=A.round(t,Je(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),Qe[8+n/3]};var tn=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,en=A.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=A.round(t,Je(t,e))).toFixed(Math.max(0,Math.min(20,Je(t*(1+1e-15),e))))}});function nn(t){return t+""}function rn(r,o,a){function t(t){var e=r(t),n=i(e,1);return t-e<n-t?e:n}function s(t){return o(t=r(new D(t-1)),1),t}function i(t,e){return o(t=new D(+t),e),t}function l(t,e,n){var r=s(t),i=[];if(1<n)for(;r<e;)a(r)%n||i.push(new Date(+r)),o(r,1);else for(;r<e;)i.push(new Date(+r)),o(r,1);return i}(r.floor=r).round=t,r.ceil=s,r.offset=i,r.range=l;var e=r.utc=on(r);return(e.floor=e).round=on(t),e.ceil=on(s),e.offset=on(i),e.range=function(t,e,n){try{var r=new(D=Ze);return r._=t,l(r,e,n)}finally{D=Date}},r}function on(r){return function(t,e){try{var n=new(D=Ze);return n._=t,r(n,e)._}finally{D=Date}}}function an(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,l=t.shortMonths;function u(s){var l=s.length;function t(t){for(var e,n,r,i=[],o=-1,a=0;++o<l;)37===s.charCodeAt(o)&&(i.push(s.substring(a,o)),null!=(n=sn[e=s.charAt(++o)])&&(e=s.charAt(++o)),(r=L[e])&&(e=r(t,null==n?"e"===e?" ":"0":n)),i.push(e),a=o+1);return i.push(s.substring(a,o)),i.join("")}return t.parse=function(t){var e={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(h(e,s,t,0)!=t.length)return null;"p"in e&&(e.H=e.H%12+12*e.p);var t=null!=e.Z&&D!==Ze,n=new(t?Ze:D);return"j"in e?n.setFullYear(e.y,0,e.j):"w"in e&&("W"in e||"U"in e)?(n.setFullYear(e.y,0,1),n.setFullYear(e.y,0,"W"in e?(e.w+6)%7+7*e.W-(n.getDay()+5)%7:e.w+7*e.U-(n.getDay()+6)%7)):n.setFullYear(e.y,e.m,e.d),n.setHours(e.H+Math.floor(e.Z/100),e.M+e.Z%100,e.S,e.L),t?n._:n},t.toString=function(){return s},t}function h(t,e,n,r){for(var i,o,a=0,s=e.length,l=n.length;a<s;){if(l<=r)return-1;if(37===(i=e.charCodeAt(a++))){if(o=e.charAt(a++),!(o=b[o in sn?e.charAt(a++):o])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}u.multi=(u.utc=function(t){var n=u(t);function e(t){try{var e=new(D=Ze);return e._=t,n(e)}finally{D=Date}}return e.parse=function(t){try{D=Ze;var e=n.parse(t);return e&&e._}finally{D=Date}},e.toString=n.toString,e}).multi=Cn;var c=A.map(),f=un(o),d=hn(o),p=un(a),g=hn(a),m=un(s),v=hn(s),y=un(l),_=hn(l),L=(i.forEach(function(t,e){c.set(t.toLowerCase(),e)}),{a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:u(e),d:function(t,e){return T(t.getDate(),e,2)},e:function(t,e){return T(t.getDate(),e,2)},H:function(t,e){return T(t.getHours(),e,2)},I:function(t,e){return T(t.getHours()%12||12,e,2)},j:function(t,e){return T(1+E.dayOfYear(t),e,3)},L:function(t,e){return T(t.getMilliseconds(),e,3)},m:function(t,e){return T(t.getMonth()+1,e,2)},M:function(t,e){return T(t.getMinutes(),e,2)},p:function(t){return i[+(12<=t.getHours())]},S:function(t,e){return T(t.getSeconds(),e,2)},U:function(t,e){return T(E.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return T(E.mondayOfYear(t),e,2)},x:u(n),X:u(r),y:function(t,e){return T(t.getFullYear()%100,e,2)},Y:function(t,e){return T(t.getFullYear()%1e4,e,4)},Z:xn,"%":function(){return"%"}}),b={a:function(t,e,n){p.lastIndex=0;e=p.exec(e.substring(n));return e?(t.w=g.get(e[0].toLowerCase()),n+e[0].length):-1},A:function(t,e,n){f.lastIndex=0;e=f.exec(e.substring(n));return e?(t.w=d.get(e[0].toLowerCase()),n+e[0].length):-1},b:function(t,e,n){y.lastIndex=0;e=y.exec(e.substring(n));return e?(t.m=_.get(e[0].toLowerCase()),n+e[0].length):-1},B:function(t,e,n){m.lastIndex=0;e=m.exec(e.substring(n));return e?(t.m=v.get(e[0].toLowerCase()),n+e[0].length):-1},c:function(t,e,n){return h(t,L.c.toString(),e,n)},d:yn,e:yn,H:Ln,I:Ln,j:_n,L:kn,m:vn,M:bn,p:function(t,e,n){e=c.get(e.substring(n,n+=2).toLowerCase());return null==e?-1:(t.p=e,n)},S:wn,U:fn,w:cn,W:dn,x:function(t,e,n){return h(t,L.x.toString(),e,n)},X:function(t,e,n){return h(t,L.X.toString(),e,n)},y:gn,Y:pn,Z:mn,"%":Mn};return u}E.year=rn(function(t){return(t=E.day(t)).setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),E.years=E.year.range,E.years.utc=E.year.utc.range,E.day=rn(function(t){var e=new D(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),E.days=E.day.range,E.days.utc=E.day.utc.range,E.dayOfYear=function(t){var e=E.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,n){n=7-n;var e=E[t]=rn(function(t){return(t=E.day(t)).setDate(t.getDate()-(t.getDay()+n)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var e=E.year(t).getDay();return Math.floor((E.dayOfYear(t)+(e+n)%7)/7)-(e!==n)});E[t+"s"]=e.range,E[t+"s"].utc=e.utc.range,E[t+"OfYear"]=function(t){var e=E.year(t).getDay();return Math.floor((E.dayOfYear(t)+(e+n)%7)/7)}}),E.week=E.sunday,E.weeks=E.sunday.range,E.weeks.utc=E.sunday.utc.range,E.weekOfYear=E.sundayOfYear;var sn={"-":"",_:" ",0:"0"},s=/^\s*\d+/,ln=/^%/;function T(t,e,n){var r=t<0?"-":"",t=(r?-t:t)+"",i=t.length;return r+(i<n?new Array(n-i+1).join(e)+t:t)}function un(t){return new RegExp("^(?:"+t.map(A.requote).join("|")+")","i")}function hn(t){for(var e=new I,n=-1,r=t.length;++n<r;)e.set(t[n].toLowerCase(),n);return e}function cn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+1));return e?(t.w=+e[0],n+e[0].length):-1}function fn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n));return e?(t.U=+e[0],n+e[0].length):-1}function dn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n));return e?(t.W=+e[0],n+e[0].length):-1}function pn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+4));return e?(t.y=+e[0],n+e[0].length):-1}function gn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+2));return e?(t.y=(t=+e[0])+(68<t?1900:2e3),n+e[0].length):-1}function mn(t,e,n){return/^[+-]\d{4}$/.test(e=e.substring(n,n+5))?(t.Z=-e,n+5):-1}function vn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+2));return e?(t.m=e[0]-1,n+e[0].length):-1}function yn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+2));return e?(t.d=+e[0],n+e[0].length):-1}function _n(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+3));return e?(t.j=+e[0],n+e[0].length):-1}function Ln(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+2));return e?(t.H=+e[0],n+e[0].length):-1}function bn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+2));return e?(t.M=+e[0],n+e[0].length):-1}function wn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+2));return e?(t.S=+e[0],n+e[0].length):-1}function kn(t,e,n){s.lastIndex=0;e=s.exec(e.substring(n,n+3));return e?(t.L=+e[0],n+e[0].length):-1}function xn(t){var t=t.getTimezoneOffset(),e=0<t?"-":"+",n=~~(P(t)/60),t=P(t)%60;return e+T(n,"0",2)+T(t,"0",2)}function Mn(t,e,n){ln.lastIndex=0;e=ln.exec(e.substring(n,n+1));return e?n+e[0].length:-1}function Cn(r){for(var t=r.length,e=-1;++e<t;)r[e][0]=this(r[e][0]);return function(t){for(var e=0,n=r[e];!n[1](t);)n=r[++e];return n[0](t)}}A.locale=function(t){return{numberFormat:(L=t.decimal,o=t.thousands,a=t.grouping,n=t.currency,b=a?function(t){for(var e=t.length,n=[],r=0,i=a[0];0<e&&0<i;)n.push(t.substring(e-=i,e+i)),i=a[r=(r+1)%a.length];return n.reverse().join(o)}:qt,function(t){var t=tn.exec(t),s=t[1]||" ",l=t[2]||">",u=t[3]||"",e=t[4]||"",h=t[5],c=+t[6],f=t[7],d=t[8],p=t[9],g=1,m="",v="",y=!1,d=d&&+d.substring(1);switch((h||"0"===s&&"="===l)&&(h=s="0",l="=",f&&(c-=Math.floor((c-1)/4))),p){case"n":f=!0,p="g";break;case"%":g=100,v="%",p="f";break;case"p":g=100,v="%",p="r";break;case"b":case"o":case"x":case"X":"#"===e&&(m="0"+p.toLowerCase());case"c":case"d":y=!0,d=0;break;case"s":g=-1,p="r"}"$"===e&&(m=n[0],v=n[1]),"r"!=p||d||(p="g"),null!=d&&("g"==p?d=Math.max(1,Math.min(21,d)):"e"!=p&&"f"!=p||(d=Math.max(0,Math.min(20,d))));var p=en.get(p)||nn,_=h&&f;return function(t){var e,n,r,i,o,a=v;return y&&t%1?"":(e=t<0||0===t&&1/t<0?(t=-t,"-"):u,g<0?(t=(r=A.formatPrefix(t,d)).scale(t),a=r.symbol+v):t*=g,n=(r=(t=p(t,d)).lastIndexOf("."))<0?t:t.substring(0,r),r=r<0?"":L+t.substring(r+1),!h&&f&&(n=b(n)),o=(i=m.length+n.length+r.length+(_?0:e.length))<c?new Array(i=c-i+1).join(s):"",_&&(n=b(o+n)),e+=m,t=n+r,("<"===l?e+t+o:">"===l?o+e+t:"^"===l?o.substring(0,i>>=1)+e+t+o.substring(i):e+(_?t:o+t))+a)}}),timeFormat:an(t)};var L,o,a,n,b};t=A.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});E.format=t.timeFormat;function Sn(t){return[Math.atan2(t[1],t[0]),Zt(t[2])]}function En(t,e){return P(t[0]-e[0])<N&&P(t[1]-e[1])<N}function Dn(t,e,n,r,s){var l=[],u=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],r=t[e];if(En(n,r)){s.lineStart();for(var i=0;i<e;++i)s.point((n=t[i])[0],n[1]);s.lineEnd()}else{var o=new An(n,t,null,!0),a=new An(n,null,o,!1);o.o=a,l.push(o),u.push(a),o=new An(r,t,null,!1),a=new An(r,null,o,!0),o.o=a,l.push(o),u.push(a)}}}),u.sort(e),Tn(l),Tn(u),l.length){for(var i=0,o=n,a=u.length;i<a;++i)u[i].e=o=!o;for(var h,c=l[0];;){for(var f=c,d=!0;f.v;)if((f=f.n)===c)return;p=f.z,s.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(i=0,a=p.length;i<a;++i)s.point((h=p[i])[0],h[1]);else r(f.x,f.n.x,1,s);f=f.n}else{if(d)for(var p,i=(p=f.p.z).length-1;0<=i;--i)s.point((h=p[i])[0],h[1]);else r(f.x,f.p.x,-1,s);f=f.p}}while(p=(f=f.o).z,d=!d,!f.v);s.lineEnd()}}}function Tn(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function An(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Pn(y,_,L,b){return function(r,a){var s,n=_(a),e=r.invert(b[0],b[1]),i={point:o,lineStart:l,lineEnd:u,polygonStart:function(){i.point=g,i.lineStart=m,i.lineEnd=v,s=[],h=[]},polygonEnd:function(){i.point=o,i.lineStart=l,i.lineEnd=u,s=A.merge(s);var t=function(t,e){var n=t[0],r=t[1],i=[Math.sin(n),-Math.cos(n),0],o=0,a=0;Vn.reset();for(var s=0,l=e.length;s<l;++s){var u=e[s],h=u.length;if(h)for(var c=u[0],f=c[0],d=c[1]/2+M/4,p=Math.sin(d),g=Math.cos(d),m=1;;){var v=(t=u[m=m===h?0:m])[0],y=t[1]/2+M/4,_=Math.sin(y),y=Math.cos(y),L=v-f,b=0<=L?1:-1,w=b*L,k=M<w,x=p*_;if(Vn.add(Math.atan2(x*b*Math.sin(w),g*y+x*Math.cos(w))),o+=k?L+b*C:L,k^n<=f^n<=v&&(Jn(x=Xn(qn(c),qn(t))),Jn(w=Xn(i,x)),((b=(k^0<=L?-1:1)*Zt(w[2]))<r||r===b&&(x[0]||x[1]))&&(a+=k^0<=L?1:-1)),!m++)break;f=v,p=_,g=y,c=t}}return(o<-N||o<N&&Vn<0)^1&a}(e,h);s.length?(p||(a.polygonStart(),p=!0),Dn(s,Hn,t,L,a)):t&&(p||(a.polygonStart(),p=!0),a.lineStart(),L(null,null,1,a),a.lineEnd()),p&&(a.polygonEnd(),p=!1),s=h=null},sphere:function(){a.polygonStart(),a.lineStart(),L(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function o(t,e){var n=r(t,e);y(t=n[0],e=n[1])&&a.point(t,e)}function t(t,e){t=r(t,e);n.point(t[0],t[1])}function l(){i.point=t,n.lineStart()}function u(){i.point=o,n.lineEnd()}var h,c,f=On(),d=_(f),p=!1;function g(t,e){c.push([t,e]);t=r(t,e);d.point(t[0],t[1])}function m(){d.lineStart(),c=[]}function v(){g(c[0][0],c[0][1]),d.lineEnd();var t=d.clean(),e=f.buffer(),n=e.length;if(c.pop(),h.push(c),c=null,n)if(1&t){var r,i,o=-1;if(0<(n=(r=e[0]).length-1)){for(p||(a.polygonStart(),p=!0),a.lineStart();++o<n;)a.point((i=r[o])[0],i[1]);a.lineEnd()}}else 1<n&&2&t&&e.push(e.pop().concat(e.shift())),s.push(e.filter(Nn))}return i}}function Nn(t){return 1<t.length}function On(){var n,e=[];return{lineStart:function(){e.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:l,buffer:function(){var t=e;return e=[],n=null,t},rejoin:function(){1<e.length&&e.push(e.pop().concat(e.shift()))}}}function Hn(t,e){return((t=t.x)[0]<0?t[1]-p-N:p-t[1])-((e=e.x)[0]<0?e[1]-p-N:p-e[1])}function zn(){}A.text=Ke(function(t){return t.responseText}),A.geo={},A.merge=function(t){for(var e,n,r,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(n=new Array(a);0<=--i;)for(e=(r=t[i]).length;0<=--e;)n[--a]=r[e];return n},zn.prototype={s:0,t:0,add:function(t){Rn(t,this.t,In),Rn(In.s,this.s,this),this.s?this.t+=In.t:this.s=In.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var In=new zn;function Rn(t,e,n){var r=n.s=t+e,i=r-t;n.t=t-(r-i)+(e-i)}function Fn(t,e){t&&Un.hasOwnProperty(t.type)&&Un[t.type](t,e)}A.geo.stream=function(t,e){t&&Gn.hasOwnProperty(t.type)?Gn[t.type](t,e):Fn(t,e)};var Gn={Feature:function(t,e){Fn(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)Fn(n[r].geometry,e)}},Un={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Wn(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Wn(n[r],e,0)},Polygon:function(t,e){Bn(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Bn(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)Fn(n[r],e)}};function Wn(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function Bn(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Wn(t[n],e,1);e.polygonEnd()}A.geo.area=function(t){return jn=0,A.geo.stream(t,h),jn};var jn,Vn=new zn,h={sphere:function(){jn+=4*M},point:l,lineStart:l,lineEnd:l,polygonStart:function(){Vn.reset(),h.lineStart=Yn},polygonEnd:function(){var t=2*Vn;jn+=t<0?4*M+t:t,h.lineStart=h.lineEnd=h.point=l}};function Yn(){var n,r,s,l,u;function i(t,e){e=e*x/2+M/4;var n=(t*=x)-s,r=0<=n?1:-1,n=r*n,i=Math.cos(e),e=Math.sin(e),o=u*e,a=l*i+o*Math.cos(n),o=o*r*Math.sin(n);Vn.add(Math.atan2(o,a)),s=t,l=i,u=e}h.point=function(t,e){h.point=i,s=(n=t)*x,l=Math.cos(e=(r=e)*x/2+M/4),u=Math.sin(e)},h.lineEnd=function(){i(n,r)}}function qn(t){var e=t[0],t=t[1],n=Math.cos(t);return[n*Math.cos(e),n*Math.sin(e),Math.sin(t)]}function Kn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xn(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function $n(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Zn(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Jn(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Qn=Pn(Rt,function(u){var h,c=NaN,f=NaN,d=NaN;return{lineStart:function(){u.lineStart(),h=1},point:function(t,e){var n,r,i,o,a,s=0<t?M:-M,l=P(t-c);P(l-M)<N?(u.point(c,f=0<(f+e)/2?p:-p),u.point(d,f),u.lineEnd(),u.lineStart(),u.point(s,f),u.point(t,f),h=0):d!==s&&M<=l&&(P(c-d)<N&&(c-=d*N),P(t-s)<N&&(t-=s*N),l=c,n=f,r=t,i=e,a=Math.sin(l-r),f=P(a)>N?Math.atan((Math.sin(n)*(o=Math.cos(i))*Math.sin(r)-Math.sin(i)*(r=Math.cos(n))*Math.sin(l))/(r*o*a)):(n+i)/2,u.point(d,f),u.lineEnd(),u.lineStart(),u.point(s,f),h=0),u.point(c=t,f=e),d=s},lineEnd:function(){u.lineEnd(),c=f=NaN},clean:function(){return 2-h}}},function(t,e,n,r){var i;null==t?(i=n*p,r.point(-M,i),r.point(0,i),r.point(M,i),r.point(M,0),r.point(M,-i),r.point(0,-i),r.point(-M,-i),r.point(-M,0),r.point(-M,i)):P(t[0]-e[0])>N?(t=t[0]<e[0]?M:-M,i=n*t/2,r.point(-t,i),r.point(0,i),r.point(t,i)):r.point(e[0],e[1])},[-M,-M/2]);function tr(t,e){return[t,e]}function er(t,e){return[M<t?t-C:t<-M?t+C:t,e]}function nr(t,e,n){return t?e||n?Sr(ir(t),or(e,n)):ir(t):e||n?or(e,n):er}function rr(n){return function(t,e){return[M<(t+=n)?t-C:t<-M?t+C:t,e]}}function ir(t){var e=rr(t);return e.invert=rr(-t),e}function or(t,e){var i=Math.cos(t),o=Math.sin(t),a=Math.cos(e),s=Math.sin(e);function n(t,e){var n=Math.cos(e),r=Math.cos(t)*n,t=Math.sin(t)*n,n=Math.sin(e),e=n*i+r*o;return[Math.atan2(t*a-e*s,r*i-n*o),Zt(e*a+t*s)]}return n.invert=function(t,e){var n=Math.cos(e),r=Math.cos(t)*n,t=Math.sin(t)*n,n=Math.sin(e),e=n*a-t*s;return[Math.atan2(t*a+n*s,r*i+e*o),Zt(e*i-r*o)]},n}function ar(s,l){var u=Math.cos(s),h=Math.sin(s);return function(t,e,n,r){var i=n*l;null!=t?(t=sr(u,t),e=sr(u,e),(0<n?t<e:e<t)&&(t+=n*C)):(t=s+n*C,e=s-.5*i);for(var o,a=t;0<n?e<a:a<e;a-=i)r.point((o=Sn([u,-h*Math.cos(a),-h*Math.sin(a)]))[0],o[1])}}function sr(t,e){e=qn(e),e[0]-=t,Jn(e),t=$t(-e[1]);return((-e[2]<0?-t:t)+2*Math.PI-N)%(2*Math.PI)}function lr(i){var g=Math.cos(i),c=0<g,f=P(g)>N;return Pn(d,function(o){var a,s,l,u,h;return{lineStart:function(){u=l=!1,h=1},point:function(t,e){var n,r=[t,e],i=d(t,e),t=c?i?0:m(t,e):i?m(t+(t<0?M:-M),e):0;!a&&(u=l=i)&&o.lineStart(),i!==l&&(n=p(a,r),(En(a,n)||En(r,n))&&(r[0]+=N,r[1]+=N,i=d(r[0],r[1]))),i!==l?(h=0,i?(o.lineStart(),n=p(r,a),o.point(n[0],n[1])):(n=p(a,r),o.point(n[0],n[1]),o.lineEnd()),a=n):f&&a&&c^i&&(t&s||!(e=p(r,a,!0))||(h=0,c?(o.lineStart(),o.point(e[0][0],e[0][1]),o.point(e[1][0],e[1][1]),o.lineEnd()):(o.point(e[1][0],e[1][1]),o.lineEnd(),o.lineStart(),o.point(e[0][0],e[0][1])))),!i||a&&En(a,r)||o.point(r[0],r[1]),a=r,l=i,s=t},lineEnd:function(){l&&o.lineEnd(),a=null},clean:function(){return h|(u&&l)<<1}}},ar(i,6*x),c?[0,-i]:[-M,i-M]);function d(t,e){return Math.cos(t)*Math.cos(e)>g}function p(t,e,n){var r,i,o,a,s,l,u,h=[1,0,0],c=Xn(qn(t),qn(e)),f=Kn(c,c),d=c[0],p=f-d*d;return p?(r=Xn(h,c),$n(h=Zn(h,g*f/p),Zn(c,-g*d/p)),(p=(c=Kn(h,f=r))*c-(d=Kn(f,f))*(Kn(h,h)-1))<0?void 0:($n(p=Zn(f,(-c-(r=Math.sqrt(p)))/d),h),p=Sn(p),n?(i=t[0],o=e[0],a=t[1],e=e[1],o<i&&(u=i,i=o,o=u),!(l=P((s=o-i)-M)<N)&&e<a&&(u=a,a=e,e=u),(l||s<N?l?0<a+e^p[1]<(P(p[0]-i)<N?a:e):a<=p[1]&&p[1]<=e:M<s^(i<=p[0]&&p[0]<=o))?($n(u=Zn(f,(-c+r)/d),h),[p,Sn(u)]):void 0):p)):!n&&t}function m(t,e){var n=c?i:M-i,r=0;return t<-n?r|=1:n<t&&(r|=2),e<-n?r|=4:n<e&&(r|=8),r}}(A.geo.equirectangular=function(){return li(tr)}).raw=tr.invert=tr,A.geo.rotation=function(e){function t(t){return(t=e(t[0]*x,t[1]*x))[0]*=S,t[1]*=S,t}return e=nr(e[0]%360*x,e[1]*x,2<e.length?e[2]*x:0),t.invert=function(t){return(t=e.invert(t[0]*x,t[1]*x))[0]*=S,t[1]*=S,t},t},er.invert=tr,A.geo.circle=function(){var e,i,o=[0,0],n=6;function r(){var t="function"==typeof o?o.apply(this,arguments):o,n=nr(-t[0]*x,-t[1]*x,0).invert,r=[];return i(null,null,1,{point:function(t,e){r.push(t=n(t,e)),t[0]*=S,t[1]*=S}}),{type:"Polygon",coordinates:[r]}}return r.origin=function(t){return arguments.length?(o=t,r):o},r.angle=function(t){return arguments.length?(i=ar((e=+t)*x,n*x),r):e},r.precision=function(t){return arguments.length?(i=ar(e*x,(n=+t)*x),r):n},r.angle(90)};var f,d,g,v,ur,hr,cr,fr,dr,pr,gr,y,mr,vr,yr,_r,_,Lr,br,L,wr,kr,xr,Mr=1e9;function Cr(x,M,C,S){return function(i){var r,h,o,l,u,c,f,a,s,d,p,g,m,v,y,_=i,t=On(),L=(l=x,u=M,c=C,f=S,function(t){var e=t.a,n=t.b,r=e.x,e=e.y,i=0,o=1,a=n.x-r,n=n.y-e,s=l-r;if(a||!(0<s)){if(s/=a,a<0){if(s<i)return;s<o&&(o=s)}else if(0<a){if(o<s)return;i<s&&(i=s)}if(s=c-r,a||!(s<0)){if(s/=a,a<0){if(o<s)return;i<s&&(i=s)}else if(0<a){if(s<i)return;s<o&&(o=s)}if(s=u-e,n||!(0<s)){if(s/=n,n<0){if(s<i)return;s<o&&(o=s)}else if(0<n){if(o<s)return;i<s&&(i=s)}if(s=f-e,n||!(s<0)){if(s/=n,n<0){if(o<s)return;i<s&&(i=s)}else if(0<n){if(s<i)return;s<o&&(o=s)}return 0<i&&(t.a={x:r+i*a,y:e+i*n}),o<1&&(t.b={x:r+o*a,y:e+o*n}),t}}}}}),e={point:n,lineStart:function(){e.point=k,h&&h.push(o=[]);v=!0,m=!1,p=g=NaN},lineEnd:function(){r&&(k(a,s),d&&m&&t.rejoin(),r.push(t.buffer()));e.point=n,m&&i.lineEnd()},polygonStart:function(){i=t,r=[],h=[],y=!0},polygonEnd:function(){i=_,r=A.merge(r);var t=function(t){for(var e=0,n=h.length,r=t[1],i=0;i<n;++i)for(var o,a=1,s=h[i],l=s.length,u=s[0];a<l;++a)o=s[a],u[1]<=r?o[1]>r&&0<Xt(u,o,t)&&++e:o[1]<=r&&Xt(u,o,t)<0&&--e,u=o;return 0!==e}([x,S]),e=y&&t,n=r.length;(e||n)&&(i.polygonStart(),e&&(i.lineStart(),b(null,null,1,i),i.lineEnd()),n&&Dn(r,D,t,b,i),i.polygonEnd()),r=h=o=null}};function b(t,e,n,r){var i=0,o=0;if(null==t||(i=E(t,n))!==(o=E(e,n))||T(t,e)<0^0<n)for(;r.point(0===i||3===i?x:C,1<i?S:M),(i=(i+n+4)%4)!==o;);else r.point(e[0],e[1])}function w(t,e){return x<=t&&t<=C&&M<=e&&e<=S}function n(t,e){w(t,e)&&i.point(t,e)}function k(t,e){var n,r=w(t=Math.max(-Mr,Math.min(Mr,t)),e=Math.max(-Mr,Math.min(Mr,e)));h&&o.push([t,e]),v?(a=t,s=e,v=!1,(d=r)&&(i.lineStart(),i.point(t,e))):r&&m?i.point(t,e):L(n={a:{x:p,y:g},b:{x:t,y:e}})?(m||(i.lineStart(),i.point(n.a.x,n.a.y)),i.point(n.b.x,n.b.y),r||i.lineEnd(),y=!1):r&&(i.lineStart(),i.point(t,e),y=!1),p=t,g=e,m=r}return e};function E(t,e){return P(t[0]-x)<N?0<e?0:3:P(t[0]-C)<N?0<e?2:1:P(t[1]-M)<N?0<e?1:0:0<e?3:2}function D(t,e){return T(t.x,e.x)}function T(t,e){var n=E(t,1),r=E(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}}function Sr(n,r){function t(t,e){return t=n(t,e),r(t[0],t[1])}return n.invert&&r.invert&&(t.invert=function(t,e){return(t=r.invert(t,e))&&n.invert(t[0],t[1])}),t}function Er(t,e){var t=Math.sin(t),n=(t+Math.sin(e))/2,r=1+t*(2*n-t),i=Math.sqrt(r)/n;function o(t,e){e=Math.sqrt(r-2*n*Math.sin(e))/n;return[e*Math.sin(t*=n),i-e*Math.cos(t)]}return o.invert=function(t,e){e=i-e;return[Math.atan2(t,e)/n,Zt((r-(t*t+e*e)*n*n)/(2*n))]},o}function Dr(t,e){pr.push(gr=[f=t,g=t]),e<d&&(d=e),v<e&&(v=e)}function Tr(t,e){var n,r,i,o,a,s=qn([t*x,e*x]);fr?(n=Xn(fr,s),Jn(n=Xn([n[1],-n[0],0],n)),n=Sn(n),o=t-ur,i=n[0]*S*(r=0<o?1:-1),(o=180<P(o))^(r*ur<i&&i<r*t)?(a=n[1]*S,v<a&&(v=a)):o^(r*ur<(i=(360+i)%360-180)&&i<r*t)?(a=-n[1]*S)<d&&(d=a):(e<d&&(d=e),v<e&&(v=e)),o?t<ur?b(f,t)>b(f,g)&&(g=t):b(t,g)>b(f,g)&&(f=t):f<=g?(t<f&&(f=t),g<t&&(g=t)):ur<t?b(f,t)>b(f,g)&&(g=t):b(t,g)>b(f,g)&&(f=t)):Dr(t,e),fr=s,ur=t}function Ar(){y.point=Tr}function Pr(){gr[0]=f,gr[1]=g,y.point=Dr,fr=null}function Nr(t,e){var n;fr?dr+=180<P(n=t-ur)?n+(0<n?360:-360):n:(hr=t,cr=e),h.point(t,e),Tr(t,e)}function Or(){h.lineStart()}function Hr(){Nr(hr,cr),h.lineEnd(),P(dr)>N&&(f=-(g=180)),gr[0]=f,gr[1]=g,fr=null}function b(t,e){return(e-=t)<0?e+360:e}function zr(t,e){return t[0]-e[0]}function Ir(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}A.geo.clipExtent=function(){var e,n,r,i,o,a,s={stream:function(t){return o&&(o.valid=!1),(o=a(t)).valid=!0,o},extent:function(t){return arguments.length?(a=Cr(e=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),o&&(o.valid=!1,o=null),s):[[e,n],[r,i]]}};return s.extent([[0,0],[960,500]])},(A.geo.conicEqualArea=function(){return e=0,n=M/3,(t=(r=ui(t=Er))(e,n)).parallels=function(t){return arguments.length?r(e=t[0]*M/180,n=t[1]*M/180):[e/M*180,n/M*180]},t;var t,e,n,r}).raw=Er,A.geo.albers=function(){return A.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},A.geo.albersUsa=function(){var n,i,o,a,s=A.geo.albers(),l=A.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=A.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),h={point:function(t,e){n=[t,e]}};function c(t){var e=t[0],t=t[1];return n=null,i(e,t),n||(o(e,t),n)||a(e,t),n}return c.invert=function(t){var e=s.scale(),n=s.translate(),r=(t[0]-n[0])/e,n=(t[1]-n[1])/e;return(.12<=n&&n<.234&&-.425<=r&&r<-.214?l:.166<=n&&n<.234&&-.214<=r&&r<-.115?u:s).invert(t)},c.stream=function(t){var n=s.stream(t),r=l.stream(t),i=u.stream(t);return{point:function(t,e){n.point(t,e),r.point(t,e),i.point(t,e)},sphere:function(){n.sphere(),r.sphere(),i.sphere()},lineStart:function(){n.lineStart(),r.lineStart(),i.lineStart()},lineEnd:function(){n.lineEnd(),r.lineEnd(),i.lineEnd()},polygonStart:function(){n.polygonStart(),r.polygonStart(),i.polygonStart()},polygonEnd:function(){n.polygonEnd(),r.polygonEnd(),i.polygonEnd()}}},c.precision=function(t){return arguments.length?(s.precision(t),l.precision(t),u.precision(t),c):s.precision()},c.scale=function(t){return arguments.length?(s.scale(t),l.scale(.35*t),u.scale(t),c.translate(s.translate())):s.scale()},c.translate=function(t){var e,n,r;return arguments.length?(e=s.scale(),n=+t[0],r=+t[1],i=s.translate(t).clipExtent([[n-.455*e,r-.238*e],[n+.455*e,r+.238*e]]).stream(h).point,o=l.translate([n-.307*e,r+.201*e]).clipExtent([[n-.425*e+N,r+.12*e+N],[n-.214*e-N,r+.234*e-N]]).stream(h).point,a=u.translate([n-.205*e,r+.212*e]).clipExtent([[n-.214*e+N,r+.166*e+N],[n-.115*e-N,r+.234*e-N]]).stream(h).point,c):s.translate()},c.scale(1070)},A.geo.bounds=(y={point:Dr,lineStart:Ar,lineEnd:Pr,polygonStart:function(){y.point=Nr,y.lineStart=Or,y.lineEnd=Hr,dr=0,h.polygonStart()},polygonEnd:function(){h.polygonEnd(),y.point=Dr,y.lineStart=Ar,y.lineEnd=Pr,Vn<0?(f=-(g=180),d=-(v=90)):N<dr?v=90:dr<-N&&(d=-90),gr[0]=f,gr[1]=g}},function(t){if(v=g=-(f=d=1/0),pr=[],A.geo.stream(t,y),i=pr.length){pr.sort(zr);for(var e=1,n=[s=pr[0]];e<i;++e)Ir((o=pr[e])[0],s)||Ir(o[1],s)?(b(s[0],o[1])>b(s[0],s[1])&&(s[1]=o[1]),b(o[0],s[1])>b(s[0],s[1])&&(s[0]=o[0])):n.push(s=o);for(var r,i,o,a=-1/0,e=0,s=n[i=n.length-1];e<=i;s=o,++e)(r=b(s[1],(o=n[e])[0]))>a&&(a=r,f=o[0],g=s[1])}return pr=gr=null,f===1/0||d===1/0?[[NaN,NaN],[NaN,NaN]]:[[f,d],[g,v]]}),A.geo.centroid=function(t){mr=vr=yr=_r=_=Lr=br=L=wr=kr=xr=0,A.geo.stream(t,O);var t=wr,e=kr,n=xr,r=t*t+e*e+n*n;return r<Kt&&(t=Lr,e=br,n=L,vr<N&&(t=yr,e=_r,n=_),(r=t*t+e*e+n*n)<Kt)?[NaN,NaN]:[Math.atan2(e,t)*S,Zt(n/Math.sqrt(r))*S]};var O={sphere:l,point:Rr,lineStart:Gr,lineEnd:Ur,polygonStart:function(){O.lineStart=Wr},polygonEnd:function(){O.lineStart=Gr}};function Rr(t,e){t*=x;var n=Math.cos(e*=x);Fr(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function Fr(t,e,n){yr+=(t-yr)/++mr,_r+=(e-_r)/mr,_+=(n-_)/mr}function Gr(){var i,o,a;function r(t,e){t*=x;var n=Math.cos(e*=x),r=n*Math.cos(t),n=n*Math.sin(t),t=Math.sin(e),e=Math.atan2(Math.sqrt((e=o*t-a*n)*e+(e=a*r-i*t)*e+(e=i*n-o*r)*e),i*r+o*n+a*t);vr+=e,Lr+=e*(i+(i=r)),br+=e*(o+(o=n)),L+=e*(a+(a=t)),Fr(i,o,a)}O.point=function(t,e){t*=x;var n=Math.cos(e*=x);i=n*Math.cos(t),o=n*Math.sin(t),a=Math.sin(e),O.point=r,Fr(i,o,a)}}function Ur(){O.point=Rr}function Wr(){var r,i,u,h,c;function o(t,e){t*=x;var n=Math.cos(e*=x),r=n*Math.cos(t),n=n*Math.sin(t),t=Math.sin(e),e=h*t-c*n,i=c*r-u*t,o=u*n-h*r,a=Math.sqrt(e*e+i*i+o*o),s=u*r+h*n+c*t,l=a&&-$t(s)/a,a=Math.atan2(a,s);wr+=l*e,kr+=l*i,xr+=l*o,vr+=a,Lr+=a*(u+(u=r)),br+=a*(h+(h=n)),L+=a*(c+(c=t)),Fr(u,h,c)}O.point=function(t,e){r=t,i=e,O.point=o,t*=x;var n=Math.cos(e*=x);u=n*Math.cos(t),h=n*Math.sin(t),c=Math.sin(e),Fr(u,h,c)},O.lineEnd=function(){o(r,i),O.lineEnd=Ur,O.point=Rr}}var Br,jr,Vr,Yr,qr,Kr,Xr={point:l,lineStart:l,lineEnd:l,polygonStart:function(){jr=0,Xr.lineStart=$r},polygonEnd:function(){Xr.lineStart=Xr.lineEnd=Xr.point=l,Br+=P(jr/2)}};function $r(){var n,r,i,o;function a(t,e){jr+=o*t-i*e,i=t,o=e}Xr.point=function(t,e){Xr.point=a,n=i=t,r=o=e},Xr.lineEnd=function(){a(n,r)}}var Zr={point:function(t,e){t<Vr&&(Vr=t);qr<t&&(qr=t);e<Yr&&(Yr=e);Kr<e&&(Kr=e)},lineStart:l,lineEnd:l,polygonStart:l,polygonEnd:l};function Jr(){var n=Qr(4.5),r=[],i={point:t,lineStart:function(){i.point=e},lineEnd:a,polygonStart:function(){i.lineEnd=s},polygonEnd:function(){i.lineEnd=a,i.point=t},pointRadius:function(t){return n=Qr(t),i},result:function(){var t;if(r.length)return t=r.join(""),r=[],t}};function t(t,e){r.push("M",t,",",e,n)}function e(t,e){r.push("M",t,",",e),i.point=o}function o(t,e){r.push("L",t,",",e)}function a(){i.point=t}function s(){r.push("Z")}return i}function Qr(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}var H={point:ti,lineStart:ei,lineEnd:ni,polygonStart:function(){H.lineStart=ri},polygonEnd:function(){H.point=ti,H.lineStart=ei,H.lineEnd=ni}};function ti(t,e){yr+=t,_r+=e,++_}function ei(){var i,o;function n(t,e){var n=t-i,r=e-o,n=Math.sqrt(n*n+r*r);Lr+=n*(i+t)/2,br+=n*(o+e)/2,L+=n,ti(i=t,o=e)}H.point=function(t,e){H.point=n,ti(i=t,o=e)}}function ni(){H.point=ti}function ri(){var n,r,i,o;function a(t,e){var n=t-i,r=e-o,n=Math.sqrt(n*n+r*r);Lr+=n*(i+t)/2,br+=n*(o+e)/2,L+=n,wr+=(n=o*t-i*e)*(i+t),kr+=n*(o+e),xr+=3*n,ti(i=t,o=e)}H.point=function(t,e){H.point=a,ti(n=i=t,r=o=e)},H.lineEnd=function(){a(n,r)}}function ii(n){var r=4.5,i={point:t,lineStart:function(){i.point=e},lineEnd:a,polygonStart:function(){i.lineEnd=s},polygonEnd:function(){i.lineEnd=a,i.point=t},pointRadius:function(t){return r=t,i},result:l};function t(t,e){n.moveTo(t,e),n.arc(t,e,r,0,C)}function e(t,e){n.moveTo(t,e),i.point=o}function o(t,e){n.lineTo(t,e)}function a(){i.point=t}function s(){n.closePath()}return i}function oi(S){var E=.5,D=Math.cos(30*x),b=16;function e(t){return(b?r:n)(t)}function n(n){return si(n,function(t,e){t=S(t,e),n.point(t[0],t[1])})}function r(r){var n,i,o,a,s,l,u,h,c,f,d,p,g={point:t,lineStart:e,lineEnd:v,polygonStart:function(){r.polygonStart(),g.lineStart=y},polygonEnd:function(){r.polygonEnd(),g.lineStart=e}};function t(t,e){t=S(t,e),r.point(t[0],t[1])}function e(){h=NaN,g.point=m,r.lineStart()}function m(t,e){var n=qn([t,e]),e=S(t,e);T(h,c,u,f,d,p,h=e[0],c=e[1],u=t,f=n[0],d=n[1],p=n[2],b,r),r.point(h,c)}function v(){g.point=t,r.lineEnd()}function y(){e(),g.point=_,g.lineEnd=L}function _(t,e){m(n=t,e),i=h,o=c,a=f,s=d,l=p,g.point=m}function L(){T(h,c,u,f,d,p,i,o,n,a,s,l,b,r),g.lineEnd=v,v()}return g}function T(t,e,n,r,i,o,a,s,l,u,h,c,f,d){var p,g,m,v,y,_,L,b,w,k,x=a-t,M=s-e,C=x*x+M*M;4*E<C&&f--&&(p=r+u,g=i+h,m=o+c,v=Math.sqrt(p*p+g*g+m*m),L=Math.asin(m/=v),y=P(P(m)-1)<N||P(n-l)<N?(n+l)/2:Math.atan2(g,p),_=(L=S(y,L))[0],L=L[1],(E<(k=M*(b=_-t)-x*(w=L-e))*k/C||.3<P((x*b+M*w)/C-.5)||r*u+i*h+o*c<D)&&(T(t,e,n,r,i,o,_,L,y,p/=v,g/=v,m,f,d),d.point(_,L),T(_,L,y,p,g,m,a,s,l,u,h,c,f,d)))}return e.precision=function(t){return arguments.length?(b=0<(E=t*t)&&16,e):Math.sqrt(E)},e}function ai(t){this.stream=t}function si(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function li(t){return ui(function(){return t})()}function ui(t){var n,e,r,i,o,a,s=oi(function(t,e){return[(t=n(t,e))[0]*l+i,o-t[1]*l]}),l=150,u=480,h=250,c=0,f=0,d=0,p=0,g=0,m=Qn,v=qt,y=null,_=null;function L(t){return[(t=r(t[0]*x,t[1]*x))[0]*l+i,o-t[1]*l]}function b(t){return(t=r.invert((t[0]-i)/l,(o-t[1])/l))&&[t[0]*S,t[1]*S]}function w(){r=Sr(e=nr(d,p,g),n);var t=n(c,f);return i=u-t[0]*l,o=h+t[1]*l,k()}function k(){return a&&(a.valid=!1,a=null),L}return L.stream=function(t){return a&&(a.valid=!1),(a=hi(m(e,s(v(t))))).valid=!0,a},L.clipAngle=function(t){return arguments.length?(m=null==t?(y=t,Qn):lr((y=+t)*x),k()):y},L.clipExtent=function(t){return arguments.length?(v=(_=t)?Cr(t[0][0],t[0][1],t[1][0],t[1][1]):qt,k()):_},L.scale=function(t){return arguments.length?(l=+t,w()):l},L.translate=function(t){return arguments.length?(u=+t[0],h=+t[1],w()):[u,h]},L.center=function(t){return arguments.length?(c=t[0]%360*x,f=t[1]%360*x,w()):[c*S,f*S]},L.rotate=function(t){return arguments.length?(d=t[0]%360*x,p=t[1]%360*x,g=2<t.length?t[2]%360*x:0,w()):[d*S,p*S,g*S]},A.rebind(L,s,"precision"),function(){return n=t.apply(this,arguments),L.invert=n.invert&&b,w()}}function hi(n){return si(n,function(t,e){n.point(t*x,e*x)})}function ci(t,e){return[t,Math.log(Math.tan(M/4+e/2))]}A.geo.path=function(){var r,e,i,n,o,a=4.5;function s(t){return t&&("function"==typeof a&&n.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=i(n)),A.geo.stream(t,o)),n.result()}function l(){return o=null,s}return s.area=function(t){return Br=0,A.geo.stream(t,i(Xr)),Br},s.centroid=function(t){return yr=_r=_=Lr=br=L=wr=kr=xr=0,A.geo.stream(t,i(H)),xr?[wr/xr,kr/xr]:L?[Lr/L,br/L]:_?[yr/_,_r/_]:[NaN,NaN]},s.bounds=function(t){return qr=Kr=-(Vr=Yr=1/0),A.geo.stream(t,i(Zr)),[[Vr,Yr],[qr,Kr]]},s.projection=function(t){var n,e;return arguments.length?(i=(r=t)?t.stream||(n=t,e=oi(function(t,e){return n([t*S,e*S])}),function(t){return hi(e(t))}):qt,l()):r},s.context=function(t){return arguments.length?(n=null==(e=t)?new Jr:new ii(t),"function"!=typeof a&&n.pointRadius(a),l()):e},s.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(n.pointRadius(+t),+t),s):a},s.projection(A.geo.albersUsa()).context(null)},A.geo.transform=function(r){return{stream:function(t){var e,n=new ai(t);for(e in r)n[e]=r[e];return n}}},ai.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},A.geo.projection=li,A.geo.projectionMutator=ui,ci.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-p]},(A.geo.mercator=function(){return o=li(ci),a=o.scale,s=o.translate,l=o.clipExtent,o.scale=function(){var t=a.apply(o,arguments);return t===o?i?o.clipExtent(null):o:t},o.translate=function(){var t=s.apply(o,arguments);return t===o?i?o.clipExtent(null):o:t},o.clipExtent=function(t){var e,n,r=l.apply(o,arguments);return r===o?(i=null==t)&&(e=M*a(),n=s(),l([[n[0]-e,n[1]-e],[n[0]+e,n[1]+e]])):i&&(r=null),r},o.clipExtent(null);var i,o,a,s,l}).raw=ci,"function"==typeof define&&define.amd?define(A):"object"==typeof module&&module.exports&&(module.exports=A),this.d3=A}(),function(){function t(t,e){this.oldURL=t,this.newURL=e,this.timeStamp=(new Date).getTime()}window.HashChangeEvent=(t.prototype={bubbles:!1,cancelable:!1,currentTarget:null,defaultPrevented:!1,returnValue:!0,srcElement:null,target:null,timeStamp:null,type:"hashchange"},t);var i={listeners:{funcs:[],remove:function(t){for(var e=[],n=0,r=i.listeners.funcs.length;n<r;n++)i.listeners.funcs[n]!==t&&e.push(i.listeners.funcs[n]);i.listeners.funcs=e}},init:function(){var n,r;i.lastHash=i.getHash(),i.lastLocation=String(location),window.addEventListener&&(n=window.addEventListener,window.addEventListener=function(t,e){if("hashchange"!==t)return n.apply(window,arguments);i.listeners.funcs.push(e)}),window.attachEvent&&(r=window.attachEvent,window.attachEvent=function(t,e){if("onhashchange"!==t)return r.apply(window,arguments);i.listeners.funcs.push(e)}),i.setTimeout()},lastHash:null,lastLocation:null,pollerRate:50,getHash:function(){return location.hash.slice(1)},setTimeout:function(){window.setTimeout(i.pollerInterval,i.pollerRate)},createEventObject:function(t,e){return new window.HashChangeEvent(t,e)},pollerInterval:function(){if(i.getHash()!==i.lastHash){var t=i.listeners.funcs.slice(0);"function"==typeof window.onhashchange&&t.push(window.onhashchange);for(var e=0,n=t.length;e<n;e++)i.createEventObject({oldURL:i.lastLocation,newURL:String(location)});i.lastHash=i.getHash(),i.lastLocation=String(location)}i.setTimeout()}};i.init()}(),"function"==typeof Blob&&"undefined"!=typeof URL||("function"==typeof Blob&&"undefined"!=typeof webkitURL?self.URL=webkitURL:Blob=function(t){"use strict";var o=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder||function(t){function s(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]}function e(){this.data=[]}function l(t,e,n){this.data=t,this.size=t.length,this.type=e,this.encoding=n}function u(t){this.code=this[this.name=t]}var n=e.prototype,r=l.prototype,h=t.FileReaderSync,i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),o=i.length,a=t.URL||t.webkitURL||t,c=a.createObjectURL,f=a.revokeObjectURL,d=a,p=t.btoa,g=t.atob,m=t.ArrayBuffer,v=t.Uint8Array;for(l.fake=r.fake=!0;o--;)u.prototype[i[o]]=o+1;return(d=a.createObjectURL?d:t.URL={}).createObjectURL=function(t){var e=t.type;return null===e&&(e="application/octet-stream"),t instanceof l?(e="data:"+e,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):p?e+";base64,"+p(t.data):e+","+encodeURIComponent(t.data)):c?c.call(a,t):void 0},d.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&f&&f.call(a,t)},n.append=function(t){var e=this.data;if(v&&(t instanceof m||t instanceof v)){for(var n="",r=new v(t),i=0,o=r.length;i<o;i++)n+=String.fromCharCode(r[i]);e.push(n)}else if("Blob"===s(t)||"File"===s(t)){if(!h)throw new u("NOT_READABLE_ERR");var a=new h;e.push(a.readAsBinaryString(t))}else t instanceof l?"base64"===t.encoding&&g?e.push(g(t.data)):"URI"===t.encoding?e.push(decodeURIComponent(t.data)):"raw"===t.encoding&&e.push(t.data):("string"!=typeof t&&(t+=""),e.push(unescape(encodeURIComponent(t))))},n.getBlob=function(t){return arguments.length||(t=null),new l(this.data.join(""),t,"raw")},n.toString=function(){return"[object BlobBuilder]"},r.slice=function(t,e,n){var r=arguments.length;return r<3&&(n=null),new l(this.data.slice(t,1<r?e:this.data.length),n,this.encoding)},r.toString=function(){return"[object Blob]"},e}(t);return function(t,e){var e=e&&e.type||"",n=new o;if(t)for(var r=0,i=t.length;r<i;r++)n.append(t[r]);return n.getBlob(e)}}(self)),function(t){"use strict";var e,n,r,i,o,a,s,l,u,h,c,f,d,p,g,m,v,y,_;t.Base64||("undefined"!=typeof module&&module.exports&&(e=require("buffer").Buffer),r=function(t){for(var e={},n=0,r=t.length;n<r;n++)e[t.charAt(n)]=n;return e}(n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),i=String.fromCharCode,o=function(t){var e;return t.length<2?(e=t.charCodeAt(0))<128?t:e<2048?i(192|e>>>6)+i(128|63&e):i(224|e>>>12&15)+i(128|e>>>6&63)+i(128|63&e):(e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320),i(240|e>>>18&7)+i(128|e>>>12&63)+i(128|e>>>6&63)+i(128|63&e))},a=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,s=function(t){return t.replace(a,o)},l=function(t){var e=[0,2,1][t.length%3],t=t.charCodeAt(0)<<16|(1<t.length?t.charCodeAt(1):0)<<8|(2<t.length?t.charCodeAt(2):0);return[n.charAt(t>>>18),n.charAt(t>>>12&63),2<=e?"=":n.charAt(t>>>6&63),1<=e?"=":n.charAt(63&t)].join("")},u=t.btoa||function(t){return t.replace(/[\s\S]{1,3}/g,l)},h=e?function(t){return new e(t).toString("base64")}:function(t){return u(s(t))},c=function(t,e){return e?h(t).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):h(t)},f=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),d=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return i(55296+(e>>>10))+i(56320+(1023&e));case 3:return i((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return i((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},g=function(t){var e=t.length,n=e%4,e=(0<e?r[t.charAt(0)]<<18:0)|(1<e?r[t.charAt(1)]<<12:0)|(2<e?r[t.charAt(2)]<<6:0)|(3<e?r[t.charAt(3)]:0),t=[i(e>>>16),i(e>>>8&255),i(255&e)];return t.length-=[0,0,2,1][n],t.join("")},m=t.atob||function(t){return t.replace(/[\s\S]{1,4}/g,g)},v=e?function(t){return new e(t,"base64").toString()}:function(t){return p(m(t))},t.Base64={VERSION:"2.1.2",atob:m,btoa:u,fromBase64:y=function(t){return v(t.replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},toBase64:c,utob:s,encode:c,encodeURI:function(t){return c(t,!0)},btou:p=function(t){return t.replace(f,d)},decode:y},"function"==typeof Object.defineProperty&&(_=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}},t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",_(function(){return y(this)})),Object.defineProperty(String.prototype,"toBase64",_(function(t){return c(this,t)})),Object.defineProperty(String.prototype,"toBase64URI",_(function(){return c(this,!0)}))}))}(this),function(){"undefined"==typeof module?self.queue=t:module.exports=t,t.version="1.0.4";var d=[].slice;function t(r){var e,i,n,o=[],a=0,s=0,l=0,u=null,h=p;function c(){for(;i=a<o.length&&s<r;){var t=a++,e=o[t],n=d.call(e,1);n.push(function(n){return function(t,e){--s,null==u&&(null!=t?(u=t,a=l=NaN,f()):(o[n]=e,--l?i||c():f()))}}(t)),++s,e[0].apply(null,n)}}function f(){null!=u?h(u):n?h(u,o):h.apply(null,[u].concat(o))}return r=r||1/0,e={defer:function(){return u||(o.push(arguments),++l,c()),e},await:function(t){return h=t,n=!1,l||f(),e},awaitAll:function(t){return h=t,n=!0,l||f(),e}}}function p(){}}(),d3.keybinding=function(e){var o=[];function n(){for(var t=0;t<o.length;t++){var e=o[t];!function(t,e){for(var n in t.event)if(e[n]!=t.event[n])return;return!t.capture==(e.eventPhase!==Event.CAPTURING_PHASE)}(e,d3.event)||e.callback()}}function r(){var t=d3.select(d3.event.target).node().tagName;"INPUT"!=t&&"SELECT"!=t&&"TEXTAREA"!=t&&n()}function a(t){return(t=t||d3.select(document)).on("keydown.capture"+e,n,!0),t.on("keydown.bubble"+e,r,!1),a}return a.off=function(t){return(t=t||d3.select(document)).on("keydown.capture"+e,null),t.on("keydown.bubble"+e,null),a},a.on=function(t,e,n){var r={event:{keyCode:0,shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1},capture:n,callback:e};t=t.toLowerCase().match(/(?:(?:[^+⇧⌃⌥⌘])+|[⇧⌃⌥⌘]|\+\+|^\+$)/g);for(var i=0;i<t.length;i++)"++"===t[i]&&(t[i]="+"),t[i]in d3.keybinding.modifierCodes?r.event[d3.keybinding.modifierProperties[d3.keybinding.modifierCodes[t[i]]]]=!0:t[i]in d3.keybinding.keyCodes&&(r.event.keyCode=d3.keybinding.keyCodes[t[i]]);return o.push(r),a},a},function(){d3.keybinding.modifierCodes={"⇧":16,shift:16,"⌃":17,ctrl:17,"⌥":18,alt:18,option:18,"⌘":91,meta:91,cmd:91,super:91,win:91},d3.keybinding.modifierProperties={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"},d3.keybinding.keyCodes={"⌫":8,backspace:8,"⇥":9,"⇆":9,tab:9,"↩":13,return:13,enter:13,"⌅":13,pause:19,"pause-break":19,"⇪":20,caps:20,"caps-lock":20,"⎋":27,escape:27,esc:27,space:32,"↖":33,pgup:33,"page-up":33,"↘":34,pgdown:34,"page-down":34,"⇟":35,end:35,"⇞":36,home:36,ins:45,insert:45,"⌦":46,del:46,delete:46,"←":37,left:37,"arrow-left":37,"↑":38,up:38,"arrow-up":38,"→":39,right:39,"arrow-right":39,"↓":40,down:40,"arrow-down":40,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,dash:189,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostrophe:222};for(var t=95,e=0;++t<106;)d3.keybinding.keyCodes["num-"+e]=t,++e;for(t=47,e=0;++t<58;)d3.keybinding.keyCodes[e]=t,++e;for(t=111,e=1;++t<136;)d3.keybinding.keyCodes["f"+e]=t,++e;for(t=64;++t<91;)d3.keybinding.keyCodes[String.fromCharCode(t).toLowerCase()]=t}(),d3.selection.prototype.trigger=function(e){this.each(function(){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),this.dispatchEvent(t)})},function(){var t=d3.selection.prototype,o=t.on,a={mouseenter:["mouseover",e],mouseleave:["mouseout",e]};function e(e){return function(){var t=d3.event.relatedTarget;if(this!==t&&!function(t,e){if(t===e)return;for(;e&&e!==t;)e=e.parentNode;return e===t}(this,t))return e.apply(this,arguments)}}t.on=function(t,e,n){var r=t.split("."),i=r.shift(),i=a[i];return i?(t=r.length?[i[0],r].join("."):i[0],"function"==typeof e&&(e=i[1](e)),o.call(this,t,e,n)):o.apply(this,arguments)}}(),function(n,e){L.drawVersion="0.2.3",L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes.",text:"Save"},cancel:{title:"Cancel editing, discards all changes.",text:"Cancel"}},buttons:{edit:"Edit layers.",editDisabled:"No layers to edit.",remove:"Delete layers.",removeDisabled:"No layers to delete."}},handlers:{edit:{tooltip:{text:"Drag handles, or marker to edit feature.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove"}}}}},L.Draw={},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e)},enable:function(){this._enabled||(this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type}),L.Handler.prototype.enable.call(this))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire("draw:created",{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&this.disable()}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3},initialize:function(t,e){this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("mouseup",this._onMouseUp,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseup",this._onMouseUp,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mousemove",this._onMouseMove,this).off("zoomend",this._onZoomEnd,this)},deleteLastVertex:function(){var t,e,n;this._markers.length<=1||(t=this._markers.pop(),e=this._poly,n=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0],this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(n,!1))},addVertex:function(t){0<this._markers.length&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)?this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0))},_finishShape:function(){var t=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],!0);!this.options.allowIntersection&&t||!this._shapeIsValid()?this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(t){var e=t.layerPoint,n=t.latlng;this._currentLatLng=n,this._updateTooltip(n),this._updateGuide(e),this._mouseMarker.setLatLng(n),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){t=t.originalEvent;this._mouseDownOrigin=L.point(t.clientX,t.clientY)},_onMouseUp:function(t){var e;this._mouseDownOrigin&&(e=L.point(t.originalEvent.clientX,t.originalEvent.clientY).distanceTo(this._mouseDownOrigin),Math.abs(e)<9*(n.devicePixelRatio||1)&&this.addVertex(t.latlng)),this._mouseDownOrigin=null},_updateFinishHandler:function(){var t=this._markers.length;1<t&&this._markers[t-1].on("click",this._finishShape,this),2<t&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){t=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(t),t},_updateGuide:function(t){var e=this._markers.length;0<e&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var n,r,i=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),o=this.options.guidelineDistance,a=this.options.maxGuideLineLength,s=a<i?i-a:o;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));s<i;s+=this.options.guidelineDistance)n=s/i,n={x:Math.floor(t.x*(1-n)+n*e.x),y:Math.floor(t.y*(1-n)+n*e.y)},(r=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer)).style.backgroundColor=(this._errorShown?this.options.drawError:this.options.shapeOptions).color,L.DomUtil.setPosition(r,n)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,n=this._guidesContainer.childNodes.length;e<n;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t=this.options.showLength,t=0===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(t=t?this._getMeasurementString():"",1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:t}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:t});return t},_updateRunningMeasure:function(t,e){var n=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(t=t.distanceTo(this._markers[n-(e?2:1)].getLatLng()),this._measurementRunningTotal+=t*(e?1:-1))},_getMeasurementString:function(){var t=this._currentLatLng,e=this._markers[this._markers.length-1].getLatLng(),t=this._measurementRunningTotal+t.distanceTo(e);return L.GeometryUtil.readableDistance(t,this.options.metric)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){1<this._markers.length&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),2<t&&(this._markers[t-1].on("dblclick",this._finishShape,this),3<t&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?t=L.drawLocal.draw.handlers.polygon.tooltip.cont:(t=L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area;return t?L.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){return 3<=this._markers.length},_vertexAdded:function(){var t;!this.options.allowIntersection&&this.options.showArea&&(t=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(t))},_cleanUpShape:function(){var t=this._markers.length;0<t&&(this._markers[0].off("click",this._finishShape,this),2<t&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(e,"mouseup",this._onMouseUp,this),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(e,"mouseup",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){t=t.latlng;this._tooltip.updatePosition(t),this._isDrawing&&(this._tooltip.updateContent({text:this._endLabelText}),this._drawShape(t))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0}},initialize:function(t,e){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(t)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var t=t.latlng,e=this.options.showRadius,n=this.options.metric;this._tooltip.updatePosition(t),this._isDrawing&&(this._drawShape(t),t=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:e?"Radius: "+L.GeometryUtil.readableDistance(t,n):""}))}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.Marker.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:L.drawLocal.draw.handlers.marker.tooltip.start}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){t=t.latlng;this._tooltip.updatePosition(t),this._mouseMarker.setLatLng(t),this._marker?(t=this._mouseMarker.getLatLng(),this._marker.setLatLng(t)):(this._marker=new L.Marker(t,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_fireCreatedEvent:function(){var t=new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(t,e){this._poly=t,L.setOptions(this,e)},addHooks:function(){this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){this._poly._map&&(this._poly._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];for(var t,e,n,r,i=this._poly._latlngs,o=0,a=i.length;o<a;o++)(e=this._createMarker(i[o],o)).on("click",this._onMarkerClick,this),this._markers.push(e);for(o=0,t=a-1;o<a;t=o++)(0!==o||L.Polygon&&this._poly instanceof L.Polygon)&&(n=this._markers[t],r=this._markers[o],this._createMiddleMarker(n,r),this._updatePrevNext(n,r))},_createMarker:function(t,e){var n=new L.Marker(t,{draggable:!0,icon:this.options.icon});return n._origLatLng=t,n._index=e,n.on("drag",this._onMarkerDrag,this),n.on("dragend",this._fireEdit,this),this._markerGroup.addLayer(n),n},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._poly.spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit")},_onMarkerDrag:function(t){t=t.target;L.extend(t._origLatLng,t._latlng),t._middleLeft&&t._middleLeft.setLatLng(this._getMiddleLatLng(t._prev,t)),t._middleRight&&t._middleRight.setLatLng(this._getMiddleLatLng(t,t._next)),this._poly.redraw()},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,t=t.target;this._poly._latlngs.length<e||(this._removeMarker(t),this._updatePrevNext(t._prev,t._next),t._middleLeft&&this._markerGroup.removeLayer(t._middleLeft),t._middleRight&&this._markerGroup.removeLayer(t._middleRight),t._prev&&t._next?this._createMiddleMarker(t._prev,t._next):t._prev?t._next||(t._prev._middleRight=null):t._next._middleLeft=null,this._fireEdit())},_updateIndexes:function(e,n){this._markerGroup.eachLayer(function(t){t._index>e&&(t._index+=n)})},_createMiddleMarker:function(e,n){var r,t,i,o=this._getMiddleLatLng(e,n),a=this._createMarker(o);a.setOpacity(.6),e._middleRight=n._middleLeft=a,t=function(){var t=n._index;a._index=t,a.off("click",r,this).on("click",this._onMarkerClick,this),o.lat=a.getLatLng().lat,o.lng=a.getLatLng().lng,this._poly.spliceLatLngs(t,0,o),this._markers.splice(t,0,a),a.setOpacity(1),this._updateIndexes(t,1),n._index++,this._updatePrevNext(e,a),this._updatePrevNext(a,n),this._poly.fire("editstart")},i=function(){a.off("dragstart",t,this),a.off("dragend",i,this),this._createMiddleMarker(e,a),this._createMiddleMarker(a,n)},r=function(){t.call(this),i.call(this),this._fireEdit()},a.on("click",r,this).on("dragstart",t,this).on("dragend",i,this),this._markerGroup.addLayer(a)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var n=this._poly._map,t=n.project(t.getLatLng()),e=n.project(e.getLatLng());return n.unproject(t._add(e)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"})},initialize:function(t,e){this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){this._shape._map&&(this._map=this._shape._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){if(this._shape._map){this._unbindMarker(this._moveMarker);for(var t=0,e=this._resizeMarkers.length;t<e;t++)this._unbindMarker(this._resizeMarkers[t]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){t=new L.Marker(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(t),this._markerGroup.addLayer(t),t},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this)},_onMarkerDragStart:function(t){t.target.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(t){var t=t.target,e=t.getLatLng();t===this._moveMarker?this._move(e):this._resize(e),this._shape.redraw()},_onMarkerDragEnd:function(t){t.target.setOpacity(1),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getBounds().getCenter();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,n=t.length;e<n;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),t=t.target._cornerIndex;this._oppositeCorner=e[(t+2)%4],this._toggleCornerMarkers(0,t)},_onMarkerDragEnd:function(t){var e,n=t.target;n===this._moveMarker&&(e=this._shape.getBounds().getCenter(),n.setLatLng(e)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_move:function(t){for(var e,n=this._shape.getLatLngs(),r=this._shape.getBounds().getCenter(),i=[],o=0,a=n.length;o<a;o++)e=[n[o].lat-r.lat,n[o].lng-r.lng],i.push([t.lat+e[0],t.lng+e[1]]);this._shape.setLatLngs(i),this._repositionCornerMarkers()},_resize:function(t){this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),t=this._shape.getBounds(),this._moveMarker.setLatLng(t.getCenter())},_getCorners:function(){var t=this._shape.getBounds();return[t.getNorthWest(),t.getNorthEast(),t.getSouthEast(),t.getSouthWest()]},_toggleCornerMarkers:function(t){for(var e=0,n=this._resizeMarkers.length;e<n;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,n=this._resizeMarkers.length;e<n;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){var t=this._shape.getLatLng(),t=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(t,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),t=this._map.project(t);return this._map.unproject([t.x+e,t.y-e])},_move:function(t){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e),this._shape.setLatLng(t)},_resize:function(t){t=this._moveMarker.getLatLng().distanceTo(t);this._shape.setRadius(t)}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],n=0,r=t.length;n<r;n++)e.push(this.cloneLatLng(t[n]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(t){var e,n,r=t.length,i=0,o=L.LatLng.DEG_TO_RAD;if(2<r){for(var a=0;a<r;a++)e=t[a],i+=((n=t[(a+1)%r]).lng-e.lng)*o*(2+Math.sin(e.lat*o)+Math.sin(n.lat*o));i=6378137*i*6378137/2}return Math.abs(i)},readableArea:function(t,e){e=e?1e4<=t?(1e-4*t).toFixed(2)+" ha":t.toFixed(2)+" m&sup2;":3097600<=(t*=.836127)?(t/3097600).toFixed(2)+" mi&sup2;":4840<=t?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;";return e},readableDistance:function(t,e){e=e?1e3<t?(t/1e3).toFixed(2)+" km":Math.ceil(t)+" m":1760<(t*=1.09361)?(t/1760).toFixed(2)+" miles":Math.ceil(t)+" yd";return e}}),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,n,r){return this._checkCounterclockwise(t,n,r)!==this._checkCounterclockwise(e,n,r)&&this._checkCounterclockwise(t,e,n)!==this._checkCounterclockwise(t,e,r)},_checkCounterclockwise:function(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,n,r=this._originalPoints,i=r?r.length:0;if(!this._tooFewPointsForIntersection())for(t=i-1;3<=t;t--)if(e=r[t-1],n=r[t],this._lineSegmentsIntersectsRange(e,n,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(t),e)},newPointIntersects:function(t,e){var n=this._originalPoints,r=n?n.length:0,n=n?n[r-1]:null,r=r-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(n,t,r,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._originalPoints,e=e?e.length:0;return e+=t||0,!this._originalPoints||e<=3},_lineSegmentsIntersectsRange:function(t,e,n,r){var i,o,a=this._originalPoints;r=r||0;for(var s=n;r<s;s--)if(i=a[s-1],o=a[s],L.LineUtil.segmentsIntersect(t,e,i,o))return!0;return!1}}),L.Polygon.include({intersects:function(){var t,e,n=this._originalPoints;return!this._tooFewPointsForIntersection()&&(!!L.Polyline.prototype.intersects.call(this)||(t=n.length,e=n[0],n=n[t-1],this._lineSegmentsIntersectsRange(n,e,t-2,1)))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");var e,n;L.Control.prototype.initialize.call(this,t),this._toolbars={},L.DrawToolbar&&this.options.draw&&(n=new L.DrawToolbar(this.options.draw),e=L.stamp(n),this._toolbars[e]=n,this._toolbars[e].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(n=new L.EditToolbar(this.options.edit),e=L.stamp(n),this._toolbars[e]=n,this._toolbars[e].on("enable",this._toolbarEnabled,this))},onAdd:function(t){var e,n,r=L.DomUtil.create("div","leaflet-draw"),i=!1,o="leaflet-draw-toolbar-top";for(n in this._toolbars)this._toolbars.hasOwnProperty(n)&&(e=this._toolbars[n].addToolbar(t))&&(i||(L.DomUtil.hasClass(e,o)||L.DomUtil.addClass(e.childNodes[0],o),i=!0),r.appendChild(e));return r},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e,n=""+L.stamp(t.target);for(e in this._toolbars)this._toolbars.hasOwnProperty(e)&&e!==n&&this._toolbars[e].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,n=L.DomUtil.create("div","leaflet-draw-section"),r=0,i=this._toolbarClass||"",o=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<o.length;e++)o[e].enabled&&this._initModeHandler(o[e].handler,this._toolbarContainer,r++,i,o[e].title);if(r)return this._lastButtonIndex=--r,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),n.appendChild(this._toolbarContainer),n.appendChild(this._actionsContainer),n},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,n=this._actionButtons.length;e<n;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,n,r,i){var o=t.type;this._modes[o]={},this._modes[o].handler=t,this._modes[o].button=this._createButton({title:i,className:r+"-"+o,container:e,callback:this._modes[o].handler.enable,context:this._modes[o].handler}),this._modes[o].buttonIndex=n,this._modes[o].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container);return e.href="#",t.text&&(e.innerHTML=t.text),t.title&&(e.title=t.title),L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",t.callback,t.context),e},_disposeButton:function(t,e){L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,"click",e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){for(var e,n=this._actionsContainer,r=this.getActions(t),i=r.length,o=0,a=this._actionButtons.length;o<a;o++)this._disposeButton(this._actionButtons[o].button,this._actionButtons[o].callback);for(this._actionButtons=[];n.firstChild;)n.removeChild(n.firstChild);for(var s=0;s<i;s++)"enabled"in r[s]&&!r[s].enabled||(e=L.DomUtil.create("li","",n),e=this._createButton({title:r[s].title,text:r[s].text,container:e,callback:r[s].callback,context:r[s].context}),this._actionButtons.push({button:e,callback:r[s].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,n=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=n+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}}),L.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container&&(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?0<t.subtext.length&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(0<t.subtext.length?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>"),this},updatePosition:function(t){var t=this._map.latLngToLayerPoint(t),e=this._container;return this._container&&(e.style.visibility="inherit",L.DomUtil.setPosition(e,t)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this}}),L.DrawToolbar=L.Toolbar.extend({options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker}]},getActions:function(t){return[{enabled:t.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:t.deleteLastVertex,context:t},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){for(var e in L.setOptions(this,t),this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.EditToolbar=L.Toolbar.extend({options:{edit:{selectedPathOptions:{color:"#fe57a1",opacity:.6,dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1}},remove:{},featureGroup:null},initialize:function(t){t.edit&&(void 0===t.edit.selectedPathOptions&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit=L.extend({},this.options.edit,t.edit)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}]},addToolbar:function(t){t=L.Toolbar.prototype.addToolbar.call(this,t);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),t},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode.handler.disable()},_checkDisabled:function(){var t,e=0!==this.options.featureGroup.getLayers().length;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,e?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",e?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,e?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",e?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),this._selectedPathOptions=e.selectedPathOptions,this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var e=new L.LayerGroup;this._featureGroup.eachLayer(function(t){t.edited&&(e.addLayer(t),t.edited=!1)}),this._map.fire("draw:edited",{layers:e})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:t instanceof L.Marker&&(this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}))},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):t instanceof L.Marker&&t.setLatLng(this._uneditedLayerProps[e].latlng))},_toggleMarkerHighlight:function(t){t._icon&&((t=t._icon).style.display="none",L.DomUtil.hasClass(t,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,-4)):(L.DomUtil.addClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,4)),t.style.display="")},_offsetMarker:function(t,e){var n=parseInt(t.style.marginTop,10)-e,e=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=n+"px",t.style.marginLeft=e+"px"},_enableLayerEdit:function(t){var e,t=t.layer||t.target||t,n=t instanceof L.Marker;n&&!t._icon||(this._backupLayer(t),this._selectedPathOptions&&(e=L.Util.extend({},this._selectedPathOptions),n?this._toggleMarkerHighlight(t):(t.options.previousOptions=L.Util.extend({dashArray:null},t.options),t instanceof L.Circle||t instanceof L.Polygon||t instanceof L.Rectangle||(e.fill=!1),t.setStyle(e))),n?(t.dragging.enable(),t.on("dragend",this._onMarkerDragEnd)):t.editing.enable())},_disableLayerEdit:function(t){t=t.layer||t.target||t;t.edited=!1,this._selectedPathOptions&&(t instanceof L.Marker?this._toggleMarkerHighlight(t):(t.setStyle(t.options.previousOptions),delete t.options.previousOptions)),t instanceof L.Marker?(t.dragging.disable(),t.off("dragend",this._onMarkerDragEnd,this)):t.editing.disable()},_onMarkerDragEnd:function(t){t.target.edited=!0},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:deletestart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:deletestop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.layerGroup,this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(t){this._deletableLayers.addLayer(t)},this)},save:function(){this._map.fire("draw:deleted",{layers:this._deletedLayers})},_enableLayerDelete:function(t){(t.layer||t.target||t).on("click",this._removeLayer,this)},_disableLayerDelete:function(t){t=t.layer||t.target||t;t.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(t)},_removeLayer:function(t){t=t.layer||t.target||t;this._deletableLayers.removeLayer(t),this._deletedLayers.addLayer(t)},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length}})}(window,document),L.Browser.svg?L.Path.include({_resetTransform:function(){this._container.setAttributeNS(null,"transform","")},_applyTransform:function(t){this._container.setAttributeNS(null,"transform","matrix("+t.join(" ")+")")}}):L.Path.include({_resetTransform:function(){this._skew&&(this._skew.on=!1,this._container.removeChild(this._skew),this._skew=null)},_applyTransform:function(t){var e=this._skew,n=(e||(e=this._createElement("skew"),this._container.appendChild(e),e.style.behavior="url(#default#VML)",this._skew=e),t[0].toFixed(8)+" "+t[1].toFixed(8)+" "+t[2].toFixed(8)+" "+t[3].toFixed(8)+" 0 0"),t=Math.floor(t[4]).toFixed()+", "+Math.floor(t[5]).toFixed(),r=this._container.style,i=parseFloat(r.left),o=parseFloat(r.top),a=parseFloat(r.width),r=parseFloat(r.height),i=(isNaN(i)&&(i=0),isNaN(o)&&(o=0),!isNaN(a)&&a||(a=1),!isNaN(r)&&r||(r=1),(-i/a-.5).toFixed(8)+" "+(-o/r-.5).toFixed(8));e.on="f",e.matrix=n,e.origin=i,e.offset=t,e.on=!0}}),L.Path.include({_onMouseClick:function(t){this.dragging&&this.dragging.moved()||this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)}}),L.Handler.PathDrag=L.Handler.extend({statics:{DRAGGABLE_CLS:"leaflet-path-draggable"},initialize:function(t){this._path=t,this._matrix=null,this._startPoint=null,this._dragStartPoint=null,this._dragInProgress=!1,this._dragMoved=!1},addHooks:function(){var t=L.Handler.PathDrag.DRAGGABLE_CLS,e=this._path._path;this._path.on("mousedown",this._onDragStart,this),this._path.options.className=(this._path.options.className||"")+" "+t,!L.Path.CANVAS&&e&&L.DomUtil.addClass(e,t)},removeHooks:function(){var t=L.Handler.PathDrag.DRAGGABLE_CLS,e=this._path._path;this._path.off("mousedown",this._onDragStart,this),this._path.options.className=(this._path.options.className||"").replace(t,""),!L.Path.CANVAS&&e&&L.DomUtil.removeClass(e,t),this._dragMoved=!1},moved:function(){return this._dragMoved},inProgress:function(){return this._dragInProgress},_onDragStart:function(t){this._dragInProgress=!0,this._startPoint=t.containerPoint.clone(),this._dragStartPoint=t.containerPoint.clone(),this._matrix=[1,0,0,1,0,0],this._path._point&&(this._point=this._path._point.clone()),this._path._map.on("mousemove",this._onDrag,this).on("mouseup",this._onDragEnd,this),this._dragMoved=!1},_onDrag:function(t){var e=t.containerPoint.x,n=t.containerPoint.y,r=this._matrix,i=this._path,o=this._startPoint,a=e-o.x,s=n-o.y;this._dragMoved||!a&&!s||(this._dragMoved=!0,i.fire("dragstart"),i._popup&&(i._popup._close(),i.off("click",i._openPopup,i))),r[4]+=a,r[5]+=s,o.x=e,o.y=n,i._applyTransform(r),i._point&&(i._point.x=this._point.x+r[4],i._point.y=this._point.y+r[5]),i.fire("drag"),L.DomEvent.stop(t.originalEvent)},_onDragEnd:function(t){L.DomEvent.stop(t),L.DomEvent._fakeStop({type:"click"}),this._dragInProgress=!1,this._path._resetTransform(),this._transformPoints(this._matrix),this._path._map.off("mousemove",this._onDrag,this).off("mouseup",this._onDragEnd,this),this._path.fire("dragend",{distance:Math.sqrt(L.LineUtil._sqDist(this._dragStartPoint,t.containerPoint))}),this._path._popup&&L.Util.requestAnimFrame(function(){this._path.on("click",this._path._openPopup,this._path)},this),this._matrix=null,this._startPoint=null,this._point=null,this._dragStartPoint=null},_transformPoint:function(t,e){var n=this._path,e=L.point(e[4],e[5]),r=n._map.options.crs,i=r.transformation,n=r.scale(n._map.getZoom()),r=r.projection,e=i.untransform(e,n).subtract(i.untransform(L.point(0,0),n));return r.unproject(r.project(t)._add(e))},_transformPoints:function(t){var e,n,r,i=this._path,o=L.point(t[4],t[5]),t=i._map.options.crs,a=t.transformation,s=t.scale(i._map.getZoom()),l=t.projection,u=a.untransform(o,s).subtract(a.untransform(L.point(0,0),s));if(i._point)i._latlng=l.unproject(l.project(i._latlng)._add(u)),i._point=this._point._add(o);else if(i._originalPoints)for(e=0,n=i._originalPoints.length;e<n;e++)r=i._latlngs[e],i._latlngs[e]=l.unproject(l.project(r)._add(u)),i._originalPoints[e]._add(o);if(i._holes)for(e=0,n=i._holes.length;e<n;e++)for(var h=0,c=i._holes[e].length;h<c;h++)r=i._holes[e][h],i._holes[e][h]=l.unproject(l.project(r)._add(u)),i._holePoints[e][h]._add(o);i._updatePath()}}),L.Path.addInitHook(function(){this.options.draggable?(this.dragging||(this.dragging=new L.Handler.PathDrag(this)),this.dragging.enable()):this.dragging&&this.dragging.disable()}),L.Circle.prototype._getLatLng=L.Circle.prototype.getLatLng,L.Circle.prototype.getLatLng=function(){return this.dragging&&this.dragging.inProgress()?this.dragging._transformPoint(this._latlng,this.dragging._matrix):this._getLatLng()},L.Polyline.prototype._getLatLngs=L.Polyline.prototype.getLatLngs,L.Polyline.prototype.getLatLngs=function(){if(this.dragging&&this.dragging.inProgress()){for(var t=this.dragging._matrix,e=this._getLatLngs(),n=0,r=e.length;n<r;n++)e[n]=this.dragging._transformPoint(e[n],t);return e}return this._getLatLngs()},function(){function t(t,e,n){for(var r=0,i=t.length;r<i;r++){var o=t[r];o.prototype["_"+e]=o.prototype[e],o.prototype[e]=n}}L.FeatureGroup.EVENTS+=" dragstart",t([L.MultiPolygon,L.MultiPolyline],"addLayer",function(t){return this.hasLayer(t)?this:(t.on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._addLayer.call(this,t))}),t([L.MultiPolygon,L.MultiPolyline],"removeLayer",function(t){return this.hasLayer(t)?(t.off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._removeLayer.call(this,t)):this});var e={_onDrag:function(t){var e=t.target;this.eachLayer(function(t){t!==e&&t._applyTransform(e.dragging._matrix)}),this._propagateEvent(t)},_onDragEnd:function(t){var e=t.target;this.eachLayer(function(t){t!==e&&(t._resetTransform(),t.dragging._transformPoints(e.dragging._matrix))}),this._propagateEvent(t)}};L.MultiPolygon.include(e),L.MultiPolyline.include(e)}(),L.Polygon.include(L.Polygon.prototype.getCenter?{}:{getCenter:function(){for(var t,e,n,r,i,o=this._originalPoints,a=r=i=0,s=0,l=o.length,u=l-1;s<l;u=s++)t=o[s],e=o[u],n=t.y*e.x-e.y*t.x,r+=(t.x+e.x)*n,i+=(t.y+e.y)*n,a+=3*n;return this._map.layerPointToLatLng([r/a,i/a])}}),L.EditToolbar.Edit.MOVE_MARKERS=!1,L.EditToolbar.Edit.include({initialize:function(t,e){L.EditToolbar.Edit.MOVE_MARKERS=!!e.selectedPathOptions.moveMarkers,this._initialize(t,e)},_initialize:L.EditToolbar.Edit.prototype.initialize}),L.Edit.SimpleShape.include({_updateMoveMarker:function(){this._moveMarker&&this._moveMarker.setLatLng(this._getShapeCenter())},_getShapeCenter:function(){return this._shape.getBounds().getCenter()},_createMoveMarker:function(){L.EditToolbar.Edit.MOVE_MARKERS&&(this._moveMarker=this._createMarker(this._getShapeCenter(),this.options.moveIcon))}}),L.Edit.SimpleShape.mergeOptions({moveMarker:!1}),L.Edit.Circle.include({addHooks:function(){this._shape._map&&(this._map=this._shape._map,this._markerGroup||(this._enableDragging(),this._initMarkers()),this._shape._map.addLayer(this._markerGroup))},removeHooks:function(){if(this._shape._map){for(var t=0,e=this._resizeMarkers.length;t<e;t++)this._unbindMarker(this._resizeMarkers[t]);this._disableDragging(),this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},_createMoveMarker:L.Edit.SimpleShape.prototype._createMoveMarker,_resize:function(t){t=this._shape.getLatLng().distanceTo(t);this._shape.setRadius(t),this._updateMoveMarker(),this._map.fire("draw:editresize",{layer:this._shape})},_enableDragging:function(){this._shape.dragging||(this._shape.dragging=new L.Handler.PathDrag(this._shape)),this._shape.dragging.enable(),this._shape.on("dragstart",this._onStartDragFeature,this).on("dragend",this._onStopDragFeature,this)},_disableDragging:function(){this._shape.dragging.disable(),this._shape.off("dragstart",this._onStartDragFeature,this).off("dragend",this._onStopDragFeature,this)},_onStartDragFeature:function(){this._shape._map.removeLayer(this._markerGroup),this._shape.fire("editstart")},_onStopDragFeature:function(){var t=this._shape.getLatLng();this._resizeMarkers[0].setLatLng(this._getResizeMarkerPoint(t)),this._shape._map.addLayer(this._markerGroup),this._updateMoveMarker(),this._fireEdit()}}),L.Edit.Rectangle.include({addHooks:function(){this._shape._map&&(this._markerGroup||(this._enableDragging(),this._initMarkers()),this._shape._map.addLayer(this._markerGroup))},removeHooks:function(){this._shape._map&&(this._shape._map.removeLayer(this._markerGroup),this._disableDragging(),delete this._markerGroup,delete this._markers)},_resize:function(t){this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),this._updateMoveMarker(),this._map.fire("draw:editresize",{layer:this._shape})},_onMarkerDragEnd:function(t){this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_enableDragging:function(){this._shape.dragging||(this._shape.dragging=new L.Handler.PathDrag(this._shape)),this._shape.dragging.enable(),this._shape.on("dragstart",this._onStartDragFeature,this).on("dragend",this._onStopDragFeature,this)},_disableDragging:function(){this._shape.dragging.disable(),this._shape.off("dragstart",this._onStartDragFeature,this).off("dragend",this._onStopDragFeature,this)},_onStartDragFeature:function(){this._shape._map.removeLayer(this._markerGroup),this._shape.fire("editstart")},_onStopDragFeature:function(){for(var t=this._shape,e=0,n=t._latlngs.length;e<n;e++){var r=this._resizeMarkers[e];r.setLatLng(t._latlngs[e]),r._origLatLng=t._latlngs[e],r._middleLeft&&r._middleLeft.setLatLng(this._getMiddleLatLng(r._prev,r)),r._middleRight&&r._middleRight.setLatLng(this._getMiddleLatLng(r,r._next))}this._shape._map.addLayer(this._markerGroup),this._updateMoveMarker(),this._repositionCornerMarkers(),this._fireEdit()}}),L.Edit.Poly.include({__createMarker:L.Edit.Poly.prototype._createMarker,__removeMarker:L.Edit.Poly.prototype._removeMarker,addHooks:function(){this._poly._map&&(this._markerGroup||(this._enableDragging(),this._initMarkers(),this._createMoveMarker()),this._poly._map.addLayer(this._markerGroup))},_createMoveMarker:function(){L.EditToolbar.Edit.MOVE_MARKERS&&this._poly instanceof L.Polygon&&(this._moveMarker=new L.Marker(this._getShapeCenter(),{icon:this.options.moveIcon}),this._moveMarker.on("mousedown",this._delegateToShape,this),this._markerGroup.addLayer(this._moveMarker))},_delegateToShape:function(t){var e=this._shape||this._poly,n=t.target;e.fire("mousedown",L.Util.extend(t,{containerPoint:L.DomUtil.getPosition(n._icon).add(e._map._getMapPanePos())}))},_getShapeCenter:function(){return this._poly.getCenter()},removeHooks:function(){this._poly._map&&(this._poly._map.removeLayer(this._markerGroup),this._disableDragging(),delete this._markerGroup,delete this._markers)},_enableDragging:function(){this._poly.dragging||(this._poly.dragging=new L.Handler.PathDrag(this._poly)),this._poly.dragging.enable(),this._poly.on("dragstart",this._onStartDragFeature,this).on("dragend",this._onStopDragFeature,this)},_disableDragging:function(){this._poly.dragging.disable(),this._poly.off("dragstart",this._onStartDragFeature,this).off("dragend",this._onStopDragFeature,this)},_onStartDragFeature:function(t){this._poly._map.removeLayer(this._markerGroup),this._poly.fire("editstart")},_onStopDragFeature:function(t){for(var e=this._poly,n=0,r=e._latlngs.length;n<r;n++){var i=this._markers[n];i.setLatLng(e._latlngs[n]),i._origLatLng=e._latlngs[n],i._middleLeft&&i._middleLeft.setLatLng(this._getMiddleLatLng(i._prev,i)),i._middleRight&&i._middleRight.setLatLng(this._getMiddleLatLng(i,i._next))}this._poly._map.addLayer(this._markerGroup),L.Edit.SimpleShape.prototype._updateMoveMarker.call(this),this._fireEdit()},_updateMoveMarker:L.Edit.SimpleShape.prototype._updateMoveMarker,_createMarker:function(t,e){t=this.__createMarker(t,e);return t.on("dragstart",this._hideMoveMarker,this).on("dragend",this._showUpdateMoveMarker,this),t},_removeMarker:function(t){this.__removeMarker(t),t.off("dragstart",this._hideMoveMarker,this).off("dragend",this._showUpdateMoveMarker,this)},_hideMoveMarker:function(){this._moveMarker&&this._markerGroup.removeLayer(this._moveMarker)},_showUpdateMoveMarker:function(){this._moveMarker&&(this._markerGroup.addLayer(this._moveMarker),this._updateMoveMarker())}}),L.Edit.Poly.prototype.options.moveIcon=new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),L.Edit.Poly.mergeOptions({moveMarker:!1}),window.CodeMirror=function(){"use strict";var i,v=/gecko\/\d/i.test(navigator.userAgent),x=/MSIE \d/.test(navigator.userAgent),Y=x&&(null==document.documentMode||document.documentMode<8),M=x&&(null==document.documentMode||document.documentMode<9),w=/WebKit\//.test(navigator.userAgent),n=w&&/Qt\/\d+\.\d+/.test(navigator.userAgent),o=/Chrome\//.test(navigator.userAgent),f=/Opera\//.test(navigator.userAgent),y=/Apple Computer/.test(navigator.vendor),_=/KHTML\//.test(navigator.userAgent),a=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),s=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),q=/PhantomJS/.test(navigator.userAgent),K=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),X=K||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),$=K||/Mac/.test(navigator.platform),l=/windows/i.test(navigator.platform),u=(u=f&&navigator.userAgent.match(/Version\/(\d*\.\d*)/))&&Number(u[1]),Z=$&&(n||f&&(null==u||u<12.11)),J=v||x&&!M,Q=!1,tt=!1;function d(t,n){if(!(this instanceof d))return new d(t,n);for(var e in this.options=n=n||{},Ve)!n.hasOwnProperty(e)&&Ve.hasOwnProperty(e)&&(n[e]=Ve[e]);ht(n);var r,i,o="string"==typeof n.value?0:n.value.first,t=this.display=function(t,e){var n={},r=n.input=B("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none; font-size: 4px;");w?r.style.width="1000px":r.setAttribute("wrap","off");K&&(r.style.border="1px solid black");r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),r.setAttribute("spellcheck","false"),n.inputDiv=B("div",[r],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),n.scrollbarH=B("div",[B("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),n.scrollbarV=B("div",[B("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),n.scrollbarFiller=B("div",null,"CodeMirror-scrollbar-filler"),n.gutterFiller=B("div",null,"CodeMirror-gutter-filler"),n.lineDiv=B("div",null,"CodeMirror-code"),n.selectionDiv=B("div",null,null,"position: relative; z-index: 1"),n.cursor=B("div"," ","CodeMirror-cursor"),n.otherCursor=B("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"),n.measure=B("div",null,"CodeMirror-measure"),n.lineSpace=B("div",[n.measure,n.selectionDiv,n.lineDiv,n.cursor,n.otherCursor],null,"position: relative; outline: none"),n.mover=B("div",[B("div",[n.lineSpace],"CodeMirror-lines")],null,"position: relative"),n.sizer=B("div",[n.mover],"CodeMirror-sizer"),n.heightForcer=B("div",null,null,"position: absolute; height: "+m+"px; width: 1px;"),n.gutters=B("div",null,"CodeMirror-gutters"),n.lineGutter=null,n.scroller=B("div",[n.sizer,n.heightForcer,n.gutters],"CodeMirror-scroll"),n.scroller.setAttribute("tabIndex","-1"),n.wrapper=B("div",[n.inputDiv,n.scrollbarH,n.scrollbarV,n.scrollbarFiller,n.gutterFiller,n.scroller],"CodeMirror"),Y&&(n.gutters.style.zIndex=-1,n.scroller.style.paddingRight=0);t.appendChild?t.appendChild(n.wrapper):t(n.wrapper);K&&(r.style.width="0px");w||(n.scroller.draggable=!0);_?(n.inputDiv.style.height="1px",n.inputDiv.style.position="absolute"):Y&&(n.scrollbarH.style.minWidth=n.scrollbarV.style.minWidth="18px");return n.viewOffset=n.lastSizeC=0,n.showingFrom=n.showingTo=e,n.lineNumWidth=n.lineNumInnerWidth=n.lineNumChars=null,n.prevInput="",n.alignWidgets=!1,n.pollingFast=!1,n.poll=new cr,n.cachedCharWidth=n.cachedTextHeight=null,n.measureLineCache=[],n.measureLineCachePos=0,n.inaccurateSelection=!1,n.maxLine=null,n.maxLineLength=0,n.maxLineChanged=!1,n.wheelDX=n.wheelDY=n.wheelStartX=n.wheelStartY=null,n}(t,o),o=(st(t.wrapper.CodeMirror=this),n.autofocus&&!X&&C(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new cr},ot(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),n.value),a=(b(this,Un)(this,o="string"==typeof o?new p(n.value,n.mode):o),x&&setTimeout(W(Xt,this,!0),20),this),s=a.display;function l(){a.state.focused&&setTimeout(W(C,a),0)}function u(){null==i&&(i=setTimeout(function(){i=null,s.cachedCharWidth=s.cachedTextHeight=Mr=null,Dt(a),Vt(a,W(L,a))},100))}function h(t){G(a,t)||a.options.onDragEvent&&a.options.onDragEvent(a,er(t))||rr(t)}function c(){s.inaccurateSelection&&(s.prevInput="",s.inaccurateSelection=!1,s.input.value=a.getSelection(),gr(s.input))}I(s.scroller,"mousedown",b(a,Qt)),I(s.scroller,"dblclick",x?b(a,function(t){var e;G(a,t)||(!(e=Jt(a,t))||te(a,t)||Zt(a.display,t)||(z(t),t=Be(P(a.doc,e.line).text,e),A(a.doc,t.from,t.to)))}):function(t){G(a,t)||z(t)}),I(s.lineSpace,"selectstart",function(t){Zt(s,t)||z(t)}),J||I(s.scroller,"contextmenu",function(t){ve(a,t)}),I(s.scroller,"scroll",function(){s.scroller.clientHeight&&(re(a,s.scroller.scrollTop),ie(a,s.scroller.scrollLeft,!0),g(a,"scroll",a))}),I(s.scrollbarV,"scroll",function(){s.scroller.clientHeight&&re(a,s.scrollbarV.scrollTop)}),I(s.scrollbarH,"scroll",function(){s.scroller.clientHeight&&ie(a,s.scrollbarH.scrollLeft)}),I(s.scroller,"mousewheel",function(t){se(a,t)}),I(s.scroller,"DOMMouseScroll",function(t){se(a,t)}),I(s.scrollbarH,"mousedown",l),I(s.scrollbarV,"mousedown",l),I(s.wrapper,"scroll",function(){s.wrapper.scrollTop=s.wrapper.scrollLeft=0}),I(window,"resize",u),setTimeout(function t(){for(var e=s.wrapper.parentNode;e&&e!=document.body;e=e.parentNode);e?setTimeout(t,5e3):R(window,"resize",u)},5e3),I(s.input,"keyup",b(a,function(t){G(a,t)||a.options.onKeyEvent&&a.options.onKeyEvent(a,er(t))||16==t.keyCode&&(a.doc.sel.shift=!1)})),I(s.input,"input",W(qt,a)),I(s.input,"keydown",b(a,de)),I(s.input,"keypress",b(a,pe)),I(s.input,"focus",W(ge,a)),I(s.input,"blur",W(me,a)),a.options.dragDrop&&(I(s.scroller,"dragstart",function(t){var e,n;e=a,t=t,x&&(!e.state.draggingText||+new Date-ee<100)?rr(t):G(e,t)||Zt(e.display,t)||(n=e.getSelection(),t.dataTransfer.setData("Text",n),t.dataTransfer.setDragImage&&!y&&(n=B("img",null,null,"position: fixed; left: 0; top: 0;"),f&&(n.width=n.height=1,e.display.wrapper.appendChild(n),n._top=n.offsetTop),t.dataTransfer.setDragImage(n,0,0),f&&n.parentNode.removeChild(n)))}),I(s.scroller,"dragenter",h),I(s.scroller,"dragover",h),I(s.scroller,"drop",b(a,ne))),I(s.scroller,"paste",function(t){Zt(s,t)||(C(a),qt(a))}),I(s.input,"paste",function(){a.state.pasteIncoming=!0,qt(a)}),I(s.input,"cut",c),I(s.input,"copy",c),_&&I(s.sizer,"mouseup",function(){document.activeElement==s.input&&s.input.blur(),C(a)});try{r=document.activeElement==t.input}catch(t){}r||n.autofocus&&!X?setTimeout(W(ge,this),20):me(this),b(this,function(){for(var t in je)je.propertyIsEnumerable(t)&&je[t](this,n[t],Ye);for(var e=0;e<$e.length;++e)$e[e](this)})()}function et(t){t.doc.mode=d.getMode(t.options,t.doc.modeOption),t.doc.iter(function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),t.doc.frontier=t.doc.first,bt(t,100),t.state.modeGen++,t.curOp&&L(t)}function nt(e){var n=It(e.display),r=e.options.lineWrapping,i=r&&Math.max(5,e.display.scroller.clientWidth/Rt(e.display)-3);return function(t){return mn(e.doc,t)?0:r?(Math.ceil(t.text.length/i)||1)*n:n}}function rt(t){var e=t.doc,n=nt(t);e.iter(function(t){var e=n(t);e!=t.height&&N(t,e)})}function it(t){var e=r[t.options.keyMap],n=e.style;t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(n?" cm-keymap-"+n:""),t.state.disableInput=e.disableInput}function ot(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Dt(t)}function at(t){st(t),L(t),setTimeout(function(){dt(t)},20)}function st(t){var e=t.display.gutters,n=t.options.gutters;kr(e);for(var r=0;r<n.length;++r){var i=n[r],o=e.appendChild(B("div",null,"CodeMirror-gutter "+i));"CodeMirror-linenumbers"==i&&((t.display.lineGutter=o).style.width=(t.display.lineNumWidth||1)+"px")}e.style.display=r?"":"none"}function lt(t,e){if(0==e.height)return 0;for(var n,r=e.text.length,i=e;n=dn(i);){i=P(t,(o=n.find()).from.line);r+=o.from.ch-o.to.ch}for(i=e;n=pn(i);)var o=n.find(),r=(r-=i.text.length-o.from.ch)+((i=P(t,o.to.line)).text.length-o.to.ch);return r}function ut(t){var n=t.display,r=t.doc;n.maxLine=P(r,r.first),n.maxLineLength=lt(r,n.maxLine),n.maxLineChanged=!0,r.iter(function(t){var e=lt(r,t);e>n.maxLineLength&&(n.maxLineLength=e,n.maxLine=t)})}function ht(t){for(var e=!1,n=0;n<t.gutters.length;++n)"CodeMirror-linenumbers"==t.gutters[n]&&(t.lineNumbers?e=!0:t.gutters.splice(n--,1));!e&&t.lineNumbers&&t.gutters.push("CodeMirror-linenumbers")}function ct(t){var e=t.display,n=t.doc.height+Mt(e),n=(e.sizer.style.minHeight=e.heightForcer.style.top=n+"px",e.gutters.style.height=Math.max(n,e.scroller.clientHeight-m)+"px",Math.max(n,e.scroller.scrollHeight)),r=e.scroller.scrollWidth>e.scroller.clientWidth+1,i=n>e.scroller.clientHeight+1;i?(e.scrollbarV.style.display="block",e.scrollbarV.style.bottom=r?Dr(e.measure)+"px":"0",e.scrollbarV.firstChild.style.height=n-e.scroller.clientHeight+e.scrollbarV.clientHeight+"px"):e.scrollbarV.style.display="",r?(e.scrollbarH.style.display="block",e.scrollbarH.style.right=i?Dr(e.measure)+"px":"0",e.scrollbarH.firstChild.style.width=e.scroller.scrollWidth-e.scroller.clientWidth+e.scrollbarH.clientWidth+"px"):e.scrollbarH.style.display="",r&&i?(e.scrollbarFiller.style.display="block",e.scrollbarFiller.style.height=e.scrollbarFiller.style.width=Dr(e.measure)+"px"):e.scrollbarFiller.style.display="",r&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(e.gutterFiller.style.display="block",e.gutterFiller.style.height=Dr(e.measure)+"px",e.gutterFiller.style.width=e.gutters.offsetWidth+"px"):e.gutterFiller.style.display="",a&&0===Dr(e.measure)&&(e.scrollbarV.style.minWidth=e.scrollbarH.style.minHeight=s?"18px":"12px")}function ft(t,e,n){var r=t.scroller.scrollTop,i=t.wrapper.clientHeight,n=("number"==typeof n?r=n:n&&(r=n.top,i=n.bottom-n.top),r=Math.floor(r-xt(t)),Math.ceil(r+i));return{from:jn(e,r),to:jn(e,n)}}function dt(t){var e=t.display;if(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter){for(var n=gt(e)-e.scroller.scrollLeft+t.doc.scrollLeft,r=e.gutters.offsetWidth,i=n+"px",o=e.lineDiv.firstChild;o;o=o.nextSibling)if(o.alignable)for(var a=0,s=o.alignable;a<s.length;++a)s[a].style.left=i;t.options.fixedGutter&&(e.gutters.style.left=n+r+"px")}}function pt(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function gt(t){return V(t.scroller).left-V(t.sizer).left}function mt(t,e,n){for(var r,i=t.display.showingFrom,o=t.display.showingTo,a=ft(t.display,t.doc,n);function(t,e,n){var r=t.display,i=t.doc;if(r.wrapper.clientWidth){if(!(0==e.length&&n.from>r.showingFrom&&n.to<r.showingTo)){!function(t){var e,n,r;if(t.options.lineNumbers)return e=t.doc,e=pt(t.options,e.first+e.size-1),t=t.display,e.length!=t.lineNumChars?(n=(r=t.measure.appendChild(B("div",[B("div",e)],"CodeMirror-linenumber CodeMirror-gutter-elt"))).firstChild.offsetWidth,r=r.offsetWidth-n,t.lineGutter.style.width="",t.lineNumInnerWidth=Math.max(n,t.lineGutter.offsetWidth-r),t.lineNumWidth=t.lineNumInnerWidth+r,t.lineNumChars=t.lineNumInnerWidth?e.length:-1,t.lineGutter.style.width=t.lineNumWidth+"px",1):void 0}(t)||(e=[{from:i.first,to:i.first+i.size}]);var o=r.sizer.style.marginLeft=r.gutters.offsetWidth+"px",a=(r.scrollbarH.style.left=t.options.fixedGutter?o:"0",1/0);if(t.options.lineNumbers)for(var s=0;s<e.length;++s)if(e[s].diff){a=e[s].from;break}var l=i.first+i.size,u=Math.max(n.from-t.options.viewportMargin,i.first),h=Math.min(l,n.to+t.options.viewportMargin);if(r.showingFrom<u&&u-r.showingFrom<20&&(u=Math.max(i.first,r.showingFrom)),r.showingTo>h&&r.showingTo-h<20&&(h=Math.min(l,r.showingTo)),tt)for(u=O(gn(i,P(i,u)));h<l&&mn(i,P(i,h));)++h;var c=[{from:Math.max(r.showingFrom,i.first),to:Math.min(r.showingTo,l)}];if(c=c[0].from>=c[0].to?[]:function(t,e){for(var n=0,r=e.length||0;n<r;++n){for(var i=e[n],o=[],a=i.diff||0,s=0,l=t.length;s<l;++s){var u=t[s];i.to<=u.from&&i.diff?o.push({from:u.from+a,to:u.to+a}):i.to<=u.from||i.from>=u.to?o.push(u):(i.from>u.from&&o.push({from:u.from,to:i.from}),i.to<u.to&&o.push({from:i.to+a,to:u.to+a}))}t=o}return t}(c,e),tt)for(s=0;s<c.length;++s)for(var f=c[s];d=pn(P(i,f.to-1));){var d=d.find().from.line;if(!(d>f.from)){c.splice(s--,1);break}f.to=d}for(var p=0,s=0;s<c.length;++s)(f=c[s]).from<u&&(f.from=u),f.to>h&&(f.to=h),f.from>=f.to?c.splice(s--,1):p+=f.to-f.from;if(p!=h-u||u!=r.showingFrom||h!=r.showingTo){c.sort(function(t,e){return t.from-e.from});try{var g=document.activeElement}catch(t){}p<.7*(h-u)&&(r.lineDiv.style.display="none"),!function(u,t,e,h,c){var f=function(t){for(var e=t.display,n={},r={},i=e.gutters.firstChild,o=0;i;i=i.nextSibling,++o)n[t.options.gutters[o]]=i.offsetLeft,r[t.options.gutters[o]]=i.offsetWidth;return{fixedPos:gt(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:n,gutterWidth:r,wrapperWidth:e.wrapper.clientWidth}}(u),n=u.display,d=u.options.lineNumbers;h.length||w&&u.display.currentWheelTarget||kr(n.lineDiv);var p=n.lineDiv,g=p.firstChild;function m(t){var e=t.nextSibling;return w&&$&&u.display.currentWheelTarget==t?(t.style.display="none",t.lineObj=null):t.parentNode.removeChild(t),e}var v=h.shift(),y=t;u.doc.iter(t,e,function(t){if(v&&v.to==y&&(v=h.shift()),mn(u.doc,t)){if(0!=t.height&&N(t,0),t.widgets&&g.previousSibling)for(var e=0;e<t.widgets.length;++e){var n,r,i=t.widgets[e];i.showIfHidden&&(n=g.previousSibling,/pre/i.test(n.nodeName)&&(r=B("div",null,null,"position: relative"),n.parentNode.replaceChild(r,n),r.appendChild(n),n=r),r=n.appendChild(B("div",[i.node],"CodeMirror-linewidget")),i.handleMouseEvents||(r.ignoreEvents=!0),yt(i,r,n,f))}}else if(v&&v.from<=y&&v.to>y){for(;g.lineObj!=t;)g=m(g);d&&c<=y&&g.lineNumber&&xr(g.lineNumber,pt(u.options,y)),g=g.nextSibling}else{if(t.widgets)for(var o,a=0,s=g;s&&a<20;++a,s=s.nextSibling)if(s.lineObj==t&&/div/i.test(s.nodeName)){o=s;break}var l=function(t,e,n,r,i){var o,a=Dn(t,e),s=e.gutterMarkers,l=t.display;if(!(t.options.lineNumbers||s||e.bgClass||e.wrapClass||e.widgets))return a;if(i){for(var u,h=!(i.alignable=null),c=0,f=null,d=i.firstChild;d;d=u)if(u=d.nextSibling,/\bCodeMirror-linewidget\b/.test(d.className)){for(var p=0;p<e.widgets.length;++p)if((L=e.widgets[p]).above||(f=d),L.node==d.firstChild){yt(L,d,i,r),++c;break}if(p==e.widgets.length){h=!1;break}}else i.removeChild(d);i.insertBefore(a,f),h&&c==e.widgets.length&&((o=i).className=e.wrapClass||"")}o||(o=B("div",null,e.wrapClass,"position: relative")).appendChild(a);e.bgClass&&o.insertBefore(B("div",null,e.bgClass+" CodeMirror-linebackground"),o.firstChild);if(t.options.lineNumbers||s){var g=o.insertBefore(B("div",null,null,"position: absolute; left: "+(t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px"),o.firstChild);if(t.options.fixedGutter&&(o.alignable||(o.alignable=[])).push(g),!t.options.lineNumbers||s&&s["CodeMirror-linenumbers"]||(o.lineNumber=g.appendChild(B("div",pt(t.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+l.lineNumInnerWidth+"px"))),s)for(var m=0;m<t.options.gutters.length;++m){var v=t.options.gutters[m],y=s.hasOwnProperty(v)&&s[v];y&&g.appendChild(B("div",[y],"CodeMirror-gutter-elt","left: "+r.gutterLeft[v]+"px; width: "+r.gutterWidth[v]+"px"))}}Y&&(o.style.zIndex=2);if(e.widgets&&o!=i)for(var p=0,_=e.widgets;p<_.length;++p){var L,b=B("div",[(L=_[p]).node],"CodeMirror-linewidget");L.handleMouseEvents||(b.ignoreEvents=!0),yt(L,b,o,r),L.above?o.insertBefore(b,t.options.lineNumbers&&0!=e.height?g:a):o.appendChild(b),F(L,"redraw")}return o}(u,t,y,f,o);if(l!=o)p.insertBefore(l,g);else{for(;g!=o;)g=m(g);g=g.nextSibling}l.lineObj=t}++y});for(;g;)g=m(g)}(t,u,h,c,a),r.lineDiv.style.display="",g&&document.activeElement!=g&&g.offsetHeight&&g.focus();(u!=r.showingFrom||h!=r.showingTo||r.lastSizeC!=r.wrapper.clientHeight)&&(r.lastSizeC=r.wrapper.clientHeight,bt(t,400)),r.showingFrom=u,r.showingTo=h;for(var m,v=r.lineDiv.offsetTop,y=r.lineDiv.firstChild;y;y=y.nextSibling)if(y.lineObj){Y?(_=y.offsetTop+y.offsetHeight,m=_-v,v=_):(_=V(y),m=_.bottom-_.top);var _,L=y.lineObj.height-m;if(m<2&&(m=It(r)),.001<L||L<-.001){N(y.lineObj,m);var b=y.lineObj.widgets;if(b)for(s=0;s<b.length;++s)b[s].height=b[s].node.offsetHeight}}return vt(t),1}vt(t)}}else r.showingFrom=r.showingTo=i.first,r.viewOffset=0}(t,e,a)&&(r=!0,_t(t),ct(t),n=n&&Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,"number"==typeof n?n:n.top),!((a=ft(t.display,t.doc,n)).from>=t.display.showingFrom&&a.to<=t.display.showingTo));)e=[];return r&&(F(t,"update",t),t.display.showingFrom==i&&t.display.showingTo==o||F(t,"viewportChange",t,t.display.showingFrom,t.display.showingTo)),r}function vt(t){var e=t.display.viewOffset=Vn(t,P(t.doc,t.display.showingFrom));t.display.mover.style.top=e+"px"}function yt(t,e,n,r){t.noHScroll&&((n.alignable||(n.alignable=[])).push(e),n=r.wrapperWidth,e.style.left=r.fixedPos+"px",t.coverGutter||(n-=r.gutterTotalWidth,e.style.paddingLeft=r.gutterTotalWidth+"px"),e.style.width=n+"px"),t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-r.gutterTotalWidth+"px"))}function _t(t){var e,n=t.display,r=E(t.doc.sel.from,t.doc.sel.to);if(r||t.options.showCursorWhenSelecting?(i=(a=t).display,s=k(a,a.doc.sel.head,"div"),i.cursor.style.left=s.left+"px",i.cursor.style.top=s.top+"px",i.cursor.style.height=Math.max(0,s.bottom-s.top)*a.options.cursorHeight+"px",i.cursor.style.display="",s.other?(i.otherCursor.style.display="",i.otherCursor.style.left=s.other.left+"px",i.otherCursor.style.top=s.other.top+"px",i.otherCursor.style.height=.85*(s.other.bottom-s.other.top)+"px"):i.otherCursor.style.display="none"):n.cursor.style.display=n.otherCursor.style.display="none",r)n.selectionDiv.style.display="none";else{var i,o=t,a=o.display,d=o.doc,s=o.doc.sel,l=document.createDocumentFragment(),p=a.lineSpace.offsetWidth,g=function(t){return j(t.measure,B("pre",null,null,"text-align: left")).appendChild(B("span","x")).offsetLeft}(o.display);function m(t,e,n,r){l.appendChild(B("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px; top: "+(e=e<0?0:e)+"px; width: "+(null==n?p-t:n)+"px; height: "+(r-e)+"px"))}function u(n,s,l){var u,h,r=P(d,n),c=r.text.length;function f(t,e){return Ot(o,S(n,t),"div",r,e)}return function(t,e,n,r){if(!t)return r(e,n,"ltr");for(var i=0;i<t.length;++i){var o=t[i];(o.from<n&&o.to>e||e==n&&o.to==e)&&r(Math.max(o.from,e),Math.min(o.to,n),1==o.level?"rtl":"ltr")}}(H(r),s||0,null==l?c:l,function(t,e,n){var r,i,o,a=f(t,"left");t==e?r=i=(o=a).left:(o=f(e-1,"right"),"rtl"==n&&(n=a,a=o,o=n),r=a.left,i=o.right),null==s&&0==t&&(r=g),3<o.top-a.top&&(m(r,a.top,null,a.bottom),r=g,a.bottom<o.top&&m(r,a.bottom,null,o.top)),null==l&&e==c&&(i=p),(!u||a.top<u.top||a.top==u.top&&a.left<u.left)&&(u=a),(!h||o.bottom>h.bottom||o.bottom==h.bottom&&o.right>h.right)&&(h=o),m(r=r<g+1?g:r,o.top,i-r,o.bottom)}),{start:u,end:h}}s.from.line==s.to.line?u(s.from.line,s.from.ch,s.to.ch):(i=P(d,s.from.line),r=P(d,s.to.line),r=gn(d,i)==gn(d,r),i=u(s.from.line,s.from.ch,r?i.text.length:null).end,s=u(s.to.line,r?0:null,s.to.ch).start,r&&(i.top<s.top-2?(m(i.right,i.top,null,i.bottom),m(g,s.top,s.left,s.bottom)):m(i.right,i.top,s.left-i.right,i.bottom)),i.bottom<s.top&&m(g,i.bottom,null,s.top)),j(a.selectionDiv,l),a.selectionDiv.style.display=""}t.options.moveInputWithCursor&&(r=k(t,t.doc.sel.head,"div"),t=V(n.wrapper),e=V(n.lineDiv),n.inputDiv.style.top=Math.max(0,Math.min(n.wrapper.clientHeight-10,r.top+e.top-t.top))+"px",n.inputDiv.style.left=Math.max(0,Math.min(n.wrapper.clientWidth-10,r.left+e.left-t.left))+"px")}function Lt(t){var e,n;t.state.focused&&(e=t.display,clearInterval(e.blinker),n=!0,e.cursor.style.visibility=e.otherCursor.style.visibility="",e.blinker=setInterval(function(){e.cursor.style.visibility=e.otherCursor.style.visibility=(n=!n)?"":"hidden"},t.options.cursorBlinkRate))}function bt(t,e){t.doc.mode.startState&&t.doc.frontier<t.display.showingTo&&t.state.highlight.set(e,W(wt,t))}function wt(i){var o,a,s,l,u=i.doc;u.frontier<u.first&&(u.frontier=u.first),u.frontier>=i.display.showingTo||(o=+new Date+i.options.workTime,a=Ze(u.mode,kt(i,u.frontier)),s=[],u.iter(u.frontier,Math.min(u.first+u.size,i.display.showingTo+500),function(t){if(u.frontier>=i.display.showingFrom){for(var e=t.styles,n=(t.styles=xn(i,t,a),!e||e.length!=t.styles.length),r=0;!n&&r<e.length;++r)n=e[r]!=t.styles[r];n&&(l&&l.end==u.frontier?l.end++:s.push(l={start:u.frontier,end:u.frontier+1})),t.stateAfter=Ze(u.mode,a)}else Cn(i,t,a),t.stateAfter=u.frontier%5==0?Ze(u.mode,a):null;if(++u.frontier,+new Date>o)return bt(i,i.options.workDelay),!0}),s.length&&b(i,function(){for(var t=0;t<s.length;++t)L(this,s[t].start,s[t].end)})())}function kt(n,r,t){var i,o,a=n.doc,s=n.display;return!a.mode.startState||(i=function(t,e,n){for(var r,i,o=t.doc,a=e,s=e-100;s<a;--a){if(a<=o.first)return o.first;var l=P(o,a-1);if(l.stateAfter&&(!n||a<=o.frontier))return a;l=fr(l.text,null,t.options.tabSize);(null==i||l<r)&&(i=a-1,r=l)}return i}(n,r,t),o=(o=i>a.first&&P(a,i-1).stateAfter)?Ze(a.mode,o):Je(a.mode),a.iter(i,r,function(t){Cn(n,t,o);var e=i==r-1||i%5==0||i>=s.showingFrom&&i<s.showingTo;t.stateAfter=e?Ze(a.mode,o):null,++i}),o)}function xt(t){return t.lineSpace.offsetTop}function Mt(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function Ct(t,e,n,r,i){var o=-1;r=r||Et(t,e);for(var a=n;;a+=o){var s=r[a];if(s)break;o<0&&0==a&&(o=1)}t=(a<n||"right"==i)&&null!=s.topRight;return{left:a<n?s.right:s.left,right:n<a?s.left:s.right,top:t?s.topRight:s.top,bottom:t?s.bottomRight:s.bottom}}function St(t,e){for(var n=t.display.measureLineCache,r=0;r<n.length;++r){var i=n[r];if(i.text==e.text&&i.markedSpans==e.markedSpans&&t.display.scroller.clientWidth==i.width&&i.classes==e.textClass+"|"+e.bgClass+"|"+e.wrapClass)return i}}function Et(t,e){var n,r=St(t,e);return r?r.measure:(r=function(t,e){var n=t.display,r=yr(e.text.length),i=Dn(t,e,r);if(x&&!Y&&!t.options.lineWrapping&&100<i.childNodes.length){for(var o=document.createDocumentFragment(),a=i.childNodes.length,s=0,l=Math.ceil(a/10);s<l;++s){for(var u=B("div",null,null,"display: inline-block"),h=0;h<10&&a;++h)u.appendChild(i.firstChild),--a;o.appendChild(u)}i.appendChild(o)}j(n.measure,i);var c=V(n.lineDiv),f=[],d=yr(e.text.length),p=i.offsetHeight;M&&n.measure.first!=i&&j(n.measure,i);function g(t,e){p<e&&(e=p),t<0&&(t=0);for(var n=0;n<f.length;n+=2){var r=f[n],i=f[n+1];if(!(e<r||i<t)&&(r<=t&&e<=i||t<=r&&i<=e||Math.min(e,i)-Math.max(t,r)>=e-t>>1))return f[n]=Math.min(t,r),f[n+1]=Math.max(e,i),n}return f.push(t,e),n}for(s=0;s<r.length;++s)if(b=r[s]){var m=b;if(/\bCodeMirror-widget\b/.test(b.className)&&b.getClientRects){var v=(m=1==b.firstChild.nodeType?b.firstChild:m).getClientRects(),y=v[0],_=v[v.length-1];if(1<v.length){var v=g(y.top-c.top,y.bottom-c.top),L=g(_.top-c.top,_.bottom-c.top);d[s]={left:y.left-c.left,right:_.right-c.left,top:v,topRight:L};continue}}_=g((y=V(m)).top-c.top,y.bottom-c.top),v=y.right;b.measureRight&&(v=V(b.measureRight).left),d[s]={left:y.left-c.left,right:v-c.left,top:_}}for(var b,s=0;s<d.length;++s){var w,k;(b=d[s])&&(w=b.top,k=b.topRight,b.top=f[w],b.bottom=f[w+1],null!=k&&(b.topRight=f[k],b.bottomRight=f[k+1]))}return d}(t,e),n=t.display.measureLineCache,e={text:e.text,width:t.display.scroller.clientWidth,markedSpans:e.markedSpans,measure:r,classes:e.textClass+"|"+e.bgClass+"|"+e.wrapClass},16==n.length?n[++t.display.measureLineCachePos%16]=e:n.push(e),r)}function Dt(t){t.display.measureLineCache.length=t.display.measureLineCachePos=0,t.display.cachedCharWidth=t.display.cachedTextHeight=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function Tt(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function At(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function Pt(t,e,n,r){if(e.widgets)for(var i=0;i<e.widgets.length;++i){var o;e.widgets[i].above&&(o=bn(e.widgets[i]),n.top+=o,n.bottom+=o)}var a;return"line"!=r&&(r=r||"local",a=Vn(t,e),"local"==r?a+=xt(t.display):a-=t.display.viewOffset,"page"!=r&&"window"!=r||(a+=(t=V(t.display.lineSpace)).top+("window"==r?0:At()),t=t.left+("window"==r?0:Tt()),n.left+=t,n.right+=t),n.top+=a,n.bottom+=a),n}function Nt(t,e,n){var r;return"div"==n?e:(r=e.left,e=e.top,"page"==n?(r-=Tt(),e-=At()):"local"!=n&&n||(r+=(n=V(t.display.sizer)).left,e+=n.top),{left:r-(n=V(t.display.lineSpace)).left,top:e-n.top})}function Ot(t,e,n,r,i){return Pt(t,r=r||P(t.doc,e.line),Ct(t,r,e.ch,null,i),n)}function k(n,t,r,i,o){function a(t,e){t=Ct(n,i,t,o,e?"right":"left");return e?t.left=t.right:t.right=t.left,Pt(n,i,t,r)}function e(t,e){var n=l[e],r=n.level%2;return t==zr(n)&&e&&n.level<l[e-1].level?(t=Ir(n=l[--e])-(n.level%2?0:1),r=!0):t==Ir(n)&&e<l.length-1&&n.level<l[e+1].level&&(t=zr(n=l[++e])-n.level%2,r=!1),r&&t==n.to&&t>n.from?a(t-1):a(t,r)}i=i||P(n.doc,t.line),o=o||Et(n,i);var s,l=H(i),t=t.ch;return l?(s=e(t,Ur(l,t)),null!=Ar&&(s.other=e(t,Ar)),s):a(t)}function Ht(t,e,n,r){t=new S(t,e);return t.xRel=r,n&&(t.outside=!0),t}function zt(t,e,n){var r=t.doc;if((n+=t.display.viewOffset)<0)return Ht(r.first,0,!0,-1);var i=jn(r,n),o=r.first+r.size-1;if(o<i)return Ht(r.first+r.size-1,P(r,o).text.length,!0,1);for(e<0&&(e=0);;){var a=P(r,i),s=function(e,n,r,t,i){var o=i-Vn(e,n),a=!1,s=2*e.display.wrapper.clientWidth,l=Et(e,n);function u(t){t=k(e,S(r,t),"line",n,l);return a=!0,o>t.bottom?t.left-s:o<t.top?t.left+s:(a=!1,t.left)}var h=H(n),c=n.text.length,f=Rr(n),d=Fr(n),p=u(f),g=a,m=u(d),v=a;if(m<t)return Ht(r,d,v,1);for(;;){if(h?d==f||d==Br(n,f,1):d-f<=1){for(var y=t<p||t-p<=m-t?f:d,_=t-(y==f?p:m);wr.test(n.text.charAt(y));)++y;return Ht(r,y,y==f?g:v,_<0?-1:_?1:0)}var L=Math.ceil(c/2),b=f+L;if(h){b=f;for(var w=0;w<L;++w)b=Br(n,b,1)}_=u(b);t<_?(d=b,m=_,(v=a)&&(m+=1e3),c=L):(f=b,p=_,g=a,c-=L)}}(t,a,i,e,n),a=pn(a),l=a&&a.find();if(!a||!(s.ch>l.from.ch||s.ch==l.from.ch&&0<s.xRel))return s;i=l.to.line}}function It(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==i){i=B("pre");for(var e=0;e<49;++e)i.appendChild(document.createTextNode("x")),i.appendChild(B("br"));i.appendChild(document.createTextNode("x"))}j(t.measure,i);var n=i.offsetHeight/50;return 3<n&&(t.cachedTextHeight=n),kr(t.measure),n||1}function Rt(t){var e,n;return null!=t.cachedCharWidth?t.cachedCharWidth:(e=B("span","x"),n=B("pre",[e]),j(t.measure,n),2<(n=e.offsetWidth)&&(t.cachedCharWidth=n),n||10)}var Ft,Gt,Ut=0;function Wt(t){t.curOp={changes:[],updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,cursorActivity:!1,updateMaxLine:!1,updateScrollPos:!1,id:++Ut},sr++||(ar=[])}function Bt(t){var e,n,r,i,o=t.curOp,a=t.doc,s=t.display,l=(t.curOp=null,o.updateMaxLine&&ut(t),s.maxLineChanged&&!t.options.lineWrapping&&s.maxLine&&(n=function(t,e){var n=!1;if(e.markedSpans)for(var r=0;r<e.markedSpans;++r){var i=e.markedSpans[r];!i.collapsed||null!=i.to&&i.to!=e.text.length||(n=!0)}var o,a=!n&&St(t,e);return a?Ct(t,e,e.text.length,a.measure,"right").right:(o=(a=Dn(t,e)).appendChild(Tr(t.display.measure)),j(t.display.measure,a),V(o).right-V(t.display.lineDiv).left)}(t,s.maxLine),s.sizer.style.minWidth=Math.max(0,n+3+m)+"px",s.maxLineChanged=!1,(n=Math.max(0,s.sizer.offsetLeft+s.sizer.offsetWidth-s.scroller.clientWidth))<a.scrollLeft&&!o.updateScrollPos&&ie(t,Math.min(s.scroller.scrollLeft,n),!0)),o.updateScrollPos?e=o.updateScrollPos:o.selectionChanged&&s.scroller.clientHeight&&(e=ze(t,(n=k(t,a.sel.head)).left,n.top,n.left,n.bottom)),(o.changes.length||e&&null!=e.scrollTop)&&(r=mt(t,o.changes,e&&e.scrollTop),t.display.scroller.offsetHeight&&(t.doc.scrollTop=t.display.scroller.scrollTop)),!r&&o.selectionChanged&&_t(t),o.updateScrollPos?(s.scroller.scrollTop=s.scrollbarV.scrollTop=a.scrollTop=e.scrollTop,s.scroller.scrollLeft=s.scrollbarH.scrollLeft=a.scrollLeft=e.scrollLeft,dt(t),o.scrollToPos&&He(t,T(t.doc,o.scrollToPos),o.scrollToPosMargin)):e&&(r=He(n=t,n.doc.sel.head,n.options.cursorScrollMargin),n.state.focused&&(n=n.display,s=V(n.sizer),a=null,r.top+s.top<0?a=!0:r.bottom+s.top>(window.innerHeight||document.documentElement.clientHeight)&&(a=!1),null==a||q||((s="none"==n.cursor.style.display)&&(n.cursor.style.display="",n.cursor.style.left=r.left+"px",n.cursor.style.top=r.top-n.viewOffset+"px"),n.cursor.scrollIntoView(a),s&&(n.cursor.style.display="none")))),o.selectionChanged&&Lt(t),t.state.focused&&o.updateInput&&Xt(t,o.userSelChange),o.maybeHiddenMarkers),u=o.maybeUnhiddenMarkers;if(l)for(var h=0;h<l.length;++h)l[h].lines.length||g(l[h],"hide");if(u)for(h=0;h<u.length;++h)u[h].lines.length&&g(u[h],"unhide");if(--sr||(i=ar,ar=null),o.textChanged&&g(t,"change",t,o.textChanged),o.cursorActivity&&g(t,"cursorActivity",t),i)for(h=0;h<i.length;++h)i[h]()}function b(r,i){return function(){var t=r||this,e=!t.curOp;e&&Wt(t);try{var n=i.apply(t,arguments)}finally{e&&Bt(t)}return n}}function jt(n){return function(){var t,e=this.cm&&!this.cm.curOp;e&&Wt(this.cm);try{t=n.apply(this,arguments)}finally{e&&Bt(this.cm)}return t}}function Vt(t,e){var n,r=!t.curOp;r&&Wt(t);try{n=e()}finally{r&&Bt(t)}return n}function L(t,e,n,r){null==e&&(e=t.doc.first),null==n&&(n=t.doc.first+t.doc.size),t.curOp.changes.push({from:e,to:n,diff:r})}function Yt(t){t.display.pollingFast||t.display.poll.set(t.options.pollInterval,function(){Kt(t),t.state.focused&&Yt(t)})}function qt(e){var n=!1;e.display.pollingFast=!0,e.display.poll.set(20,function t(){Kt(e)||n?(e.display.pollingFast=!1,Yt(e)):(n=!0,e.display.poll.set(60,t))})}function Kt(t){var e=t.display.input,n=t.display.prevInput,r=t.doc,i=r.sel;if(!t.state.focused||Nr(e)||$t(t)||t.state.disableInput)return!1;var o=e.value;if(o==n&&E(i.from,i.to))return!1;if(x&&!M&&t.display.inputHasSelection===o)return Xt(t,!0),!1;for(var a=!t.curOp,s=(a&&Wt(t),i.shift=!1,0),l=Math.min(n.length,o.length);s<l&&n.charCodeAt(s)==o.charCodeAt(s);)++s;var u=i.from,i=i.to,r=(s<n.length?u=S(u.line,u.ch-(n.length-s)):t.state.overwrite&&E(u,i)&&!t.state.pasteIncoming&&(i=S(i.line,Math.min(P(r,i.line).text.length,i.ch+(o.length-s)))),t.curOp.updateInput),u={from:u,to:i,text:Pr(o.slice(s)),origin:t.state.pasteIncoming?"paste":"+input"};return we(t.doc,u,"end"),t.curOp.updateInput=r,F(t,"inputRead",t,u),1e3<o.length||-1<o.indexOf("\n")?e.value=t.display.prevInput="":t.display.prevInput=o,a&&Bt(t),!(t.state.pasteIncoming=!1)}function Xt(t,e){var n,r,i=t.doc;E(i.sel.from,i.sel.to)?e&&(t.display.prevInput=t.display.input.value="",x&&!M&&(t.display.inputHasSelection=null)):(t.display.prevInput="",e=(r=Or&&(100<i.sel.to.line-i.sel.from.line||1e3<(n=t.getSelection()).length))?"-":n||t.getSelection(),t.display.input.value=e,t.state.focused&&gr(t.display.input),x&&!M&&(t.display.inputHasSelection=e)),t.display.inaccurateSelection=r}function C(t){"nocursor"==t.options.readOnly||X&&document.activeElement==t.display.input||t.display.input.focus()}function $t(t){return t.options.readOnly||t.doc.cantEdit}function Zt(t,e){for(var n=ir(e);n!=t.wrapper;n=n.parentNode)if(!n||n.ignoreEvents||n.parentNode==t.sizer&&n!=t.mover)return 1}function Jt(t,e,n){var r=t.display;if(!n){n=ir(e);if(n==r.scrollbarH||n==r.scrollbarH.firstChild||n==r.scrollbarV||n==r.scrollbarV.firstChild||n==r.scrollbarFiller||n==r.gutterFiller)return null}var i,o,n=V(r.lineSpace);try{i=e.clientX,o=e.clientY}catch(e){return null}return zt(t,i-n.left,o-n.top)}function Qt(e){if(!G(this,e)){var a=this,s=a.display,l=a.doc,t=l.sel;if(t.shift=e.shiftKey,Zt(s,e))w||(s.scroller.draggable=!1,setTimeout(function(){s.scroller.draggable=!0},100));else if(!te(a,e)){var n,u,r,i,h,o,c,f,d,p,g,m,v,y=Jt(a,e);switch(or(e)){case 3:return void(J&&ve.call(a,a,e));case 2:return y&&A(a.doc,y),setTimeout(W(C,a),20),void z(e)}y?(a.state.focused||ge(a),n=+new Date,u="single",Gt&&Gt.time>n-400&&E(Gt.pos,y)?(u="triple",z(e),setTimeout(W(C,a),20),r=a,i=y.line,A(r.doc,S(i,0),T(r.doc,S(i+1,0)))):Ft&&Ft.time>n-400&&E(Ft.pos,y)?(u="double",Gt={time:n,pos:y},z(e),r=Be(P(l,y.line).text,y),A(a.doc,r.from,r.to)):Ft={time:n,pos:y},h=y,!a.options.dragDrop||!Sr||$t(a)||E(t.from,t.to)||D(y,t.from)||D(t.to,y)||"single"!=u?(z(e),"single"==u&&A(a.doc,T(l,y)),c=t.from,f=t.to,d=y,p=V(s.wrapper),g=0,m=b(a,function(t){(x||or(t)?_:L)(t)}),v=b(a,L),I(document,"mousemove",m),I(document,"mouseup",v)):(o=b(a,function(t){w&&(s.scroller.draggable=!1),a.state.draggingText=!1,R(document,"mouseup",o),R(s.scroller,"drop",o),Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)<10&&(z(t),A(a.doc,y),C(a))}),w&&(s.scroller.draggable=!0),a.state.draggingText=o,s.scroller.dragDrop&&s.scroller.dragDrop(),I(document,"mouseup",o),I(s.scroller,"drop",o))):ir(e)==s.scroller&&z(e)}}function _(t){var e,n,r,i=++g,o=Jt(a,t,!0);o&&(E(o,h)?(e=t.clientY<p.top?-20:t.clientY>p.bottom?20:0)&&setTimeout(b(a,function(){g==i&&(s.scroller.scrollTop+=e,_(t))}),50):(a.state.focused||ge(a),E(d,n=h=o)||(d=n,"single"==u?A(a.doc,T(l,y),n):(c=T(l,c),f=T(l,f),"double"==u?(r=Be(P(l,n.line).text,n),D(n,c)?A(a.doc,r.from,f):A(a.doc,c,r.to)):"triple"==u&&(D(n,c)?A(a.doc,f,T(l,S(n.line,0))):A(a.doc,c,T(l,S(n.line+1,0)))))),r=ft(s,l),(o.line>=r.to||o.line<r.from)&&setTimeout(b(a,function(){g==i&&_(t)}),150)))}function L(t){g=1/0,z(t),C(a),R(document,"mousemove",m),R(document,"mouseup",v)}}function te(t,e){var n=t.display;try{var r=e.clientX,i=e.clientY}catch(e){return}if(!(r>=Math.floor(V(n.gutters).right))){if(z(e),ur(t,"gutterClick")){var o=V(n.lineDiv);if(!(i>o.bottom)){i-=o.top-n.viewOffset;for(var a=0;a<t.options.gutters.length;++a){var s=n.gutters.childNodes[a];if(s&&V(s).right>=r){F(t,"gutterClick",t,jn(t.doc,i),t.options.gutters[a],e);break}}}}return 1}}var ee=0;function ne(t){var r=this;if(!(G(r,t)||Zt(r.display,t)||r.options.onDragEvent&&r.options.onDragEvent(r,er(t)))){z(t),x&&(ee=+new Date);var e,n,i=Jt(r,t,!0),o=t.dataTransfer.files;if(i&&!$t(r))if(o&&o.length&&window.FileReader&&window.File)for(var a=o.length,s=Array(a),l=0,u=0;u<a;++u)!function(t,e){var n=new FileReader;n.onload=function(){s[e]=n.result,++l==a&&(i=T(r.doc,i),we(r.doc,{from:i,to:i,text:Pr(s.join("\n")),origin:"paste"},"around"))},n.readAsText(t)}(o[u],u);else if(!r.state.draggingText||D(i,r.doc.sel.from)||D(r.doc.sel.to,i))try{(s=t.dataTransfer.getData("Text"))&&(e=r.doc.sel.from,n=r.doc.sel.to,Pe(r.doc,i,i),r.state.draggingText&&Se(r.doc,"",e,n,"paste"),r.replaceSelection(s,null,"paste"),C(r),ge(r))}catch(t){}else r.state.draggingText(t),setTimeout(W(C,r),20)}}function re(t,e){Math.abs(t.doc.scrollTop-e)<2||(t.doc.scrollTop=e,v||mt(t,[],e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e),t.display.scrollbarV.scrollTop!=e&&(t.display.scrollbarV.scrollTop=e),v&&mt(t,[]),bt(t,100))}function ie(t,e,n){(n?e==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-e)<2)||(e=Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth),t.doc.scrollLeft=e,dt(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbarH.scrollLeft!=e&&(t.display.scrollbarH.scrollLeft=e))}var oe,ae=0,h=null;function se(t,e){var n,r,i,o=e.wheelDeltaX,a=e.wheelDeltaY,s=(null==o&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(o=e.detail),null==a&&e.detail&&e.axis==e.VERTICAL_AXIS?a=e.detail:null==a&&(a=e.wheelDelta),t.display),l=s.scroller;if(o&&l.scrollWidth>l.clientWidth||a&&l.scrollHeight>l.clientHeight){if(a&&$&&w)for(var u=e.target;u!=l;u=u.parentNode)if(u.lineObj){t.display.currentWheelTarget=u;break}!o||v||f||null==h?(a&&null!=h&&(n=a*h,i=(r=t.doc.scrollTop)+s.wrapper.clientHeight,n<0?r=Math.max(0,r+n-50):i=Math.min(t.doc.height,i+n+50),mt(t,[],{top:r,bottom:i})),ae<20&&(null==s.wheelStartX?(s.wheelStartX=l.scrollLeft,s.wheelStartY=l.scrollTop,s.wheelDX=o,s.wheelDY=a,setTimeout(function(){var t,e;null!=s.wheelStartX&&(t=l.scrollLeft-s.wheelStartX,e=(e=l.scrollTop-s.wheelStartY)&&s.wheelDY&&e/s.wheelDY||t&&s.wheelDX&&t/s.wheelDX,s.wheelStartX=s.wheelStartY=null,e&&(h=(h*ae+e)/(ae+1),++ae))},200)):(s.wheelDX+=o,s.wheelDY+=a))):(a&&re(t,Math.max(0,Math.min(l.scrollTop+a*h,l.scrollHeight-l.clientHeight))),ie(t,Math.max(0,Math.min(l.scrollLeft+o*h,l.scrollWidth-l.clientWidth))),z(e),s.wheelStartX=null)}}function le(t,e,n){if("string"==typeof e&&!(e=Qe[e]))return!1;t.display.pollingFast&&Kt(t)&&(t.display.pollingFast=!1);var r=t.doc,i=r.sel.shift,o=!1;try{$t(t)&&(t.state.suppressEdits=!0),n&&(r.sel.shift=!1),o=e(t)!=hr}finally{r.sel.shift=i,t.state.suppressEdits=!1}return o}function ue(t){var e=t.state.keyMaps.slice(0);return t.options.extraKeys&&e.push(t.options.extraKeys),e.push(t.options.keyMap),e}function he(e,t){var n,r=tn(e.options.keyMap),i=r.auto,o=(clearTimeout(oe),i&&!nn(t)&&(oe=setTimeout(function(){tn(e.options.keyMap)==r&&(e.options.keyMap=i.call?i.call(null,e):i,it(e))},50)),rn(t,!0)),a=!1;return!!o&&(n=ue(e),(a=t.shiftKey?en("Shift-"+o,n,function(t){return le(e,t,!0)})||en(o,n,function(t){return!("string"==typeof t?!/^go[A-Z]/.test(t):!t.motion)&&le(e,t)}):en(o,n,function(t){return le(e,t)}))&&(z(t),Lt(e),M&&(t.oldKeyCode=t.keyCode,t.keyCode=0),F(e,"keyHandled",e,o,t)),a)}x?h=-.53:v?h=15:o?h=-.7:y&&(h=-1/3);var ce,fe=null;function de(t){var e,n;this.state.focused||ge(this),x&&27==t.keyCode&&(t.returnValue=!1),G(this,t)||this.options.onKeyEvent&&this.options.onKeyEvent(this,er(t))||(e=t.keyCode,this.doc.sel.shift=16==e||t.shiftKey,n=he(this,t),f&&(fe=n?e:null,!n&&88==e&&!Or&&($?t.metaKey:t.ctrlKey)&&this.replaceSelection("")))}function pe(t){var e,n,r,i=this;G(i,t)||i.options.onKeyEvent&&i.options.onKeyEvent(i,er(t))||(r=t.keyCode,n=t.charCode,f&&r==fe?(fe=null,z(t)):(f&&(!t.which||t.which<10)||_)&&he(i,t)||(r=String.fromCharCode(null==n?r:n),this.options.electricChars&&this.doc.mode.electricChars&&this.options.smartIndent&&!$t(this)&&-1<this.doc.mode.electricChars.indexOf(r)&&setTimeout(b(i,function(){Fe(i,i.doc.sel.to.line,"smart")}),75),n=t,(r=en("'"+(t=r)+"'",ue(e=i),function(t){return le(e,t,!0)}))&&(z(n),Lt(e),F(e,"keyHandled",e,"'"+t+"'",n)),r||(x&&!M&&(i.display.inputHasSelection=null),qt(i))))}function ge(t){"nocursor"!=t.options.readOnly&&(t.state.focused||(g(t,"focus",t),t.state.focused=!0,-1==t.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(t.display.wrapper.className+=" CodeMirror-focused"),Xt(t,!0)),Yt(t),Lt(t))}function me(t){t.state.focused&&(g(t,"blur",t),t.state.focused=!1,t.display.wrapper.className=t.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(t.display.blinker),setTimeout(function(){t.state.focused||(t.doc.sel.shift=!1)},150)}function ve(n,t){var e,r,i,o,a=n.display,s=n.doc.sel;function l(){var t;null!=a.input.selectionStart&&(t=a.input.value=" "+(E(s.from,s.to)?"":a.input.value),a.prevInput=" ",a.input.selectionStart=1,a.input.selectionEnd=t.length)}function u(){var t,e;a.inputDiv.style.position="relative",a.input.style.cssText=i,M&&(a.scrollbarV.scrollTop=a.scroller.scrollTop=r),Yt(n),null!=a.input.selectionStart&&(x&&!M||l(),clearTimeout(ce),t=0,e=function(){" "==a.prevInput&&0==a.input.selectionStart?b(n,Qe.selectAll)(n):t++<10?ce=setTimeout(e,500):Xt(n)},ce=setTimeout(e,200))}Zt(a,t)||(e=Jt(n,t),r=a.scroller.scrollTop,e&&!f&&(!E(s.from,s.to)&&!D(e,s.from)&&D(e,s.to)||b(n,Pe)(n.doc,e,e),i=a.input.style.cssText,a.inputDiv.style.position="absolute",a.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);",C(n),Xt(n,!0),E(s.from,s.to)&&(a.input.value=a.prevInput=" "),x&&!M&&l(),J?(rr(t),o=function(){R(window,"mouseup",o),setTimeout(u,20)},I(window,"mouseup",o)):setTimeout(u,50)))}var ye=d.changeEnd=function(t){return t.text?S(t.from.line+t.text.length-1,U(t.text).length+(1==t.text.length?t.from.ch:0)):t.to};function _e(t,e,n){var r,i,o;return D(e.from,n)?(r=e.text.length-1-(e.to.line-e.from.line),n.line>e.to.line+r?(i=n.line-r,(o=t.first+t.size-1)<i?S(o,P(t,o).text.length):Te(n,P(t,i).text.length)):n.line==e.to.line+r?Te(n,U(e.text).length+(1==e.text.length?e.from.ch:0)+P(t,e.to.line).text.length-e.to.ch):(o=n.line-e.from.line,Te(n,e.text[o].length+(o?0:e.from.ch)))):T(t,n)}function Le(t,r,e){var i;return e&&"object"==typeof e?{anchor:_e(t,r,e.anchor),head:_e(t,r,e.head)}:"start"==e?{anchor:r.from,head:r.from}:(i=ye(r),"around"==e?{anchor:r.from,head:i}:"end"==e?{anchor:i,head:i}:{anchor:(e=function(t){var e,n;return D(t,r.from)?t:D(r.to,t)?(e=t.line+r.text.length-(r.to.line-r.from.line)-1,n=t.ch,t.line==r.to.line&&(n+=i.ch-r.to.ch),S(e,n)):i})(t.sel.anchor),head:e(t.sel.head)})}function be(i,t,e){t={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){this.canceled=!0}};return e&&(t.update=function(t,e,n,r){t&&(this.from=T(i,t)),e&&(this.to=T(i,e)),n&&(this.text=n),void 0!==r&&(this.origin=r)}),g(i,"beforeChange",i,t),i.cm&&g(i.cm,"beforeChange",i.cm,t),t.canceled?null:{from:t.from,to:t.to,text:t.text,origin:t.origin}}function we(t,e,n,r){if(t.cm){if(!t.cm.curOp)return b(t.cm,we)(t,e,n,r);if(t.cm.state.suppressEdits)return}if(!(ur(t,"beforeChange")||t.cm&&ur(t.cm,"beforeChange"))||(e=be(t,e,!0))){var i=Q&&!r&&function(t,e,n){var r=null;if(t.iter(e.line,n.line+1,function(t){if(t.markedSpans)for(var e=0;e<t.markedSpans.length;++e){var n=t.markedSpans[e].marker;!n.readOnly||r&&-1!=c(r,n)||(r=r||[]).push(n)}}),!r)return null;for(var i=[{from:e,to:n}],o=0;o<r.length;++o)for(var a=r[o],s=a.find(),l=0;l<i.length;++l){var u,h=i[l];D(h.to,s.from)||D(s.to,h.from)||(u=[l,1],(D(h.from,s.from)||!a.inclusiveLeft&&E(h.from,s.from))&&u.push({from:h.from,to:s.from}),(D(s.to,h.to)||!a.inclusiveRight&&E(h.to,s.to))&&u.push({from:s.to,to:h.to}),i.splice.apply(i,u),l+=u.length-1)}return i}(t,e.from,e.to);if(i){for(var o=i.length-1;1<=o;--o)ke(t,{from:i[o].from,to:i[o].to,text:[""]});i.length&&ke(t,{from:i[0].from,to:i[0].to,text:e.text},n)}else ke(t,e,n)}}function ke(t,n,e){var e=Le(t,n,e),r=(Xn(t,n,e,t.cm?t.cm.curOp.id:NaN),Ce(t,n,e,hn(t,n)),[]);Gn(t,function(t,e){e||-1!=c(r,t.history)||(Qn(t.history,n),r.push(t.history)),Ce(t,n,null,hn(t,n))})}function xe(t,e){if(!t.cm||!t.cm.state.suppressEdits){var n=t.history,r=("undo"==e?n.done:n.undone).pop();if(r)for(var i={changes:[],anchorBefore:r.anchorAfter,headBefore:r.headAfter,anchorAfter:r.anchorBefore,headAfter:r.headBefore,generation:n.generation},o=(("undo"==e?n.undone:n.done).push(i),n.generation=r.generation||++n.maxGeneration,ur(t,"beforeChange")||t.cm&&ur(t.cm,"beforeChange")),a=r.changes.length-1;0<=a;--a){var s=r.changes[a];if(s.origin=e,o&&!be(t,s,!1))return void(("undo"==e?n.done:n.undone).length=0);i.changes.push(Kn(t,s));var l=a?Le(t,s,null):{anchor:r.anchorBefore,head:r.headBefore},u=(Ce(t,s,l,cn(t,s)),[]);Gn(t,function(t,e){e||-1!=c(u,t.history)||(Qn(t.history,s),u.push(t.history)),Ce(t,s,null,cn(t,s))})}}}function Me(t,e){function n(t){return S(t.line+e,t.ch)}t.first+=e,t.cm&&L(t.cm,t.first,t.first,e),t.sel.head=n(t.sel.head),t.sel.anchor=n(t.sel.anchor),t.sel.from=n(t.sel.from),t.sel.to=n(t.sel.to)}function Ce(t,e,n,r){if(t.cm&&!t.cm.curOp)return b(t.cm,Ce)(t,e,n,r);if(e.to.line<t.first)Me(t,e.text.length-1-(e.to.line-e.from.line));else if(!(e.from.line>t.lastLine())){e.from.line<t.first&&(Me(t,i=e.text.length-1-(t.first-e.from.line)),e={from:S(t.first,0),to:S(e.to.line+i,e.to.ch),text:[U(e.text)],origin:e.origin});var i=t.lastLine();if((e=e.to.line>i?{from:e.from,to:S(i,P(t,i).text.length),text:[e.text[0]],origin:e.origin}:e).removed=Wn(t,e.from,e.to),n=n||Le(t,e,null),t.cm){var i=t.cm,o=e,a=r,s=n,l=i.doc,u=i.display,h=o.from,c=o.to,f=!1,d=h.line;if(i.options.lineWrapping||(d=O(gn(l,P(l,h.line))),l.iter(d,c.line+1,function(t){if(t==u.maxLine)return f=!0})),D(l.sel.head,o.from)||D(o.to,l.sel.head)||(i.curOp.cursorActivity=!0),On(l,o,a,s,nt(i)),i.options.lineWrapping||(l.iter(d,h.line+o.text.length,function(t){var e=lt(l,t);e>u.maxLineLength&&(u.maxLine=t,u.maxLineLength=e,u.maxLineChanged=!0,f=!1)}),f&&(i.curOp.updateMaxLine=!0)),l.frontier=Math.min(l.frontier,h.line),bt(i,400),a=o.text.length-(c.line-h.line)-1,L(i,h.line,c.line+1,a),ur(i,"change")){s={from:h,to:c,text:o.text,removed:o.removed,origin:o.origin};if(i.curOp.textChanged){for(var p=i.curOp.textChanged;p.next;p=p.next);p.next=s}else i.curOp.textChanged=s}}else On(t,e,r,n)}}function Se(t,e,n,r,i){var o;D(r=r||n,n)&&(o=r,r=n,n=o),we(t,{from:n,to:r,text:e="string"==typeof e?Pr(e):e,origin:i},null)}function S(t,e){if(!(this instanceof S))return new S(t,e);this.line=t,this.ch=e}function E(t,e){return t.line==e.line&&t.ch==e.ch}function D(t,e){return t.line<e.line||t.line==e.line&&t.ch<e.ch}function Ee(t){return S(t.line,t.ch)}function De(t,e){return Math.max(t.first,Math.min(e,t.first+t.size-1))}function T(t,e){var n;return e.line<t.first?S(t.first,0):(n=t.first+t.size-1,e.line>n?S(n,P(t,n).text.length):Te(e,P(t,e.line).text.length))}function Te(t,e){var n=t.ch;return null==n||e<n?S(t.line,e):n<0?S(t.line,0):t}function Ae(t,e){return e>=t.first&&e<t.first+t.size}function A(t,e,n,r){var i,o;t.sel.shift||t.sel.extend?(i=t.sel.anchor,n&&((o=D(e,i))!=D(n,i)?(i=e,e=n):o!=D(e,n)&&(e=n)),Pe(t,i,e,r)):Pe(t,e,n||e,r),t.cm&&(t.cm.curOp.userSelChange=!0)}function Pe(t,e,n,r,i){(!i&&ur(t,"beforeSelectionChange")||t.cm&&ur(t.cm,"beforeSelectionChange"))&&(g(o=t,"beforeSelectionChange",o,a={anchor:a=e,head:n}),o.cm&&g(o.cm,"beforeSelectionChange",o.cm,a),a.anchor=T(o,a.anchor),a.head=T(o,a.head),n=(o=a).head,e=o.anchor);var o,a=t.sel;a.goalColumn=null,!i&&E(e,a.anchor)||(e=Oe(t,e,r,"push"!=i)),!i&&E(n,a.head)||(n=Oe(t,n,r,"push"!=i)),E(a.anchor,e)&&E(a.head,n)||(a.anchor=e,o=D(a.head=n,e),a.from=o?n:e,a.to=o?e:n,t.cm&&(t.cm.curOp.updateInput=t.cm.curOp.selectionChanged=t.cm.curOp.cursorActivity=!0),F(t,"cursorActivity",t))}function Ne(t){Pe(t.doc,t.doc.sel.from,t.doc.sel.to,null,"push")}function Oe(t,e,n,r){var i=!1,o=e,a=n||1;t.cantEdit=!1;t:for(;;){var s=P(t,o.line);if(s.markedSpans)for(var l=0;l<s.markedSpans.length;++l){var u=s.markedSpans[l],h=u.marker;if((null==u.from||(h.inclusiveLeft?u.from<=o.ch:u.from<o.ch))&&(null==u.to||(h.inclusiveRight?u.to>=o.ch:u.to>o.ch))){if(r&&(g(h,"beforeCursorEnter"),h.explicitlyCleared)){if(s.markedSpans){--l;continue}break}if(h.atomic){u=h.find()[a<0?"from":"to"];if(E(u,o)&&(u.ch+=a,u.ch<0?u=u.line>t.first?T(t,S(u.line-1)):null:u.ch>s.text.length&&(u=u.line<t.first+t.size-1?S(u.line+1,0):null),!u)){if(i)return r?(t.cantEdit=!0,S(t.first,0)):Oe(t,e,n,!0);i=!0,u=e,a=-a}o=u;continue t}}}return o}}function He(t,e,n){for(null==n&&(n=0);;){var r=!1,i=k(t,e),o=ze(t,i.left,i.top-n,i.left,i.bottom+n),a=t.doc.scrollTop,s=t.doc.scrollLeft;if(null!=o.scrollTop&&(re(t,o.scrollTop),1<Math.abs(t.doc.scrollTop-a)&&(r=!0)),null!=o.scrollLeft&&(ie(t,o.scrollLeft),1<Math.abs(t.doc.scrollLeft-s)&&(r=!0)),!r)return i}}function ze(t,e,n,r,i){var o=t.display,a=It(t.display),s=o.scroller.clientHeight-m,l=o.scroller.scrollTop,u={},t=t.doc.height+Mt(o),h=t-a<i,n=((n=n<0?0:n)<l?u.scrollTop=n<a?0:n:l+s<i&&((a=Math.min(n,(h?t:i)-s))!=l&&(u.scrollTop=a)),o.scroller.clientWidth-m),h=o.scroller.scrollLeft,t=(e+=o.gutters.offsetWidth,r+=o.gutters.offsetWidth,o.gutters.offsetWidth),i=e<t+10;return e<h+t||i?(i&&(e=0),u.scrollLeft=Math.max(0,e-10-t)):n+h-3<r&&(u.scrollLeft=r+10-n),u}function Ie(t,e,n){t.curOp.updateScrollPos={scrollLeft:null==e?t.doc.scrollLeft:e,scrollTop:null==n?t.doc.scrollTop:n}}function Re(t,e,n){var r=t.curOp.updateScrollPos||(t.curOp.updateScrollPos={scrollLeft:t.doc.scrollLeft,scrollTop:t.doc.scrollTop}),t=t.display.scroller;r.scrollTop=Math.max(0,Math.min(t.scrollHeight-t.clientHeight,r.scrollTop+n)),r.scrollLeft=Math.max(0,Math.min(t.scrollWidth-t.clientWidth,r.scrollLeft+e))}function Fe(t,e,n,r){var i,o=t.doc,a=("smart"==(n=null==n?"add":n)&&(t.doc.mode.indent?i=kt(t,e):n="prev"),t.options.tabSize),s=P(o,e),l=fr(s.text,null,a),u=s.text.match(/^\s*/)[0];if("smart"==n&&(h=t.doc.mode.indent(i,s.text.slice(u.length),s.text))==hr){if(!r)return;n="prev"}"prev"==n?h=e>o.first?fr(P(o,e-1).text,null,a):0:"add"==n?h=l+t.options.indentUnit:"subtract"==n?h=l-t.options.indentUnit:"number"==typeof n&&(h=l+n);var h=Math.max(0,h),c="",f=0;if(t.options.indentWithTabs)for(var d=Math.floor(h/a);d;--d)f+=a,c+="\t";f<h&&(c+=pr(h-f)),c!=u&&Se(t.doc,c,S(e,0),S(e,u.length),"+input"),s.stateAfter=null}function Ge(t,e,n){var r=e,i=e,o=t.doc;return"number"==typeof e?i=P(o,De(o,e)):r=O(e),null!=r&&n(i,r)?(L(t,r,r+1),i):null}function Ue(n,t,r,e,i){var o=t.line,a=t.ch,t=r,s=P(n,o),l=!0;function u(t){var e=(i?Br:jr)(s,a,r,!0);if(null==e){if(t||!((t=o+r)<n.first||t>=n.first+n.size?l=!1:s=P(n,o=t)))return l=!1;a=i?(r<0?Fr:Rr)(s):r<0?s.text.length:0}else a=e;return 1}if("char"==e)u();else if("column"==e)u(!0);else if("word"==e||"group"==e)for(var h=null,c="group"==e,f=!0;!(r<0)||u(!f);f=!1){var d=s.text.charAt(a)||"\n",d=Lr(d)?"w":!c||/\s/.test(d)?null:"p";if(h&&h!=d){r<0&&(r=1,u());break}if(d&&(h=d),0<r&&!u(!f))break}e=Oe(n,S(o,a),t,!0);return l||(e.hitSide=!0),e}function We(t,e,n,r){var i,o,a=t.doc,s=e.left;for("page"==r?(i=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),o=e.top+n*(i-(n<0?1.5:.5)*It(t.display))):"line"==r&&(o=0<n?e.bottom+3:e.top-3);;){var l=zt(t,s,o);if(!l.outside)break;if(n<0?o<=0:o>=a.height){l.hitSide=!0;break}o+=5*n}return l}function Be(t,e){var n=e.ch,r=e.ch;if(t){e.xRel<0||r==t.length?--n:++r;for(var i=t.charAt(n),o=Lr(i)?Lr:/\s/.test(i)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!Lr(t)};0<n&&o(t.charAt(n-1));)--n;for(;r<t.length&&o(t.charAt(r));)++r}return{from:S(e.line,n),to:S(e.line,r)}}d.Pos=S,d.prototype={constructor:d,focus:function(){window.focus(),C(this),ge(this),qt(this)},setOption:function(t,e){var n=this.options,r=n[t];n[t]==e&&"mode"!=t||(n[t]=e,je.hasOwnProperty(t)&&b(this,je[t])(this,e,r))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,e){this.state.keyMaps[e?"push":"unshift"](t)},removeKeyMap:function(t){for(var e=this.state.keyMaps,n=0;n<e.length;++n)if(("string"==typeof t?e[n].name:e[n])==t)return e.splice(n,1),!0},addOverlay:b(null,function(t,e){var n=t.token?t:d.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:n,modeSpec:t,opaque:e&&e.opaque}),this.state.modeGen++,L(this)}),removeOverlay:b(null,function(t){for(var e=this.state.overlays,n=0;n<e.length;++n){var r=e[n].modeSpec;if(r==t||"string"==typeof t&&r.name==t)return e.splice(n,1),this.state.modeGen++,void L(this)}}),indentLine:b(null,function(t,e,n){"string"!=typeof e&&"number"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),Ae(this.doc,t)&&Fe(this,t,e,n)}),indentSelection:b(null,function(t){var e=this.doc.sel;if(E(e.from,e.to))return Fe(this,e.from.line,t);for(var n=e.to.line-(e.to.ch?0:1),r=e.from.line;r<=n;++r)Fe(this,r,t)}),getTokenAt:function(t,e){for(var n=this.doc,r=kt(this,(t=T(n,t)).line,e),i=this.doc.mode,o=new on(P(n,t.line).text,this.options.tabSize);o.pos<t.ch&&!o.eol();){o.start=o.pos;var a=i.token(o,r)}return{start:o.start,end:o.pos,string:o.current(),className:a||null,type:a||null,state:r}},getTokenTypeAt:function(t){t=T(this.doc,t);for(var e=Mn(this,P(this.doc,t.line)),n=0,r=(e.length-1)/2,i=t.ch;;){var o=n+r>>1;if((o?e[2*o-1]:0)>=i)r=o;else{if(!(e[2*o+1]<i))return e[2*o+2];n=1+o}}},getStateAfter:function(t,e){var n=this.doc;return kt(this,(t=De(n,null==t?n.first+n.size-1:t))+1,e)},cursorCoords:function(t,e){var n=this.doc.sel,t=null==t?n.head:"object"==typeof t?T(this.doc,t):t?n.from:n.to;return k(this,t,e||"page")},charCoords:function(t,e){return Ot(this,T(this.doc,t),e||"page")},coordsChar:function(t,e){return zt(this,(t=Nt(this,t,e||"page")).left,t.top)},lineAtHeight:function(t,e){return t=Nt(this,{top:t,left:0},e||"page").top,jn(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,e){var n=!1,r=this.doc.first+this.doc.size-1,r=(t<this.doc.first?t=this.doc.first:r<t&&(t=r,n=!0),P(this.doc,t));return Pt(this,P(this.doc,t),{top:0,left:0},e||"page").top+(n?r.height:0)},defaultTextHeight:function(){return It(this.display)},defaultCharWidth:function(){return Rt(this.display)},setGutterMarker:b(null,function(t,n,r){return Ge(this,t,function(t){var e=t.gutterMarkers||(t.gutterMarkers={});return!(e[n]=r)&&br(e)&&(t.gutterMarkers=null),1})}),clearGutter:b(null,function(e){var n=this,t=n.doc,r=t.first;t.iter(function(t){t.gutterMarkers&&t.gutterMarkers[e]&&(t.gutterMarkers[e]=null,L(n,r,r+1),br(t.gutterMarkers)&&(t.gutterMarkers=null)),++r})}),addLineClass:b(null,function(t,n,r){return Ge(this,t,function(t){var e="text"==n?"textClass":"background"==n?"bgClass":"wrapClass";if(t[e]){if(new RegExp("(?:^|\\s)"+r+"(?:$|\\s)").test(t[e]))return;t[e]+=" "+r}else t[e]=r;return 1})}),removeLineClass:b(null,function(t,o,a){return Ge(this,t,function(t){var e="text"==o?"textClass":"background"==o?"bgClass":"wrapClass",n=t[e];if(n){if(null==a)t[e]=null;else{var r=n.match(new RegExp("(?:^|\\s+)"+a+"(?:$|\\s+)"));if(!r)return;var i=r.index+r[0].length;t[e]=n.slice(0,r.index)+(r.index&&i!=n.length?" ":"")+n.slice(i)||null}return 1}})}),addLineWidget:b(null,function(t,e,n){var r=this,i=new _n(r,e,n);return i.noHScroll&&(r.display.alignWidgets=!0),Ge(r,t,function(t){var e;return(t.widgets||(t.widgets=[])).push(i),i.line=t,mn(r.doc,t)&&!i.showIfHidden||(e=Vn(r,t)<r.display.scroller.scrollTop,N(t,t.height+bn(i)),e&&Re(r,0,i.height)),1}),i}),removeLineWidget:function(t){t.clear()},lineInfo:function(t){if("number"==typeof t){if(!Ae(this.doc,t))return null;var e=t;if(!(t=P(this.doc,t)))return null}else if(null==(e=O(t)))return null;return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(t,e,n,r,i){var o,a,s=this.display,l=(t=k(this,T(this.doc,t))).bottom,u=t.left;e.style.position="absolute",s.sizer.appendChild(e),"over"==r?l=t.top:"above"!=r&&"near"!=r||(o=Math.max(s.wrapper.clientHeight,this.doc.height),a=Math.max(s.sizer.clientWidth,s.lineSpace.clientWidth),("above"==r||t.bottom+e.offsetHeight>o)&&t.top>e.offsetHeight?l=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=o&&(l=t.bottom),u+e.offsetWidth>a&&(u=a-e.offsetWidth)),e.style.top=l+"px",e.style.left=e.style.right="","right"==i?(u=s.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==i?u=0:"middle"==i&&(u=(s.sizer.clientWidth-e.offsetWidth)/2),e.style.left=u+"px"),n&&(r=this,o=l,a=(t=u)+e.offsetWidth,i=l+e.offsetHeight,null!=(t=ze(r,t,o,a,i)).scrollTop&&re(r,t.scrollTop),null!=t.scrollLeft&&ie(r,t.scrollLeft))},triggerOnKeyDown:b(null,de),execCommand:function(t){return Qe[t](this)},findPosH:function(t,e,n,r){var i=1;e<0&&(i=-1,e=-e);for(var o=0,a=T(this.doc,t);o<e&&!(a=Ue(this.doc,a,i,n,r)).hitSide;++o);return a},moveH:b(null,function(t,e){var n=this.doc.sel,e=n.shift||n.extend||E(n.from,n.to)?Ue(this.doc,n.head,t,e,this.options.rtlMoveVisually):t<0?n.from:n.to;A(this.doc,e,e,t)}),deleteH:b(null,function(t,e){var n=this.doc.sel;E(n.from,n.to)?Se(this.doc,"",n.from,Ue(this.doc,n.head,t,e,!1),"+delete"):Se(this.doc,"",n.from,n.to,"+delete"),this.curOp.userSelChange=!0}),findPosV:function(t,e,n,r){var i=1,o=r;e<0&&(i=-1,e=-e);for(var a=0,s=T(this.doc,t);a<e;++a){var l=k(this,s,"div");if(null==o?o=l.left:l.left=o,(s=We(this,l,i,n)).hitSide)break}return s},moveV:b(null,function(t,e){var n=this.doc.sel,r=k(this,n.head,"div"),i=(null!=n.goalColumn&&(r.left=n.goalColumn),We(this,r,t,e));"page"==e&&Re(this,0,Ot(this,i,"div").top-r.top),A(this.doc,i,i,t),n.goalColumn=r.left}),toggleOverwrite:function(t){null!=t&&t==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite",""))},hasFocus:function(){return this.state.focused},scrollTo:b(null,function(t,e){Ie(this,t,e)}),getScrollInfo:function(){var t=this.display.scroller;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-m,width:t.scrollWidth-m,clientHeight:t.clientHeight-m,clientWidth:t.clientWidth-m}},scrollIntoView:b(null,function(t,e){e=e||0;var n=t="number"==typeof t?S(t,0):t,t=(t&&null==t.line||(this.curOp.scrollToPos=t?T(this.doc,t):this.doc.sel.head,this.curOp.scrollToPosMargin=e,n=k(this,this.curOp.scrollToPos)),ze(this,n.left,n.top-e,n.right,n.bottom+e));Ie(this,t.scrollLeft,t.scrollTop)}),setSize:function(t,e){function n(t){return"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t}null!=t&&(this.display.wrapper.style.width=n(t)),null!=e&&(this.display.wrapper.style.height=n(e)),this.refresh()},on:function(t,e){I(this,t,e)},off:function(t,e){R(this,t,e)},operation:function(t){return Vt(this,t)},refresh:b(null,function(){Dt(this),Ie(this,this.doc.scrollLeft,this.doc.scrollTop),L(this)}),swapDoc:b(null,function(t){var e=this.doc;return e.cm=null,Un(this,t),Dt(this),Xt(this,!0),Ie(this,t.scrollLeft,t.scrollTop),e}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};var je=d.optionHandlers={},Ve=d.defaults={};function t(t,e,r,n){d.defaults[t]=e,r&&(je[t]=n?function(t,e,n){n!=Ye&&r(t,e,n)}:r)}var Ye=d.Init={toString:function(){return"CodeMirror.Init"}},qe=(t("value","",function(t,e){t.setValue(e)},!0),t("mode",null,function(t,e){t.doc.modeOption=e,et(t)},!0),t("indentUnit",2,et,!0),t("indentWithTabs",!1),t("smartIndent",!0),t("tabSize",4,function(t){et(t),Dt(t),L(t)},!0),t("electricChars",!0),t("rtlMoveVisually",!l),t("theme","default",function(t){ot(t),at(t)},!0),t("keyMap","default",it),t("extraKeys",null),t("onKeyEvent",null),t("onDragEvent",null),t("lineWrapping",!1,function(t){t.options.lineWrapping?(t.display.wrapper.className+=" CodeMirror-wrap",t.display.sizer.style.minWidth=""):(t.display.wrapper.className=t.display.wrapper.className.replace(" CodeMirror-wrap",""),ut(t)),rt(t),L(t),Dt(t),setTimeout(function(){ct(t)},100)},!0),t("gutters",[],function(t){ht(t.options),at(t)},!0),t("fixedGutter",!0,function(t,e){t.display.gutters.style.left=e?gt(t.display)+"px":"0",t.refresh()},!0),t("coverGutterNextToScrollbar",!1,ct,!0),t("lineNumbers",!1,function(t){ht(t.options),at(t)},!0),t("firstLineNumber",1,at,!0),t("lineNumberFormatter",function(t){return t},at,!0),t("showCursorWhenSelecting",!1,_t,!0),t("readOnly",!1,function(t,e){"nocursor"==e?(me(t),t.display.input.blur()):e||Xt(t,!0)}),t("dragDrop",!0),t("cursorBlinkRate",530),t("cursorScrollMargin",0),t("cursorHeight",1),t("workTime",100),t("workDelay",100),t("flattenSpans",!0),t("pollInterval",100),t("undoDepth",40,function(t,e){t.doc.history.undoDepth=e}),t("historyEventDelay",500),t("viewportMargin",10,function(t){t.refresh()},!0),t("maxHighlightLength",1e4,function(t){et(t),t.refresh()},!0),t("moveInputWithCursor",!0,function(t,e){e||(t.display.inputDiv.style.top=t.display.inputDiv.style.left=0)}),t("tabindex",null,function(t,e){t.display.input.tabIndex=e||""}),t("autofocus",null),d.modes={}),Ke=d.mimeModes={},Xe=(d.defineMode=function(t,e){if(d.defaults.mode||"null"==t||(d.defaults.mode=t),2<arguments.length){e.dependencies=[];for(var n=2;n<arguments.length;++n)e.dependencies.push(arguments[n])}qe[t]=e},d.defineMIME=function(t,e){Ke[t]=e},d.resolveMode=function(t){if("string"==typeof t&&Ke.hasOwnProperty(t))t=Ke[t];else if(t&&"string"==typeof t.name&&Ke.hasOwnProperty(t.name)){var e=Ke[t.name];(t=mr(e,t)).name=e.name}else if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return d.resolveMode("application/xml");return"string"==typeof t?{name:t}:t||{name:"null"}},d.getMode=function(t,e){e=d.resolveMode(e);var n=qe[e.name];if(!n)return d.getMode(t,"text/plain");var r=n(t,e);if(Xe.hasOwnProperty(e.name)){var i,o=Xe[e.name];for(i in o)o.hasOwnProperty(i)&&(r.hasOwnProperty(i)&&(r["_"+i]=r[i]),r[i]=o[i])}return r.name=e.name,r},d.defineMode("null",function(){return{token:function(t){t.skipToEnd()}}}),d.defineMIME("text/plain","null"),d.modeExtensions={}),$e=(d.extendMode=function(t,e){vr(e,Xe.hasOwnProperty(t)?Xe[t]:Xe[t]={})},d.defineExtension=function(t,e){d.prototype[t]=e},d.defineDocExtension=function(t,e){p.prototype[t]=e},d.defineOption=t,[]);function Ze(t,e){if(!0===e)return e;if(t.copyState)return t.copyState(e);var n,r={};for(n in e){var i=e[n];i instanceof Array&&(i=i.concat([])),r[n]=i}return r}function Je(t,e,n){return!t.startState||t.startState(e,n)}d.defineInitHook=function(t){$e.push(t)},d.copyState=Ze,d.startState=Je,d.innerMode=function(t,e){for(;t.innerMode;){var n=t.innerMode(e);e=n.state,t=n.mode}return n||{mode:t,state:e}};var Qe=d.commands={selectAll:function(t){t.setSelection(S(t.firstLine(),0),S(t.lastLine()))},killLine:function(t){var e=t.getCursor(!0),n=t.getCursor(!1),r=!E(e,n);r||t.getLine(e.line).length!=e.ch?t.replaceRange("",e,r?n:S(e.line),"+delete"):t.replaceRange("",e,S(e.line+1,0),"+delete")},deleteLine:function(t){var e=t.getCursor().line;t.replaceRange("",S(e,0),S(e),"+delete")},delLineLeft:function(t){var e=t.getCursor();t.replaceRange("",S(e.line,0),e,"+delete")},undo:function(t){t.undo()},redo:function(t){t.redo()},goDocStart:function(t){t.extendSelection(S(t.firstLine(),0))},goDocEnd:function(t){t.extendSelection(S(t.lastLine()))},goLineStart:function(t){t.extendSelection(Gr(t,t.getCursor().line))},goLineStartSmart:function(t){var e=t.getCursor(),n=Gr(t,e.line),r=t.getLineHandle(n.line),i=H(r);i&&0!=i[0].level?t.extendSelection(n):(i=Math.max(0,r.text.search(/\S/)),r=e.line==n.line&&e.ch<=i&&e.ch,t.extendSelection(S(n.line,r?0:i)))},goLineEnd:function(t){t.extendSelection(function(t,e){var n,r;for(;n=pn(r=P(t.doc,e));)e=n.find().to.line;var i=H(r),i=i?(i[0].level%2?Rr:Fr)(r):r.text.length;return S(e,i)}(t,t.getCursor().line))},goLineRight:function(t){var e=t.charCoords(t.getCursor(),"div").top+5;t.extendSelection(t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:e},"div"))},goLineLeft:function(t){var e=t.charCoords(t.getCursor(),"div").top+5;t.extendSelection(t.coordsChar({left:0,top:e},"div"))},goLineUp:function(t){t.moveV(-1,"line")},goLineDown:function(t){t.moveV(1,"line")},goPageUp:function(t){t.moveV(-1,"page")},goPageDown:function(t){t.moveV(1,"page")},goCharLeft:function(t){t.moveH(-1,"char")},goCharRight:function(t){t.moveH(1,"char")},goColumnLeft:function(t){t.moveH(-1,"column")},goColumnRight:function(t){t.moveH(1,"column")},goWordLeft:function(t){t.moveH(-1,"word")},goGroupRight:function(t){t.moveH(1,"group")},goGroupLeft:function(t){t.moveH(-1,"group")},goWordRight:function(t){t.moveH(1,"word")},delCharBefore:function(t){t.deleteH(-1,"char")},delCharAfter:function(t){t.deleteH(1,"char")},delWordBefore:function(t){t.deleteH(-1,"word")},delWordAfter:function(t){t.deleteH(1,"word")},delGroupBefore:function(t){t.deleteH(-1,"group")},delGroupAfter:function(t){t.deleteH(1,"group")},indentAuto:function(t){t.indentSelection("smart")},indentMore:function(t){t.indentSelection("add")},indentLess:function(t){t.indentSelection("subtract")},insertTab:function(t){t.replaceSelection("\t","end","+input")},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.replaceSelection("\t","end","+input")},transposeChars:function(t){var e=t.getCursor(),n=t.getLine(e.line);0<e.ch&&e.ch<n.length-1&&t.replaceRange(n.charAt(e.ch)+n.charAt(e.ch-1),S(e.line,e.ch-1),S(e.line,e.ch+1))},newlineAndIndent:function(t){b(t,function(){t.replaceSelection("\n","end","+input"),t.indentLine(t.getCursor().line,null,!0)})()},toggleOverwrite:function(t){t.toggleOverwrite()}},r=d.keyMap={};function tn(t){return"string"==typeof t?r[t]:t}function en(s,t,l){for(var e=0;e<t.length;++e){var n=function t(e){var n=(e=tn(e))[s];if(!1===n)return"stop";if(null!=n&&l(n))return!0;if(e.nofallthrough)return"stop";var r=e.fallthrough;if(null!=r){if("[object Array]"!=Object.prototype.toString.call(r))return t(r);for(var i=0,o=r.length;i<o;++i){var a=t(r[i]);if(a)return a}}return!1}(t[e]);if(n)return"stop"!=n}}function nn(t){t=Hr[t.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function rn(t,e){var n;return(!f||34!=t.keyCode||!t.char)&&(null!=(n=Hr[t.keyCode])&&!t.altGraphKey&&(t.altKey&&(n="Alt-"+n),(Z?t.metaKey:t.ctrlKey)&&(n="Ctrl-"+n),(Z?t.ctrlKey:t.metaKey)&&(n="Cmd-"+n),!e&&t.shiftKey?"Shift-"+n:n))}function on(t,e){this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0}function an(t,e){this.lines=[],this.type=e,this.doc=t}function sn(n,r,i,t,e){if(t&&t.shared)return o=n,a=r,s=i,u=e,(l=vr(l=t)).shared=!1,h=[sn(o,a,s,l,u)],c=h[0],f=l.replacedWith,Gn(o,function(t){f&&(l.replacedWith=f.cloneNode(!0)),h.push(sn(t,T(t,a),T(t,s),l,u));for(var e=0;e<t.linked.length;++e)if(t.linked[e].isParent)return;c=U(h)}),new ln(h,c);var o,a,s,l,u,h,c,f;if(n.cm&&!n.cm.curOp)return b(n.cm,sn)(n,r,i,t,e);var d=new an(n,e);if("range"!=e||D(r,i)){t&&vr(t,d),d.replacedWith&&(d.collapsed=!0,d.replacedWith=B("span",[d.replacedWith],"CodeMirror-widget"),t.handleMouseEvents||(d.replacedWith.ignoreEvents=!0)),d.collapsed&&(tt=!0),d.addToHistory&&Xn(n,{from:r,to:i,origin:"markText"},{head:n.sel.head,anchor:n.sel.anchor},NaN);var p,g,m,v=r.line,y=0,_=n.cm;if(n.iter(v,i.line+1,function(t){_&&d.collapsed&&!_.options.lineWrapping&&gn(n,t)==_.display.maxLine&&(m=!0);var e={from:null,to:null,marker:d};y+=t.text.length,v==r.line&&(e.from=r.ch,y-=r.ch),v==i.line&&(e.to=i.ch,y-=t.text.length-i.ch),d.collapsed&&(v==i.line&&(g=fn(t,i.ch)),v==r.line?p=fn(t,r.ch):N(t,0)),e=e,(t=t).markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],e.marker.attachLine(t),++v}),d.collapsed&&n.iter(r.line,i.line+1,function(t){mn(n,t)&&N(t,0)}),d.clearOnEnter&&I(d,"beforeCursorEnter",function(){d.clear()}),d.readOnly&&(Q=!0,(n.history.done.length||n.history.undone.length)&&n.clearHistory()),d.collapsed){if(p!=g)throw new Error("Inserting collapsed marker overlapping an existing one");d.size=y,d.atomic=!0}_&&(m&&(_.curOp.updateMaxLine=!0),(d.className||d.startStyle||d.endStyle||d.collapsed)&&L(_,r.line,i.line+1),d.atomic&&Ne(_))}return d}function ln(t,e){this.markers=t,this.primary=e;for(var n=0,r=this;n<t.length;++n)t[n].parent=this,I(t[n],"clear",function(){r.clear()})}function un(t,e){if(t)for(var n=0;n<t.length;++n){var r=t[n];if(r.marker==e)return r}}function hn(t,e){var n=Ae(t,e.from.line)&&P(t,e.from.line).markedSpans,t=Ae(t,e.to.line)&&P(t,e.to.line).markedSpans;if(!n&&!t)return null;var r=e.from.ch,i=e.to.ch,o=E(e.from,e.to),a=function(t,e,n){if(t)for(var r,i=0;i<t.length;++i){var o,a=t[i],s=a.marker;!(null==a.from||(s.inclusiveLeft?a.from<=e:a.from<e))&&("bookmark"!=s.type||a.from!=e||n&&a.marker.insertLeft)||(o=null==a.to||(s.inclusiveRight?a.to>=e:a.to>e),(r=r||[]).push({from:a.from,to:o?null:a.to,marker:s}))}return r}(n,r,o),s=function(t,e,n){if(t)for(var r,i=0;i<t.length;++i){var o,a=t[i],s=a.marker;!(null==a.to||(s.inclusiveRight?a.to>=e:a.to>e))&&("bookmark"!=s.type||a.from!=e||n&&!a.marker.insertLeft)||(o=null==a.from||(s.inclusiveLeft?a.from<=e:a.from<e),(r=r||[]).push({from:o?null:a.from-e,to:null==a.to?null:a.to-e,marker:s}))}return r}(t,i,o),l=1==e.text.length,u=U(e.text).length+(l?r:0);if(a)for(var h=0;h<a.length;++h)null==(c=a[h]).to&&((f=un(s,c.marker))?l&&(c.to=null==f.to?null:f.to+u):c.to=r);if(s)for(var c,f,h=0;h<s.length;++h)null!=(c=s[h]).to&&(c.to+=u),null==c.from?(f=un(a,c.marker))||(c.from=u,l&&(a=a||[]).push(c)):(c.from+=u,l&&(a=a||[]).push(c));if(l&&a){for(h=0;h<a.length;++h)null!=a[h].from&&a[h].from==a[h].to&&"bookmark"!=a[h].marker.type&&a.splice(h--,1);a.length||(a=null)}var d=[a];if(!l){var p,g=e.text.length-2;if(0<g&&a)for(h=0;h<a.length;++h)null==a[h].to&&(p=p||[]).push({from:null,to:null,marker:a[h].marker});for(h=0;h<g;++h)d.push(p);d.push(s)}return d}function cn(t,e){var n=function(t,e){var n=e["spans_"+t.id];if(!n)return null;for(var r=0,i=[];r<e.text.length;++r)i.push(function(t){if(!t)return null;for(var e,n=0;n<t.length;++n)t[n].marker.explicitlyCleared?e=e||t.slice(0,n):e&&e.push(t[n]);return e?e.length?e:null:t}(n[r]));return i}(t,e),r=hn(t,e);if(!n)return r;if(r)for(var i=0;i<n.length;++i){var o=n[i],a=r[i];if(o&&a)t:for(var s=0;s<a.length;++s){for(var l=a[s],u=0;u<o.length;++u)if(o[u].marker==l.marker)continue t;o.push(l)}else a&&(n[i]=a)}return n}function fn(t,e){var n,r=tt&&t.markedSpans;if(r)for(var i,o=0;o<r.length;++o)(i=r[o]).marker.collapsed&&(null==i.from||i.from<e)&&(null==i.to||i.to>e)&&(!n||n.width<i.marker.width)&&(n=i.marker);return n}function dn(t){return fn(t,-1)}function pn(t){return fn(t,t.text.length+1)}function gn(t,e){for(var n;n=dn(e);)e=P(t,n.find().from.line);return e}function mn(t,e){var n=tt&&e.markedSpans;if(n)for(var r,i=0;i<n.length;++i)if((r=n[i]).marker.collapsed){if(null==r.from)return 1;if(!r.marker.replacedWith&&0==r.from&&r.marker.inclusiveLeft&&function t(e,n,r){{var i;if(null==r.to)return i=r.marker.find().to,i=P(e,i.line),t(e,i,un(i.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==n.text.length)return!0;for(var o,a=0;a<n.markedSpans.length;++a)if((o=n.markedSpans[a]).marker.collapsed&&!o.marker.replacedWith&&o.from==r.to&&(o.marker.inclusiveLeft||r.marker.inclusiveRight)&&t(e,n,o))return!0}(t,e,r))return 1}}function vn(t){var e=t.markedSpans;if(e){for(var n=0;n<e.length;++n)e[n].marker.detachLine(t);t.markedSpans=null}}function yn(t,e){if(e){for(var n=0;n<e.length;++n)e[n].marker.attachLine(t);t.markedSpans=e}}r.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},r.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},r.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft",fallthrough:["basic","emacsy"]},r.default=$?r.macDefault:r.pcDefault,r.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},d.lookupKey=en,d.isModifierKey=nn,d.keyName=rn,d.fromTextArea=function(e,t){if((t=t||{}).value=e.value,!t.tabindex&&e.tabindex&&(t.tabindex=e.tabindex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=document.body;try{n=document.activeElement}catch(t){}t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}function r(){e.value=s.getValue()}if(e.form&&(I(e.form,"submit",r),!t.leaveSubmitMethodAlone)){var i=e.form,o=i.submit;try{var a=i.submit=function(){r(),i.submit=o,i.submit(),i.submit=a}}catch(t){}}e.style.display="none";var s=d(function(t){e.parentNode.insertBefore(t,e.nextSibling)},t);return s.save=r,s.getTextArea=function(){return e},s.toTextArea=function(){r(),e.parentNode.removeChild(s.getWrapperElement()),e.style.display="",e.form&&(R(e.form,"submit",r),"function"==typeof e.form.submit&&(e.form.submit=o))},s},on.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(t){var e=this.string.charAt(this.pos);if("string"==typeof t?e==t:e&&(t.test?t.test(e):t(e)))return++this.pos,e},eatWhile:function(t){for(var e=this.pos;this.eat(t););return this.pos>e},eatSpace:function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},skipToEnd:function(){this.pos=this.string.length},skipTo:function(t){t=this.string.indexOf(t,this.pos);if(-1<t)return this.pos=t,!0},backUp:function(t){this.pos-=t},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=fr(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue},indentation:function(){return fr(this.string,null,this.tabSize)},match:function(t,e,n){var r;return"string"!=typeof t?(r=this.string.slice(this.pos).match(t))&&0<r.index?null:(r&&!1!==e&&(this.pos+=r[0].length),r):(r=function(t){return n?t.toLowerCase():t})(this.string.substr(this.pos,t.length))==r(t)?(!1!==e&&(this.pos+=t.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},d.StringStream=on,(d.TextMarker=an).prototype.clear=function(){if(!this.explicitlyCleared){for(var t=this.doc.cm,e=t&&!t.curOp,n=(e&&Wt(t),null),r=null,i=0;i<this.lines.length;++i){var o=this.lines[i],a=un(o.markedSpans,this);null!=a.to&&(r=O(o)),o.markedSpans=function(t,e){for(var n,r=0;r<t.length;++r)t[r]!=e&&(n=n||[]).push(t[r]);return n}(o.markedSpans,a),null!=a.from?n=O(o):this.collapsed&&!mn(this.doc,o)&&t&&N(o,It(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(i=0;i<this.lines.length;++i){var s=gn(t.doc,this.lines[i]),l=lt(t.doc,s);l>t.display.maxLineLength&&(t.display.maxLine=s,t.display.maxLineLength=l,t.display.maxLineChanged=!0)}null!=n&&t&&L(t,n,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Ne(t)),e&&Bt(t),F(this,"clear")}},an.prototype.find=function(){for(var t,e,n=0;n<this.lines.length;++n){var r=this.lines[n],i=un(r.markedSpans,this);null==i.from&&null==i.to||(r=O(r),null!=i.from&&(t=S(r,i.from)),null!=i.to&&(e=S(r,i.to)))}return"bookmark"==this.type?t:t&&{from:t,to:e}},an.prototype.changed=function(){var t=this.find(),e=this.doc.cm;if(t&&e){var n,r=P(this.doc,t.from.line);if((n=St(n=e,r))&&(n.text=n.measure=n.markedSpans=null),t.from.line>=e.display.showingFrom&&t.from.line<e.display.showingTo){for(var i=e.display.lineDiv.firstChild;i;i=i.nextSibling)if(i.lineObj==r){i.offsetHeight!=r.height&&N(r,i.offsetHeight);break}Vt(e,function(){e.curOp.selectionChanged=!0})}}},an.prototype.attachLine=function(t){var e;this.lines.length||!this.doc.cm||(e=this.doc.cm.curOp).maybeHiddenMarkers&&-1!=c(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this),this.lines.push(t)},an.prototype.detachLine=function(t){this.lines.splice(c(this.lines,t),1),!this.lines.length&&this.doc.cm&&((t=this.doc.cm.curOp).maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)},(d.SharedTextMarker=ln).prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)this.markers[t].clear();F(this,"clear")}},ln.prototype.find=function(){return this.primary.find()};var _n=d.LineWidget=function(t,e,n){for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);this.cm=t,this.node=e};function Ln(n){return function(){var t=!this.cm.curOp;t&&Wt(this.cm);try{var e=n.apply(this,arguments)}finally{t&&Bt(this.cm)}return e}}function bn(t){return null!=t.height?t.height:(t.node.parentNode&&1==t.node.parentNode.nodeType||j(t.cm.display.measure,B("div",[t.node],null,"position: relative")),t.height=t.node.offsetHeight)}function wn(t,e,n){t={text:t};return yn(t,e),t.height=n?n(t):1,t}function kn(t,e,n,r,i){var o,a=n.flattenSpans,s=(null==a&&(a=t.options.flattenSpans),0),l=null,u=new on(e,t.options.tabSize);for(""==e&&n.blankLine&&n.blankLine(r);!u.eol();)o=u.pos>t.options.maxHighlightLength?(a=!1,u.pos=Math.min(e.length,u.start+5e4),null):n.token(u,r),a&&l==o||(s<u.start&&i(u.start,l),s=u.start,l=o),u.start=u.pos;s<u.pos&&i(u.pos,l)}function xn(t,e,n){var o=[t.state.modeGen];kn(t,e.text,t.doc.mode,n,function(t,e){o.push(t,e)});for(var r=0;r<t.state.overlays.length;++r){var a=t.state.overlays[r],s=1,l=0;kn(t,e.text,a.mode,!0,function(t,e){for(var n=s;l<t;){var r=o[s];t<r&&o.splice(s,1,t,o[s+1],r),s+=2,l=Math.min(t,r)}if(e)if(a.opaque)o.splice(n,s-n,t,e),s=n+2;else for(;n<s;n+=2){var i=o[n+1];o[n+1]=i?i+" "+e:e}})}return o}function Mn(t,e){return e.styles&&e.styles[0]==t.state.modeGen||(e.styles=xn(t,e,e.stateAfter=kt(t,O(e)))),e.styles}function Cn(t,e,n){var r=t.doc.mode,i=new on(e.text,t.options.tabSize);for(""==e.text&&r.blankLine&&r.blankLine(n);!i.eol()&&i.pos<=t.options.maxHighlightLength;)r.token(i,n),i.start=i.pos}_n.prototype.clear=Ln(function(){var t=this.line.widgets,e=O(this.line);if(null!=e&&t){for(var n=0;n<t.length;++n)t[n]==this&&t.splice(n--,1);t.length||(this.line.widgets=null),N(this.line,Math.max(0,this.line.height-bn(this))),L(this.cm,e,e+1)}}),_n.prototype.changed=Ln(function(){var t=this.height,t=(this.height=null,bn(this)-t);t&&(N(this.line,this.line.height+t),t=O(this.line),L(this.cm,t,t+1))});var Sn={};function En(t){return t?Sn[t]||(Sn[t]="cm-"+t.replace(/ +/g," cm-")):null}function Dn(t,e,n){for(var r,i=e,o=!0;r=dn(i);)i=P(t.doc,r.find().from.line);var a,s,l,u={pre:B("pre"),col:0,pos:0,display:!n,measure:null,measuredSomething:!1,cm:t};i.textClass&&(u.pre.className=i.textClass);do{i.text&&(o=!1),u.measure=i==e&&n,u.pos=0,u.addToken=u.measure?Pn:An,(x||w)&&t.getOption("lineWrapping")&&(u.addToken=function(o){function a(t){for(var e=" ",n=0;n<t.length-2;++n)e+=n%2?" ":" ";return e+=" "}return function(t,e,n,r,i){return o(t,e.replace(/ {3,}/,a),n,r,i)}}(u.addToken));var h=function(t,e,n){var r=t.markedSpans,i=t.text,o=0;if(r)for(var a,s,l,u,h,c=i.length,f=0,d=1,p="",g=0;;){if(g==f){s=l=u="",g=1/0;for(var m=h=null,v=0;v<r.length;++v){var y=r[v],_=y.marker;y.from<=f&&(null==y.to||y.to>f)?(null!=y.to&&g>y.to&&(g=y.to,l=""),_.className&&(s+=" "+_.className),_.startStyle&&y.from==f&&(u+=" "+_.startStyle),_.endStyle&&y.to==g&&(l+=" "+_.endStyle),_.collapsed&&(!h||h.marker.size<_.size)&&(h=y)):y.from>f&&g>y.from&&(g=y.from),"bookmark"==_.type&&y.from==f&&_.replacedWith&&(m=_.replacedWith)}if(h&&(h.from||0)==f&&(Nn(e,(null==h.to?c:h.to)-f,null!=h.from&&h.marker.replacedWith),null==h.to))return h.marker.find();m&&!h&&Nn(e,0,m)}if(c<=f)break;for(var L=Math.min(c,g);;){if(p){var b,w=f+p.length;if(h||(b=L<w?p.slice(0,L-f):p,e.addToken(e,b,a?a+s:s,u,f+b.length==g?l:"")),L<=w){p=p.slice(L-f),f=L;break}f=w,u=""}p=i.slice(o,o=n[d++]),a=En(n[d++])}}else for(var d=1;d<n.length;d+=2)e.addToken(e,i.slice(o,o=n[d]),En(n[d+1]))}(i,u,Mn(t,i))}while(n&&i==e&&!u.measuredSomething&&(n[0]=u.pre.appendChild(Tr(t.display.measure)),u.measuredSomething=!0),h&&(i=P(t.doc,h.to.line)),h);return!n||u.measuredSomething||n[0]||(n[0]=u.pre.appendChild(o?B("span"," "):Tr(t.display.measure))),u.pre.firstChild||mn(t.doc,e)||u.pre.appendChild(document.createTextNode(" ")),n&&x&&(s=H(i))&&(s[l=s.length-1].from==s[l].to&&--l,a=s[l],s=s[l-1],a.from+1==a.to&&s&&a.level<s.level&&((l=n[u.pos-1])&&l.parentNode.insertBefore(l.measureRight=Tr(t.display.measure),l.nextSibling))),g(t,"renderLine",t,e,u.pre),u.pre}var Tn=/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\uFEFF]/g;function An(t,e,n,r,i){if(e){if(Tn.test(e))for(var o=document.createDocumentFragment(),a=0;;){Tn.lastIndex=a;var s=Tn.exec(e),l=s?s.index-a:e.length-a;if(l&&(o.appendChild(document.createTextNode(e.slice(a,a+l))),t.col+=l),!s)break;a+=1+l,"\t"==s[0]?(l=(l=t.cm.options.tabSize)-t.col%l,o.appendChild(B("span",pr(l),"cm-tab")),t.col+=l):((l=B("span","•","cm-invalidchar")).title="\\u"+s[0].charCodeAt(0).toString(16),o.appendChild(l),t.col+=1)}else{t.col+=e.length;var o=document.createTextNode(e)}if(n||r||i||t.measure)return n=n||"",r&&(n+=r),i&&(n+=i),t.pre.appendChild(B("span",[o],n));t.pre.appendChild(o)}}function Pn(t,e,n,r,i){for(var o=t.cm.options.lineWrapping,a=0;a<e.length;++a){var s=e.charAt(a),l=0==a,l=("\ud800"<=s&&s<"\udbff"&&a<e.length-1?(s=e.slice(a,a+2),++a):a&&o&&Er(e,a)&&t.pre.appendChild(B("wbr")),t.measure[t.pos]=An(t,s,n,l&&r,a==e.length-1&&i));x&&o&&" "==s&&a&&!/\s/.test(e.charAt(a-1))&&a<e.length-1&&!/\s/.test(e.charAt(a+1))&&(l.style.whiteSpace="normal"),t.pos+=s.length}e.length&&(t.measuredSomething=!0)}function Nn(t,e,n){n&&(t.display||(n=n.cloneNode(!0)),t.measure&&(t.measure[t.pos]=e?n:t.pre.appendChild(Tr(t.cm.display.measure)),t.measuredSomething=!0),t.pre.appendChild(n)),t.pos+=e}function On(t,o,e,n,a){function r(t){return e?e[t]:null}function i(t,e,n){var r,i;e=e,n=n,i=a,(r=t).text=e,r.stateAfter&&(r.stateAfter=null),r.styles&&(r.styles=null),null!=r.order&&(r.order=null),vn(r),yn(r,n),(e=i?i(r):1)!=r.height&&N(r,e),F(t,"change",t,o)}var s=o.from,l=o.to,u=o.text,h=P(t,s.line),c=P(t,l.line),f=U(u),d=r(u.length-1),p=l.line-s.line;if(0==s.ch&&0==l.ch&&""==f){for(var g=0,m=u.length-1,v=[];g<m;++g)v.push(wn(u[g],r(g),a));i(c,c.text,d),p&&t.remove(s.line,p),v.length&&t.insert(s.line,v)}else if(h==c)if(1==u.length)i(h,h.text.slice(0,s.ch)+f+h.text.slice(l.ch),d);else{for(v=[],g=1,m=u.length-1;g<m;++g)v.push(wn(u[g],r(g),a));v.push(wn(f+h.text.slice(l.ch),d,a)),i(h,h.text.slice(0,s.ch)+u[0],r(0)),t.insert(s.line+1,v)}else if(1==u.length)i(h,h.text.slice(0,s.ch)+u[0]+c.text.slice(l.ch),r(0)),t.remove(s.line+1,p);else{i(h,h.text.slice(0,s.ch)+u[0],r(0)),i(c,f+c.text.slice(l.ch),d);for(g=1,m=u.length-1,v=[];g<m;++g)v.push(wn(u[g],r(g),a));1<p&&t.remove(s.line+1,p-1),t.insert(s.line+1,v)}F(t,"change",t,o),Pe(t,n.anchor,n.head,null,!0)}function Hn(t){this.lines=t,this.parent=null;for(var e=0,n=t.length,r=0;e<n;++e)t[e].parent=this,r+=t[e].height;this.height=r}function zn(t){for(var e=0,n=0,r=0,i=(this.children=t).length;r<i;++r){var o=t[r];e+=o.chunkSize(),n+=o.height,o.parent=this}this.size=e,this.height=n,this.parent=null}Hn.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,e){for(var n,r=t,i=t+e;r<i;++r){var o=this.lines[r];this.height-=o.height,(n=o).parent=null,vn(n),F(o,"delete")}this.lines.splice(t,e)},collapse:function(t){t.splice.apply(t,[t.length,0].concat(this.lines))},insertInner:function(t,e,n){this.height+=n,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(var r=0,i=e.length;r<i;++r)e[r].parent=this},iterN:function(t,e,n){for(var r=t+e;t<r;++t)if(n(this.lines[t]))return!0}},zn.prototype={chunkSize:function(){return this.size},removeInner:function(t,e){this.size-=e;for(var n,r=0;r<this.children.length;++r){var i=this.children[r],o=i.chunkSize();if(t<o){var a=Math.min(e,o-t),s=i.height;if(i.removeInner(t,a),this.height-=s-i.height,o==a&&(this.children.splice(r--,1),i.parent=null),0==(e-=a))break;t=0}else t-=o}this.size-e<25&&(this.collapse(n=[]),this.children=[new Hn(n)],this.children[0].parent=this)},collapse:function(t){for(var e=0,n=this.children.length;e<n;++e)this.children[e].collapse(t)},insertInner:function(t,e,n){this.size+=e.length,this.height+=n;for(var r=0,i=this.children.length;r<i;++r){var o=this.children[r],a=o.chunkSize();if(t<=a){if(o.insertInner(t,e,n),o.lines&&50<o.lines.length){for(;50<o.lines.length;){var s=new Hn(o.lines.splice(o.lines.length-25,25));o.height-=s.height,this.children.splice(r+1,0,s),s.parent=this}this.maybeSpill()}break}t-=a}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var e,n=new zn(t.children.splice(t.children.length-5,5))}while(t.parent?(t.size-=n.size,t.height-=n.height,e=c(t.parent.children,t),t.parent.children.splice(e+1,0,n)):(((e=new zn(t.children)).parent=t).children=[e,n],t=e),n.parent=t.parent,10<t.children.length);t.parent.maybeSpill()}},iterN:function(t,e,n){for(var r=0,i=this.children.length;r<i;++r){var o=this.children[r],a=o.chunkSize();if(t<a){var s=Math.min(e,a-t);if(o.iterN(t,s,n))return!0;if(0==(e-=s))break;t=0}else t-=a}}};var In,Rn=0,p=d.Doc=function(t,e,n){if(!(this instanceof p))return new p(t,e,n);null==n&&(n=0),zn.call(this,[new Hn([wn("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.history=Yn(),this.cleanGeneration=1,this.frontier=n;n=S(n,0);this.sel={from:n,to:n,head:n,anchor:n,shift:!1,extend:!1,goalColumn:null},this.id=++Rn,this.modeOption=e,On(this,{from:n,to:n,text:t="string"==typeof t?Pr(t):t},null,{head:n,anchor:n})},Fn=(p.prototype=mr(zn.prototype,{constructor:p,iter:function(t,e,n){n?this.iterN(t-this.first,e-t,n):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){for(var n=0,r=0,i=e.length;r<i;++r)n+=e[r].height;this.insertInner(t-this.first,e,n)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){var e=Bn(this,this.first,this.first+this.size);return!1===t?e:e.join(t||"\n")},setValue:function(t){var e=S(this.first,0),n=this.first+this.size-1;we(this,{from:e,to:S(n,P(this,n).text.length),text:Pr(t),origin:"setValue"},{head:e,anchor:e},!0)},replaceRange:function(t,e,n,r){Se(this,t,e=T(this,e),n=n?T(this,n):e,r)},getRange:function(t,e,n){t=Wn(this,T(this,t),T(this,e));return!1===n?t:t.join(n||"\n")},getLine:function(t){t=this.getLineHandle(t);return t&&t.text},setLine:function(t,e){Ae(this,t)&&Se(this,e,S(t,0),T(this,S(t)))},removeLine:function(t){t?Se(this,"",T(this,S(t-1)),T(this,S(t))):Se(this,"",S(0,0),T(this,S(1,0)))},getLineHandle:function(t){if(Ae(this,t))return P(this,t)},getLineNumber:O,lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return T(this,t)},getCursor:function(t){var e=this.sel,t=null==t||"head"==t?e.head:"anchor"==t?e.anchor:"end"==t||!1===t?e.to:e.from;return Ee(t)},somethingSelected:function(){return!E(this.sel.head,this.sel.anchor)},setCursor:jt(function(t,e,n){e=T(this,"number"==typeof t?S(t,e||0):t);n?A(this,e):Pe(this,e,e)}),setSelection:jt(function(t,e){Pe(this,T(this,t),T(this,e||t))}),extendSelection:jt(function(t,e){A(this,T(this,t),e&&T(this,e))}),getSelection:function(t){return this.getRange(this.sel.from,this.sel.to,t)},replaceSelection:function(t,e,n){we(this,{from:this.sel.from,to:this.sel.to,text:Pr(t),origin:n},e||"around")},undo:jt(function(){xe(this,"undo")}),redo:jt(function(){xe(this,"redo")}),setExtending:function(t){this.sel.extend=t},historySize:function(){var t=this.history;return{undo:t.done.length,redo:t.undone.length}},clearHistory:function(){this.history=Yn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration()},changeGeneration:function(){return this.history.lastOp=this.history.lastOrigin=null,this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:$n(this.history.done),undone:$n(this.history.undone)}},setHistory:function(t){var e=this.history=Yn(this.history.maxGeneration);e.done=t.done.slice(0),e.undone=t.undone.slice(0)},markText:function(t,e,n){return sn(this,T(this,t),T(this,e),n,"range")},setBookmark:function(t,e){e={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft};return sn(this,t=T(this,t),t,e,"bookmark")},findMarksAt:function(t){var e=[],n=P(this,(t=T(this,t)).line).markedSpans;if(n)for(var r=0;r<n.length;++r){var i=n[r];(null==i.from||i.from<=t.ch)&&(null==i.to||i.to>=t.ch)&&e.push(i.marker.parent||i.marker)}return e},getAllMarks:function(){var r=[];return this.iter(function(t){var e=t.markedSpans;if(e)for(var n=0;n<e.length;++n)null!=e[n].from&&r.push(e[n].marker)}),r},posFromIndex:function(e){var n,r=this.first;return this.iter(function(t){t=t.text.length+1;if(e<t)return n=e,!0;e-=t,++r}),T(this,S(r,n))},indexFromPos:function(t){var e=(t=T(this,t)).ch;return t.line<this.first||t.ch<0?0:(this.iter(this.first,t.line,function(t){e+=t.text.length+1}),e)},copy:function(t){var e=new p(Bn(this,this.first,this.first+this.size),this.modeOption,this.first);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel={from:this.sel.from,to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn},t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){var e=this.first,n=this.first+this.size,n=(null!=(t=t||{}).from&&t.from>e&&(e=t.from),null!=t.to&&t.to<n&&(n=t.to),new p(Bn(this,e,n),t.mode||this.modeOption,e));return t.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:t.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],n},unlinkDoc:function(t){if(t instanceof d&&(t=t.doc),this.linked)for(var e=0;e<this.linked.length;++e){var n=this.linked[e];if(n.doc==t){this.linked.splice(e,1),t.unlinkDoc(this);break}}var r;t.history==this.history&&(r=[t.id],Gn(t,function(t){r.push(t.id)},!0),t.history=Yn(),t.history.done=$n(this.history.done,r),t.history.undone=$n(this.history.undone,r))},iterLinkedDocs:function(t){Gn(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),p.prototype.eachLine=p.prototype.iter,"iter insert remove copy getEditor".split(" "));for(In in p.prototype)p.prototype.hasOwnProperty(In)&&c(Fn,In)<0&&(d.prototype[In]=function(t){return function(){return t.apply(this.doc,arguments)}}(p.prototype[In]));function Gn(t,s,l){!function t(e,n,r){if(e.linked)for(var i=0;i<e.linked.length;++i){var o,a=e.linked[i];a.doc!=n&&(o=r&&a.sharedHist,l&&!o||(s(a.doc,o),t(a.doc,e,o)))}}(t,null,!0)}function Un(t,e){if(e.cm)throw new Error("This document is already in use.");rt((t.doc=e).cm=t),et(t),t.options.lineWrapping||ut(t),t.options.mode=e.modeOption,L(t)}function P(t,e){for(e-=t.first;!t.lines;)for(var n=0;;++n){var r=t.children[n],i=r.chunkSize();if(e<i){t=r;break}e-=i}return t.lines[e]}function Wn(t,e,n){var r=[],i=e.line;return t.iter(e.line,n.line+1,function(t){t=t.text;i==n.line&&(t=t.slice(0,n.ch)),i==e.line&&(t=t.slice(e.ch)),r.push(t),++i}),r}function Bn(t,e,n){var r=[];return t.iter(e,n,function(t){r.push(t.text)}),r}function N(t,e){for(var n=e-t.height,r=t;r;r=r.parent)r.height+=n}function O(t){if(null==t.parent)return null;for(var e=t.parent,n=c(e.lines,t),r=e.parent;r;r=(e=r).parent)for(var i=0;r.children[i]!=e;++i)n+=r.children[i].chunkSize();return n+e.first}function jn(t,e){var n=t.first;t:do{for(var r=0,i=t.children.length;r<i;++r){var o=t.children[r],a=o.height;if(e<a){t=o;continue t}e-=a,n+=o.chunkSize()}return n}while(!t.lines);for(r=0,i=t.lines.length;r<i;++r){var s=t.lines[r].height;if(e<s)break;e-=s}return n+r}function Vn(t,e){for(var n=0,r=(e=gn(t.doc,e)).parent,i=0;i<r.lines.length;++i){var o=r.lines[i];if(o==e)break;n+=o.height}for(var a=r.parent;a;a=(r=a).parent)for(i=0;i<a.children.length;++i){var s=a.children[i];if(s==r)break;n+=s.height}return n}function H(t){var e=t.order;return e=null==e?t.order=$r(t.text):e}function Yn(t){return{done:[],undone:[],undoDepth:1/0,lastTime:0,lastOp:null,lastOrigin:null,generation:t||1,maxGeneration:t||1}}function qn(e,n,t,r){var i=n["spans_"+e.id],o=0;e.iter(Math.max(e.first,t),Math.min(e.first+e.size,r),function(t){t.markedSpans&&((i=i||(n["spans_"+e.id]={}))[o]=t.markedSpans),++o})}function Kn(t,e){var n={from:e.from,to:ye(e),text:Wn(t,e.from,e.to)};return qn(t,n,e.from.line,e.to.line+1),Gn(t,function(t){qn(t,n,e.from.line,e.to.line+1)},!0),n}function Xn(t,e,n,r){var i=t.history,o=(i.undone.length=0,+new Date),a=U(i.done);if(a&&(i.lastOp==r||i.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&t.cm&&i.lastTime>o-t.cm.options.historyEventDelay||"*"==e.origin.charAt(0)))){var s=U(a.changes);E(e.from,e.to)&&E(e.from,s.to)?s.to=ye(e):a.changes.push(Kn(t,e)),a.anchorAfter=n.anchor,a.headAfter=n.head}else for(a={changes:[Kn(t,e)],generation:i.generation,anchorBefore:t.sel.anchor,headBefore:t.sel.head,anchorAfter:n.anchor,headAfter:n.head},i.done.push(a),i.generation=++i.maxGeneration;i.done.length>i.undoDepth;)i.done.shift();i.lastTime=o,i.lastOp=r,i.lastOrigin=e.origin}function $n(t,e){for(var n=0,r=[];n<t.length;++n){var i=t[n],o=i.changes,a=[];r.push({changes:a,anchorBefore:i.anchorBefore,headBefore:i.headBefore,anchorAfter:i.anchorAfter,headAfter:i.headAfter});for(var s=0;s<o.length;++s){var l,u=o[s];if(a.push({from:u.from,to:u.to,text:u.text}),e)for(var h in u)(l=h.match(/^spans_(\d+)$/))&&-1<c(e,Number(l[1]))&&(U(a)[h]=u[h],delete u[h])}}return r}function Zn(t,e,n,r){n<t.line?t.line+=r:e<t.line&&(t.line=e,t.ch=0)}function Jn(t,e,n,r){for(var i=0;i<t.length;++i){for(var o=t[i],a=!0,s=0;s<o.changes.length;++s){var l=o.changes[s];if(o.copied||(l.from=Ee(l.from),l.to=Ee(l.to)),n<l.from.line)l.from.line+=r,l.to.line+=r;else if(e<=l.to.line){a=!1;break}}o.copied||(o.anchorBefore=Ee(o.anchorBefore),o.headBefore=Ee(o.headBefore),o.anchorAfter=Ee(o.anchorAfter),o.readAfter=Ee(o.headAfter),o.copied=!0),a?(Zn(o.anchorBefore),Zn(o.headBefore),Zn(o.anchorAfter),Zn(o.headAfter)):(t.splice(0,i+1),i=0)}}function Qn(t,e){var n=e.from.line,r=e.to.line,e=e.text.length-(r-n)-1;Jn(t.done,n,r,e),Jn(t.undone,n,r,e)}function tr(){rr(this)}function er(t){return t.stop||(t.stop=tr),t}function z(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function nr(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function rr(t){z(t),nr(t)}function ir(t){return t.target||t.srcElement}function or(t){var e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),e=$&&t.ctrlKey&&1==e?3:e}function I(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):((t=t._handlers||(t._handlers={}))[e]||(t[e]=[])).push(n)}function R(t,e,n){if(t.removeEventListener)t.removeEventListener(e,n,!1);else if(t.detachEvent)t.detachEvent("on"+e,n);else{var r=t._handlers&&t._handlers[e];if(r)for(var i=0;i<r.length;++i)if(r[i]==n){r.splice(i,1);break}}}function g(t,e){var n=t._handlers&&t._handlers[e];if(n)for(var r=Array.prototype.slice.call(arguments,2),i=0;i<n.length;++i)n[i].apply(null,r)}d.e_stop=rr,d.e_preventDefault=z,d.e_stopPropagation=nr;var ar,sr=0;function F(t,e){var n=t._handlers&&t._handlers[e];if(n){var r=Array.prototype.slice.call(arguments,2);ar||(++sr,ar=[],setTimeout(lr,0));for(var i=0;i<n.length;++i)ar.push(function(t){return function(){t.apply(null,r)}}(n[i]))}}function G(t,e){return g(t,e.type,t,e),null!=(t=e).defaultPrevented?t.defaultPrevented:0==t.returnValue}function lr(){--sr;var t=ar;ar=null;for(var e=0;e<t.length;++e)t[e]()}function ur(t,e){t=t._handlers&&t._handlers[e];return t&&0<t.length}d.on=I,d.off=R,d.signal=g;var m=30,hr=d.Pass={toString:function(){return"CodeMirror.Pass"}};function cr(){this.id=null}function fr(t,e,n,r,i){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);for(var o=r||0,a=i||0;o<e;++o)"\t"==t.charAt(o)?a+=n-a%n:++a;return a}cr.prototype={set:function(t,e){clearTimeout(this.id),this.id=setTimeout(e,t)}},d.countColumn=fr;var dr=[""];function pr(t){for(;dr.length<=t;)dr.push(U(dr)+" ");return dr[t]}function U(t){return t[t.length-1]}function gr(t){if(K)t.selectionStart=0,t.selectionEnd=t.value.length;else try{t.select()}catch(t){}}function c(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;++n)if(t[n]==e)return n;return-1}function mr(t,e){function n(){}n.prototype=t;t=new n;return e&&vr(e,t),t}function vr(t,e){for(var n in e=e||{},t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function yr(t){for(var e=[],n=0;n<t;++n)e.push(void 0);return e}function W(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}var _r=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function Lr(t){return/\w/.test(t)||""<t&&(t.toUpperCase()!=t.toLowerCase()||_r.test(t))}function br(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return;return 1}var wr=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/;function B(t,e,n,r){var i=document.createElement(t);if(n&&(i.className=n),r&&(i.style.cssText=r),"string"==typeof e)xr(i,e);else if(e)for(var o=0;o<e.length;++o)i.appendChild(e[o]);return i}function kr(t){for(var e=t.childNodes.length;0<e;--e)t.removeChild(t.firstChild);return t}function j(t,e){return kr(t).appendChild(e)}function xr(t,e){M?(t.innerHTML="",t.appendChild(document.createTextNode(e))):t.textContent=e}function V(t){return t.getBoundingClientRect()}d.replaceGetRect=function(t){V=t};var Mr,Cr,Sr=!M&&("draggable"in(n=B("div"))||"dragDrop"in n);function Er(){return!1}function Dr(t){return null!=Mr?Mr:(j(t,t=B("div",null,null,"width: 50px; height: 50px; overflow-x: scroll")),(Mr=t.offsetWidth?t.offsetHeight-t.clientHeight:Mr)||0)}function Tr(t){var e;return null==Cr&&(e=B("span","​"),j(t,B("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(Cr=e.offsetWidth<=1&&2<e.offsetHeight&&!Y)),Cr?B("span","​"):B("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}v?Er=function(t,e){return 36==t.charCodeAt(e-1)&&39==t.charCodeAt(e)}:y&&!/Version\/([6-9]|\d\d)\b/.test(navigator.userAgent)?Er=function(t,e){return/\-[^ \-?]|\?[^ !\'\"\),.\-\/:;\?\]\}]/.test(t.slice(e-1,e+1))}:w&&(Er=function(t,e){return!!(1<e&&45==t.charCodeAt(e-1)&&/\w/.test(t.charAt(e-2))&&/[^\-?\.]/.test(t.charAt(e)))||/[~!#%&*)=+}\]|\"\.>,:;][({[<]|-[^\-?\.\u2010-\u201f\u2026]|\?[\w~`@#$%\^&*(_=+{[|><]|…[\w~`@#$%\^&*(_=+{[><]/.test(t.slice(e-1,e+1))});var Ar,Pr=3!="\n\nb".split(/\n/).length?function(t){for(var e=0,n=[],r=t.length;e<=r;){var i=t.indexOf("\n",e),o=(-1==i&&(i=t.length),t.slice(e,"\r"==t.charAt(i-1)?i-1:i)),a=o.indexOf("\r");-1!=a?(n.push(o.slice(0,a)),e+=a+1):(n.push(o),e=i+1)}return n}:function(t){return t.split(/\r\n?|\n/)},Nr=(d.splitLines=Pr,window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:function(t){try{var e=t.ownerDocument.selection.createRange()}catch(t){}return!(!e||e.parentElement()!=t)&&0!=e.compareEndPoints("StartToEnd",e)}),Or="oncopy"in(u=B("div"))||(u.setAttribute("oncopy","return;"),"function"==typeof u.oncopy),Hr={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};d.keyNames=Hr;for(var e=0;e<10;e++)Hr[e+48]=String(e);for(e=65;e<=90;e++)Hr[e]=String.fromCharCode(e);for(e=1;e<=12;e++)Hr[e+111]=Hr[e+63235]="F"+e;function zr(t){return t.level%2?t.to:t.from}function Ir(t){return t.level%2?t.from:t.to}function Rr(t){t=H(t);return t?zr(t[0]):0}function Fr(t){var e=H(t);return e?Ir(U(e)):t.text.length}function Gr(t,e){var n=P(t.doc,e),t=gn(t.doc,n),n=(t!=n&&(e=O(t)),H(t));return S(e,n?(n[0].level%2?Fr:Rr)(t):0)}function Ur(t,e){for(var n,r,i,o=0;o<t.length;++o){var a=t[o];if(a.from<e&&a.to>e)return Ar=null,o;if(a.from==e||a.to==e){if(null!=n)return r=t,a=a.level,i=t[n].level,r=r[0].level,a==r||i!=r&&a<i?(Ar=n,o):(Ar=o,n);n=o}}return Ar=null,n}function Wr(t,e,n,r){if(!r)return e+n;for(;0<(e+=n)&&wr.test(t.text.charAt(e)););return e}function Br(t,e,n,r){var i=H(t);if(!i)return jr(t,e,n,r);for(var o=Ur(i,e),a=i[o],s=Wr(t,e,a.level%2?-n:n,r);;){if(s>a.from&&s<a.to)return s;if(s==a.from||s==a.to)return Ur(i,s)==o?s:0<n==(a=i[o+=n]).level%2?a.to:a.from;if(!(a=i[o+=n]))return null;s=0<n==a.level%2?Wr(t,a.to,-1,r):Wr(t,a.from,1,r)}}function jr(t,e,n,r){var i=e+n;if(r)for(;0<i&&wr.test(t.text.charAt(i));)i+=n;return i<0||i>t.text.length?null:i}Vr=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,Yr=/[stwN]/,qr=/[LRr]/,Kr=/[Lb1n]/,Xr=/[1n]/;var Vr,Yr,qr,Kr,Xr,$r=function(t){if(!Vr.test(t))return!1;for(var e,n=t.length,r=[],i=0;i<n;++i)r.push(h=(e=t.charCodeAt(i))<=255?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL".charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1791?"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr".charAt(e-1536):1792<=e&&e<=2220?"r":"L");for(var i=0,o="L";i<n;++i)"m"==(h=r[i])?r[i]=o:o=h;for(var i=0,a="L";i<n;++i)"1"==(h=r[i])&&"r"==a?r[i]="n":qr.test(h)&&"r"==(a=h)&&(r[i]="R");for(i=1,o=r[0];i<n-1;++i)"+"==(h=r[i])&&"1"==o&&"1"==r[i+1]?r[i]="1":","!=h||o!=r[i+1]||"1"!=o&&"n"!=o||(r[i]=o),o=h;for(i=0;i<n;++i)if(","==(h=r[i]))r[i]="N";else if("%"==h){for(var s=i+1;s<n&&"%"==r[s];++s);for(var l=i&&"!"==r[i-1]||s<n-1&&"1"==r[s]?"1":"N",u=i;u<s;++u)r[u]=l;i=s-1}for(i=0,a="L";i<n;++i){var h=r[i];"L"==a&&"1"==h?r[i]="L":qr.test(h)&&(a=h)}for(i=0;i<n;++i)if(Yr.test(r[i])){for(s=i+1;s<n&&Yr.test(r[s]);++s);for(l="L"==(i?r[i-1]:"L")||"L"==(s<n-1?r[s]:"L")?"L":"R",u=i;u<s;++u)r[u]=l;i=s-1}for(var c,f=[],i=0;i<n;)if(Kr.test(r[i])){var d=i;for(++i;i<n&&Kr.test(r[i]);++i);f.push({from:d,to:i,level:0})}else{var p=i,g=f.length;for(++i;i<n&&"L"!=r[i];++i);for(u=p;u<i;)if(Xr.test(r[u])){p<u&&f.splice(g,0,{from:p,to:u,level:1});var m=u;for(++u;u<i&&Xr.test(r[u]);++u);f.splice(g,0,{from:m,to:u,level:2}),p=u}else++u;p<i&&f.splice(g,0,{from:p,to:i,level:1})}return 1==f[0].level&&(c=t.match(/^\s+/))&&(f[0].from=c[0].length,f.unshift({from:0,to:c[0].length,level:0})),1==U(f).level&&(c=t.match(/\s+$/))&&(U(f).to-=c[0].length,f.push({from:n-c[0].length,to:n,level:0})),f[0].level!=U(f).level&&f.push({from:n,to:n,level:f[0].level}),f};return d.version="3.14.0",d}(),CodeMirror.defineMode("javascript",function(t,a){var r,i,s=t.indentUnit,l=a.statementIndent,u=a.json,h=a.typescript,o=function(){function t(t){return{type:t,style:"keyword"}}var e=t("keyword a"),n=t("keyword b"),r=t("keyword c"),i=t("operator"),o={type:"atom",style:"atom"},a={if:t("if"),while:e,with:e,else:n,do:n,try:n,finally:n,return:r,break:r,continue:r,new:r,delete:r,throw:r,var:t("var"),const:t("var"),let:t("var"),function:t("function"),catch:t("catch"),for:t("for"),switch:t("switch"),case:t("case"),default:t("default"),in:i,typeof:i,instanceof:i,true:o,false:o,null:o,undefined:o,NaN:o,Infinity:o,this:t("this")};if(h){var s,e={type:"variable",style:"variable-3"},l={interface:t("interface"),class:t("class"),extends:t("extends"),constructor:t("constructor"),public:t("public"),private:t("private"),protected:t("protected"),static:t("static"),super:t("super"),string:e,number:e,bool:e,any:e};for(s in l)a[s]=l[s]}return a}(),c=/[+\-*&%=<>!?|~^]/;function f(t,e,n){return(e.tokenize=n)(t,e)}function d(t,e){for(var n,r=!1;null!=(n=t.next());){if(n==e&&!r)return;r=!r&&"\\"==n}return r}function p(t,e,n){return r=t,i=n,e}function g(t,e){var n,r=t.next();return'"'==r||"'"==r?f(t,e,(n=r,function(t,e){return d(t,n)||(e.tokenize=g),p("string","string")})):/[\[\]{}\(\),;\:\.]/.test(r)?p(r):"0"==r&&t.eat(/x/i)?(t.eatWhile(/[\da-f]/i),p("number","number")):/\d/.test(r)||"-"==r&&t.eat(/\d/)?(t.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),p("number","number")):"/"==r?t.eat("*")?f(t,e,m):t.eat("/")?(t.skipToEnd(),p("comment","comment")):"operator"==e.lastType||"keyword c"==e.lastType||/^[\[{}\(,;:]$/.test(e.lastType)?(d(t,"/"),t.eatWhile(/[gimy]/),p("regexp","string-2")):(t.eatWhile(c),p("operator",null,t.current())):"#"==r?(t.skipToEnd(),p("error","error")):c.test(r)?(t.eatWhile(c),p("operator",null,t.current())):(t.eatWhile(/[\w\$_]/),r=t.current(),(t=o.propertyIsEnumerable(r)&&o[r])&&"."!=e.lastType?p(t.type,t.style,r):p("variable","variable",r))}function m(t,e){for(var n,r=!1;n=t.next();){if("/"==n&&r){e.tokenize=g;break}r="*"==n}return p("comment","comment")}var v={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0};function y(t,e,n,r,i,o){this.indented=t,this.column=e,this.type=n,this.prev=i,this.info=o,null!=r&&(this.align=r)}function I(t,e,n,r,i){var o=t.cc;for(_.state=t,_.stream=i,_.marked=null,_.cc=o,t.lexical.hasOwnProperty("align")||(t.lexical.align=!0);;)if((o.length?o.pop():u?E:S)(n,r)){for(;o.length&&o[o.length-1].lex;)o.pop()();return _.marked?_.marked:"variable"==n&&function(t,e){for(var n=t.localVars;n;n=n.next)if(n.name==e)return 1}(t,r)?"variable-2":e}}var _={state:null,column:null,marked:null,cc:null};function L(){for(var t=arguments.length-1;0<=t;t--)_.cc.push(arguments[t])}function b(){return L.apply(null,arguments),!0}function n(n){function t(t){for(var e=t;e;e=e.next)if(e.name==n)return 1}var e=_.state;e.context?(_.marked="def",t(e.localVars)||(e.localVars={name:n,next:e.localVars})):t(e.globalVars)||(e.globalVars={name:n,next:e.globalVars})}var R={name:"this",next:{name:"arguments"}};function w(){_.state.context={prev:_.state.context,vars:_.state.localVars},_.state.localVars=R}function k(){_.state.localVars=_.state.context.vars,_.state.context=_.state.context.prev}function x(n,r){function t(){var t=_.state,e=t.indented;"stat"==t.lexical.type&&(e=t.lexical.indented),t.lexical=new y(e,_.stream.column(),n,null,t.lexical,r)}return t.lex=!0,t}function M(){var t=_.state;t.lexical.prev&&(")"==t.lexical.type&&(t.indented=t.lexical.indented),t.lexical=t.lexical.prev)}function C(e){return function(t){return t==e?b():";"==e?L():b(arguments.callee)}}function S(t){var n;return"var"==t?b(x("vardef"),N,C(";"),M):"keyword a"==t?b(x("form"),E,S,M):"keyword b"==t?b(x("form"),S,M):"{"==t?b(x("}"),e,M):";"==t?b():"if"==t?b(x("form"),E,S,M,(n=_.state.indented,function(t,e){return"keyword b"==t&&"else"==e?(_.state.lexical=new y(n,0,"form",null,_.state.lexical),b(S,M)):L()})):"function"==t?b(z):"for"==t?b(x("form"),C("("),x(")"),K,C(")"),M,S,M):"variable"==t?b(x("stat"),W):"switch"==t?b(x("form"),E,x("}","switch"),C("{"),e,M,M):"case"==t?b(E,C(":")):"default"==t?b(C(":")):"catch"==t?b(x("form"),w,C("("),Z,C(")"),S,M,k):L(x("stat"),E,C(";"),M)}function E(t){return F(t,!1)}function D(t){return F(t,!0)}function F(t,e){var n=e?A:T;return v.hasOwnProperty(t)?b(n):"function"==t?b(z):"keyword c"==t?b(e?U:G):"("==t?b(x(")"),G,C(")"),M,n):"operator"==t?b(e?D:E):"["==t?b(x("]"),P(D,"]"),M,n):"{"==t?b(x("}"),P(j,"}"),M,n):b()}function G(t){return t.match(/[;\}\)\],]/)?L():L(E)}function U(t){return t.match(/[;\}\)\],]/)?L():L(D)}function T(t,e){return","==t?b(E):A(t,e,T)}function A(t,e,n){return n=n||A,"operator"==t?/\+\+|--/.test(e)?b(n):"?"==e?b(E,C(":"),E):b(E):";"!=t?"("==t?b(x(")","call"),P(D,")"),M,n):"."==t?b(B,n):"["==t?b(x("]"),E,C("]"),M,n):void 0:void 0}function W(t){return":"==t?b(M,S):L(T,C(";"),M)}function B(t){if("variable"==t)return _.marked="property",b()}function j(t,e){if("variable"==t){if(_.marked="property","get"==e||"set"==e)return b(V)}else"number"!=t&&"string"!=t||(_.marked=t+" property");if(v.hasOwnProperty(t))return b(C(":"),D)}function V(t){return":"==t?b(E):"variable"!=t?b(C(":"),E):(_.marked="property",b(z))}function P(n,r){function i(t){var e;return","==t?("call"==(e=_.state.lexical).info&&(e.pos=(e.pos||0)+1),b(n,i)):t==r?b():b(C(r))}return function(t){return t==r?b():L(n,i)}}function e(t){return"}"==t?b():L(S,e)}function Y(t){return":"==t?b(q):L()}function q(t){return("variable"==t?(_.marked="variable-3",b):L)()}function N(t,e){return"variable"==t?(n(e),h?b(Y,O):b(O)):L()}function O(t,e){return"="==e?b(D,O):","==t?b(N):void 0}function K(t){return"var"==t?b(N,C(";"),H):";"==t?b(H):"variable"==t?b(X):L(E,C(";"),H)}function X(t,e){return"in"==e?b(E):b(T,H)}function H(t,e){return";"==t?b($):"in"==e?b(E):L(E,C(";"),$)}function $(t){")"!=t&&b(E)}function z(t,e){return"variable"==t?(n(e),b(z)):"("==t?b(x(")"),w,P(Z,")"),M,S,k):void 0}function Z(t,e){if("variable"==t)return n(e),h?b(Y):b()}return M.lex=!0,{startState:function(t){return{tokenize:g,lastType:null,cc:[],lexical:new y((t||0)-s,0,"block",!1),localVars:a.localVars,globalVars:a.globalVars,context:a.localVars&&{vars:a.localVars},indented:0}},token:function(t,e){var n;return t.sol()&&(e.lexical.hasOwnProperty("align")||(e.lexical.align=!1),e.indented=t.indentation()),e.tokenize!=m&&t.eatSpace()?null:(n=e.tokenize(t,e),"comment"==r?n:(e.lastType="operator"!=r||"++"!=i&&"--"!=i?r:"incdec",I(e,n,r,i,t)))},indent:function(t,e){var n,r,i,o;return t.tokenize==m?CodeMirror.Pass:t.tokenize!=g?0:(n=e&&e.charAt(0),"stat"==(r=t.lexical).type&&"}"==n&&(r=r.prev),o=n==(i=(r=l&&")"==r.type&&"stat"==r.prev.type?r.prev:r).type),"vardef"==i?r.indented+("operator"==t.lastType||","==t.lastType?4:0):"form"==i&&"{"==n?r.indented:"form"==i?r.indented+s:"stat"==i?r.indented+("operator"==t.lastType||","==t.lastType?l||s:0):"switch"!=r.info||o||0==a.doubleIndentSwitch?r.align?r.column+(o?0:1):r.indented+(o?0:s):r.indented+(/^(?:case|default)\b/.test(e)?s:2*s))},electricChars:":{}",blockCommentStart:u?null:"/*",blockCommentEnd:u?null:"*/",lineComment:u?null:"//",jsonMode:u}}),CodeMirror.defineMIME("text/javascript","javascript"),CodeMirror.defineMIME("text/ecmascript","javascript"),CodeMirror.defineMIME("application/javascript","javascript"),CodeMirror.defineMIME("application/ecmascript","javascript"),CodeMirror.defineMIME("application/json",{name:"javascript",json:!0}),CodeMirror.defineMIME("application/x-json",{name:"javascript",json:!0}),CodeMirror.defineMIME("text/typescript",{name:"javascript",typescript:!0}),CodeMirror.defineMIME("application/typescript",{name:"javascript",typescript:!0});