!function(ns){ns.wrapper=function(goog,fb){var CLOSURE_NO_DEPS=!0,CLIENT_VERSION="2.3.2",COMPILED=!1,goog=goog||{},NODE_CLIENT=(goog.global=this,goog.global.CLOSURE_UNCOMPILED_DEFINES,goog.global.CLOSURE_DEFINES,goog.isDef=function(e){return void 0!==e},goog.exportPath_=function(e,t,o){var r,n=e.split("."),i=o||goog.global;n[0]in i||!i.execScript||i.execScript("var "+n[0]);for(;n.length&&(r=n.shift());)!n.length&&goog.isDef(t)?i[r]=t:i=i[r]||(i[r]={})},goog.define=function(e,t){COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,e)?t=goog.global.CLOSURE_UNCOMPILED_DEFINES[e]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,e)&&(t=goog.global.CLOSURE_DEFINES[e])),goog.exportPath_(e,t)},goog.define("goog.DEBUG",!0),goog.define("goog.LOCALE","en"),goog.define("goog.TRUSTED_SITE",!0),goog.define("goog.STRICT_MODE_COMPATIBLE",!1),goog.define("goog.DISALLOW_TEST_ONLY_CODE",COMPILED&&!goog.DEBUG),goog.provide=function(e){if(!COMPILED&&goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');goog.constructNamespace_(e)},goog.constructNamespace_=function(e,t){if(!COMPILED){delete goog.implicitNamespaces_[e];for(var o=e;(o=o.substring(0,o.lastIndexOf(".")))&&!goog.getObjectByName(o);)goog.implicitNamespaces_[o]=!0}goog.exportPath_(e,t)},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(e){if(!goog.isString(e)||!e||-1==e.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+e+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");if(goog.moduleLoaderState_.moduleName=e,!COMPILED){if(goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');delete goog.implicitNamespaces_[e]}},goog.module.get=function(e){return goog.module.getInternal_(e)},goog.module.getInternal_=function(e){if(!COMPILED)return goog.isProvided_(e)?e in goog.loadedModules_?goog.loadedModules_[e]:goog.getObjectByName(e):null},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_},goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_())throw new Error("goog.module.declareTestMethods must be called from within a goog.module");goog.moduleLoaderState_.declareTestMethods=!0},goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw new Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.setTestOnly=function(e){if(goog.DISALLOW_TEST_ONLY_CODE)throw e=e||"",Error("Importing test-only code into non-debug environment"+(e?": "+e:"."))},goog.forwardDeclare=function(e){},COMPILED||(goog.isProvided_=function(e){return e in goog.loadedModules_||!goog.implicitNamespaces_[e]&&goog.isDefAndNotNull(goog.getObjectByName(e))},goog.implicitNamespaces_={"goog.module":!0}),goog.getObjectByName=function(e,t){for(var o,r=e.split("."),n=t||goog.global;o=r.shift();){if(!goog.isDefAndNotNull(n[o]))return null;n=n[o]}return n},goog.globalize=function(e,t){var o,r=t||goog.global;for(o in e)r[o]=e[o]},goog.addDependency=function(e,t,o,r){if(goog.DEPENDENCIES_ENABLED){for(var n,i,a=e.replace(/\\/g,"/"),s=goog.dependencies_,l=0;n=t[l];l++)s.nameToPath[n]=a,s.pathIsModule[a]=!!r;for(var c=0;i=o[c];c++)a in s.requires||(s.requires[a]={}),s.requires[a][i]=!0}},goog.define("goog.ENABLE_DEBUG_LOADER",!0),goog.logToConsole_=function(e){goog.global.console&&goog.global.console.error(e)},goog.require=function(e){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(e),goog.isProvided_(e))return goog.isInModuleLoader_()?goog.module.getInternal_(e):null;if(goog.ENABLE_DEBUG_LOADER){var t=goog.getPathFromDeps_(e);if(t)return goog.included_[t]=!0,goog.writeScripts_(),null}t="goog.require could not find: "+e;throw goog.logToConsole_(t),Error(t)}},goog.basePath="",goog.global.CLOSURE_BASE_PATH,goog.global.CLOSURE_NO_DEPS,goog.global.CLOSURE_IMPORT_SCRIPT,goog.nullFunction=function(){},goog.identityFunction=function(e,t){return e},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(e){e.getInstance=function(){return e.instance_||(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=e),e.instance_=new e)}},goog.instantiatedSingletons_=[],goog.define("goog.LOAD_MODULE_USING_EVAL",!0),goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG),goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var e=goog.global.document;return void 0!==e&&"write"in e},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var e=goog.global.document.getElementsByTagName("script"),t=e.length-1;0<=t;--t){var o=e[t].src,r=o.lastIndexOf("?"),r=-1==r?o.length:r;if("base.js"==o.substr(r-7,7))return void(goog.basePath=o.substr(0,r-7))}},goog.importScript_=function(e,t){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(e,t)&&(goog.dependencies_.written[e]=!0)},goog.IS_OLD_IE_=!goog.global.atob&&goog.global.document&&goog.global.document.all,goog.importModule_=function(e){goog.importScript_("",'goog.retrieveAndExecModule_("'+e+'");')&&(goog.dependencies_.written[e]=!0)},goog.queuedModules_=[],goog.wrapModule_=function(e,t){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(t+"\n//# sourceURL="+e+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+t+"\n;return exports});\n//# sourceURL="+e+"\n"},goog.loadQueuedModules_=function(){var e=goog.queuedModules_.length;if(0<e){var t=goog.queuedModules_;goog.queuedModules_=[];for(var o=0;o<e;o++){var r=t[o];goog.maybeProcessDeferredPath_(r)}}},goog.maybeProcessDeferredDep_=function(e){goog.isDeferredModule_(e)&&goog.allDepsAreAvailable_(e)&&(e=goog.getPathFromDeps_(e),goog.maybeProcessDeferredPath_(goog.basePath+e))},goog.isDeferredModule_=function(e){e=goog.getPathFromDeps_(e);return!(!e||!goog.dependencies_.pathIsModule[e])&&goog.basePath+e in goog.dependencies_.deferred},goog.allDepsAreAvailable_=function(e){e=goog.getPathFromDeps_(e);if(e&&e in goog.dependencies_.requires)for(var t in goog.dependencies_.requires[e])if(!goog.isProvided_(t)&&!goog.isDeferredModule_(t))return!1;return!0},goog.maybeProcessDeferredPath_=function(e){var t;e in goog.dependencies_.deferred&&(t=goog.dependencies_.deferred[e],delete goog.dependencies_.deferred[e],goog.globalEval(t))},goog.loadModule=function(e){var t,o=goog.moduleLoaderState_;try{if(goog.moduleLoaderState_={moduleName:void 0,declareTestMethods:!1},goog.isFunction(e))t=e.call(goog.global,{});else{if(!goog.isString(e))throw Error("Invalid module definition");t=goog.loadModuleFromSource_.call(goog.global,e)}var r=goog.moduleLoaderState_.moduleName;if(!goog.isString(r)||!r)throw Error('Invalid module name "'+r+'"');if(goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(r,t):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(t),goog.loadedModules_[r]=t,goog.moduleLoaderState_.declareTestMethods)for(var n in t)0!==n.indexOf("test",0)&&"tearDown"!=n&&"setUp"!=n&&"setUpPage"!=n&&"tearDownPage"!=n||(goog.global[n]=t[n])}finally{goog.moduleLoaderState_=o}},goog.loadModuleFromSource_=function(source){var exports={};return eval(source),exports},goog.writeScriptTag_=function(e,t){if(goog.inHtmlDocument_()){var o=goog.global.document;if("complete"==o.readyState){if(/\bdeps.js$/.test(e))return!1;throw Error('Cannot write "'+e+'" after document load')}var r=goog.IS_OLD_IE_;return void 0===t?r?(r=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ",o.write('<script type="text/javascript" src="'+e+'"'+r+"><\/script>")):o.write('<script type="text/javascript" src="'+e+'"><\/script>'):o.write('<script type="text/javascript">'+t+"<\/script>"),!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(e,t){return"complete"==e.readyState&&goog.lastNonModuleScriptIndex_==t&&goog.loadQueuedModules_(),!0},goog.writeScripts_=function(){var r=[],n={},i=goog.dependencies_;for(t in goog.included_)i.written[t]||!function e(t){if(!(t in i.written)){if(!(t in i.visited)&&(i.visited[t]=!0,t in i.requires))for(var o in i.requires[t])if(!goog.isProvided_(o)){if(!(o in i.nameToPath))throw Error("Undefined nameToPath for "+o);e(i.nameToPath[o])}t in n||(n[t]=!0,r.push(t))}}(t);for(var e=0;e<r.length;e++){var t=r[e];goog.dependencies_.written[t]=!0}for(var o=goog.moduleLoaderState_,e=(goog.moduleLoaderState_=null,0);e<r.length;e++){if(!(t=r[e]))throw goog.moduleLoaderState_=o,Error("Undefined script input");i.pathIsModule[t]?goog.importModule_(goog.basePath+t):goog.importScript_(goog.basePath+t)}goog.moduleLoaderState_=o},goog.getPathFromDeps_=function(e){return e in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[e]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.normalizePath_=function(e){for(var t=e.split("/"),o=0;o<t.length;)"."==t[o]?t.splice(o,1):o&&".."==t[o]&&t[o-1]&&".."!=t[o-1]?t.splice(--o,2):o++;return t.join("/")},goog.retrieveAndExecModule_=function(e){if(!COMPILED){var t=e,o=(e=goog.normalizePath_(e),goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_),r=null,n=new goog.global.XMLHttpRequest;if(n.onload=function(){r=this.responseText},n.open("get",e,!1),n.send(),null==(r=n.responseText))throw new Error("load of "+e+"failed");n=goog.wrapModule_(e,r);goog.IS_OLD_IE_?(goog.dependencies_.deferred[t]=n,goog.queuedModules_.push(t)):o(e,n)}},goog.typeOf=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var o=Object.prototype.toString.call(e);if("[object Window]"==o)return"object";if("[object Array]"==o||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==o||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t},goog.isNull=function(e){return null===e},goog.isDefAndNotNull=function(e){return null!=e},goog.isArray=function(e){return"array"==goog.typeOf(e)},goog.isArrayLike=function(e){var t=goog.typeOf(e);return"array"==t||"object"==t&&"number"==typeof e.length},goog.isDateLike=function(e){return goog.isObject(e)&&"function"==typeof e.getFullYear},goog.isString=function(e){return"string"==typeof e},goog.isBoolean=function(e){return"boolean"==typeof e},goog.isNumber=function(e){return"number"==typeof e},goog.isFunction=function(e){return"function"==goog.typeOf(e)},goog.isObject=function(e){var t=typeof e;return"object"==t&&null!=e||"function"==t},goog.getUid=function(e){return e[goog.UID_PROPERTY_]||(e[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(e){return!!e[goog.UID_PROPERTY_]},goog.removeUid=function(e){"removeAttribute"in e&&e.removeAttribute(goog.UID_PROPERTY_);try{delete e[goog.UID_PROPERTY_]}catch(e){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(e){var t=goog.typeOf(e);if("object"!=t&&"array"!=t)return e;if(e.clone)return e.clone();var o,r="array"==t?[]:{};for(o in e)r[o]=goog.cloneObject(e[o]);return r},goog.bindNative_=function(e,t,o){return e.call.apply(e.bind,arguments)},goog.bindJs_=function(t,o,e){var r;if(t)return 2<arguments.length?(r=Array.prototype.slice.call(arguments,2),function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(o,e)}):function(){return t.apply(o,arguments)};throw new Error},goog.bind=function(e,t,o){return Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(t,e){var o=Array.prototype.slice.call(arguments,1);return function(){var e=o.slice();return e.push.apply(e,arguments),t.apply(this,e)}},goog.mixin=function(e,t){for(var o in t)e[o]=t[o]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(e){if(goog.global.execScript)goog.global.execScript(e,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");var t,o;null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),void 0!==goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_?goog.global.eval(e):((o=(t=goog.global.document).createElement("script")).type="text/javascript",o.defer=!1,o.appendChild(t.createTextNode(e)),t.body.appendChild(o),t.body.removeChild(o))}},goog.evalWorksForGlobals_=null,goog.cssNameMapping_,goog.cssNameMappingStyle_,goog.getCssName=function(e,t){function n(e){return goog.cssNameMapping_[e]||e}var o=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?n:function(e){for(var t=e.split("-"),o=[],r=0;r<t.length;r++)o.push(n(t[r]));return o.join("-")}:function(e){return e};return t?e+"-"+o(t):o(e)},goog.setCssNameMapping=function(e,t){goog.cssNameMapping_=e,goog.cssNameMappingStyle_=t},goog.global.CLOSURE_CSS_NAME_MAPPING,!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(e,o){return e=o?e.replace(/\{\$([^}]+)}/g,function(e,t){return t in o?o[t]:e}):e},goog.getMsgWithFallback=function(e,t){return e},goog.exportSymbol=function(e,t,o){goog.exportPath_(e,t,o)},goog.exportProperty=function(e,t,o){e[t]=o},goog.inherits=function(e,i){function t(){}t.prototype=i.prototype,e.superClass_=i.prototype,e.prototype=new t,(e.prototype.constructor=e).base=function(e,t,o){for(var r=new Array(arguments.length-2),n=2;n<arguments.length;n++)r[n-2]=arguments[n];return i.prototype[t].apply(e,r)}},goog.base=function(e,t,o){var r=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!r)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(r.superClass_){for(var n=new Array(arguments.length-1),i=1;i<arguments.length;i++)n[i-1]=arguments[i];return r.superClass_.constructor.apply(e,n)}for(var a=new Array(arguments.length-2),i=2;i<arguments.length;i++)a[i-2]=arguments[i];for(var s=!1,l=e.constructor;l;l=l.superClass_&&l.superClass_.constructor)if(l.prototype[t]===r)s=!0;else if(s)return l.prototype[t].apply(e,a);if(e[t]===r)return e.constructor.prototype[t].apply(e,a);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(e){e.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(e,t){var o=t.constructor,r=t.statics,o=(o&&o!=Object.prototype.constructor||(o=function(){throw Error("cannot instantiate an interface (no constructor defined).")}),goog.defineClass.createSealingConstructor_(o,e));return e&&goog.inherits(o,e),delete t.constructor,delete t.statics,goog.defineClass.applyProperties_(o.prototype,t),null!=r&&(r instanceof Function?r(o):goog.defineClass.applyProperties_(o,r)),o},goog.defineClass.ClassDescriptor,goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG),goog.defineClass.createSealingConstructor_=function(t,e){var o;return!(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function)||e&&e.prototype&&e.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]?t:o=function(){var e=t.apply(this,arguments)||this;return e[goog.UID_PROPERTY_]=e[goog.UID_PROPERTY_],this.constructor===o&&Object.seal(e),e}},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.defineClass.applyProperties_=function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);for(var r=0;r<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;r++)o=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[r],Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},goog.tagUnsealableClass=function(e){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(e.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)},goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable",goog.provide("goog.debug.Error"),goog.debug.Error=function(e){var t;Error.captureStackTrace?Error.captureStackTrace(this,goog.debug.Error):(t=(new Error).stack)&&(this.stack=t),e&&(this.message=String(e))},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.provide("goog.object"),goog.object.forEach=function(e,t,o){for(var r in e)t.call(o,e[r],r,e)},goog.object.filter=function(e,t,o){var r,n={};for(r in e)t.call(o,e[r],r,e)&&(n[r]=e[r]);return n},goog.object.map=function(e,t,o){var r,n={};for(r in e)n[r]=t.call(o,e[r],r,e);return n},goog.object.some=function(e,t,o){for(var r in e)if(t.call(o,e[r],r,e))return!0;return!1},goog.object.every=function(e,t,o){for(var r in e)if(!t.call(o,e[r],r,e))return!1;return!0},goog.object.getCount=function(e){var t,o=0;for(t in e)o++;return o},goog.object.getAnyKey=function(e){for(var t in e)return t},goog.object.getAnyValue=function(e){for(var t in e)return e[t]},goog.object.contains=function(e,t){return goog.object.containsValue(e,t)},goog.object.getValues=function(e){var t,o=[],r=0;for(t in e)o[r++]=e[t];return o},goog.object.getKeys=function(e){var t,o=[],r=0;for(t in e)o[r++]=t;return o},goog.object.getValueByKeys=function(e,t){for(var o=goog.isArrayLike(t),r=o?t:arguments,n=o?0:1;n<r.length&&(e=e[r[n]],goog.isDef(e));n++);return e},goog.object.containsKey=function(e,t){return t in e},goog.object.containsValue=function(e,t){for(var o in e)if(e[o]==t)return!0;return!1},goog.object.findKey=function(e,t,o){for(var r in e)if(t.call(o,e[r],r,e))return r},goog.object.findValue=function(e,t,o){t=goog.object.findKey(e,t,o);return t&&e[t]},goog.object.isEmpty=function(e){for(var t in e)return!1;return!0},goog.object.clear=function(e){for(var t in e)delete e[t]},goog.object.remove=function(e,t){var o;return(o=t in e)&&delete e[t],o},goog.object.add=function(e,t,o){if(t in e)throw Error('The object already contains the key "'+t+'"');goog.object.set(e,t,o)},goog.object.get=function(e,t,o){return t in e?e[t]:o},goog.object.set=function(e,t,o){e[t]=o},goog.object.setIfUndefined=function(e,t,o){return t in e?e[t]:e[t]=o},goog.object.setWithReturnValueIfNotSet=function(e,t,o){return t in e?e[t]:(o=o(),e[t]=o)},goog.object.equals=function(e,t){for(var o in e)if(!(o in t)||e[o]!==t[o])return!1;for(var o in t)if(!(o in e))return!1;return!0},goog.object.clone=function(e){var t,o={};for(t in e)o[t]=e[t];return o},goog.object.unsafeClone=function(e){var t=goog.typeOf(e);if("object"!=t&&"array"!=t)return e;if(e.clone)return e.clone();var o,r="array"==t?[]:{};for(o in e)r[o]=goog.object.unsafeClone(e[o]);return r},goog.object.transpose=function(e){var t,o={};for(t in e)o[e[t]]=t;return o},goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.object.extend=function(e,t){for(var o,r,n=1;n<arguments.length;n++){for(o in r=arguments[n])e[o]=r[o];for(var i=0;i<goog.object.PROTOTYPE_FIELDS_.length;i++)o=goog.object.PROTOTYPE_FIELDS_[i],Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}},goog.object.create=function(e){var t=arguments.length;if(1==t&&goog.isArray(e))return goog.object.create.apply(null,e);if(t%2)throw Error("Uneven number of arguments");for(var o={},r=0;r<t;r+=2)o[arguments[r]]=arguments[r+1];return o},goog.object.createSet=function(e){var t=arguments.length;if(1==t&&goog.isArray(e))return goog.object.createSet.apply(null,e);for(var o={},r=0;r<t;r++)o[arguments[r]]=!0;return o},goog.object.createImmutableView=function(e){var t=e;return Object.isFrozen&&!Object.isFrozen(e)&&(t=Object.create(e),Object.freeze(t)),t},goog.object.isImmutableView=function(e){return!!Object.isFrozen&&Object.isFrozen(e)},goog.provide("goog.dom.NodeType"),goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},goog.provide("goog.json"),goog.provide("goog.json.Replacer"),goog.provide("goog.json.Reviver"),goog.provide("goog.json.Serializer"),goog.define("goog.json.USE_NATIVE_JSON",!1),goog.json.isValid=function(e){return!/^\s*$/.test(e)&&/^[\],:{}\s\u2028\u2029]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,""))},goog.json.parse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(s){var o=String(s);if(goog.json.isValid(o))try{return eval("("+o+")")}catch(ex){}throw Error("Invalid JSON string: "+o)},goog.json.unsafeParse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(s){return eval("("+s+")")},goog.json.Replacer,goog.json.Reviver,goog.json.serialize=goog.json.USE_NATIVE_JSON?goog.global.JSON.stringify:function(e,t){return new goog.json.Serializer(t).serialize(e)},goog.json.Serializer=function(e){this.replacer_=e},goog.json.Serializer.prototype.serialize=function(e){var t=[];return this.serializeInternal(e,t),t.join("")},goog.json.Serializer.prototype.serializeInternal=function(e,t){switch(typeof e){case"string":this.serializeString_(e,t);break;case"number":this.serializeNumber_(e,t);break;case"boolean":t.push(e);break;case"undefined":t.push("null");break;case"object":null==e?t.push("null"):goog.isArray(e)?this.serializeArray(e,t):this.serializeObject_(e,t);break;case"function":break;default:throw Error("Unknown type: "+typeof e)}},goog.json.Serializer.charToJsonCharCache_={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},goog.json.Serializer.charsToReplace_=/\uffff/.test("￿")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,goog.json.Serializer.prototype.serializeString_=function(e,t){t.push('"',e.replace(goog.json.Serializer.charsToReplace_,function(e){var t,o;return e in goog.json.Serializer.charToJsonCharCache_?goog.json.Serializer.charToJsonCharCache_[e]:(o="\\u",(t=e.charCodeAt(0))<16?o+="000":t<256?o+="00":t<4096&&(o+="0"),goog.json.Serializer.charToJsonCharCache_[e]=o+t.toString(16))}),'"')},goog.json.Serializer.prototype.serializeNumber_=function(e,t){t.push(isFinite(e)&&!isNaN(e)?e:"null")},goog.json.Serializer.prototype.serializeArray=function(e,t){for(var o=e.length,r=(t.push("["),""),n=0;n<o;n++){t.push(r);var i=e[n];this.serializeInternal(this.replacer_?this.replacer_.call(e,String(n),i):i,t),r=","}t.push("]")},goog.json.Serializer.prototype.serializeObject_=function(e,t){t.push("{");var o,r,n="";for(o in e)!Object.prototype.hasOwnProperty.call(e,o)||"function"!=typeof(r=e[o])&&(t.push(n),this.serializeString_(o,t),t.push(":"),this.serializeInternal(this.replacer_?this.replacer_.call(e,o,r):r,t),n=",");t.push("}")},goog.provide("goog.string"),goog.provide("goog.string.Unicode"),goog.define("goog.string.DETECT_DOUBLE_ESCAPING",!1),goog.define("goog.string.FORCE_NON_DOM_HTML_UNESCAPING",!1),goog.string.Unicode={NBSP:" "},goog.string.startsWith=function(e,t){return 0==e.lastIndexOf(t,0)},goog.string.endsWith=function(e,t){var o=e.length-t.length;return 0<=o&&e.indexOf(t,o)==o},goog.string.caseInsensitiveStartsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(0,t.length))},goog.string.caseInsensitiveEndsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(e.length-t.length,t.length))},goog.string.caseInsensitiveEquals=function(e,t){return e.toLowerCase()==t.toLowerCase()},goog.string.subs=function(e,t){for(var o=e.split("%s"),r="",n=Array.prototype.slice.call(arguments,1);n.length&&1<o.length;)r+=o.shift()+n.shift();return r+o.join("%s")},goog.string.collapseWhitespace=function(e){return e.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmptyOrWhitespace=function(e){return/^[\s\xa0]*$/.test(e)},goog.string.isEmptyString=function(e){return 0==e.length},goog.string.isEmpty=goog.string.isEmptyOrWhitespace,goog.string.isEmptyOrWhitespaceSafe=function(e){return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(e))},goog.string.isEmptySafe=goog.string.isEmptyOrWhitespaceSafe,goog.string.isBreakingWhitespace=function(e){return!/[^\t\n\r ]/.test(e)},goog.string.isAlpha=function(e){return!/[^a-zA-Z]/.test(e)},goog.string.isNumeric=function(e){return!/[^0-9]/.test(e)},goog.string.isAlphaNumeric=function(e){return!/[^a-zA-Z0-9]/.test(e)},goog.string.isSpace=function(e){return" "==e},goog.string.isUnicodeChar=function(e){return 1==e.length&&" "<=e&&e<="~"||""<=e&&e<="�"},goog.string.stripNewlines=function(e){return e.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(e){return e.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(e){return e.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(e){return e.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(e){return e.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=goog.TRUSTED_SITE&&String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(e){return e.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(e){return e.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(e,t){e=String(e).toLowerCase(),t=String(t).toLowerCase();return e<t?-1:e==t?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(e,t){if(e==t)return 0;if(!e)return-1;if(!t)return 1;for(var o=e.toLowerCase().match(goog.string.numerateCompareRegExp_),r=t.toLowerCase().match(goog.string.numerateCompareRegExp_),n=Math.min(o.length,r.length),i=0;i<n;i++){var a=o[i],s=r[i];if(a!=s){var l=parseInt(a,10);if(!isNaN(l)){var c=parseInt(s,10);if(!isNaN(c)&&l-c)return l-c}return a<s?-1:1}}return o.length!=r.length?o.length-r.length:e<t?-1:1},goog.string.urlEncode=function(e){return encodeURIComponent(String(e))},goog.string.urlDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},goog.string.newLineToBr=function(e,t){return e.replace(/(\r\n|\r|\n)/g,t?"<br />":"<br>")},goog.string.htmlEscape=function(e,t){return t?(e=e.replace(goog.string.AMP_RE_,"&amp;").replace(goog.string.LT_RE_,"&lt;").replace(goog.string.GT_RE_,"&gt;").replace(goog.string.QUOT_RE_,"&quot;").replace(goog.string.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.NULL_RE_,"&#0;"),goog.string.DETECT_DOUBLE_ESCAPING?e.replace(goog.string.E_RE_,"&#101;"):e):(goog.string.ALL_RE_.test(e)&&(-1!=(e=-1!=(e=-1!=(e=-1!=(e=-1!=(e=-1!=e.indexOf("&")?e.replace(goog.string.AMP_RE_,"&amp;"):e).indexOf("<")?e.replace(goog.string.LT_RE_,"&lt;"):e).indexOf(">")?e.replace(goog.string.GT_RE_,"&gt;"):e).indexOf('"')?e.replace(goog.string.QUOT_RE_,"&quot;"):e).indexOf("'")?e.replace(goog.string.SINGLE_QUOTE_RE_,"&#39;"):e).indexOf("\0")&&(e=e.replace(goog.string.NULL_RE_,"&#0;")),goog.string.DETECT_DOUBLE_ESCAPING&&-1!=e.indexOf("e")&&(e=e.replace(goog.string.E_RE_,"&#101;"))),e)},goog.string.AMP_RE_=/&/g,goog.string.LT_RE_=/</g,goog.string.GT_RE_=/>/g,goog.string.QUOT_RE_=/"/g,goog.string.SINGLE_QUOTE_RE_=/'/g,goog.string.NULL_RE_=/\x00/g,goog.string.E_RE_=/e/g,goog.string.ALL_RE_=goog.string.DETECT_DOUBLE_ESCAPING?/[\x00&<>"'e]/:/[\x00&<>"']/,goog.string.unescapeEntities=function(e){return goog.string.contains(e,"&")?!goog.string.FORCE_NON_DOM_HTML_UNESCAPING&&"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(e):goog.string.unescapePureXmlEntities_(e):e},goog.string.unescapeEntitiesWithDocument=function(e,t){return goog.string.contains(e,"&")?goog.string.unescapeEntitiesUsingDom_(e,t):e},goog.string.unescapeEntitiesUsingDom_=function(e,t){var r={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},n=(t||goog.global.document).createElement("div");return e.replace(goog.string.HTML_ENTITY_PATTERN_,function(e,t){var o=r[e];return o||("#"==t.charAt(0)&&(t=Number("0"+t.substr(1)),isNaN(t)||(o=String.fromCharCode(t))),o||(n.innerHTML=e+" ",o=n.firstChild.nodeValue.slice(0,-1)),r[e]=o)})},goog.string.unescapePureXmlEntities_=function(e){return e.replace(/&([^;]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==t.charAt(0)){var o=Number("0"+t.substr(1));if(!isNaN(o))return String.fromCharCode(o)}return e}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(e,t){return goog.string.newLineToBr(e.replace(/  /g," &#160;"),t)},goog.string.preserveSpaces=function(e){return e.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)},goog.string.stripQuotes=function(e,t){for(var o=t.length,r=0;r<o;r++){var n=1==o?t:t.charAt(r);if(e.charAt(0)==n&&e.charAt(e.length-1)==n)return e.substring(1,e.length-1)}return e},goog.string.truncate=function(e,t,o){return(e=o?goog.string.unescapeEntities(e):e).length>t&&(e=e.substring(0,t-3)+"..."),e=o?goog.string.htmlEscape(e):e},goog.string.truncateMiddle=function(e,t,o,r){var n;return o&&(e=goog.string.unescapeEntities(e)),r&&e.length>t?(n=e.length-(r=t<r?t:r),e=e.substring(0,t-r)+"..."+e.substring(n)):e.length>t&&(r=Math.floor(t/2),n=e.length-r,e=e.substring(0,r+=t%2)+"..."+e.substring(n)),e=o?goog.string.htmlEscape(e):e},goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(e){if((e=String(e)).quote)return e.quote();for(var t=['"'],o=0;o<e.length;o++){var r=e.charAt(o),n=r.charCodeAt(0);t[o+1]=goog.string.specialEscapeChars_[r]||(31<n&&n<127?r:goog.string.escapeChar(r))}return t.push('"'),t.join("")},goog.string.escapeString=function(e){for(var t=[],o=0;o<e.length;o++)t[o]=goog.string.escapeChar(e.charAt(o));return t.join("")},goog.string.escapeChar=function(e){var t,o;return e in goog.string.jsEscapeCache_?goog.string.jsEscapeCache_[e]:e in goog.string.specialEscapeChars_?goog.string.jsEscapeCache_[e]=goog.string.specialEscapeChars_[e]:(31<(o=(t=e).charCodeAt(0))&&o<127?t=e:(o<256?(t="\\x",(o<16||256<o)&&(t+="0")):(t="\\u",o<4096&&(t+="0")),t+=o.toString(16).toUpperCase()),goog.string.jsEscapeCache_[e]=t)},goog.string.contains=function(e,t){return-1!=e.indexOf(t)},goog.string.caseInsensitiveContains=function(e,t){return goog.string.contains(e.toLowerCase(),t.toLowerCase())},goog.string.countOf=function(e,t){return e&&t?e.split(t).length-1:0},goog.string.removeAt=function(e,t,o){var r=e;return r=0<=t&&t<e.length&&0<o?e.substr(0,t)+e.substr(t+o,e.length-t-o):r},goog.string.remove=function(e,t){t=new RegExp(goog.string.regExpEscape(t),"");return e.replace(t,"")},goog.string.removeAll=function(e,t){t=new RegExp(goog.string.regExpEscape(t),"g");return e.replace(t,"")},goog.string.regExpEscape=function(e){return String(e).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(e,t){return new Array(t+1).join(e)},goog.string.padNumber=function(e,t,o){o=goog.isDef(o)?e.toFixed(o):String(e),e=o.indexOf(".");return-1==e&&(e=o.length),goog.string.repeat("0",Math.max(0,t-e))+o},goog.string.makeSafe=function(e){return null==e?"":String(e)},goog.string.buildString=function(e){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){var e=2147483648;return Math.floor(Math.random()*e).toString(36)+Math.abs(Math.floor(Math.random()*e)^goog.now()).toString(36)},goog.string.compareVersions=function(e,t){for(var o=0,r=goog.string.trim(String(e)).split("."),n=goog.string.trim(String(t)).split("."),i=Math.max(r.length,n.length),a=0;0==o&&a<i;a++){var s=r[a]||"",l=n[a]||"",c=new RegExp("(\\d*)(\\D*)","g"),g=new RegExp("(\\d*)(\\D*)","g");do{var u=c.exec(s)||["","",""],f=g.exec(l)||["","",""];if(0==u[0].length&&0==f[0].length)break;var h=0==u[1].length?0:parseInt(u[1],10),p=0==f[1].length?0:parseInt(f[1],10),o=goog.string.compareElements_(h,p)||goog.string.compareElements_(0==u[2].length,0==f[2].length)||goog.string.compareElements_(u[2],f[2])}while(0==o)}return o},goog.string.compareElements_=function(e,t){return e<t?-1:t<e?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(e){for(var t=0,o=0;o<e.length;++o)t=31*t+e.charCodeAt(o),t%=goog.string.HASHCODE_MAX_;return t},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(e){var t=Number(e);return 0==t&&goog.string.isEmptyOrWhitespace(e)?NaN:t},goog.string.isLowerCamelCase=function(e){return/^[a-z]+([A-Z][a-z]*)*$/.test(e)},goog.string.isUpperCamelCase=function(e){return/^([A-Z][a-z]*)+$/.test(e)},goog.string.toCamelCase=function(e){return String(e).replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})},goog.string.toSelectorCase=function(e){return String(e).replace(/([A-Z])/g,"-$1").toLowerCase()},goog.string.toTitleCase=function(e,t){t=(t=goog.isString(t)?goog.string.regExpEscape(t):"\\s")?"|["+t+"]+":"",t=new RegExp("(^"+t+")([a-z])","g");return e.replace(t,function(e,t,o){return t+o.toUpperCase()})},goog.string.capitalize=function(e){return String(e.charAt(0)).toUpperCase()+String(e.substr(1)).toLowerCase()},goog.string.parseInt=function(e){return isFinite(e)&&(e=String(e)),goog.isString(e)?/^\s*-?0x/i.test(e)?parseInt(e,16):parseInt(e,10):NaN},goog.string.splitLimit=function(e,t,o){for(var r=e.split(t),n=[];0<o&&r.length;)n.push(r.shift()),o--;return r.length&&n.push(r.join(t)),n},goog.string.editDistance=function(e,t){var o=[],r=[];if(e==t)return 0;if(!e.length||!t.length)return Math.max(e.length,t.length);for(var n=0;n<t.length+1;n++)o[n]=n;for(n=0;n<e.length;n++){r[0]=n+1;for(var i=0;i<t.length;i++){var a=e[n]!=t[i];r[i+1]=Math.min(r[i]+1,o[i+1]+1,o[i]+a)}for(i=0;i<o.length;i++)o[i]=r[i]}return r[t.length]},goog.provide("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.util.getNativeUserAgentString_=function(){var e=goog.labs.userAgent.util.getNavigator_();if(e){e=e.userAgent;if(e)return e}return""},goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator},goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_(),goog.labs.userAgent.util.setUserAgent=function(e){goog.labs.userAgent.util.userAgent_=e||goog.labs.userAgent.util.getNativeUserAgentString_()},goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_},goog.labs.userAgent.util.matchUserAgent=function(e){var t=goog.labs.userAgent.util.getUserAgent();return goog.string.contains(t,e)},goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(e){var t=goog.labs.userAgent.util.getUserAgent();return goog.string.caseInsensitiveContains(t,e)},goog.labs.userAgent.util.extractVersionTuples=function(e){for(var t,o=new RegExp("(\\w[\\w ]+)/([^\\s]+)\\s*(?:\\((.*?)\\))?","g"),r=[];t=o.exec(e);)r.push([t[1],t[2],t[3]||void 0]);return r},goog.provide("goog.labs.userAgent.platform"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.platform.isAndroid=function(){return goog.labs.userAgent.util.matchUserAgent("Android")},goog.labs.userAgent.platform.isIpod=function(){return goog.labs.userAgent.util.matchUserAgent("iPod")},goog.labs.userAgent.platform.isIphone=function(){return goog.labs.userAgent.util.matchUserAgent("iPhone")&&!goog.labs.userAgent.util.matchUserAgent("iPod")&&!goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIpad=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIos=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpad()||goog.labs.userAgent.platform.isIpod()},goog.labs.userAgent.platform.isMacintosh=function(){return goog.labs.userAgent.util.matchUserAgent("Macintosh")},goog.labs.userAgent.platform.isLinux=function(){return goog.labs.userAgent.util.matchUserAgent("Linux")},goog.labs.userAgent.platform.isWindows=function(){return goog.labs.userAgent.util.matchUserAgent("Windows")},goog.labs.userAgent.platform.isChromeOS=function(){return goog.labs.userAgent.util.matchUserAgent("CrOS")},goog.labs.userAgent.platform.getVersion=function(){var e,t=goog.labs.userAgent.util.getUserAgent(),o="";return goog.labs.userAgent.platform.isWindows()?o=(e=/Windows (?:NT|Phone) ([0-9.]+)/.exec(t))?e[1]:"0.0":goog.labs.userAgent.platform.isIos()?o=(e=/(?:iPhone|iPod|iPad|CPU)\s+OS\s+(\S+)/.exec(t))&&e[1].replace(/_/g,"."):goog.labs.userAgent.platform.isMacintosh()?o=(e=/Mac OS X ([0-9_.]+)/.exec(t))?e[1].replace(/_/g,"."):"10":goog.labs.userAgent.platform.isAndroid()?o=(e=/Android\s+([^\);]+)(\)|;)/.exec(t))&&e[1]:goog.labs.userAgent.platform.isChromeOS()&&(o=(e=/(?:CrOS\s+(?:i686|x86_64)\s+([0-9.]+))/.exec(t))&&e[1]),o||""},goog.labs.userAgent.platform.isVersionOrHigher=function(e){return 0<=goog.string.compareVersions(goog.labs.userAgent.platform.getVersion(),e)},goog.provide("goog.crypt.Hash"),goog.crypt.Hash=function(){this.blockSize=-1},goog.crypt.Hash.prototype.reset=goog.abstractMethod,goog.crypt.Hash.prototype.update=goog.abstractMethod,goog.crypt.Hash.prototype.digest=goog.abstractMethod,goog.provide("goog.crypt.Sha1"),goog.require("goog.crypt.Hash"),goog.crypt.Sha1=function(){goog.crypt.Sha1.base(this,"constructor"),this.blockSize=64,this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.inbuf_=0,this.total_=0,this.reset()},goog.inherits(goog.crypt.Sha1,goog.crypt.Hash),goog.crypt.Sha1.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},goog.crypt.Sha1.prototype.compress_=function(e,t){t=t||0;var o=this.W_;if(goog.isString(e))for(var r=0;r<16;r++)o[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)o[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var n=o[r-3]^o[r-8]^o[r-14]^o[r-16];o[r]=4294967295&(n<<1|n>>>31)}for(var i,a=this.chain_[0],s=this.chain_[1],l=this.chain_[2],c=this.chain_[3],g=this.chain_[4],r=0;r<80;r++)var u=r<40?r<20?(i=c^s&(l^c),1518500249):(i=s^l^c,1859775393):r<60?(i=s&l|c&(s|l),2400959708):(i=s^l^c,3395469782),n=(a<<5|a>>>27)+i+g+u+o[r]&4294967295,g=c,c=l,l=4294967295&(s<<30|s>>>2),s=a,a=n;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+g&4294967295},goog.crypt.Sha1.prototype.update=function(e,t){if(null!=e){for(var o=(t=goog.isDef(t)?t:e.length)-this.blockSize,r=0,n=this.buf_,i=this.inbuf_;r<t;){if(0==i)for(;r<=o;)this.compress_(e,r),r+=this.blockSize;if(goog.isString(e)){for(;r<t;)if(n[i]=e.charCodeAt(r),++r,++i==this.blockSize){this.compress_(n),i=0;break}}else for(;r<t;)if(n[i]=e[r],++r,++i==this.blockSize){this.compress_(n),i=0;break}}this.inbuf_=i,this.total_+=t}},goog.crypt.Sha1.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var o=this.blockSize-1;56<=o;o--)this.buf_[o]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,o=0;o<5;o++)for(var n=24;0<=n;n-=8)e[r]=this.chain_[o]>>n&255,++r;return e},goog.provide("goog.asserts"),goog.provide("goog.asserts.AssertionError"),goog.require("goog.debug.Error"),goog.require("goog.dom.NodeType"),goog.require("goog.string"),goog.define("goog.asserts.ENABLE_ASSERTS",goog.DEBUG),goog.asserts.AssertionError=function(e,t){t.unshift(e),goog.debug.Error.call(this,goog.string.subs.apply(null,t)),t.shift(),this.messagePattern=e},goog.inherits(goog.asserts.AssertionError,goog.debug.Error),goog.asserts.AssertionError.prototype.name="AssertionError",goog.asserts.DEFAULT_ERROR_HANDLER=function(e){throw e},goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER,goog.asserts.doAssertFailure_=function(e,t,o,r){var n,i="Assertion failed",o=(o?(i+=": "+o,n=r):e&&(i+=": "+e,n=t),new goog.asserts.AssertionError(""+i,n||[]));goog.asserts.errorHandler_(o)},goog.asserts.setErrorHandler=function(e){goog.asserts.ENABLE_ASSERTS&&(goog.asserts.errorHandler_=e)},goog.asserts.assert=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!e&&goog.asserts.doAssertFailure_("",null,t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.fail=function(e,t){goog.asserts.ENABLE_ASSERTS&&goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1)))},goog.asserts.assertNumber=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(e)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertString=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isString(e)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertFunction=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(e)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertObject=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isObject(e)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertArray=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isArray(e)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertBoolean=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(e)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertElement=function(e,t,o){return!goog.asserts.ENABLE_ASSERTS||goog.isObject(e)&&e.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertInstanceof=function(e,t,o,r){return!goog.asserts.ENABLE_ASSERTS||e instanceof t||goog.asserts.doAssertFailure_("Expected instanceof %s but got %s.",[goog.asserts.getType_(t),goog.asserts.getType_(e)],o,Array.prototype.slice.call(arguments,3)),e},goog.asserts.assertObjectPrototypeIsIntact=function(){for(var e in Object.prototype)goog.asserts.fail(e+" should not be enumerable in Object.prototype.")},goog.asserts.getType_=function(e){return e instanceof Function?e.displayName||e.name||"unknown type name":e instanceof Object?e.constructor.displayName||e.constructor.name||Object.prototype.toString.call(e):null===e?"null":typeof e},goog.provide("goog.array"),goog.provide("goog.array.ArrayLike"),goog.require("goog.asserts"),goog.define("goog.NATIVE_ARRAY_PROTOTYPES",goog.TRUSTED_SITE),goog.define("goog.array.ASSUME_NATIVE_FUNCTIONS",!1),goog.array.ArrayLike,goog.array.peek=function(e){return e[e.length-1]},goog.array.last=goog.array.peek,goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.indexOf)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.indexOf.call(e,t,o)}:function(e,t,o){o=null==o?0:o<0?Math.max(0,e.length+o):o;if(goog.isString(e))return goog.isString(t)&&1==t.length?e.indexOf(t,o):-1;for(var r=o;r<e.length;r++)if(r in e&&e[r]===t)return r;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.lastIndexOf)?function(e,t,o){goog.asserts.assert(null!=e.length);o=null==o?e.length-1:o;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(e,t,o)}:function(e,t,o){o=null==o?e.length-1:o;if(o<0&&(o=Math.max(0,e.length+o)),goog.isString(e))return goog.isString(t)&&1==t.length?e.lastIndexOf(t,o):-1;for(var r=o;0<=r;r--)if(r in e&&e[r]===t)return r;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.forEach)?function(e,t,o){goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.forEach.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;i<r;i++)i in n&&t.call(o,n[i],i,e)},goog.array.forEachRight=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=r-1;0<=i;--i)i in n&&t.call(o,n[i],i,e)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.filter)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.filter.call(e,t,o)}:function(e,t,o){for(var r,n=e.length,i=[],a=0,s=goog.isString(e)?e.split(""):e,l=0;l<n;l++)l in s&&(r=s[l],t.call(o,r,l,e)&&(i[a++]=r));return i},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.map)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.map.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=new Array(r),i=goog.isString(e)?e.split(""):e,a=0;a<r;a++)a in i&&(n[a]=t.call(o,i[a],a,e));return n},goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduce)?function(e,t,o,r){goog.asserts.assert(null!=e.length);for(var n=[],i=1,a=arguments.length;i<a;i++)n.push(arguments[i]);return r&&(n[0]=goog.bind(t,r)),goog.array.ARRAY_PROTOTYPE_.reduce.apply(e,n)}:function(o,r,e,n){var i=e;return goog.array.forEach(o,function(e,t){i=r.call(n,i,e,t,o)}),i},goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduceRight)?function(e,t,o,r){return goog.asserts.assert(null!=e.length),r&&(t=goog.bind(t,r)),goog.array.ARRAY_PROTOTYPE_.reduceRight.call(e,t,o)}:function(o,r,e,n){var i=e;return goog.array.forEachRight(o,function(e,t){i=r.call(n,i,e,t,o)}),i},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.some)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.some.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;i<r;i++)if(i in n&&t.call(o,n[i],i,e))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.every)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.every.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;i<r;i++)if(i in n&&!t.call(o,n[i],i,e))return!1;return!0},goog.array.count=function(e,r,n){var i=0;return goog.array.forEach(e,function(e,t,o){r.call(n,e,t,o)&&++i},n),i},goog.array.find=function(e,t,o){t=goog.array.findIndex(e,t,o);return t<0?null:goog.isString(e)?e.charAt(t):e[t]},goog.array.findIndex=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;i<r;i++)if(i in n&&t.call(o,n[i],i,e))return i;return-1},goog.array.findRight=function(e,t,o){t=goog.array.findIndexRight(e,t,o);return t<0?null:goog.isString(e)?e.charAt(t):e[t]},goog.array.findIndexRight=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=r-1;0<=i;i--)if(i in n&&t.call(o,n[i],i,e))return i;return-1},goog.array.contains=function(e,t){return 0<=goog.array.indexOf(e,t)},goog.array.isEmpty=function(e){return 0==e.length},goog.array.clear=function(e){if(!goog.isArray(e))for(var t=e.length-1;0<=t;t--)delete e[t];e.length=0},goog.array.insert=function(e,t){goog.array.contains(e,t)||e.push(t)},goog.array.insertAt=function(e,t,o){goog.array.splice(e,o,0,t)},goog.array.insertArrayAt=function(e,t,o){goog.partial(goog.array.splice,e,o,0).apply(null,t)},goog.array.insertBefore=function(e,t,o){var r;2==arguments.length||(r=goog.array.indexOf(e,o))<0?e.push(t):goog.array.insertAt(e,t,r)},goog.array.remove=function(e,t){var o,t=goog.array.indexOf(e,t);return(o=0<=t)&&goog.array.removeAt(e,t),o},goog.array.removeAt=function(e,t){return goog.asserts.assert(null!=e.length),1==goog.array.ARRAY_PROTOTYPE_.splice.call(e,t,1).length},goog.array.removeIf=function(e,t,o){t=goog.array.findIndex(e,t,o);return 0<=t&&(goog.array.removeAt(e,t),!0)},goog.array.removeAllIf=function(o,r,n){var i=0;return goog.array.forEachRight(o,function(e,t){r.call(n,e,t,o)&&goog.array.removeAt(o,t)&&i++}),i},goog.array.concat=function(e){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.join=function(e){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.toArray=function(e){var t=e.length;if(0<t){for(var o=new Array(t),r=0;r<t;r++)o[r]=e[r];return o}return[]},goog.array.clone=goog.array.toArray,goog.array.extend=function(e,t){for(var o=1;o<arguments.length;o++){var r=arguments[o];if(goog.isArrayLike(r)){var n=e.length||0,i=r.length||0;e.length=n+i;for(var a=0;a<i;a++)e[n+a]=r[a]}else e.push(r)}},goog.array.splice=function(e,t,o,r){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.splice.apply(e,goog.array.slice(arguments,1))},goog.array.slice=function(e,t,o){return goog.asserts.assert(null!=e.length),arguments.length<=2?goog.array.ARRAY_PROTOTYPE_.slice.call(e,t):goog.array.ARRAY_PROTOTYPE_.slice.call(e,t,o)},goog.array.removeDuplicates=function(e,t,o){for(var r=t||e,n=o||function(e){return goog.isObject(l)?"o"+goog.getUid(l):(typeof l).charAt(0)+l},i={},a=0,s=0;s<e.length;){var l=e[s++],c=n(l);Object.prototype.hasOwnProperty.call(i,c)||(i[c]=!0,r[a++]=l)}r.length=a},goog.array.binarySearch=function(e,t,o){return goog.array.binarySearch_(e,o||goog.array.defaultCompare,!1,t)},goog.array.binarySelect=function(e,t,o){return goog.array.binarySearch_(e,t,!0,void 0,o)},goog.array.binarySearch_=function(e,t,o,r,n){for(var i,a=0,s=e.length;a<s;){var l=a+s>>1,c=o?t.call(n,e[l],l,e):t(r,e[l]);0<c?a=1+l:(s=l,i=!c)}return i?a:~a},goog.array.sort=function(e,t){e.sort(t||goog.array.defaultCompare)},goog.array.stableSort=function(e,t){for(var o=0;o<e.length;o++)e[o]={index:o,value:e[o]};var r=t||goog.array.defaultCompare;goog.array.sort(e,function(e,t){return r(e.value,t.value)||e.index-t.index});for(o=0;o<e.length;o++)e[o]=e[o].value},goog.array.sortByKey=function(e,o,t){var r=t||goog.array.defaultCompare;goog.array.sort(e,function(e,t){return r(o(e),o(t))})},goog.array.sortObjectsByKey=function(e,t,o){goog.array.sortByKey(e,function(e){return e[t]},o)},goog.array.isSorted=function(e,t,o){for(var r=t||goog.array.defaultCompare,n=1;n<e.length;n++){var i=r(e[n-1],e[n]);if(0<i||0==i&&o)return!1}return!0},goog.array.equals=function(e,t,o){if(!goog.isArrayLike(e)||!goog.isArrayLike(t)||e.length!=t.length)return!1;for(var r=e.length,n=o||goog.array.defaultCompareEquality,i=0;i<r;i++)if(!n(e[i],t[i]))return!1;return!0},goog.array.compare3=function(e,t,o){for(var r=o||goog.array.defaultCompare,n=Math.min(e.length,t.length),i=0;i<n;i++){var a=r(e[i],t[i]);if(0!=a)return a}return goog.array.defaultCompare(e.length,t.length)},goog.array.defaultCompare=function(e,t){return t<e?1:e<t?-1:0},goog.array.inverseDefaultCompare=function(e,t){return-goog.array.defaultCompare(e,t)},goog.array.defaultCompareEquality=function(e,t){return e===t},goog.array.binaryInsert=function(e,t,o){o=goog.array.binarySearch(e,t,o);return o<0&&(goog.array.insertAt(e,t,-(o+1)),!0)},goog.array.binaryRemove=function(e,t,o){t=goog.array.binarySearch(e,t,o);return 0<=t&&goog.array.removeAt(e,t)},goog.array.bucket=function(e,t,o){for(var r={},n=0;n<e.length;n++){var i=e[n],a=t.call(o,i,n,e);goog.isDef(a)&&(r[a]||(r[a]=[])).push(i)}return r},goog.array.toObject=function(o,r,n){var i={};return goog.array.forEach(o,function(e,t){i[r.call(n,e,t,o)]=e}),i},goog.array.range=function(e,t,o){var r=[],n=0,i=e,a=o||1;if(void 0!==t&&(n=e,i=t),a*(i-n)<0)return[];if(0<a)for(var s=n;s<i;s+=a)r.push(s);else for(s=n;i<s;s+=a)r.push(s);return r},goog.array.repeat=function(e,t){for(var o=[],r=0;r<t;r++)o[r]=e;return o},goog.array.flatten=function(e){for(var t=[],o=0;o<arguments.length;o++){var r=arguments[o];if(goog.isArray(r))for(var n=0;n<r.length;n+=8192)for(var i=goog.array.slice(r,n,n+8192),a=goog.array.flatten.apply(null,i),s=0;s<a.length;s++)t.push(a[s]);else t.push(r)}return t},goog.array.rotate=function(e,t){return goog.asserts.assert(null!=e.length),e.length&&(0<(t%=e.length)?goog.array.ARRAY_PROTOTYPE_.unshift.apply(e,e.splice(-t,t)):t<0&&goog.array.ARRAY_PROTOTYPE_.push.apply(e,e.splice(0,-t))),e},goog.array.moveItem=function(e,t,o){goog.asserts.assert(0<=t&&t<e.length),goog.asserts.assert(0<=o&&o<e.length);t=goog.array.ARRAY_PROTOTYPE_.splice.call(e,t,1);goog.array.ARRAY_PROTOTYPE_.splice.call(e,o,0,t[0])},goog.array.zip=function(e){if(!arguments.length)return[];for(var t=[],o=0;;o++){for(var r=[],n=0;n<arguments.length;n++){var i=arguments[n];if(o>=i.length)return t;r.push(i[o])}t.push(r)}},goog.array.shuffle=function(e,t){for(var o=t||Math.random,r=e.length-1;0<r;r--){var n=Math.floor(o()*(r+1)),i=e[r];e[r]=e[n],e[n]=i}},goog.array.copyByIndex=function(t,e){var o=[];return goog.array.forEach(e,function(e){o.push(t[e])}),o},goog.provide("goog.labs.userAgent.browser"),goog.require("goog.array"),goog.require("goog.labs.userAgent.util"),goog.require("goog.object"),goog.require("goog.string"),goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")||goog.labs.userAgent.util.matchUserAgent("OPR")},goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")},goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!(goog.labs.userAgent.browser.matchChrome_()||goog.labs.userAgent.browser.matchCoast_()||goog.labs.userAgent.browser.matchOpera_()||goog.labs.userAgent.browser.isSilk()||goog.labs.userAgent.util.matchUserAgent("Android"))},goog.labs.userAgent.browser.matchCoast_=function(){return goog.labs.userAgent.util.matchUserAgent("Coast")},goog.labs.userAgent.browser.matchIosWebview_=function(){return(goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("iPhone"))&&!goog.labs.userAgent.browser.matchSafari_()&&!goog.labs.userAgent.browser.matchChrome_()&&!goog.labs.userAgent.browser.matchCoast_()&&goog.labs.userAgent.util.matchUserAgent("AppleWebKit")},goog.labs.userAgent.browser.matchChrome_=function(){return(goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS"))&&!goog.labs.userAgent.browser.matchOpera_()},goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return goog.labs.userAgent.util.matchUserAgent("Android")&&!(goog.labs.userAgent.browser.isChrome()||goog.labs.userAgent.browser.isFirefox()||goog.labs.userAgent.browser.isOpera()||goog.labs.userAgent.browser.isSilk())},goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_,goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_,goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_,goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_,goog.labs.userAgent.browser.isCoast=goog.labs.userAgent.browser.matchCoast_,goog.labs.userAgent.browser.isIosWebview=goog.labs.userAgent.browser.matchIosWebview_,goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_,goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_,goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")},goog.labs.userAgent.browser.getVersion=function(){var o,t,e=goog.labs.userAgent.util.getUserAgent();return goog.labs.userAgent.browser.isIE()?goog.labs.userAgent.browser.getIEVersion_(e):(e=goog.labs.userAgent.util.extractVersionTuples(e),o={},goog.array.forEach(e,function(e){var t=e[0],e=e[1];o[t]=e}),t=goog.partial(goog.object.containsKey,o),goog.labs.userAgent.browser.isOpera()?r(["Version","Opera","OPR"]):goog.labs.userAgent.browser.isChrome()?r(["Chrome","CriOS"]):(e=e[2])&&e[1]||"");function r(e){e=goog.array.find(e,t);return o[e]||""}},goog.labs.userAgent.browser.isVersionOrHigher=function(e){return 0<=goog.string.compareVersions(goog.labs.userAgent.browser.getVersion(),e)},goog.labs.userAgent.browser.getIEVersion_=function(e){var t=/rv: *([\d\.]*)/.exec(e);if(t&&t[1])return t[1];var o="",t=/MSIE +([\d\.]+)/.exec(e);if(t&&t[1]){e=/Trident\/(\d.\d)/.exec(e);if("7.0"==t[1])if(e&&e[1])switch(e[1]){case"4.0":o="8.0";break;case"5.0":o="9.0";break;case"6.0":o="10.0";break;case"7.0":o="11.0"}else o="7.0";else o=t[1]}return o},goog.provide("goog.labs.userAgent.engine"),goog.require("goog.array"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")},goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")},goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()},goog.labs.userAgent.engine.getVersion=function(){var e=goog.labs.userAgent.util.getUserAgent();if(e){var e=goog.labs.userAgent.util.extractVersionTuples(e),t=e[1];if(t)return"Gecko"==t[0]?goog.labs.userAgent.engine.getVersionForKey_(e,"Firefox"):t[1];t=e[0];if(t&&(e=t[2])){t=/Trident\/([^\s;]+)/.exec(e);if(t)return t[1]}}return""},goog.labs.userAgent.engine.isVersionOrHigher=function(e){return 0<=goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),e)},goog.labs.userAgent.engine.getVersionForKey_=function(e,t){e=goog.array.find(e,function(e){return t==e[0]});return e&&e[1]||""},goog.provide("goog.crypt"),goog.require("goog.array"),goog.require("goog.asserts"),goog.crypt.stringToByteArray=function(e){for(var t=[],o=0,r=0;r<e.length;r++){for(var n=e.charCodeAt(r);255<n;)t[o++]=255&n,n>>=8;t[o++]=n}return t},goog.crypt.byteArrayToString=function(e){if(e.length<8192)return String.fromCharCode.apply(null,e);for(var t="",o=0;o<e.length;o+=8192){var r=goog.array.slice(e,o,o+8192);t+=String.fromCharCode.apply(null,r)}return t},goog.crypt.byteArrayToHex=function(e){return goog.array.map(e,function(e){e=e.toString(16);return 1<e.length?e:"0"+e}).join("")},goog.crypt.hexToByteArray=function(e){goog.asserts.assert(e.length%2==0,"Key string length must be multiple of 2");for(var t=[],o=0;o<e.length;o+=2)t.push(parseInt(e.substring(o,o+2),16));return t},goog.crypt.stringToUtf8ByteArray=function(e){e=e.replace(/\r\n/g,"\n");for(var t=[],o=0,r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t[o++]=n:(n<2048?t[o++]=n>>6|192:(t[o++]=n>>12|224,t[o++]=n>>6&63|128),t[o++]=63&n|128)}return t},goog.crypt.utf8ByteArrayToString=function(e){for(var t=[],o=0,r=0;o<e.length;){var n,i,a=e[o++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(n=e[o++],t[r++]=String.fromCharCode((31&a)<<6|63&n)):(n=e[o++],i=e[o++],t[r++]=String.fromCharCode((15&a)<<12|(63&n)<<6|63&i))}return t.join("")},goog.crypt.xorByteArray=function(e,t){goog.asserts.assert(e.length==t.length,"XOR array lengths must match");for(var o=[],r=0;r<e.length;r++)o.push(e[r]^t[r]);return o},goog.provide("goog.userAgent"),goog.require("goog.labs.userAgent.browser"),goog.require("goog.labs.userAgent.engine"),goog.require("goog.labs.userAgent.platform"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.define("goog.userAgent.ASSUME_IE",!1),goog.define("goog.userAgent.ASSUME_GECKO",!1),goog.define("goog.userAgent.ASSUME_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_MOBILE_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_OPERA",!1),goog.define("goog.userAgent.ASSUME_ANY_VERSION",!1),goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA,goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()},goog.userAgent.getNavigator=function(){return goog.global.navigator||null},goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera(),goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE(),goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko(),goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit(),goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")},goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_(),goog.userAgent.SAFARI=goog.userAgent.WEBKIT,goog.userAgent.determinePlatform_=function(){var e=goog.userAgent.getNavigator();return e&&e.platform||""},goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_(),goog.define("goog.userAgent.ASSUME_MAC",!1),goog.define("goog.userAgent.ASSUME_WINDOWS",!1),goog.define("goog.userAgent.ASSUME_LINUX",!1),goog.define("goog.userAgent.ASSUME_X11",!1),goog.define("goog.userAgent.ASSUME_ANDROID",!1),goog.define("goog.userAgent.ASSUME_IPHONE",!1),goog.define("goog.userAgent.ASSUME_IPAD",!1),goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD,goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.labs.userAgent.platform.isMacintosh(),goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.labs.userAgent.platform.isWindows(),goog.userAgent.isLegacyLinux_=function(){return goog.labs.userAgent.platform.isLinux()||goog.labs.userAgent.platform.isChromeOS()},goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.isLegacyLinux_(),goog.userAgent.isX11_=function(){var e=goog.userAgent.getNavigator();return!!e&&goog.string.contains(e.appVersion||"","X11")},goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.isX11_(),goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.labs.userAgent.platform.isAndroid(),goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.labs.userAgent.platform.isIphone(),goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad(),goog.userAgent.determineVersion_=function(){var e,t="";if(goog.userAgent.OPERA&&goog.global.opera)return e=goog.global.opera.version,goog.isFunction(e)?e():e;if(goog.userAgent.GECKO?o=/rv\:([^\);]+)(\)|;)/:goog.userAgent.IE?o=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:goog.userAgent.WEBKIT&&(o=/WebKit\/(\S+)/),o&&(t=(e=o.exec(goog.userAgent.getUserAgentString()))?e[1]:""),goog.userAgent.IE){var o=goog.userAgent.getDocumentMode_();if(o>parseFloat(t))return String(o)}return t},goog.userAgent.getDocumentMode_=function(){var e=goog.global.document;return e?e.documentMode:void 0},goog.userAgent.VERSION=goog.userAgent.determineVersion_(),goog.userAgent.compare=function(e,t){return goog.string.compareVersions(e,t)},goog.userAgent.isVersionOrHigherCache_={},goog.userAgent.isVersionOrHigher=function(e){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[e]||(goog.userAgent.isVersionOrHigherCache_[e]=0<=goog.string.compareVersions(goog.userAgent.VERSION,e))},goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher,goog.userAgent.isDocumentModeOrHigher=function(e){return goog.userAgent.IE&&goog.userAgent.DOCUMENT_MODE>=e},goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher,goog.userAgent.DOCUMENT_MODE=function(){var e=goog.global.document;if(e&&goog.userAgent.IE)return goog.userAgent.getDocumentMode_()||("CSS1Compat"==e.compatMode?parseInt(goog.userAgent.VERSION,10):5)}(),goog.provide("goog.crypt.base64"),goog.require("goog.crypt"),goog.require("goog.userAgent"),goog.crypt.base64.byteToCharMap_=null,goog.crypt.base64.charToByteMap_=null,goog.crypt.base64.byteToCharMapWebSafe_=null,goog.crypt.base64.charToByteMapWebSafe_=null,goog.crypt.base64.ENCODED_VALS_BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",goog.crypt.base64.ENCODED_VALS=goog.crypt.base64.ENCODED_VALS_BASE+"+/=",goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.ENCODED_VALS_BASE+"-_.",goog.crypt.base64.HAS_NATIVE_SUPPORT=goog.userAgent.GECKO||goog.userAgent.WEBKIT||goog.userAgent.OPERA||"function"==typeof goog.global.atob,goog.crypt.base64.encodeByteArray=function(e,t){if(!goog.isArrayLike(e))throw Error("encodeByteArray takes an array as a parameter");goog.crypt.base64.init_();for(var o=t?goog.crypt.base64.byteToCharMapWebSafe_:goog.crypt.base64.byteToCharMap_,r=[],n=0;n<e.length;n+=3){var i=e[n],a=n+1<e.length,s=a?e[n+1]:0,l=n+2<e.length,c=l?e[n+2]:0,g=(15&s)<<2|c>>6,c=63&c;l||(c=64,a||(g=64)),r.push(o[i>>2],o[(3&i)<<4|s>>4],o[g],o[c])}return r.join("")},goog.crypt.base64.encodeString=function(e,t){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!t?goog.global.btoa(e):goog.crypt.base64.encodeByteArray(goog.crypt.stringToByteArray(e),t)},goog.crypt.base64.decodeString=function(e,t){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!t?goog.global.atob(e):goog.crypt.byteArrayToString(goog.crypt.base64.decodeStringToByteArray(e,t))},goog.crypt.base64.decodeStringToByteArray=function(e,t){goog.crypt.base64.init_();for(var o=t?goog.crypt.base64.charToByteMapWebSafe_:goog.crypt.base64.charToByteMap_,r=[],n=0;n<e.length;){var i=o[e.charAt(n++)],a=n<e.length?o[e.charAt(n)]:0,s=++n<e.length?o[e.charAt(n)]:64,l=++n<e.length?o[e.charAt(n)]:64;if(++n,null==i||null==a||null==s||null==l)throw Error();r.push(i<<2|a>>4),64!=s&&(r.push(a<<4&240|s>>2),64!=l&&r.push(s<<6&192|l))}return r},goog.crypt.base64.init_=function(){if(!goog.crypt.base64.byteToCharMap_){goog.crypt.base64.byteToCharMap_={},goog.crypt.base64.charToByteMap_={},goog.crypt.base64.byteToCharMapWebSafe_={},goog.crypt.base64.charToByteMapWebSafe_={};for(var e=0;e<goog.crypt.base64.ENCODED_VALS.length;e++)goog.crypt.base64.byteToCharMap_[e]=goog.crypt.base64.ENCODED_VALS.charAt(e),goog.crypt.base64.charToByteMap_[goog.crypt.base64.byteToCharMap_[e]]=e,goog.crypt.base64.byteToCharMapWebSafe_[e]=goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(e),(goog.crypt.base64.charToByteMapWebSafe_[goog.crypt.base64.byteToCharMapWebSafe_[e]]=e)>=goog.crypt.base64.ENCODED_VALS_BASE.length&&(goog.crypt.base64.charToByteMap_[goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(e)]=e,goog.crypt.base64.charToByteMapWebSafe_[goog.crypt.base64.ENCODED_VALS.charAt(e)]=e)}},goog.provide("fb.constants"),!1),CLIENT_VERSION_DEFINE="0.0.0",CLIENT_VERSION=CLIENT_VERSION||CLIENT_VERSION_DEFINE,FIRST_STATS_MIN_TIME=(goog.provide("fb.util.obj"),fb.util.obj.contains=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},fb.util.obj.get=function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},fb.util.obj.foreach=function(e,t){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t(o,e[o])},fb.util.obj.clone=function(e){var o={};return fb.util.obj.foreach(e,function(e,t){o[e]=t}),o},goog.provide("fb.util"),goog.require("fb.util.obj"),fb.util.querystring=function(e){var o=[];return fb.util.obj.foreach(e,function(t,e){goog.isArray(e)?goog.array.forEach(e,function(e){o.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}):o.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),o.length?"&"+o.join("&"):""},fb.util.querystringDecode=function(e){var t={},e=e.replace(/^\?/,"").split("&");return goog.array.forEach(e,function(e){e&&(e=e.split("="),t[e[0]]=e[1])}),t},goog.provide("fb.util.validation"),fb.util.validation.validateArgCount=function(e,t,o,r){var n;if(r<t?n="at least "+t:o<r&&(n=0===o?"none":"no more than "+o),n)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+n+".")},fb.util.validation.errorPrefix=function(e,t,o){var r="";switch(t){case 1:r=o?"first":"First";break;case 2:r=o?"second":"Second";break;case 3:r=o?"third":"Third";break;case 4:r=o?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}t=e+" failed: ";return t+=r+" argument "},fb.util.validation.validateNamespace=function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isString(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid firebase namespace.")},fb.util.validation.validateCallback=function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isFunction(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid function.")},fb.util.validation.validateContextObject=function(e,t,o,r){if((!r||goog.isDef(o))&&(!goog.isObject(o)||null===o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid context object.")},goog.provide("fb.util.json"),goog.require("goog.json"),fb.util.json.eval=function(e){return("undefined"!=typeof JSON&&goog.isDef(JSON.parse)?JSON:goog.json).parse(e)},fb.util.json.stringify=function(e){return"undefined"!=typeof JSON&&goog.isDef(JSON.stringify)?JSON.stringify(e):goog.json.serialize(e)},goog.provide("fb.core.SnapshotHolder"),fb.core.SnapshotHolder=function(){this.rootNode_=fb.core.snap.EMPTY_NODE},fb.core.SnapshotHolder.prototype.getNode=function(e){return this.rootNode_.getChild(e)},fb.core.SnapshotHolder.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},goog.DEBUG&&(fb.core.SnapshotHolder.prototype.toString=function(){return this.rootNode_.toString()}),goog.provide("fb.core.view.CompleteChildSource"),fb.core.view.CompleteChildSource=function(){},fb.core.view.CompleteChildSource.prototype.getCompleteChild=function(e){},fb.core.view.CompleteChildSource.prototype.getChildAfterChild=function(e,t,o){},fb.core.view.NoCompleteChildSource_=function(){},fb.core.view.NoCompleteChildSource_.prototype.getCompleteChild=function(){return null},fb.core.view.NoCompleteChildSource_.prototype.getChildAfterChild=function(){return null},fb.core.view.NO_COMPLETE_CHILD_SOURCE=new fb.core.view.NoCompleteChildSource_,fb.core.view.WriteTreeCompleteChildSource=function(e,t,o){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=o},fb.core.view.WriteTreeCompleteChildSource.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();return t.isCompleteForChild(e)?t.getNode().getImmediateChild(e):(t=null!=this.optCompleteServerCache_?new fb.core.view.CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache(),this.writes_.calcCompleteChild(e,t))},fb.core.view.WriteTreeCompleteChildSource.prototype.getChildAfterChild=function(e,t,o){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),r=this.writes_.calcIndexedSlice(r,t,1,o,e);return 0===r.length?null:r[0]},goog.provide("fb.core.view.EventQueue"),fb.core.view.EventQueue=function(){this.eventLists_=[],this.recursionDepth_=0},fb.core.view.EventQueue.prototype.queueEvents=function(e){for(var t=null,o=0;o<e.length;o++){var r=e[o],n=r.getPath();null===t||n.equals(t.getPath())||(this.eventLists_.push(t),t=null),(t=null===t?new fb.core.view.EventList(n):t).add(r)}t&&this.eventLists_.push(t)},fb.core.view.EventQueue.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},fb.core.view.EventQueue.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},fb.core.view.EventQueue.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,o=0;o<this.eventLists_.length;o++){var r=this.eventLists_[o];r&&(e(r.getPath())?(this.eventLists_[o].raise(),this.eventLists_[o]=null):t=!1)}t&&(this.eventLists_=[]),this.recursionDepth_--},fb.core.view.EventList=function(e){this.path_=e,this.events_=[]},fb.core.view.EventList.prototype.add=function(e){this.events_.push(e)},fb.core.view.EventList.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t,o=this.events_[e];null!==o&&(this.events_[e]=null,t=o.getEventRunner(),fb.core.util.logger&&fb.core.util.log("event: "+o.toString()),fb.core.util.exceptionGuard(t))}},fb.core.view.EventList.prototype.getPath=function(){return this.path_},goog.provide("fb.core.view.Change"),fb.core.view.Change=function(e,t,o,r,n){this.type=e,this.snapshotNode=t,this.childName=o,this.oldSnap=r,this.prevName=n},fb.core.view.Change.valueChange=function(e){return new fb.core.view.Change(fb.core.view.Change.VALUE,e)},fb.core.view.Change.childAddedChange=function(e,t){return new fb.core.view.Change(fb.core.view.Change.CHILD_ADDED,t,e)},fb.core.view.Change.childRemovedChange=function(e,t){return new fb.core.view.Change(fb.core.view.Change.CHILD_REMOVED,t,e)},fb.core.view.Change.childChangedChange=function(e,t,o){return new fb.core.view.Change(fb.core.view.Change.CHILD_CHANGED,t,e,o)},fb.core.view.Change.childMovedChange=function(e,t){return new fb.core.view.Change(fb.core.view.Change.CHILD_MOVED,t,e)},fb.core.view.Change.prototype.changeWithPrevName=function(e){return new fb.core.view.Change(this.type,this.snapshotNode,this.childName,this.oldSnap,e)},fb.core.view.Change.CHILD_ADDED="child_added",fb.core.view.Change.CHILD_REMOVED="child_removed",fb.core.view.Change.CHILD_CHANGED="child_changed",fb.core.view.Change.CHILD_MOVED="child_moved",fb.core.view.Change.VALUE="value",goog.provide("fb.core.view.Event"),fb.core.view.Event=function(){},fb.core.view.Event.prototype.getPath,fb.core.view.Event.prototype.getEventType,fb.core.view.Event.prototype.getEventRunner,fb.core.view.Event.prototype.toString,fb.core.view.DataEvent=function(e,t,o,r){this.eventRegistration=t,this.snapshot=o,this.prevName=r,this.eventType=e},fb.core.view.DataEvent.prototype.getPath=function(){var e=this.snapshot.ref();return("value"===this.eventType?e:e.parent()).path},fb.core.view.DataEvent.prototype.getEventType=function(){return this.eventType},fb.core.view.DataEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},fb.core.view.DataEvent.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+fb.util.json.stringify(this.snapshot.exportVal())},fb.core.view.CancelEvent=function(e,t,o){this.eventRegistration=e,this.error=t,this.path=o},fb.core.view.CancelEvent.prototype.getPath=function(){return this.path},fb.core.view.CancelEvent.prototype.getEventType=function(){return"cancel"},fb.core.view.CancelEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},fb.core.view.CancelEvent.prototype.toString=function(){return this.path.toString()+":cancel"},goog.provide("fb.core.view.CacheNode"),fb.core.view.CacheNode=function(e,t,o){this.node_=e,this.fullyInitialized_=t,this.filtered_=o},fb.core.view.CacheNode.prototype.isFullyInitialized=function(){return this.fullyInitialized_},fb.core.view.CacheNode.prototype.isFiltered=function(){return this.filtered_},fb.core.view.CacheNode.prototype.isCompleteForPath=function(e){return e.isEmpty()?this.isFullyInitialized()&&!this.filtered_:(e=e.getFront(),this.isCompleteForChild(e))},fb.core.view.CacheNode.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},fb.core.view.CacheNode.prototype.getNode=function(){return this.node_},goog.provide("fb.core.stats.StatsListener"),fb.core.stats.StatsListener=function(e){this.collection_=e,this.last_=null},fb.core.stats.StatsListener.prototype.get=function(){var e=this.collection_.get(),t=goog.object.clone(e);if(this.last_)for(var o in this.last_)t[o]=t[o]-this.last_[o];return this.last_=e,t},goog.provide("fb.core.stats.StatsReporter"),1e4),FIRST_STATS_MAX_TIME=3e4,REPORT_STATS_INTERVAL=3e5,USE_HINZE=(fb.core.stats.StatsReporter=function(e,t){this.statsToReport_={},this.statsListener_=new fb.core.stats.StatsListener(e),this.server_=t;e=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();setTimeout(goog.bind(this.reportStats_,this),Math.floor(e))},fb.core.stats.StatsReporter.prototype.includeStat=function(e){this.statsToReport_[e]=!0},fb.core.stats.StatsReporter.prototype.reportStats_=function(){var e,t=this.statsListener_.get(),o={},r=!1;for(e in t)0<t[e]&&fb.util.obj.contains(this.statsToReport_,e)&&(o[e]=t[e],r=!0);r&&this.server_.reportStats(o),setTimeout(goog.bind(this.reportStats_,this),Math.floor(2*Math.random()*REPORT_STATS_INTERVAL))},goog.provide("fb.core.stats.StatsCollection"),goog.require("fb.util.obj"),goog.require("goog.array"),goog.require("goog.object"),fb.core.stats.StatsCollection=function(){this.counters_={}},fb.core.stats.StatsCollection.prototype.incrementCounter=function(e,t){goog.isDef(t)||(t=1),fb.util.obj.contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},fb.core.stats.StatsCollection.prototype.get=function(){return goog.object.clone(this.counters_)},goog.provide("fb.core.stats.StatsManager"),goog.require("fb.core.stats.StatsCollection"),goog.require("fb.core.stats.StatsListener"),goog.require("fb.core.stats.StatsReporter"),fb.core.stats.StatsManager={},fb.core.stats.StatsManager.collections_={},fb.core.stats.StatsManager.reporters_={},fb.core.stats.StatsManager.getCollection=function(e){e=e.toString();return fb.core.stats.StatsManager.collections_[e]||(fb.core.stats.StatsManager.collections_[e]=new fb.core.stats.StatsCollection),fb.core.stats.StatsManager.collections_[e]},fb.core.stats.StatsManager.getOrCreateReporter=function(e,t){e=e.toString();return fb.core.stats.StatsManager.reporters_[e]||(fb.core.stats.StatsManager.reporters_[e]=t()),fb.core.stats.StatsManager.reporters_[e]},goog.provide("fb.core.ServerActions"),fb.core.ServerActions=goog.defineClass(null,{listen:goog.abstractMethod,unlisten:goog.abstractMethod,put:goog.abstractMethod,merge:goog.abstractMethod,auth:goog.abstractMethod,unauth:goog.abstractMethod,onDisconnectPut:goog.abstractMethod,onDisconnectMerge:goog.abstractMethod,onDisconnectCancel:goog.abstractMethod,reportStats:goog.abstractMethod}),goog.provide("fb.core.snap.Node"),goog.provide("fb.core.snap.NamedNode"),fb.core.snap.Node=function(){},fb.core.snap.Node.prototype.isLeafNode,fb.core.snap.Node.prototype.getPriority,fb.core.snap.Node.prototype.updatePriority,fb.core.snap.Node.prototype.getImmediateChild,fb.core.snap.Node.prototype.getChild,fb.core.snap.Node.prototype.getPredecessorChildName,fb.core.snap.Node.prototype.updateImmediateChild,fb.core.snap.Node.prototype.updateChild,fb.core.snap.Node.prototype.hasChild,fb.core.snap.Node.prototype.isEmpty,fb.core.snap.Node.prototype.numChildren,fb.core.snap.Node.prototype.forEachChild,fb.core.snap.Node.prototype.val,fb.core.snap.Node.prototype.hash,fb.core.snap.Node.prototype.compareTo,fb.core.snap.Node.prototype.equals,fb.core.snap.Node.prototype.withIndex,fb.core.snap.Node.prototype.isIndexed,fb.core.snap.NamedNode=function(e,t){this.name=e,this.node=t},fb.core.snap.NamedNode.Wrap=function(e,t){return new fb.core.snap.NamedNode(e,t)},goog.provide("fb.core.snap.comparators"),fb.core.snap.NAME_ONLY_COMPARATOR=function(e,t){return fb.core.util.nameCompare(e.name,t.name)},fb.core.snap.NAME_COMPARATOR=function(e,t){return fb.core.util.nameCompare(e,t)},goog.provide("fb.core.operation.Overwrite"),fb.core.operation.Overwrite=function(e,t,o){this.type=fb.core.OperationType.OVERWRITE,this.source=e,this.path=t,this.snap=o},fb.core.operation.Overwrite.prototype.operationForChild=function(e){return this.path.isEmpty()?new fb.core.operation.Overwrite(this.source,fb.core.util.Path.Empty,this.snap.getImmediateChild(e)):new fb.core.operation.Overwrite(this.source,this.path.popFront(),this.snap)},goog.DEBUG&&(fb.core.operation.Overwrite.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" overwrite: "+this.snap.toString()+")"}),goog.provide("fb.core.operation.ListenComplete"),fb.core.operation.ListenComplete=function(e,t){this.type=fb.core.OperationType.LISTEN_COMPLETE,this.source=e,this.path=t},fb.core.operation.ListenComplete.prototype.operationForChild=function(e){return this.path.isEmpty()?new fb.core.operation.ListenComplete(this.source,fb.core.util.Path.Empty):new fb.core.operation.ListenComplete(this.source,this.path.popFront())},goog.DEBUG&&(fb.core.operation.ListenComplete.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" listen_complete)"}),goog.provide("fb.core.util.SortedMap"),goog.require("goog.array"),fb.Comparator,fb.core.util.SortedMap=goog.defineClass(null,{constructor:function(e,t){this.comparator_=e,this.root_=t||fb.core.util.SortedMap.EMPTY_NODE_},insert:function(e,t){return new fb.core.util.SortedMap(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,fb.LLRBNode.BLACK,null,null))},remove:function(e){return new fb.core.util.SortedMap(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,fb.LLRBNode.BLACK,null,null))},get:function(e){for(var t,o=this.root_;!o.isEmpty();){if(0===(t=this.comparator_(e,o.key)))return o.value;t<0?o=o.left:0<t&&(o=o.right)}return null},getPredecessorKey:function(e){for(var t,o=this.root_,r=null;!o.isEmpty();){if(0===(t=this.comparator_(e,o.key))){if(o.left.isEmpty())return r?r.key:null;for(o=o.left;!o.right.isEmpty();)o=o.right;return o.key}t<0?o=o.left:0<t&&(o=(r=o).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},isEmpty:function(){return this.root_.isEmpty()},count:function(){return this.root_.count()},minKey:function(){return this.root_.minKey()},maxKey:function(){return this.root_.maxKey()},inorderTraversal:function(e){return this.root_.inorderTraversal(e)},reverseTraversal:function(e){return this.root_.reverseTraversal(e)},getIterator:function(e){return new fb.core.util.SortedMapIterator(this.root_,null,this.comparator_,!1,e)},getIteratorFrom:function(e,t){return new fb.core.util.SortedMapIterator(this.root_,e,this.comparator_,!1,t)},getReverseIteratorFrom:function(e,t){return new fb.core.util.SortedMapIterator(this.root_,e,this.comparator_,!0,t)},getReverseIterator:function(e){return new fb.core.util.SortedMapIterator(this.root_,null,this.comparator_,!0,e)}}),fb.core.util.SortedMapIterator=goog.defineClass(null,{constructor:function(e,t,o,r,n){this.resultGenerator_=n||null,this.isReverse_=r,this.nodeStack_=[];for(var i=1;!e.isEmpty();)if(i=t?o(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse_?e.left:e.right;else{if(0===i){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}},getNext:function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_.pop(),t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value};if(this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},hasNext:function(){return 0<this.nodeStack_.length},peek:function(){var e;return 0===this.nodeStack_.length?null:(e=goog.array.peek(this.nodeStack_),this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value})}}),fb.LLRBNode=goog.defineClass(null,{constructor:function(e,t,o,r,n){this.key=e,this.value=t,this.color=null!=o?o:fb.LLRBNode.RED,this.left=null!=r?r:fb.core.util.SortedMap.EMPTY_NODE_,this.right=null!=n?n:fb.core.util.SortedMap.EMPTY_NODE_},statics:{RED:!0,BLACK:!1},copy:function(e,t,o,r,n){return new fb.LLRBNode(null!=e?e:this.key,null!=t?t:this.value,null!=o?o:this.color,null!=r?r:this.left,null!=n?n:this.right)},count:function(){return this.left.count()+1+this.right.count()},isEmpty:function(){return!1},inorderTraversal:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},reverseTraversal:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},min_:function(){return this.left.isEmpty()?this:this.left.min_()},minKey:function(){return this.min_().key},maxKey:function(){return this.right.isEmpty()?this.key:this.right.maxKey()},insert:function(e,t,o){var r=this,n=o(e,r.key);return(r=n<0?r.copy(null,null,null,r.left.insert(e,t,o),null):0===n?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,o))).fixUp_()},removeMin_:function(){var e;return this.left.isEmpty()?fb.core.util.SortedMap.EMPTY_NODE_:(e=(e=(e=this).left.isRed_()||e.left.left.isRed_()?e:e.moveRedLeft_()).copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},remove:function(e,t){var o,r=this;if(t(e,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed_()||r.left.left.isRed_()?r:r.moveRedLeft_()).copy(null,null,null,r.left.remove(e,t),null);else{if(0===t(e,(r=(r=r.left.isRed_()?r.rotateRight_():r).right.isEmpty()||r.right.isRed_()||r.right.left.isRed_()?r:r.moveRedRight_()).key)){if(r.right.isEmpty())return fb.core.util.SortedMap.EMPTY_NODE_;o=r.right.min_(),r=r.copy(o.key,o.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()},isRed_:function(){return this.color},fixUp_:function(){var e=this;return e=(e=(e=e.right.isRed_()&&!e.left.isRed_()?e.rotateLeft_():e).left.isRed_()&&e.left.left.isRed_()?e.rotateRight_():e).left.isRed_()&&e.right.isRed_()?e.colorFlip_():e},moveRedLeft_:function(){var e=this.colorFlip_();return e=e.right.left.isRed_()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_():e},moveRedRight_:function(){var e=this.colorFlip_();return e=e.left.left.isRed_()?(e=e.rotateRight_()).colorFlip_():e},rotateLeft_:function(){var e=this.copy(null,null,fb.LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},rotateRight_:function(){var e=this.copy(null,null,fb.LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},colorFlip_:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},checkMaxDepth_:function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},check_:function(){var e;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((e=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}),fb.LLRBEmptyNode=goog.defineClass(null,{constructor:function(){},copy:function(){return this},insert:function(e,t,o){return new fb.LLRBNode(e,t,null)},remove:function(e,t){return this},count:function(){return 0},isEmpty:function(){return!0},inorderTraversal:function(e){return!1},reverseTraversal:function(e){return!1},minKey:function(){return null},maxKey:function(){return null},check_:function(){return 0},isRed_:function(){return!1}}),fb.core.util.SortedMap.EMPTY_NODE_=new fb.LLRBEmptyNode,goog.provide("fb.core.util.NodePatches"),!function(){function l(e,t,o){this.chunk=e,this.encoding=t,this.callback=o}var e;!NODE_CLIENT||"v0.10.22"!==(e=process.version)&&"v0.10.23"!==e&&"v0.10.24"!==e||((e=require("_stream_writable")).prototype.write=function(e,t,o){var r,n,i,a=this._writableState,s=!1;return"function"==typeof t&&(o=t,t=null),t=Buffer.isBuffer(e)?"buffer":t||a.defaultEncoding,"function"!=typeof o&&(o=function(){}),a.ended?(r=this,n=o,i=new Error("write after end"),r.emit("error",i),process.nextTick(function(){n(i)})):function(e,t,o,r){var n=!0;{var i;Buffer.isBuffer(o)||"string"==typeof o||null==o||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"),e.emit("error",i),process.nextTick(function(){r(i)}),n=!1)}return n}(this,a,e,o)&&(s=function(e,t,o,r,n){o=function(e,t,o){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new Buffer(t,o));return t}(t,o,r),Buffer.isBuffer(o)&&(r="buffer");var i=t.objectMode?1:o.length,a=(t.length+=i,t.length<t.highWaterMark);a||(t.needDrain=!0);t.writing?t.buffer.push(new l(o,r,n)):function(e,t,o,r,n,i){t.writelen=o,t.writecb=i,t.writing=!0,t.sync=!0,e._write(r,n,t.onwrite),t.sync=!1}(e,t,i,o,r,n);return a}(this,a,e,t,o)),s},require("_stream_duplex").prototype.write=e.prototype.write)}(),goog.provide("fb.core.util.ServerValues"),fb.core.util.ServerValues.generateWithValues=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},fb.core.util.ServerValues.resolveDeferredValue=function(e,t){return e&&"object"==typeof e?(fb.core.util.assert(".sv"in e,"Unexpected leaf node or priority contents"),t[e[".sv"]]):e},fb.core.util.ServerValues.resolveDeferredValueTree=function(e,o){var r=new fb.core.SparseSnapshotTree;return e.forEachTree(new fb.core.util.Path(""),function(e,t){r.remember(e,fb.core.util.ServerValues.resolveDeferredValueSnapshot(t,o))}),r},fb.core.util.ServerValues.resolveDeferredValueSnapshot=function(e,r){var t,o,n,i=e.getPriority().val(),i=fb.core.util.ServerValues.resolveDeferredValue(i,r);return e.isLeafNode()?(t=fb.core.util.ServerValues.resolveDeferredValue((o=e).getValue(),r))!==o.getValue()||i!==o.getPriority().val()?new fb.core.snap.LeafNode(t,fb.core.snap.NodeFromJSON(i)):e:(i!==(n=o=e).getPriority().val()&&(n=n.updatePriority(new fb.core.snap.LeafNode(i))),o.forEachChild(fb.core.snap.PriorityIndex,function(e,t){var o=fb.core.util.ServerValues.resolveDeferredValueSnapshot(t,r);o!==t&&(n=n.updateImmediateChild(e,o))}),n)},goog.provide("fb.core.storage.MemoryStorage"),goog.require("fb.util.obj"),goog.scope(function(){var t=fb.util.obj,e=(fb.core.storage.MemoryStorage=function(){this.cache_={}},fb.core.storage.MemoryStorage);e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return t.contains(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e.prototype.isInMemoryStorage=!0}),goog.provide("fb.core.storage.DOMStorageWrapper"),goog.require("fb.util.obj"),goog.scope(function(){fb.core.storage.DOMStorageWrapper=function(e){this.domStorage_=e,this.prefix_="firebase:"};var e=fb.core.storage.DOMStorageWrapper;e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),fb.util.json.stringify(t))},e.prototype.get=function(e){e=this.domStorage_.getItem(this.prefixedName_(e));return null==e?null:fb.util.json.eval(e)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.isInMemoryStorage=!1,e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()}}),goog.provide("fb.core.storage"),goog.require("fb.core.storage.DOMStorageWrapper"),goog.require("fb.core.storage.MemoryStorage"),fb.core.storage.createStoragefor=function(e){try{var t;if("undefined"!=typeof window&&void 0!==window[e])return(t=window[e]).setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new fb.core.storage.DOMStorageWrapper(t)}catch(e){}return new fb.core.storage.MemoryStorage},fb.core.storage.PersistentStorage=fb.core.storage.createStoragefor("localStorage"),fb.core.storage.SessionStorage=fb.core.storage.createStoragefor("sessionStorage"),goog.provide("fb.core.RepoInfo"),goog.require("fb.core.storage"),fb.core.RepoInfo=function(e,t,o,r,n){this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.secure=t,this.namespace=o,this.webSocketOnly=r,this.persistenceKey=n||"",this.internalHost=fb.core.storage.PersistentStorage.get("host:"+e)||this.host},fb.core.RepoInfo.prototype.needsQueryParam=function(){return this.host!==this.internalHost},fb.core.RepoInfo.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},fb.core.RepoInfo.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},fb.core.RepoInfo.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},fb.core.RepoInfo.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&fb.core.storage.PersistentStorage.set("host:"+this.host,this.internalHost))},fb.core.RepoInfo.prototype.connectionURL=function(e,t){var o;if(fb.core.util.assert("string"==typeof e,"typeof type must == string"),fb.core.util.assert("object"==typeof t,"typeof params must == object"),e===fb.realtime.Constants.WEBSOCKET)o=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==fb.realtime.Constants.LONG_POLLING)throw new Error("Unknown connection type: "+e);o=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var r=[];return goog.object.forEach(t,function(e,t,o){r.push(t+"="+e)}),o+r.join("&")},fb.core.RepoInfo.prototype.toString=function(){var e=(this.secure?"https://":"http://")+this.host;return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},goog.provide("fb.core.util"),goog.require("fb.constants"),goog.require("fb.core.RepoInfo"),goog.require("fb.core.storage"),goog.require("fb.util.json"),goog.require("goog.crypt.Sha1"),goog.require("goog.crypt.base64"),goog.require("goog.object"),goog.require("goog.string"),fb.core.util.LUIDGenerator=function(){var e=1;return function(){return e++}}(),fb.core.util.assert=function(e,t){if(!e)throw fb.core.util.assertionError(t)},fb.core.util.assertionError=function(e){return new Error("Firebase ("+Firebase.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},fb.core.util.assertWeak=function(e,t){e||fb.core.util.error(t)},fb.core.util.base64Encode=function(e){e=fb.util.utf8.stringToByteArray(e);return goog.crypt.base64.encodeByteArray(e,!0)},fb.core.util.base64Decode=function(e){try{return NODE_CLIENT?new Buffer(e,"base64").toString("utf8"):"undefined"!=typeof atob?atob(e):goog.crypt.base64.decodeString(e,!0)}catch(e){fb.core.util.log("base64Decode failed: ",e)}return null},fb.core.util.sha1=function(e){var e=fb.util.utf8.stringToByteArray(e),t=new goog.crypt.Sha1,e=(t.update(e),t.digest());return goog.crypt.base64.encodeByteArray(e)},fb.core.util.buildLogMessage_=function(e){for(var t="",o=0;o<arguments.length;o++)goog.isArrayLike(arguments[o])?t+=fb.core.util.buildLogMessage_.apply(null,arguments[o]):t+="object"==typeof arguments[o]?fb.util.json.stringify(arguments[o]):arguments[o],t+=" ";return t},fb.core.util.logger=null,fb.core.util.firstLog_=!0,fb.core.util.log=function(e){var t;!0===fb.core.util.firstLog_&&(fb.core.util.firstLog_=!1,null===fb.core.util.logger&&!0===fb.core.storage.SessionStorage.get("logging_enabled")&&Firebase.enableLogging(!0)),fb.core.util.logger&&(t=fb.core.util.buildLogMessage_.apply(null,arguments),fb.core.util.logger(t))},fb.core.util.logWrapper=function(e){return function(){fb.core.util.log(e,arguments)}},fb.core.util.error=function(e){var t;"undefined"!=typeof console&&(t="FIREBASE INTERNAL ERROR: "+fb.core.util.buildLogMessage_.apply(null,arguments),void 0!==console.error?console.error(t):console.log(t))},fb.core.util.fatal=function(e){var t=fb.core.util.buildLogMessage_.apply(null,arguments);throw new Error("FIREBASE FATAL ERROR: "+t)},fb.core.util.warn=function(e){var t;"undefined"!=typeof console&&(t="FIREBASE WARNING: "+fb.core.util.buildLogMessage_.apply(null,arguments),void 0!==console.warn?console.warn(t):console.log(t))},fb.core.util.warnIfPageIsSecure=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&fb.core.util.warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},fb.core.util.warnAboutUnsupportedMethod=function(e){fb.core.util.warn(e+" is unsupported and will likely change soon.  Please do not use.")},fb.core.util.parseRepoInfo=function(e){var e=fb.core.util.parseURL(e),t=e.subdomain,o=("firebase"===e.domain&&fb.core.util.fatal(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),t&&"undefined"!=t||fb.core.util.fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||fb.core.util.warnIfPageIsSecure(),"ws"===e.scheme||"wss"===e.scheme);return{repoInfo:new fb.core.RepoInfo(e.host,e.secure,t,o),path:new fb.core.util.Path(e.pathString)}},fb.core.util.parseURL=function(e){var t,o,r="",n="",i="",a="",s=!0,l="https",c=443;return goog.isString(e)&&(0<=(t=e.indexOf("//"))&&(l=e.substring(0,t-1),e=e.substring(t+2)),-1===(o=e.indexOf("/"))&&(o=e.length),r=e.substring(0,o),a=fb.core.util.decodePath(e.substring(o)),3===(e=r.split(".")).length?(n=e[1],i=e[0].toLowerCase()):2===e.length&&(n=e[0]),0<=(t=r.indexOf(":"))&&(s="https"===l||"wss"===l,c=goog.string.parseInt(r.substring(t+1)))),{host:r,port:c,domain:n,subdomain:i,secure:s,scheme:l,pathString:a}},fb.core.util.decodePath=function(e){for(var t="",o=e.split("/"),r=0;r<o.length;r++)if(0<o[r].length){var n=o[r];try{n=goog.string.urlDecode(n)}catch(e){}t+="/"+n}return t},fb.core.util.isInvalidJSONNumber=function(e){return goog.isNumber(e)&&(e!=e||e==Number.POSITIVE_INFINITY||e==Number.NEGATIVE_INFINITY)},fb.core.util.executeWhenDOMReady=function(e){var t,o;NODE_CLIENT||"complete"===document.readyState?e():(t=!1,o=function(){document.body?t||(t=!0,e()):setTimeout(o,Math.floor(10))},document.addEventListener?(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&o()}),window.attachEvent("onload",o)))},fb.core.util.MIN_NAME="[MIN_NAME]",fb.core.util.MAX_NAME="[MAX_NAME]",fb.core.util.nameCompare=function(e,t){var o,r;return e===t?0:e===fb.core.util.MIN_NAME||t===fb.core.util.MAX_NAME?-1:t===fb.core.util.MIN_NAME||e===fb.core.util.MAX_NAME?1:(o=fb.core.util.tryParseInt(e),r=fb.core.util.tryParseInt(t),null!==o?null!==r?o-r==0?e.length-t.length:o-r:-1:null===r&&e<t?-1:1)},fb.core.util.stringCompare=function(e,t){return e===t?0:e<t?-1:1},fb.core.util.requireKey=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+fb.util.json.stringify(t))},fb.core.util.ObjectToUniqueKey=function(e){if("object"!=typeof e||null===e)return fb.util.json.stringify(e);var t,o=[];for(t in e)o.push(t);o.sort();for(var r="{",n=0;n<o.length;n++)0!==n&&(r+=","),r=(r=r+fb.util.json.stringify(o[n])+":")+fb.core.util.ObjectToUniqueKey(e[o[n]]);return r+="}"},fb.core.util.splitStringBySize=function(e,t){if(e.length<=t)return[e];for(var o=[],r=0;r<e.length;r+=t)o.push(e<r+t?e.substring(r,e.length):e.substring(r,r+t));return o},fb.core.util.each=function(e,t){if(goog.isArray(e))for(var o=0;o<e.length;++o)t(o,e[o]);else goog.object.forEach(e,t)},fb.core.util.bindCallback=function(e,t){return t?goog.bind(e,t):e},fb.core.util.doubleToIEEE754String=function(e){fb.core.util.assert(!fb.core.util.isInvalidJSONNumber(e),"Invalid JSON number");var t,o,r,n,i;for(0===e?t=1/e==-1/(r=o=0)?1:0:(t=e<0,r=(e=Math.abs(e))>=Math.pow(2,-1022)?(o=(n=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,Math.round(e*Math.pow(2,52-n)-Math.pow(2,52))):(o=0,Math.round(e/Math.pow(2,-1074)))),i=[],l=52;l;--l)i.push(r%2?1:0),r=Math.floor(r/2);for(l=11;l;--l)i.push(o%2?1:0),o=Math.floor(o/2);i.push(t?1:0),i.reverse();for(var a=i.join(""),s="",l=0;l<64;l+=8){var c=parseInt(a.substr(l,8),2).toString(16);s+=c=1===c.length?"0"+c:c}return s.toLowerCase()},fb.core.util.isChromeExtensionContentScript=function(){return!("object"!=typeof window||!window.chrome||!window.chrome.extension||/^chrome/.test(window.location.href))},fb.core.util.isWindowsStoreApp=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI},fb.core.util.errorForServerCode=function(e){var t="Unknown Error",t=("too_big"===e?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==e?t="Client doesn't have permission to access the desired data.":"unavailable"==e&&(t="The service is unavailable"),new Error(e+": "+t));return t.code=e.toUpperCase(),t},fb.core.util.INTEGER_REGEXP_=new RegExp("^-?\\d{1,10}$"),fb.core.util.tryParseInt=function(e){if(fb.core.util.INTEGER_REGEXP_.test(e)){e=Number(e);if(-2147483648<=e&&e<=2147483647)return e}return null},fb.core.util.exceptionGuard=function(e){try{e()}catch(t){setTimeout(function(){var e=t.stack||"";throw fb.core.util.warn("Exception was thrown by user callback.",e),t},Math.floor(0))}},fb.core.util.callUserCallback=function(e,t){var o;goog.isFunction(e)&&(o=Array.prototype.slice.call(arguments,1).slice(),fb.core.util.exceptionGuard(function(){e.apply(null,o)}))},fb.core.util.beingCrawled=function(){return 0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)},goog.provide("fb.util.utf8"),goog.require("fb.core.util"),fb.util.utf8.stringToByteArray=function(e){for(var t=[],o=0,r=0;r<e.length;r++){var n,i=e.charCodeAt(r);55296<=i&&i<=56319&&(n=i-55296,r++,fb.core.util.assert(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(n<<10)+(e.charCodeAt(r)-56320)),i<128?t[o++]=i:(i<2048?t[o++]=i>>6|192:(i<65536?t[o++]=i>>12|224:(t[o++]=i>>18|240,t[o++]=i>>12&63|128),t[o++]=i>>6&63|128),t[o++]=63&i|128)}return t},fb.util.utf8.stringLength=function(e){for(var t=0,o=0;o<e.length;o++){var r=e.charCodeAt(o);r<128?t++:r<2048?t+=2:55296<=r&&r<=56319?(t+=4,o++):t+=3}return t},goog.provide("fb.util.jwt"),goog.require("fb.core.util"),goog.require("fb.util.json"),goog.require("fb.util.obj"),goog.require("goog.crypt.base64"),goog.require("goog.json"),fb.util.jwt.decode=function(e){var t={},o={},r={},n="";try{var i=e.split("."),t=fb.util.json.eval(fb.core.util.base64Decode(i[0])||""),o=fb.util.json.eval(fb.core.util.base64Decode(i[1])||""),n=i[2],r=o.d||{};delete o.d}catch(e){}return{header:t,claims:o,data:r,signature:n}},fb.util.jwt.isValidTimestamp=function(e){var t,o,e=fb.util.jwt.decode(e).claims,r=Math.floor((new Date).getTime()/1e3);return"object"==typeof e&&(e.hasOwnProperty("nbf")?t=fb.util.obj.get(e,"nbf"):e.hasOwnProperty("iat")&&(t=fb.util.obj.get(e,"iat")),o=e.hasOwnProperty("exp")?fb.util.obj.get(e,"exp"):t+86400),r&&t&&o&&t<=r&&r<=o},fb.util.jwt.issuedAtTime=function(e){e=fb.util.jwt.decode(e).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?fb.util.obj.get(e,"iat"):null},fb.util.jwt.isValidFormat=function(e){var e=fb.util.jwt.decode(e),t=e.claims;return!!e.signature&&!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},fb.util.jwt.isAdmin=function(e){e=fb.util.jwt.decode(e).claims;return"object"==typeof e&&!0===fb.util.obj.get(e,"admin")},goog.provide("fb.core.view.EventGenerator"),goog.require("fb.core.snap.NamedNode"),goog.require("fb.core.util"),fb.core.view.EventGenerator=function(e){this.query_=e,this.index_=e.getQueryParams().getIndex()},fb.core.view.EventGenerator.prototype.generateEventsForChanges=function(e,t,o){var r=[],n=this,i=[];return goog.array.forEach(e,function(e){e.type===fb.core.view.Change.CHILD_CHANGED&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&i.push(fb.core.view.Change.childMovedChange(e.childName,e.snapshotNode))}),this.generateEventsForType_(r,fb.core.view.Change.CHILD_REMOVED,e,o,t),this.generateEventsForType_(r,fb.core.view.Change.CHILD_ADDED,e,o,t),this.generateEventsForType_(r,fb.core.view.Change.CHILD_MOVED,i,o,t),this.generateEventsForType_(r,fb.core.view.Change.CHILD_CHANGED,e,o,t),this.generateEventsForType_(r,fb.core.view.Change.VALUE,e,o,t),r},fb.core.view.EventGenerator.prototype.generateEventsForType_=function(r,t,e,n,i){var e=goog.array.filter(e,function(e){return e.type===t}),a=this;goog.array.sort(e,goog.bind(this.compareChanges_,this)),goog.array.forEach(e,function(t){var o=a.materializeSingleChange_(t,i);goog.array.forEach(n,function(e){e.respondsTo(t.type)&&r.push(e.createEvent(o,a.query_))})})},fb.core.view.EventGenerator.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_)),e},fb.core.view.EventGenerator.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw fb.core.util.assertionError("Should only compare child_ events.");e=new fb.core.snap.NamedNode(e.childName,e.snapshotNode),t=new fb.core.snap.NamedNode(t.childName,t.snapshotNode);return this.index_.compare(e,t)},goog.provide("fb.core.view.ChildChangeAccumulator"),goog.require("fb.core.util"),fb.core.view.ChildChangeAccumulator=function(){this.changeMap_={}},fb.core.view.ChildChangeAccumulator.prototype.trackChildChange=function(e){var t=fb.core.view.Change,o=e.type,r=e.childName,n=(fb.core.util.assert(o==fb.core.view.Change.CHILD_ADDED||o==fb.core.view.Change.CHILD_CHANGED||o==fb.core.view.Change.CHILD_REMOVED,"Only child changes supported for tracking"),fb.core.util.assert(".priority"!==r,"Only non-priority child changes can be tracked."),fb.util.obj.get(this.changeMap_,r));if(n){var i=n.type;if(o==t.CHILD_ADDED&&i==t.CHILD_REMOVED)this.changeMap_[r]=t.childChangedChange(r,e.snapshotNode,n.snapshotNode);else if(o==t.CHILD_REMOVED&&i==t.CHILD_ADDED)delete this.changeMap_[r];else if(o==t.CHILD_REMOVED&&i==t.CHILD_CHANGED)this.changeMap_[r]=t.childRemovedChange(r,n.oldSnap);else if(o==t.CHILD_CHANGED&&i==t.CHILD_ADDED)this.changeMap_[r]=t.childAddedChange(r,e.snapshotNode);else{if(o!=t.CHILD_CHANGED||i!=t.CHILD_CHANGED)throw fb.core.util.assertionError("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap_[r]=t.childChangedChange(r,e.snapshotNode,n.oldSnap)}}else this.changeMap_[r]=e},fb.core.view.ChildChangeAccumulator.prototype.getChanges=function(){return goog.object.getValues(this.changeMap_)},goog.provide("fb.core.view.EventRegistration"),goog.require("fb.core.view.Change"),goog.require("fb.core.view.Event"),goog.require("fb.core.util"),fb.core.view.EventRegistration=function(){},fb.core.view.EventRegistration.prototype.respondsTo,fb.core.view.EventRegistration.prototype.createEvent,fb.core.view.EventRegistration.prototype.getEventRunner,fb.core.view.EventRegistration.prototype.createCancelEvent,fb.core.view.EventRegistration.prototype.matches,fb.core.view.EventRegistration.prototype.hasAnyCallback,fb.core.view.ValueEventRegistration=function(e,t,o){this.callback_=e,this.cancelCallback_=t,this.context_=o||null},fb.core.view.ValueEventRegistration.prototype.respondsTo=function(e){return"value"===e},fb.core.view.ValueEventRegistration.prototype.createEvent=function(e,t){var o=t.getQueryParams().getIndex();return new fb.core.view.DataEvent("value",this,new fb.api.DataSnapshot(e.snapshotNode,t.ref(),o))},fb.core.view.ValueEventRegistration.prototype.getEventRunner=function(e){var t,o,r=this.context_;return"cancel"===e.getEventType()?(fb.core.util.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback"),t=this.cancelCallback_,function(){t.call(r,e.error)}):(o=this.callback_,function(){o.call(r,e.snapshot)})},fb.core.view.ValueEventRegistration.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new fb.core.view.CancelEvent(this,e,t):null},fb.core.view.ValueEventRegistration.prototype.matches=function(e){return e instanceof fb.core.view.ValueEventRegistration&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},fb.core.view.ValueEventRegistration.prototype.hasAnyCallback=function(){return null!==this.callback_},fb.core.view.ChildEventRegistration=function(e,t,o){this.callbacks_=e,this.cancelCallback_=t,this.context_=o},fb.core.view.ChildEventRegistration.prototype.respondsTo=function(e){e="children_added"===e?"child_added":e;return goog.object.containsKey(this.callbacks_,"children_removed"===e?"child_removed":e)},fb.core.view.ChildEventRegistration.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new fb.core.view.CancelEvent(this,e,t):null},fb.core.view.ChildEventRegistration.prototype.createEvent=function(e,t){fb.core.util.assert(null!=e.childName,"Child events should have a childName.");var o=t.ref().child(e.childName),t=t.getQueryParams().getIndex();return new fb.core.view.DataEvent(e.type,this,new fb.api.DataSnapshot(e.snapshotNode,o,t),e.prevName)},fb.core.view.ChildEventRegistration.prototype.getEventRunner=function(e){var t,o,r=this.context_;return"cancel"===e.getEventType()?(fb.core.util.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback"),t=this.cancelCallback_,function(){t.call(r,e.error)}):(o=this.callbacks_[e.eventType],function(){o.call(r,e.snapshot,e.prevName)})},fb.core.view.ChildEventRegistration.prototype.matches=function(o){if(o instanceof fb.core.view.ChildEventRegistration){if(!this.callbacks_||!o.callbacks_)return!0;if(this.context_===o.context_){var e,t=goog.object.getCount(o.callbacks_);if(t===goog.object.getCount(this.callbacks_))return 1===t?(t=goog.object.getAnyKey(o.callbacks_),!((e=goog.object.getAnyKey(this.callbacks_))!==t||o.callbacks_[t]&&this.callbacks_[e]&&o.callbacks_[t]!==this.callbacks_[e])):goog.object.every(this.callbacks_,function(e,t){return o.callbacks_[t]===e})}}return!1},fb.core.view.ChildEventRegistration.prototype.hasAnyCallback=function(){return null!==this.callbacks_},goog.provide("fb.core.view.filter.IndexedFilter"),goog.require("fb.core.util"),fb.core.view.filter.IndexedFilter=function(e){this.index_=e},fb.core.view.filter.IndexedFilter.prototype.updateChild=function(e,t,o,r,n,i){var a=fb.core.view.Change,s=(fb.core.util.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated"),e.getImmediateChild(t));return s.getChild(r).equals(o.getChild(r))&&s.isEmpty()==o.isEmpty()||(null!=i&&(o.isEmpty()?e.hasChild(t)?i.trackChildChange(a.childRemovedChange(t,s)):fb.core.util.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?i.trackChildChange(a.childAddedChange(t,o)):i.trackChildChange(a.childChangedChange(t,o,s))),e.isLeafNode()&&o.isEmpty())?e:e.updateImmediateChild(t,o).withIndex(this.index_)},fb.core.view.filter.IndexedFilter.prototype.updateFullNode=function(r,o,n){var i=fb.core.view.Change;return null!=n&&(r.isLeafNode()||r.forEachChild(fb.core.snap.PriorityIndex,function(e,t){o.hasChild(e)||n.trackChildChange(i.childRemovedChange(e,t))}),o.isLeafNode()||o.forEachChild(fb.core.snap.PriorityIndex,function(e,t){var o;r.hasChild(e)?(o=r.getImmediateChild(e)).equals(t)||n.trackChildChange(i.childChangedChange(e,t,o)):n.trackChildChange(i.childAddedChange(e,t))})),o.withIndex(this.index_)},fb.core.view.filter.IndexedFilter.prototype.updatePriority=function(e,t){return e.isEmpty()?fb.core.snap.EMPTY_NODE:e.updatePriority(t)},fb.core.view.filter.IndexedFilter.prototype.filtersNodes=function(){return!1},fb.core.view.filter.IndexedFilter.prototype.getIndexedFilter=function(){return this},fb.core.view.filter.IndexedFilter.prototype.getIndex=function(){return this.index_},goog.provide("fb.core.view.filter.RangedFilter"),goog.require("fb.core.view.filter.IndexedFilter"),fb.core.view.filter.RangedFilter=function(e){this.indexedFilter_=new fb.core.view.filter.IndexedFilter(e.getIndex()),this.index_=e.getIndex(),this.startPost_=this.getStartPost_(e),this.endPost_=this.getEndPost_(e)},fb.core.view.filter.RangedFilter.prototype.getStartPost=function(){return this.startPost_},fb.core.view.filter.RangedFilter.prototype.getEndPost=function(){return this.endPost_},fb.core.view.filter.RangedFilter.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},fb.core.view.filter.RangedFilter.prototype.updateChild=function(e,t,o,r,n,i){return this.matches(new fb.core.snap.NamedNode(t,o))||(o=fb.core.snap.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,o,r,n,i)},fb.core.view.filter.RangedFilter.prototype.updateFullNode=function(e,t,o){t.isLeafNode()&&(t=fb.core.snap.EMPTY_NODE);var r=(r=t.withIndex(this.index_)).updatePriority(fb.core.snap.EMPTY_NODE),n=this;return t.forEachChild(fb.core.snap.PriorityIndex,function(e,t){n.matches(new fb.core.snap.NamedNode(e,t))||(r=r.updateImmediateChild(e,fb.core.snap.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,o)},fb.core.view.filter.RangedFilter.prototype.updatePriority=function(e,t){return e},fb.core.view.filter.RangedFilter.prototype.filtersNodes=function(){return!0},fb.core.view.filter.RangedFilter.prototype.getIndexedFilter=function(){return this.indexedFilter_},fb.core.view.filter.RangedFilter.prototype.getIndex=function(){return this.index_},fb.core.view.filter.RangedFilter.prototype.getStartPost_=function(e){var t;return e.hasStart()?(t=e.getIndexStartName(),e.getIndex().makePost(e.getIndexStartValue(),t)):e.getIndex().minPost()},fb.core.view.filter.RangedFilter.prototype.getEndPost_=function(e){var t;return e.hasEnd()?(t=e.getIndexEndName(),e.getIndex().makePost(e.getIndexEndValue(),t)):e.getIndex().maxPost()},goog.provide("fb.core.view.filter.NodeFilter"),goog.require("fb.core.view.ChildChangeAccumulator"),goog.require("fb.core.view.CompleteChildSource"),fb.core.view.filter.NodeFilter=function(){},fb.core.view.filter.NodeFilter.prototype.updateChild=function(e,t,o,r,n,i){},fb.core.view.filter.NodeFilter.prototype.updateFullNode=function(e,t,o){},fb.core.view.filter.NodeFilter.prototype.updatePriority=function(e,t){},fb.core.view.filter.NodeFilter.prototype.filtersNodes=function(){},fb.core.view.filter.NodeFilter.prototype.getIndexedFilter=function(){},fb.core.view.filter.NodeFilter.prototype.getIndex=function(){},goog.provide("fb.core.view.filter.LimitedFilter"),goog.require("fb.core.snap.NamedNode"),goog.require("fb.core.view.filter.RangedFilter"),goog.require("fb.core.util"),fb.core.view.filter.LimitedFilter=function(e){this.rangedFilter_=new fb.core.view.filter.RangedFilter(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()},fb.core.view.filter.LimitedFilter.prototype.updateChild=function(e,t,o,r,n,i){return this.rangedFilter_.matches(new fb.core.snap.NamedNode(t,o))||(o=fb.core.snap.EMPTY_NODE),e.getImmediateChild(t).equals(o)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,o,r,n,i):this.fullLimitUpdateChild_(e,t,o,n,i)},fb.core.view.filter.LimitedFilter.prototype.updateFullNode=function(e,t,o){if(t.isLeafNode()||t.isEmpty())r=fb.core.snap.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_))for(var r=fb.core.snap.EMPTY_NODE.withIndex(this.index_),n=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_),i=0;n.hasNext()&&i<this.limit_;){var a=n.getNext(),s=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0;if(!s)break;r=r.updateImmediateChild(a.name,a.node),i++}else{r=(r=t.withIndex(this.index_)).updatePriority(fb.core.snap.EMPTY_NODE),u=this.reverse_?(n=r.getReverseIterator(this.index_),l=this.rangedFilter_.getEndPost(),c=this.rangedFilter_.getStartPost(),g=this.index_.getCompare(),function(e,t){return g(t,e)}):(n=r.getIterator(this.index_),l=this.rangedFilter_.getStartPost(),c=this.rangedFilter_.getEndPost(),this.index_.getCompare()),i=0;for(var l,c,g,u,f=!1;n.hasNext();)a=n.getNext(),(s=(f=!f&&u(l,a)<=0?!0:f)&&i<this.limit_&&u(a,c)<=0)?i++:r=r.updateImmediateChild(a.name,fb.core.snap.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,o)},fb.core.view.filter.LimitedFilter.prototype.updatePriority=function(e,t){return e},fb.core.view.filter.LimitedFilter.prototype.filtersNodes=function(){return!0},fb.core.view.filter.LimitedFilter.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},fb.core.view.filter.LimitedFilter.prototype.getIndex=function(){return this.index_},fb.core.view.filter.LimitedFilter.prototype.fullLimitUpdateChild_=function(e,t,o,r,n){var i,a,s=fb.core.view.Change,l=(a=this.reverse_?(i=this.index_.getCompare(),function(e,t){return i(t,e)}):this.index_.getCompare(),e),c=(fb.core.util.assert(l.numChildren()==this.limit_,""),new fb.core.snap.NamedNode(t,o)),g=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(t)){for(var f=l.getImmediateChild(t),h=r.getChildAfterChild(this.index_,g,this.reverse_);null!=h&&(h.name==t||l.hasChild(h.name));)h=r.getChildAfterChild(this.index_,h,this.reverse_);var p=null==h?1:a(h,c);return u&&!o.isEmpty()&&0<=p?(null!=n&&n.trackChildChange(s.childChangedChange(t,o,f)),l.updateImmediateChild(t,o)):(null!=n&&n.trackChildChange(s.childRemovedChange(t,f)),p=l.updateImmediateChild(t,fb.core.snap.EMPTY_NODE),null!=h&&this.rangedFilter_.matches(h)?(null!=n&&n.trackChildChange(s.childAddedChange(h.name,h.node)),p.updateImmediateChild(h.name,h.node)):p)}return!o.isEmpty()&&u&&0<=a(g,c)?(null!=n&&(n.trackChildChange(s.childRemovedChange(g.name,g.node)),n.trackChildChange(s.childAddedChange(t,o))),l.updateImmediateChild(t,o).updateImmediateChild(g.name,fb.core.snap.EMPTY_NODE)):e},goog.provide("fb.core.view.ViewProcessor"),goog.require("fb.core.view.CompleteChildSource"),goog.require("fb.core.util"),fb.core.view.ProcessorResult=function(e,t){this.viewCache=e,this.changes=t},fb.core.view.ViewProcessor=function(e){this.filter_=e},fb.core.view.ViewProcessor.prototype.assertIndexed=function(e){fb.core.util.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),fb.core.util.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},fb.core.view.ViewProcessor.prototype.applyOperation=function(e,t,o,r){var n=new fb.core.view.ChildChangeAccumulator;if(t.type===fb.core.OperationType.OVERWRITE)var i=t,i=i.source.fromUser?this.applyUserOverwrite_(e,i.path,i.snap,o,r,n):(fb.core.util.assert(i.source.fromServer,"Unknown source."),s=i.source.tagged||e.getServerCache().isFiltered()&&!i.path.isEmpty(),this.applyServerOverwrite_(e,i.path,i.snap,o,r,s,n));else if(t.type===fb.core.OperationType.MERGE){var a=t;i=a.source.fromUser?this.applyUserMerge_(e,a.path,a.children,o,r,n):(fb.core.util.assert(a.source.fromServer,"Unknown source."),s=a.source.tagged||e.getServerCache().isFiltered(),this.applyServerMerge_(e,a.path,a.children,o,r,s,n))}else if(t.type===fb.core.OperationType.ACK_USER_WRITE){a=t;i=a.revert?this.revertUserWrite_(e,a.path,o,r,n):this.ackUserWrite_(e,a.path,a.affectedTree,o,r,n)}else{if(t.type!==fb.core.OperationType.LISTEN_COMPLETE)throw fb.core.util.assertionError("Unknown operation type: "+t.type);i=this.listenComplete_(e,t.path,o,r,n)}var s=n.getChanges();return this.maybeAddValueEvent_(e,i,s),new fb.core.view.ProcessorResult(i,s)},fb.core.view.ViewProcessor.prototype.maybeAddValueEvent_=function(e,t,o){var r,n,i=t.getEventCache();i.isFullyInitialized()&&(r=i.getNode().isLeafNode()||i.getNode().isEmpty(),n=e.getCompleteEventSnap(),(0<o.length||!e.getEventCache().isFullyInitialized()||r&&!i.getNode().equals(n)||!i.getNode().getPriority().equals(n.getPriority()))&&o.push(fb.core.view.Change.valueChange(t.getCompleteEventSnap())))},fb.core.view.ViewProcessor.prototype.generateEventCacheAfterServerEvent_=function(e,t,o,r,n){var i,a,s,l,c=e.getEventCache();return null!=o.shadowingWrite(t)?e:(s=t.isEmpty()?(fb.core.util.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()?(i=(i=e.getCompleteServerSnap())instanceof fb.core.snap.ChildrenNode?i:fb.core.snap.EMPTY_NODE,i=o.calcCompleteEventChildren(i),this.filter_.updateFullNode(e.getEventCache().getNode(),i,n)):(i=o.calcCompleteEventCache(e.getCompleteServerSnap()),this.filter_.updateFullNode(e.getEventCache().getNode(),i,n))):".priority"==(i=t.getFront())?(fb.core.util.assert(1==t.getLength(),"Can't have a priority with additional path components"),a=c.getNode(),l=e.getServerCache().getNode(),null!=(s=o.calcEventCacheAfterServerOverwrite(t,a,l))?this.filter_.updatePriority(a,s):c.getNode()):(a=t.popFront(),null!=(l=c.isCompleteForChild(i)?(l=e.getServerCache().getNode(),null!=(s=o.calcEventCacheAfterServerOverwrite(t,c.getNode(),l))?c.getNode().getImmediateChild(i).updateChild(a,s):c.getNode().getImmediateChild(i)):o.calcCompleteChild(i,e.getServerCache()))?this.filter_.updateChild(c.getNode(),i,l,a,r,n):c.getNode()),e.updateEventSnap(s,c.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes()))},fb.core.view.ViewProcessor.prototype.applyServerOverwrite_=function(e,t,o,r,n,i,a){var s=e.getServerCache(),i=i?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())c=i.updateFullNode(s.getNode(),o,null);else if(i.filtersNodes()&&!s.isFiltered())var l=s.getNode().updateChild(t,o),c=i.updateFullNode(s.getNode(),l,null);else{l=t.getFront();if(!s.isCompleteForPath(t)&&1<t.getLength())return e;var g=t.popFront(),o=s.getNode().getImmediateChild(l).updateChild(g,o);c=".priority"==l?i.updatePriority(s.getNode(),o):i.updateChild(s.getNode(),l,o,g,fb.core.view.NO_COMPLETE_CHILD_SOURCE,null)}l=e.updateServerSnap(c,s.isFullyInitialized()||t.isEmpty(),i.filtersNodes()),o=new fb.core.view.WriteTreeCompleteChildSource(r,l,n);return this.generateEventCacheAfterServerEvent_(l,t,r,o,a)},fb.core.view.ViewProcessor.prototype.applyUserOverwrite_=function(e,t,o,r,n,i){var a,s,l=e.getEventCache(),r=new fb.core.view.WriteTreeCompleteChildSource(r,e,n);return t.isEmpty()?(a=this.filter_.updateFullNode(e.getEventCache().getNode(),o,i),e.updateEventSnap(a,!0,this.filter_.filtersNodes())):".priority"===(n=t.getFront())?(a=this.filter_.updatePriority(e.getEventCache().getNode(),o),e.updateEventSnap(a,l.isFullyInitialized(),l.isFiltered())):(a=t.popFront(),t=l.getNode().getImmediateChild(n),s=a.isEmpty()?o:null!=(s=r.getCompleteChild(n))?".priority"===a.getBack()&&s.getChild(a.parent()).isEmpty()?s:s.updateChild(a,o):fb.core.snap.EMPTY_NODE,t.equals(s)?e:(o=this.filter_.updateChild(l.getNode(),n,s,a,r,i),e.updateEventSnap(o,l.isFullyInitialized(),this.filter_.filtersNodes())))},fb.core.view.ViewProcessor.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},fb.core.view.ViewProcessor.prototype.applyUserMerge_=function(o,r,e,n,i,a){var s=this,l=o;return e.foreach(function(e,t){e=r.child(e);fb.core.view.ViewProcessor.cacheHasChild_(o,e.getFront())&&(l=s.applyUserOverwrite_(l,e,t,n,i,a))}),e.foreach(function(e,t){e=r.child(e);fb.core.view.ViewProcessor.cacheHasChild_(o,e.getFront())||(l=s.applyUserOverwrite_(l,e,t,n,i,a))}),l},fb.core.view.ViewProcessor.prototype.applyMerge_=function(o,e){return e.foreach(function(e,t){o=o.updateChild(e,t)}),o},fb.core.view.ViewProcessor.prototype.applyServerMerge_=function(r,e,t,n,i,a,s){var l,c,g;return r.getServerCache().getNode().isEmpty()&&!r.getServerCache().isFullyInitialized()?r:(l=r,e=e.isEmpty()?t:fb.core.util.ImmutableTree.Empty.setTree(e,t),c=r.getServerCache().getNode(),g=this,e.children.inorderTraversal(function(e,t){var o;c.hasChild(e)&&(o=r.getServerCache().getNode().getImmediateChild(e),o=g.applyMerge_(o,t),l=g.applyServerOverwrite_(l,new fb.core.util.Path(e),o,n,i,a,s))}),e.children.inorderTraversal(function(e,t){var o=!r.getServerCache().isCompleteForChild(e)&&null==t.value;c.hasChild(e)||o||(o=r.getServerCache().getNode().getImmediateChild(e),o=g.applyMerge_(o,t),l=g.applyServerOverwrite_(l,new fb.core.util.Path(e),o,n,i,a,s))}),l)},fb.core.view.ViewProcessor.prototype.ackUserWrite_=function(e,r,t,o,n,i){var a,s,l;return null!=o.shadowingWrite(r)?e:(a=e.getServerCache().isFiltered(),s=e.getServerCache(),null!=t.value?r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r)?this.applyServerOverwrite_(e,r,s.getNode().getChild(r),o,n,a,i):r.isEmpty()?(l=fb.core.util.ImmutableTree.Empty,s.getNode().forEachChild(fb.core.snap.KeyIndex,function(e,t){l=l.set(new fb.core.util.Path(e),t)}),this.applyServerMerge_(e,r,l,o,n,a,i)):e:(l=fb.core.util.ImmutableTree.Empty,t.foreach(function(e,t){var o=r.child(e);s.isCompleteForPath(o)&&(l=l.set(e,s.getNode().getChild(o)))}),this.applyServerMerge_(e,r,l,o,n,a,i)))},fb.core.view.ViewProcessor.prototype.revertUserWrite_=function(e,t,o,r,n){var i,a,s,l,c;return null!=o.shadowingWrite(t)?e:(r=new fb.core.view.WriteTreeCompleteChildSource(o,e,r),a=e.getEventCache().getNode(),t.isEmpty()||".priority"===t.getFront()?(s=e.getServerCache().isFullyInitialized()?o.calcCompleteEventCache(e.getCompleteServerSnap()):(s=e.getServerCache().getNode(),fb.core.util.assert(s instanceof fb.core.snap.ChildrenNode,"serverChildren would be complete if leaf node"),o.calcCompleteEventChildren(s)),s=this.filter_.updateFullNode(a,s,n)):(l=t.getFront(),(s=null!=(c=null==(c=o.calcCompleteChild(l,e.getServerCache()))&&e.getServerCache().isCompleteForChild(l)?a.getImmediateChild(l):c)?this.filter_.updateChild(a,l,c,t.popFront(),r,n):e.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(a,l,fb.core.snap.EMPTY_NODE,t.popFront(),r,n):a).isEmpty()&&e.getServerCache().isFullyInitialized()&&(i=o.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(s=this.filter_.updateFullNode(s,i,n))),i=e.getServerCache().isFullyInitialized()||null!=o.shadowingWrite(fb.core.util.Path.Empty),e.updateEventSnap(s,i,this.filter_.filtersNodes()))},fb.core.view.ViewProcessor.prototype.listenComplete_=function(e,t,o,r,n){var i=e.getServerCache(),e=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(e,t,o,fb.core.view.NO_COMPLETE_CHILD_SOURCE,n)},goog.provide("fb.core.snap.Index"),goog.provide("fb.core.snap.KeyIndex"),goog.provide("fb.core.snap.PathIndex"),goog.provide("fb.core.snap.PriorityIndex"),goog.provide("fb.core.snap.ValueIndex"),goog.require("fb.core.util"),fb.core.snap.Index=function(){},fb.core.snap.Index.FallbackType,fb.core.snap.Index.Fallback={},fb.core.snap.Index.prototype.compare=goog.abstractMethod,fb.core.snap.Index.prototype.isDefinedOn=goog.abstractMethod,fb.core.snap.Index.prototype.getCompare=function(){return goog.bind(this.compare,this)},fb.core.snap.Index.prototype.indexedValueChanged=function(e,t){e=new fb.core.snap.NamedNode(fb.core.util.MIN_NAME,e),t=new fb.core.snap.NamedNode(fb.core.util.MIN_NAME,t);return 0!==this.compare(e,t)},fb.core.snap.Index.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.Index.prototype.maxPost=goog.abstractMethod,fb.core.snap.Index.prototype.makePost=goog.abstractMethod,fb.core.snap.Index.prototype.toString=goog.abstractMethod,fb.core.snap.PathIndex=function(e){fb.core.snap.Index.call(this),fb.core.util.assert(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),this.indexPath_=e},goog.inherits(fb.core.snap.PathIndex,fb.core.snap.Index),fb.core.snap.PathIndex.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},fb.core.snap.PathIndex.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},fb.core.snap.PathIndex.prototype.compare=function(e,t){var o=this.extractChild(e.node),r=this.extractChild(t.node),o=o.compareTo(r);return 0===o?fb.core.util.nameCompare(e.name,t.name):o},fb.core.snap.PathIndex.prototype.makePost=function(e,t){e=fb.core.snap.NodeFromJSON(e),e=fb.core.snap.EMPTY_NODE.updateChild(this.indexPath_,e);return new fb.core.snap.NamedNode(t,e)},fb.core.snap.PathIndex.prototype.maxPost=function(){var e=fb.core.snap.EMPTY_NODE.updateChild(this.indexPath_,fb.core.snap.MAX_NODE);return new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,e)},fb.core.snap.PathIndex.prototype.toString=function(){return this.indexPath_.slice().join("/")},fb.core.snap.PriorityIndex_=function(){fb.core.snap.Index.call(this)},goog.inherits(fb.core.snap.PriorityIndex_,fb.core.snap.Index),fb.core.snap.PriorityIndex_.prototype.compare=function(e,t){var o=e.node.getPriority(),r=t.node.getPriority(),o=o.compareTo(r);return 0===o?fb.core.util.nameCompare(e.name,t.name):o},fb.core.snap.PriorityIndex_.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},fb.core.snap.PriorityIndex_.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},fb.core.snap.PriorityIndex_.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.PriorityIndex_.prototype.maxPost=function(){return new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,new fb.core.snap.LeafNode("[PRIORITY-POST]",fb.core.snap.MAX_NODE))},fb.core.snap.PriorityIndex_.prototype.makePost=function(e,t){e=fb.core.snap.NodeFromJSON(e);return new fb.core.snap.NamedNode(t,new fb.core.snap.LeafNode("[PRIORITY-POST]",e))},fb.core.snap.PriorityIndex_.prototype.toString=function(){return".priority"},fb.core.snap.PriorityIndex=new fb.core.snap.PriorityIndex_,fb.core.snap.KeyIndex_=function(){fb.core.snap.Index.call(this)},goog.inherits(fb.core.snap.KeyIndex_,fb.core.snap.Index),fb.core.snap.KeyIndex_.prototype.compare=function(e,t){return fb.core.util.nameCompare(e.name,t.name)},fb.core.snap.KeyIndex_.prototype.isDefinedOn=function(e){throw fb.core.util.assertionError("KeyIndex.isDefinedOn not expected to be called.")},fb.core.snap.KeyIndex_.prototype.indexedValueChanged=function(e,t){return!1},fb.core.snap.KeyIndex_.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.KeyIndex_.prototype.maxPost=function(){return new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,fb.core.snap.EMPTY_NODE)},fb.core.snap.KeyIndex_.prototype.makePost=function(e,t){return fb.core.util.assert(goog.isString(e),"KeyIndex indexValue must always be a string."),new fb.core.snap.NamedNode(e,fb.core.snap.EMPTY_NODE)},fb.core.snap.KeyIndex_.prototype.toString=function(){return".key"},fb.core.snap.KeyIndex=new fb.core.snap.KeyIndex_,fb.core.snap.ValueIndex_=function(){fb.core.snap.Index.call(this)},goog.inherits(fb.core.snap.ValueIndex_,fb.core.snap.Index),fb.core.snap.ValueIndex_.prototype.compare=function(e,t){var o=e.node.compareTo(t.node);return 0===o?fb.core.util.nameCompare(e.name,t.name):o},fb.core.snap.ValueIndex_.prototype.isDefinedOn=function(e){return!0},fb.core.snap.ValueIndex_.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},fb.core.snap.ValueIndex_.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.ValueIndex_.prototype.maxPost=function(){return fb.core.snap.NamedNode.MAX},fb.core.snap.ValueIndex_.prototype.makePost=function(e,t){e=fb.core.snap.NodeFromJSON(e);return new fb.core.snap.NamedNode(t,e)},fb.core.snap.ValueIndex_.prototype.toString=function(){return".value"},fb.core.snap.ValueIndex=new fb.core.snap.ValueIndex_,goog.provide("fb.core.view.QueryParams"),goog.require("fb.core.snap.Index"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.util"),goog.require("fb.core.view.filter.IndexedFilter"),goog.require("fb.core.view.filter.LimitedFilter"),goog.require("fb.core.view.filter.NodeFilter"),goog.require("fb.core.view.filter.RangedFilter"),fb.core.view.QueryParams=function(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=fb.core.snap.PriorityIndex},fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},fb.core.view.QueryParams.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},fb.core.view.QueryParams.DEFAULT=new fb.core.view.QueryParams,fb.core.view.QueryParams.prototype.hasStart=function(){return this.startSet_},fb.core.view.QueryParams.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},fb.core.view.QueryParams.prototype.getIndexStartValue=function(){return fb.core.util.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},fb.core.view.QueryParams.prototype.getIndexStartName=function(){return fb.core.util.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fb.core.util.MIN_NAME},fb.core.view.QueryParams.prototype.hasEnd=function(){return this.endSet_},fb.core.view.QueryParams.prototype.getIndexEndValue=function(){return fb.core.util.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},fb.core.view.QueryParams.prototype.getIndexEndName=function(){return fb.core.util.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:fb.core.util.MAX_NAME},fb.core.view.QueryParams.prototype.hasLimit=function(){return this.limitSet_},fb.core.view.QueryParams.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},fb.core.view.QueryParams.prototype.getLimit=function(){return fb.core.util.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},fb.core.view.QueryParams.prototype.getIndex=function(){return this.index_},fb.core.view.QueryParams.prototype.copy_=function(){var e=new fb.core.view.QueryParams;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e},fb.core.view.QueryParams.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},fb.core.view.QueryParams.prototype.limitToFirst=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,t},fb.core.view.QueryParams.prototype.limitToLast=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,t},fb.core.view.QueryParams.prototype.startAt=function(e,t){var o=this.copy_();return o.startSet_=!0,goog.isDef(e)||(e=null),o.indexStartValue_=e,null!=t?(o.startNameSet_=!0,o.indexStartName_=t):(o.startNameSet_=!1,o.indexStartName_=""),o},fb.core.view.QueryParams.prototype.endAt=function(e,t){var o=this.copy_();return o.endSet_=!0,goog.isDef(e)||(e=null),o.indexEndValue_=e,goog.isDef(t)?(o.endNameSet_=!0,o.indexEndName_=t):(o.startEndSet_=!1,o.indexEndName_=""),o},fb.core.view.QueryParams.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},fb.core.view.QueryParams.prototype.getQueryObject=function(){var e,t=fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_,o={};return this.startSet_&&(o[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(o[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(o[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(o[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_&&(o[t.LIMIT]=this.limit_,""===(e=this.viewFrom_)&&(e=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),o[t.VIEW_FROM]=e),this.index_!==fb.core.snap.PriorityIndex&&(o[t.INDEX]=this.index_.toString()),o},fb.core.view.QueryParams.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},fb.core.view.QueryParams.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==fb.core.snap.PriorityIndex},fb.core.view.QueryParams.prototype.getNodeFilter=function(){return this.loadsAllData()?new fb.core.view.filter.IndexedFilter(this.getIndex()):new(this.hasLimit()?fb.core.view.filter.LimitedFilter:fb.core.view.filter.RangedFilter)(this)},fb.core.view.QueryParams.prototype.toRestQueryStringParameters=function(){var e,t=fb.core.view.QueryParams.REST_QUERY_CONSTANTS_,o={};return this.isDefault()||(e=this.index_===fb.core.snap.PriorityIndex?t.PRIORITY_INDEX:this.index_===fb.core.snap.ValueIndex?t.VALUE_INDEX:this.index_===fb.core.snap.KeyIndex?t.KEY_INDEX:(fb.core.util.assert(this.index_ instanceof fb.core.snap.PathIndex,"Unrecognized index type!"),this.index_.toString()),o[t.ORDER_BY]=fb.util.json.stringify(e),this.startSet_&&(o[t.START_AT]=fb.util.json.stringify(this.indexStartValue_),this.startNameSet_&&(o[t.START_AT]+=","+fb.util.json.stringify(this.indexStartName_))),this.endSet_&&(o[t.END_AT]=fb.util.json.stringify(this.indexEndValue_),this.endNameSet_&&(o[t.END_AT]+=","+fb.util.json.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?o[t.LIMIT_TO_FIRST]=this.limit_:o[t.LIMIT_TO_LAST]=this.limit_)),o},goog.DEBUG&&(fb.core.view.QueryParams.prototype.toString=function(){return fb.util.json.stringify(this.getQueryObject())}),goog.provide("fb.core.snap.IndexMap"),goog.require("fb.core.snap.Index"),goog.require("fb.core.util"),fb.core.snap.IndexMap=function(e,t){this.indexes_=e,this.indexSet_=t},fb.core.snap.IndexMap.prototype.get=function(e){var t=fb.util.obj.get(this.indexes_,e);if(t)return t===fb.core.snap.Index.Fallback?null:t;throw new Error("No index defined for "+e)},fb.core.snap.IndexMap.prototype.hasIndex=function(e){return goog.object.contains(this.indexSet_,e.toString())},fb.core.snap.IndexMap.prototype.addIndex=function(e,t){fb.core.util.assert(e!==fb.core.snap.KeyIndex,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var o=[],r=!1,n=t.getIterator(fb.core.snap.NamedNode.Wrap),i=n.getNext();i;)r=r||e.isDefinedOn(i.node),o.push(i),i=n.getNext();var t=r?fb.core.snap.buildChildSet(o,e.getCompare()):fb.core.snap.Index.Fallback,a=e.toString(),s=goog.object.clone(this.indexSet_),l=(s[a]=e,goog.object.clone(this.indexes_));return l[a]=t,new fb.core.snap.IndexMap(l,s)},fb.core.snap.IndexMap.prototype.addToIndexes=function(s,l){var c=this,e=goog.object.map(this.indexes_,function(e,t){var o,r=fb.util.obj.get(c.indexSet_,t);if(fb.core.util.assert(r,"Missing index implementation for "+t),e!==fb.core.snap.Index.Fallback)return t=e,(t=(o=l.get(s.name))?e.remove(new fb.core.snap.NamedNode(s.name,o)):t).insert(s,s.node);if(r.isDefinedOn(s.node)){for(var n=[],i=l.getIterator(fb.core.snap.NamedNode.Wrap),a=i.getNext();a;)a.name!=s.name&&n.push(a),a=i.getNext();return n.push(s),fb.core.snap.buildChildSet(n,r.getCompare())}return fb.core.snap.Index.Fallback});return new fb.core.snap.IndexMap(e,this.indexSet_)},fb.core.snap.IndexMap.prototype.removeFromIndexes=function(o,r){var e=goog.object.map(this.indexes_,function(e){var t;return e!==fb.core.snap.Index.Fallback&&(t=r.get(o.name))?e.remove(new fb.core.snap.NamedNode(o.name,t)):e});return new fb.core.snap.IndexMap(e,this.indexSet_)},fb.core.snap.IndexMap.Default=new fb.core.snap.IndexMap({".priority":fb.core.snap.Index.Fallback},{".priority":fb.core.snap.PriorityIndex}),goog.provide("fb.core.snap.LeafNode"),goog.require("fb.core.snap.Node"),goog.require("fb.core.util"),fb.core.snap.LeafNode=goog.defineClass(null,{constructor:function(e,t){this.value_=e,fb.core.util.assert(goog.isDef(this.value_)&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),this.priorityNode_=t||fb.core.snap.EMPTY_NODE,fb.core.snap.validatePriorityNode(this.priorityNode_),this.lazyHash_=null},statics:{VALUE_TYPE_ORDER:["object","boolean","number","string"]},isLeafNode:function(){return!0},getPriority:function(){return this.priorityNode_},updatePriority:function(e){return new fb.core.snap.LeafNode(this.value_,e)},getImmediateChild:function(e){return".priority"===e?this.priorityNode_:fb.core.snap.EMPTY_NODE},getChild:function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:fb.core.snap.EMPTY_NODE},hasChild:function(){return!1},getPredecessorChildName:function(e,t){return null},updateImmediateChild:function(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:fb.core.snap.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)},updateChild:function(e,t){var o=e.getFront();return null===o?t:t.isEmpty()&&".priority"!==o?this:(fb.core.util.assert(".priority"!==o||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(o,fb.core.snap.EMPTY_NODE.updateChild(e.popFront(),t)))},isEmpty:function(){return!1},numChildren:function(){return 0},forEachChild:function(e,t){return!1},val:function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},hash:function(){var e,t;return null===this.lazyHash_&&(t="",this.priorityNode_.isEmpty()||(t+="priority:"+fb.core.snap.priorityHashText(this.priorityNode_.val())+":"),t=(t+=(e=typeof this.value_)+":")+("number"==e?fb.core.util.doubleToIEEE754String(this.value_):this.value_),this.lazyHash_=fb.core.util.sha1(t)),this.lazyHash_},getValue:function(){return this.value_},compareTo:function(e){return e===fb.core.snap.EMPTY_NODE?1:e instanceof fb.core.snap.ChildrenNode?-1:(fb.core.util.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},compareToLeafNode_:function(e){var t=typeof e.value_,o=typeof this.value_,r=goog.array.indexOf(fb.core.snap.LeafNode.VALUE_TYPE_ORDER,t),n=goog.array.indexOf(fb.core.snap.LeafNode.VALUE_TYPE_ORDER,o);return fb.core.util.assert(0<=r,"Unknown leaf type: "+t),fb.core.util.assert(0<=n,"Unknown leaf type: "+o),r===n?"object"==o?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:n-r},withIndex:function(){return this},isIndexed:function(){return!0},equals:function(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}),goog.DEBUG&&(fb.core.snap.LeafNode.prototype.toString=function(){return fb.util.json.stringify(this.val(!0))}),goog.provide("fb.core.snap.ChildrenNode"),goog.require("fb.core.snap.IndexMap"),goog.require("fb.core.snap.LeafNode"),goog.require("fb.core.snap.NamedNode"),goog.require("fb.core.snap.Node"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.snap.comparators"),goog.require("fb.core.util"),goog.require("fb.core.util.SortedMap"),fb.core.snap.ChildrenNode=function(e,t,o){this.children_=e,this.priorityNode_=t,this.priorityNode_&&fb.core.snap.validatePriorityNode(this.priorityNode_),e.isEmpty()&&fb.core.util.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority"),this.indexMap_=o,this.lazyHash_=null},fb.core.snap.ChildrenNode.prototype.isLeafNode=function(){return!1},fb.core.snap.ChildrenNode.prototype.getPriority=function(){return this.priorityNode_||fb.core.snap.EMPTY_NODE},fb.core.snap.ChildrenNode.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new fb.core.snap.ChildrenNode(this.children_,e,this.indexMap_)},fb.core.snap.ChildrenNode.prototype.getImmediateChild=function(e){return".priority"===e?this.getPriority():null===(e=this.children_.get(e))?fb.core.snap.EMPTY_NODE:e},fb.core.snap.ChildrenNode.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},fb.core.snap.ChildrenNode.prototype.hasChild=function(e){return null!==this.children_.get(e)},fb.core.snap.ChildrenNode.prototype.updateImmediateChild=function(e,t){var o,r;return fb.core.util.assert(t,"We should always be passing snapshot nodes"),".priority"===e?this.updatePriority(t):(o=new fb.core.snap.NamedNode(e,t),e=t.isEmpty()?(r=this.children_.remove(e),this.indexMap_.removeFromIndexes(o,this.children_)):(r=this.children_.insert(e,t),this.indexMap_.addToIndexes(o,this.children_)),t=r.isEmpty()?fb.core.snap.EMPTY_NODE:this.priorityNode_,new fb.core.snap.ChildrenNode(r,t,e))},fb.core.snap.ChildrenNode.prototype.updateChild=function(e,t){var o=e.getFront();return null===o?t:(fb.core.util.assert(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path"),e=this.getImmediateChild(o).updateChild(e.popFront(),t),this.updateImmediateChild(o,e))},fb.core.snap.ChildrenNode.prototype.isEmpty=function(){return this.children_.isEmpty()},fb.core.snap.ChildrenNode.prototype.numChildren=function(){return this.children_.count()},fb.core.snap.ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,fb.core.snap.ChildrenNode.prototype.val=function(o){if(this.isEmpty())return null;var r={},n=0,i=0,a=!0;if(this.forEachChild(fb.core.snap.PriorityIndex,function(e,t){r[e]=t.val(o),n++,a&&fb.core.snap.ChildrenNode.INTEGER_REGEXP_.test(e)?i=Math.max(i,Number(e)):a=!1}),!o&&a&&i<2*n){var e,t=[];for(e in r)t[e]=r[e];return t}return o&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},fb.core.snap.ChildrenNode.prototype.hash=function(){var o;return null===this.lazyHash_&&(o="",this.getPriority().isEmpty()||(o+="priority:"+fb.core.snap.priorityHashText(this.getPriority().val())+":"),this.forEachChild(fb.core.snap.PriorityIndex,function(e,t){t=t.hash();""!==t&&(o+=":"+e+":"+t)}),this.lazyHash_=""===o?"":fb.core.util.sha1(o)),this.lazyHash_},fb.core.snap.ChildrenNode.prototype.getPredecessorChildName=function(e,t,o){var o=this.resolveIndex_(o);return o?(o=o.getPredecessorKey(new fb.core.snap.NamedNode(e,t)))?o.name:null:this.children_.getPredecessorKey(e)},fb.core.snap.ChildrenNode.prototype.getFirstChildName=function(e){var e=this.resolveIndex_(e);return e?(e=e.minKey())&&e.name:this.children_.minKey()},fb.core.snap.ChildrenNode.prototype.getFirstChild=function(e){e=this.getFirstChildName(e);return e?new fb.core.snap.NamedNode(e,this.children_.get(e)):null},fb.core.snap.ChildrenNode.prototype.getLastChildName=function(e){var e=this.resolveIndex_(e);return e?(e=e.maxKey())&&e.name:this.children_.maxKey()},fb.core.snap.ChildrenNode.prototype.getLastChild=function(e){e=this.getLastChildName(e);return e?new fb.core.snap.NamedNode(e,this.children_.get(e)):null},fb.core.snap.ChildrenNode.prototype.forEachChild=function(e,t){e=this.resolveIndex_(e);return e?e.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},fb.core.snap.ChildrenNode.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},fb.core.snap.ChildrenNode.prototype.getIteratorFrom=function(e,t){var o=this.resolveIndex_(t);if(o)return o.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,fb.core.snap.NamedNode.Wrap),n=r.peek();null!=n&&t.compare(n,e)<0;)r.getNext(),n=r.peek();return r},fb.core.snap.ChildrenNode.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},fb.core.snap.ChildrenNode.prototype.getReverseIteratorFrom=function(e,t){var o=this.resolveIndex_(t);if(o)return o.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,fb.core.snap.NamedNode.Wrap),n=r.peek();null!=n&&0<t.compare(n,e);)r.getNext(),n=r.peek();return r},fb.core.snap.ChildrenNode.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===fb.core.snap.MAX_NODE?-1:0},fb.core.snap.ChildrenNode.prototype.withIndex=function(e){return e===fb.core.snap.KeyIndex||this.indexMap_.hasIndex(e)?this:(e=this.indexMap_.addIndex(e,this.children_),new fb.core.snap.ChildrenNode(this.children_,this.priorityNode_,e))},fb.core.snap.ChildrenNode.prototype.isIndexed=function(e){return e===fb.core.snap.KeyIndex||this.indexMap_.hasIndex(e)},fb.core.snap.ChildrenNode.prototype.equals=function(e){if(e===this)return!0;if(!e.isLeafNode())if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var t=this.getIterator(fb.core.snap.PriorityIndex),o=e.getIterator(fb.core.snap.PriorityIndex),r=t.getNext(),n=o.getNext();r&&n;){if(r.name!==n.name||!r.node.equals(n.node))return!1;r=t.getNext(),n=o.getNext()}return null===r&&null===n}return!1},fb.core.snap.ChildrenNode.prototype.resolveIndex_=function(e){return e===fb.core.snap.KeyIndex?null:this.indexMap_.get(e.toString())},goog.DEBUG&&(fb.core.snap.ChildrenNode.prototype.toString=function(){return fb.util.json.stringify(this.val(!0))}),goog.provide("fb.core.snap"),goog.require("fb.core.snap.ChildrenNode"),goog.require("fb.core.snap.IndexMap"),goog.require("fb.core.snap.LeafNode"),goog.require("fb.core.util"),!0),LOG_2=(fb.core.snap.NodeFromJSON=function(e,t){var o,r,n,i,a,s;return null===e?fb.core.snap.EMPTY_NODE:(o=null,"object"==typeof e&&".priority"in e?o=e[".priority"]:void 0!==t&&(o=t),fb.core.util.assert(null===o||"string"==typeof o||"number"==typeof o||"object"==typeof o&&".sv"in o,"Invalid priority type found: "+typeof o),"object"!=typeof(e="object"==typeof e&&".value"in e&&null!==e[".value"]?e[".value"]:e)||".sv"in e?(t=e,new fb.core.snap.LeafNode(t,fb.core.snap.NodeFromJSON(o))):e instanceof Array||!USE_HINZE?(r=fb.core.snap.EMPTY_NODE,n=e,goog.object.forEach(n,function(e,t){!fb.util.obj.contains(n,t)||"."===t.substring(0,1)||!(e=fb.core.snap.NodeFromJSON(e)).isLeafNode()&&e.isEmpty()||(r=r.updateImmediateChild(t,e))}),r.updatePriority(fb.core.snap.NodeFromJSON(o))):(a=!(i=[]),s=e,fb.util.obj.foreach(s,function(e,t){var o;"string"==typeof e&&"."===e.substring(0,1)||((o=fb.core.snap.NodeFromJSON(s[e])).isEmpty()||(a=a||!o.getPriority().isEmpty(),i.push(new fb.core.snap.NamedNode(e,o))))}),0==i.length?fb.core.snap.EMPTY_NODE:(t=fb.core.snap.buildChildSet(i,fb.core.snap.NAME_ONLY_COMPARATOR,function(e){return e.name},fb.core.snap.NAME_COMPARATOR),a?(e=fb.core.snap.buildChildSet(i,fb.core.snap.PriorityIndex.getCompare()),new fb.core.snap.ChildrenNode(t,fb.core.snap.NodeFromJSON(o),new fb.core.snap.IndexMap({".priority":e},{".priority":fb.core.snap.PriorityIndex}))):new fb.core.snap.ChildrenNode(t,fb.core.snap.NodeFromJSON(o),fb.core.snap.IndexMap.Default))))},Math.log(2)),errors=(fb.core.snap.Base12Num=function(e){this.count=(t=e+1,parseInt(Math.log(t)/LOG_2,10)),this.current_=this.count-1,t=this.count;var t=parseInt(Array(t+1).join("1"),2);this.bits_=e+1&t},fb.core.snap.Base12Num.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},fb.core.snap.buildChildSet=function(l,e,c,t){l.sort(e);var g=function(e,t){var o,r,n=t-e;return 0==n?null:1==n?(o=l[e],r=c?c(o):o,new fb.LLRBNode(r,o.node,fb.LLRBNode.BLACK,null,null)):(n=parseInt(n/2,10)+e,e=g(e,n),t=g(n+1,t),o=l[n],r=c?c(o):o,new fb.LLRBNode(r,o.node,fb.LLRBNode.BLACK,e,t))},o=function(e){function t(e,t){var o=a-e,r=a,e=(a-=e,g(1+o,r)),r=l[o],o=c?c(r):r,o=new fb.LLRBNode(o,r.node,t,null,e);n=n?n.left=o:i=o}for(var n=null,i=null,a=l.length,o=0;o<e.count;++o){var r=e.nextBitIsOne(),s=Math.pow(2,e.count-(o+1));r?t(s,fb.LLRBNode.BLACK):(t(s,fb.LLRBNode.BLACK),t(s,fb.LLRBNode.RED))}return i}(new fb.core.snap.Base12Num(l.length));return null!==o?new fb.core.util.SortedMap(t||e,o):new fb.core.util.SortedMap(t||e)},fb.core.snap.priorityHashText=function(e){return"number"==typeof e?"number:"+fb.core.util.doubleToIEEE754String(e):"string:"+e},fb.core.snap.validatePriorityNode=function(e){var t;e.isLeafNode()?(t=e.val(),fb.core.util.assert("string"==typeof t||"number"==typeof t||"object"==typeof t&&fb.util.obj.contains(t,".sv"),"Priority must be a string or number.")):fb.core.util.assert(e===fb.core.snap.MAX_NODE||e.isEmpty(),"priority of unexpected type."),fb.core.util.assert(e===fb.core.snap.MAX_NODE||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},fb.core.snap.EMPTY_NODE=new fb.core.snap.ChildrenNode(new fb.core.util.SortedMap(fb.core.snap.NAME_COMPARATOR),null,fb.core.snap.IndexMap.Default),fb.core.snap.MAX_NODE_=function(){fb.core.snap.ChildrenNode.call(this,new fb.core.util.SortedMap(fb.core.snap.NAME_COMPARATOR),fb.core.snap.EMPTY_NODE,fb.core.snap.IndexMap.Default)},goog.inherits(fb.core.snap.MAX_NODE_,fb.core.snap.ChildrenNode),fb.core.snap.MAX_NODE_.prototype.compareTo=function(e){return e===this?0:1},fb.core.snap.MAX_NODE_.prototype.equals=function(e){return e===this},fb.core.snap.MAX_NODE_.prototype.getPriority=function(){return this},fb.core.snap.MAX_NODE_.prototype.getImmediateChild=function(e){return fb.core.snap.EMPTY_NODE},fb.core.snap.MAX_NODE_.prototype.isEmpty=function(){return!1},fb.core.snap.MAX_NODE=new fb.core.snap.MAX_NODE_,fb.core.snap.NamedNode.MIN=new fb.core.snap.NamedNode(fb.core.util.MIN_NAME,fb.core.snap.EMPTY_NODE),fb.core.snap.NamedNode.MAX=new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,fb.core.snap.MAX_NODE),goog.provide("fb.core.view.ViewCache"),goog.require("fb.core.view.CacheNode"),goog.require("fb.core.snap"),fb.core.view.ViewCache=function(e,t){this.eventCache_=e,this.serverCache_=t},fb.core.view.ViewCache.Empty=new fb.core.view.ViewCache(new fb.core.view.CacheNode(fb.core.snap.EMPTY_NODE,!1,!1),new fb.core.view.CacheNode(fb.core.snap.EMPTY_NODE,!1,!1)),fb.core.view.ViewCache.prototype.updateEventSnap=function(e,t,o){return new fb.core.view.ViewCache(new fb.core.view.CacheNode(e,t,o),this.serverCache_)},fb.core.view.ViewCache.prototype.updateServerSnap=function(e,t,o){return new fb.core.view.ViewCache(this.eventCache_,new fb.core.view.CacheNode(e,t,o))},fb.core.view.ViewCache.prototype.getEventCache=function(){return this.eventCache_},fb.core.view.ViewCache.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},fb.core.view.ViewCache.prototype.getServerCache=function(){return this.serverCache_},fb.core.view.ViewCache.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},goog.provide("fb.core.view.View"),goog.require("fb.core.view.EventGenerator"),goog.require("fb.core.view.ViewCache"),goog.require("fb.core.view.ViewProcessor"),goog.require("fb.core.util"),fb.core.view.View=function(e,t){var o=(this.query_=e).getQueryParams(),r=new fb.core.view.filter.IndexedFilter(o.getIndex()),o=o.getNodeFilter(),n=(this.processor_=new fb.core.view.ViewProcessor(o),t.getServerCache()),t=t.getEventCache(),i=r.updateFullNode(fb.core.snap.EMPTY_NODE,n.getNode(),null),a=o.updateFullNode(fb.core.snap.EMPTY_NODE,t.getNode(),null),i=new fb.core.view.CacheNode(i,n.isFullyInitialized(),r.filtersNodes()),n=new fb.core.view.CacheNode(a,t.isFullyInitialized(),o.filtersNodes());this.viewCache_=new fb.core.view.ViewCache(n,i),this.eventRegistrations_=[],this.eventGenerator_=new fb.core.view.EventGenerator(e)},fb.core.view.View.prototype.getQuery=function(){return this.query_},fb.core.view.View.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},fb.core.view.View.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},fb.core.view.View.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},fb.core.view.View.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},fb.core.view.View.prototype.removeEventRegistration=function(e,t){var o,r=[];if(t&&(fb.core.util.assert(null==e,"A cancel should cancel all event registrations."),o=this.query_.path,goog.array.forEach(this.eventRegistrations_,function(e){e=e.createCancelEvent(t,o);e&&r.push(e)})),e){for(var n=[],i=0;i<this.eventRegistrations_.length;++i){var a=this.eventRegistrations_[i];if(a.matches(e)){if(e.hasAnyCallback()){n=n.concat(this.eventRegistrations_.slice(i+1));break}}else n.push(a)}this.eventRegistrations_=n}else this.eventRegistrations_=[];return r},fb.core.view.View.prototype.applyOperation=function(e,t,o){e.type===fb.core.OperationType.MERGE&&null!==e.source.queryId&&(fb.core.util.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),fb.core.util.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,e=this.processor_.applyOperation(r,e,t,o);return this.processor_.assertIndexed(e.viewCache),fb.core.util.assert(e.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=e.viewCache,this.generateEventsForChanges_(e.changes,e.viewCache.getEventCache().getNode(),null)},fb.core.view.View.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),o=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(fb.core.snap.PriorityIndex,function(e,t){o.push(fb.core.view.Change.childAddedChange(e,t))}),t.isFullyInitialized()&&o.push(fb.core.view.Change.valueChange(t.getNode())),this.generateEventsForChanges_(o,t.getNode(),e)},fb.core.view.View.prototype.generateEventsForChanges_=function(e,t,o){o=o?[o]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,o)},goog.provide("fb.core.operation.Merge"),goog.require("fb.core.util"),fb.core.operation.Merge=function(e,t,o){this.type=fb.core.OperationType.MERGE,this.source=e,this.path=t,this.children=o},fb.core.operation.Merge.prototype.operationForChild=function(e){var t;return this.path.isEmpty()?(t=this.children.subtree(new fb.core.util.Path(e))).isEmpty()?null:t.value?new fb.core.operation.Overwrite(this.source,fb.core.util.Path.Empty,t.value):new fb.core.operation.Merge(this.source,fb.core.util.Path.Empty,t):(fb.core.util.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new fb.core.operation.Merge(this.source,this.path.popFront(),this.children))},goog.DEBUG&&(fb.core.operation.Merge.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}),goog.provide("fb.core.ReadonlyRestClient"),goog.require("fb.core.util"),goog.require("fb.util"),goog.require("fb.util.json"),goog.require("fb.util.jwt"),goog.require("fb.util.obj"),fb.core.ReadonlyRestClient=goog.defineClass(null,{constructor:function(e,t){this.log_=fb.core.util.logWrapper("p:rest:"),this.repoInfo_=e,this.onDataUpdate_=t,this.credential_=null,this.listens_={}},listen:function(e,t,o,r){var n=e.path.toString(),i=(this.log_("Listen called for "+n+" "+e.queryIdentifier()),fb.core.ReadonlyRestClient.getListenId_(e,o)),a=new Object,e=(this.listens_[i]=a,e.getQueryParams().toRestQueryStringParameters()),s=this;this.restRequest_(n+".json",e,function(e,t){null===(e=404===e?t=null:e)&&s.onDataUpdate_(n,t,!1,o),fb.util.obj.get(s.listens_,i)===a&&r(e?401==e?"permission_denied":"rest_error:"+e:"ok",null)})},unlisten:function(e,t){e=fb.core.ReadonlyRestClient.getListenId_(e,t);delete this.listens_[e]},auth:function(e,t,o){this.credential_=e;var e=fb.util.jwt.decode(e),r=e.data,e=e.claims&&e.claims.exp;t&&t("ok",{auth:r,expires:e})},unauth:function(e){e("ok",this.credential_=null)},onDisconnectPut:function(e,t,o){},onDisconnectMerge:function(e,t,o){},onDisconnectCancel:function(e,t){},put:function(e,t,o,r){},merge:function(e,t,o,r){},reportStats:function(e){},restRequest_:function(e,t,o){(t=t||{}).format="export",this.credential_&&(t.auth=this.credential_);var r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?"+fb.util.querystring(t),n=(this.log_("Sending REST request for "+r),new XMLHttpRequest),i=this;n.onreadystatechange=function(){if(o&&4===n.readyState){i.log_("REST Response for "+r+" received. status:",n.status,"response:",n.responseText);var e=null;if(200<=n.status&&n.status<300){try{e=fb.util.json.eval(n.responseText)}catch(e){fb.core.util.warn("Failed to parse JSON response for "+r+": "+n.responseText)}o(null,e)}else 401!==n.status&&404!==n.status&&fb.core.util.warn("Got unsuccessful REST response for "+r+" Status: "+n.status),o(n.status);o=null}},n.open("GET",r,!0),n.send()},statics:{getListenId_:function(e,t){return goog.isDef(t)?"tag$"+t:(fb.core.util.assert(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())}}}),goog.provide("fb.core.util.EventEmitter"),goog.require("fb.core.util"),goog.require("goog.array"),fb.core.util.EventEmitter=goog.defineClass(null,{constructor:function(e){fb.core.util.assert(goog.isArray(e)&&0<e.length,"Requires a non-empty array"),this.allowedEvents_=e,this.listeners_={}},getInitialEvent:goog.abstractMethod,trigger:function(e,t){for(var o=goog.array.clone(this.listeners_[e]||[]),r=0;r<o.length;r++)o[r].callback.apply(o[r].context,Array.prototype.slice.call(arguments,1))},on:function(e,t,o){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:o});e=this.getInitialEvent(e);e&&t.apply(o,e)},off:function(e,t,o){this.validateEventType_(e);for(var r=this.listeners_[e]||[],n=0;n<r.length;n++)if(r[n].callback===t&&(!o||o===r[n].context))return void r.splice(n,1)},validateEventType_:function(t){fb.core.util.assert(goog.array.find(this.allowedEvents_,function(e){return e===t}),"Unknown event: "+t)}}),goog.provide("fb.core.util.nextPushId"),goog.require("fb.core.util"),fb.core.util.nextPushId=function(){var i="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",a=0,s=[];return function(e){for(var t=e===a,o=(a=e,new Array(8)),r=7;0<=r;r--)o[r]=i.charAt(e%64),e=Math.floor(e/64);fb.core.util.assert(0===e,"Cannot push at time == 0");var n=o.join("");if(t){for(r=11;0<=r&&63===s[r];r--)s[r]=0;s[r]++}else for(r=0;r<12;r++)s[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)n+=i.charAt(s[r]);return fb.core.util.assert(20===n.length,"nextPushId: Length should be 20."),n}}(),goog.provide("fb.core.util.OnlineMonitor"),goog.require("fb.core.util"),goog.require("fb.core.util.EventEmitter"),fb.core.util.OnlineMonitor=goog.defineClass(fb.core.util.EventEmitter,{constructor:function(){var e;fb.core.util.EventEmitter.call(this,["online"]),this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&(e=this,window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1))},getInitialEvent:function(e){return fb.core.util.assert("online"===e,"Unknown event type: "+e),[this.online_]},currentlyOnline:function(){return this.online_}}),goog.addSingletonGetter(fb.core.util.OnlineMonitor),goog.provide("fb.core.util.VisibilityMonitor"),goog.require("fb.core.util"),goog.require("fb.core.util.EventEmitter"),fb.core.util.VisibilityMonitor=goog.defineClass(fb.core.util.EventEmitter,{constructor:function(){var t,e,o;fb.core.util.EventEmitter.call(this,["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&(o=this,document.addEventListener(e,function(){var e=!document[t];e!==o.visible_&&(o.visible_=e,o.trigger("visible",e))},!1))},getInitialEvent:function(e){return fb.core.util.assert("visible"===e,"Unknown event type: "+e),[this.visible_]}}),goog.addSingletonGetter(fb.core.util.VisibilityMonitor),goog.provide("fb.core.util.Path"),goog.provide("fb.core.util.ValidationPath"),goog.require("fb.core.util"),goog.require("fb.util.utf8"),goog.require("goog.string"),fb.core.util.Path=goog.defineClass(null,{constructor:function(e,t){if(1==arguments.length){this.pieces_=e.split("/");for(var o=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[o]=this.pieces_[r],o++);this.pieces_.length=o,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t},getFront:function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},getLength:function(){return this.pieces_.length-this.pieceNum_},popFront:function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new fb.core.util.Path(this.pieces_,e)},getBack:function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},toString:function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},toUrlEncodedString:function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+goog.string.urlEncode(this.pieces_[t]));return e||"/"},slice:function(e){return this.pieces_.slice(this.pieceNum_+(e||0))},parent:function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],t=this.pieceNum_;t<this.pieces_.length-1;t++)e.push(this.pieces_[t]);return new fb.core.util.Path(e,0)},child:function(e){for(var t=[],o=this.pieceNum_;o<this.pieces_.length;o++)t.push(this.pieces_[o]);if(e instanceof fb.core.util.Path)for(o=e.pieceNum_;o<e.pieces_.length;o++)t.push(e.pieces_[o]);else for(var r=e.split("/"),o=0;o<r.length;o++)0<r[o].length&&t.push(r[o]);return new fb.core.util.Path(t,0)},isEmpty:function(){return this.pieceNum_>=this.pieces_.length},statics:{relativePath:function(e,t){var o=e.getFront(),r=t.getFront();if(null===o)return t;if(o===r)return fb.core.util.Path.relativePath(e.popFront(),t.popFront());throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")},comparePaths:function(e,t){for(var o=e.slice(),r=t.slice(),n=0;n<o.length&&n<r.length;n++){var i=fb.core.util.nameCompare(o[n],r[n]);if(0!==i)return i}return o.length===r.length?0:o.length<r.length?-1:1}},equals:function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,o=e.pieceNum_;t<=this.pieces_.length;t++,o++)if(this.pieces_[t]!==e.pieces_[o])return!1;return!0},contains:function(e){var t=this.pieceNum_,o=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[o])return!1;++t,++o}return!0}}),fb.core.util.Path.Empty=new fb.core.util.Path(""),fb.core.util.ValidationPath=goog.defineClass(null,{constructor:function(e,t){this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length),this.errorPrefix_=t;for(var o=0;o<this.parts_.length;o++)this.byteLength_+=fb.util.utf8.stringLength(this.parts_[o]);this.checkValid_()},statics:{MAX_PATH_DEPTH:32,MAX_PATH_LENGTH_BYTES:768},push:function(e){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=fb.util.utf8.stringLength(e),this.checkValid_()},pop:function(){var e=this.parts_.pop();this.byteLength_-=fb.util.utf8.stringLength(e),0<this.parts_.length&&--this.byteLength_},checkValid_:function(){if(this.byteLength_>fb.core.util.ValidationPath.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+fb.core.util.ValidationPath.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>fb.core.util.ValidationPath.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+fb.core.util.ValidationPath.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},toErrorString:function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"}}),goog.provide("fb.core.util.ImmutableTree"),goog.require("fb.core.util"),goog.require("fb.core.util.Path"),goog.require("fb.core.util.SortedMap"),goog.require("fb.util.json"),goog.require("fb.util.obj"),goog.require("goog.object"),fb.core.util.ImmutableTree=goog.defineClass(null,{constructor:function(e,t){this.value=e,this.children=t||fb.core.util.ImmutableTree.EmptyChildren_},statics:{EmptyChildren_:new fb.core.util.SortedMap(fb.core.util.stringCompare),fromObject:function(e){var o=fb.core.util.ImmutableTree.Empty;return goog.object.forEach(e,function(e,t){o=o.set(new fb.core.util.Path(t),e)}),o}},isEmpty:function(){return null===this.value&&this.children.isEmpty()},findRootMostMatchingPathAndValue:function(e,t){var o,r,n;return null!=this.value&&t(this.value)?{path:fb.core.util.Path.Empty,value:this.value}:!e.isEmpty()&&(o=e.getFront(),null!==(r=this.children.get(o))&&null!=(n=r.findRootMostMatchingPathAndValue(e.popFront(),t)))?{path:new fb.core.util.Path(o).child(n.path),value:n.value}:null},findRootMostValueAndPath:function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},subtree:function(e){var t;return e.isEmpty()?this:(t=e.getFront(),null!==(t=this.children.get(t))?t.subtree(e.popFront()):fb.core.util.ImmutableTree.Empty)},set:function(e,t){var o;return e.isEmpty()?new fb.core.util.ImmutableTree(t,this.children):(o=e.getFront(),e=(this.children.get(o)||fb.core.util.ImmutableTree.Empty).set(e.popFront(),t),t=this.children.insert(o,e),new fb.core.util.ImmutableTree(this.value,t))},remove:function(e){var t,o;return e.isEmpty()?this.children.isEmpty()?fb.core.util.ImmutableTree.Empty:new fb.core.util.ImmutableTree(null,this.children):(t=e.getFront(),(o=this.children.get(t))?(e=(o=o.remove(e.popFront())).isEmpty()?this.children.remove(t):this.children.insert(t,o),null===this.value&&e.isEmpty()?fb.core.util.ImmutableTree.Empty:new fb.core.util.ImmutableTree(this.value,e)):this)},get:function(e){var t;return e.isEmpty()?this.value:(t=e.getFront(),(t=this.children.get(t))?t.get(e.popFront()):null)},setTree:function(e,t){var o;return e.isEmpty()?t:(o=e.getFront(),t=(e=(this.children.get(o)||fb.core.util.ImmutableTree.Empty).setTree(e.popFront(),t)).isEmpty()?this.children.remove(o):this.children.insert(o,e),new fb.core.util.ImmutableTree(this.value,t))},fold:function(e){return this.fold_(fb.core.util.Path.Empty,e)},fold_:function(o,r){var n={};return this.children.inorderTraversal(function(e,t){n[e]=t.fold_(o.child(e),r)}),r(o,this.value,n)},findOnPath:function(e,t){return this.findOnPath_(e,fb.core.util.Path.Empty,t)},findOnPath_:function(e,t,o){var r,n=!!this.value&&o(t,this.value);return n||(!e.isEmpty()&&(n=e.getFront(),r=this.children.get(n))?r.findOnPath_(e.popFront(),t.child(n),o):null)},foreachOnPath:function(e,t){return this.foreachOnPath_(e,fb.core.util.Path.Empty,t)},foreachOnPath_:function(e,t,o){var r,n;return e.isEmpty()?this:(this.value&&o(t,this.value),r=e.getFront(),(n=this.children.get(r))?n.foreachOnPath_(e.popFront(),t.child(r),o):fb.core.util.ImmutableTree.Empty)},foreach:function(e){this.foreach_(fb.core.util.Path.Empty,e)},foreach_:function(o,r){this.children.inorderTraversal(function(e,t){t.foreach_(o.child(e),r)}),this.value&&r(o,this.value)},foreachChild:function(o){this.children.inorderTraversal(function(e,t){t.value&&o(e,t.value)})}}),fb.core.util.ImmutableTree.Empty=new fb.core.util.ImmutableTree(null),goog.DEBUG&&(fb.core.util.ImmutableTree.prototype.toString=function(){var o={};return this.foreach(function(e,t){e=e.toString();o[e]=t.toString()}),fb.util.json.stringify(o)}),goog.provide("fb.core.operation.AckUserWrite"),goog.require("fb.core.util.ImmutableTree"),fb.core.operation.AckUserWrite=function(e,t,o){this.type=fb.core.OperationType.ACK_USER_WRITE,this.source=fb.core.OperationSource.User,this.path=e,this.affectedTree=t,this.revert=o},fb.core.operation.AckUserWrite.prototype.operationForChild=function(e){var t;return this.path.isEmpty()?null!=this.affectedTree.value?(fb.core.util.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this):(t=this.affectedTree.subtree(new fb.core.util.Path(e)),new fb.core.operation.AckUserWrite(fb.core.util.Path.Empty,t,this.revert)):(fb.core.util.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new fb.core.operation.AckUserWrite(this.path.popFront(),this.affectedTree,this.revert))},goog.DEBUG&&(fb.core.operation.AckUserWrite.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" ack write revert="+this.revert+" affectedTree="+this.affectedTree+")"}),goog.provide("fb.core.Operation"),goog.require("fb.core.operation.AckUserWrite"),goog.require("fb.core.operation.Merge"),goog.require("fb.core.operation.Overwrite"),goog.require("fb.core.operation.ListenComplete"),goog.require("fb.core.util"),fb.core.OperationType={OVERWRITE:0,MERGE:1,ACK_USER_WRITE:2,LISTEN_COMPLETE:3},fb.core.Operation=function(){},fb.core.Operation.prototype.source,fb.core.Operation.prototype.type,fb.core.Operation.prototype.path,fb.core.Operation.prototype.operationForChild=goog.abstractMethod,fb.core.OperationSource=function(e,t,o,r){this.fromUser=e,this.fromServer=t,this.queryId=o,this.tagged=r,fb.core.util.assert(!r||t,"Tagged queries must be from server.")},fb.core.OperationSource.User=new fb.core.OperationSource(!0,!1,null,!1),fb.core.OperationSource.Server=new fb.core.OperationSource(!1,!0,null,!1),fb.core.OperationSource.forServerTaggedQuery=function(e){return new fb.core.OperationSource(!1,!0,e,!0)},goog.DEBUG&&(fb.core.OperationSource.prototype.toString=function(){return this.fromUser?"user":this.tagged?"server(queryID="+this.queryId+")":"server"}),goog.provide("fb.core.CompoundWrite"),goog.require("fb.core.snap.Node"),goog.require("fb.core.util"),goog.require("fb.core.util.ImmutableTree"),fb.core.CompoundWrite=function(e){this.writeTree_=e},fb.core.CompoundWrite.Empty=new fb.core.CompoundWrite(new fb.core.util.ImmutableTree(null)),fb.core.CompoundWrite.prototype.addWrite=function(e,t){var o,r,n;return e.isEmpty()?new fb.core.CompoundWrite(new fb.core.util.ImmutableTree(t)):null!=(o=this.writeTree_.findRootMostValueAndPath(e))?(n=o.path,o=o.value,r=fb.core.util.Path.relativePath(n,e),o=o.updateChild(r,t),new fb.core.CompoundWrite(this.writeTree_.set(n,o))):(r=new fb.core.util.ImmutableTree(t),n=this.writeTree_.setTree(e,r),new fb.core.CompoundWrite(n))},fb.core.CompoundWrite.prototype.addWrites=function(o,e){var r=this;return fb.util.obj.foreach(e,function(e,t){r=r.addWrite(o.child(e),t)}),r},fb.core.CompoundWrite.prototype.removeWrite=function(e){return e.isEmpty()?fb.core.CompoundWrite.Empty:(e=this.writeTree_.setTree(e,fb.core.util.ImmutableTree.Empty),new fb.core.CompoundWrite(e))},fb.core.CompoundWrite.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},fb.core.CompoundWrite.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(fb.core.util.Path.relativePath(t.path,e)):null},fb.core.CompoundWrite.prototype.getCompleteChildren=function(){var o=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(fb.core.snap.PriorityIndex,function(e,t){o.push(new fb.core.snap.NamedNode(e,t))}):this.writeTree_.children.inorderTraversal(function(e,t){null!=t.value&&o.push(new fb.core.snap.NamedNode(e,t.value))}),o},fb.core.CompoundWrite.prototype.childCompoundWrite=function(e){var t;return e.isEmpty()?this:null!=(t=this.getCompleteNode(e))?new fb.core.CompoundWrite(new fb.core.util.ImmutableTree(t)):new fb.core.CompoundWrite(this.writeTree_.subtree(e))},fb.core.CompoundWrite.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},fb.core.CompoundWrite.prototype.apply=function(e){return fb.core.CompoundWrite.applySubtreeWrite_(fb.core.util.Path.Empty,this.writeTree_,e)},fb.core.CompoundWrite.applySubtreeWrite_=function(o,e,r){var n;return null!=e.value?r.updateChild(o,e.value):(n=null,e.children.inorderTraversal(function(e,t){".priority"===e?(fb.core.util.assert(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):r=fb.core.CompoundWrite.applySubtreeWrite_(o.child(e),t,r)}),r=r.getChild(o).isEmpty()||null===n?r:r.updateChild(o.child(".priority"),n))},goog.provide("fb.core.WriteTree"),goog.require("fb.core.CompoundWrite"),goog.require("fb.core.util"),goog.require("fb.core.view.CacheNode"),fb.core.WriteRecord,fb.core.WriteTree=function(){this.visibleWrites_=fb.core.CompoundWrite.Empty,this.allWrites_=[],this.lastWriteId_=-1},fb.core.WriteTree.prototype.childWrites=function(e){return new fb.core.WriteTreeRef(e,this)},fb.core.WriteTree.prototype.addOverwrite=function(e,t,o,r){fb.core.util.assert(o>this.lastWriteId_,"Stacking an older write on top of newer ones"),goog.isDef(r)||(r=!0),this.allWrites_.push({path:e,snap:t,writeId:o,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=o},fb.core.WriteTree.prototype.addMerge=function(e,t,o){fb.core.util.assert(o>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:o,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=o},fb.core.WriteTree.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var o=this.allWrites_[t];if(o.writeId===e)return o}return null},fb.core.WriteTree.prototype.removeWrite=function(t){for(var e,o,r=goog.array.findIndex(this.allWrites_,function(e){return e.writeId===t}),n=(fb.core.util.assert(0<=r,"removeWrite called with nonexistent writeId."),this.allWrites_[r]),i=(this.allWrites_.splice(r,1),n.visible),a=!1,s=this.allWrites_.length-1;i&&0<=s;){var l=this.allWrites_[s];l.visible&&(r<=s&&this.recordContainsPath_(l,n.path)?i=!1:n.path.contains(l.path)&&(a=!0)),s--}return!!i&&(a?this.resetTree_():n.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(n.path):(e=n.children,o=this,goog.object.forEach(e,function(e,t){o.visibleWrites_=o.visibleWrites_.removeWrite(n.path.child(t))})),!0)},fb.core.WriteTree.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},fb.core.WriteTree.prototype.calcCompleteEventCache=function(t,e,o,r){var n,i;return o||r?(n=this.visibleWrites_.childCompoundWrite(t),!r&&n.isEmpty()?e:r||null!=e||n.hasCompleteWrite(fb.core.util.Path.Empty)?(n=fb.core.WriteTree.layerTree_(this.allWrites_,function(e){return(e.visible||r)&&(!o||!goog.array.contains(o,e.writeId))&&(e.path.contains(t)||t.contains(e.path))},t),i=e||fb.core.snap.EMPTY_NODE,n.apply(i)):null):null!=(n=this.visibleWrites_.getCompleteNode(t))?n:(n=this.visibleWrites_.childCompoundWrite(t)).isEmpty()?e:null!=e||n.hasCompleteWrite(fb.core.util.Path.Empty)?(i=e||fb.core.snap.EMPTY_NODE,n.apply(i)):null},fb.core.WriteTree.prototype.calcCompleteEventChildren=function(e,t){var o,r=fb.core.snap.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(e);return n?n.isLeafNode()||n.forEachChild(fb.core.snap.PriorityIndex,function(e,t){r=r.updateImmediateChild(e,t)}):t?(o=this.visibleWrites_.childCompoundWrite(e),t.forEachChild(fb.core.snap.PriorityIndex,function(e,t){t=o.childCompoundWrite(new fb.core.util.Path(e)).apply(t);r=r.updateImmediateChild(e,t)}),goog.array.forEach(o.getCompleteChildren(),function(e){r=r.updateImmediateChild(e.name,e.node)})):(o=this.visibleWrites_.childCompoundWrite(e),goog.array.forEach(o.getCompleteChildren(),function(e){r=r.updateImmediateChild(e.name,e.node)})),r},fb.core.WriteTree.prototype.calcEventCacheAfterServerOverwrite=function(e,t,o,r){fb.core.util.assert(o||r,"Either existingEventSnap or existingServerSnap must exist");o=e.child(t);return this.visibleWrites_.hasCompleteWrite(o)?null:(e=this.visibleWrites_.childCompoundWrite(o)).isEmpty()?r.getChild(t):e.apply(r.getChild(t))},fb.core.WriteTree.prototype.calcCompleteChild=function(e,t,o){var e=e.child(t),r=this.visibleWrites_.getCompleteNode(e);return null!=r?r:o.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(e).apply(o.getNode().getImmediateChild(t)):null},fb.core.WriteTree.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},fb.core.WriteTree.prototype.calcIndexedSlice=function(e,t,o,r,n,i){var a,e=this.visibleWrites_.childCompoundWrite(e),s=e.getCompleteNode(fb.core.util.Path.Empty);if(null!=s)a=s;else{if(null==t)return[];a=e.apply(t)}if((a=a.withIndex(i)).isEmpty()||a.isLeafNode())return[];for(var l=[],c=i.getCompare(),g=n?a.getReverseIteratorFrom(o,i):a.getIteratorFrom(o,i),u=g.getNext();u&&l.length<r;)0!==c(u,o)&&l.push(u),u=g.getNext();return l},fb.core.WriteTree.prototype.recordContainsPath_=function(o,r){return o.snap?o.path.contains(r):!!goog.object.findKey(o.children,function(e,t){return o.path.child(t).contains(r)})},fb.core.WriteTree.prototype.resetTree_=function(){this.visibleWrites_=fb.core.WriteTree.layerTree_(this.allWrites_,fb.core.WriteTree.DefaultFilter_,fb.core.util.Path.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},fb.core.WriteTree.DefaultFilter_=function(e){return e.visible},fb.core.WriteTree.layerTree_=function(e,t,o){for(var r=fb.core.CompoundWrite.Empty,n=0;n<e.length;++n){var i=e[n];if(t(i)){var a,s=i.path;if(i.snap)o.contains(s)?(a=fb.core.util.Path.relativePath(o,s),r=r.addWrite(a,i.snap)):s.contains(o)&&(a=fb.core.util.Path.relativePath(s,o),r=r.addWrite(fb.core.util.Path.Empty,i.snap.getChild(a)));else{if(!i.children)throw fb.core.util.assertionError("WriteRecord should have .snap or .children");o.contains(s)?(a=fb.core.util.Path.relativePath(o,s),r=r.addWrites(a,i.children)):s.contains(o)&&((a=fb.core.util.Path.relativePath(s,o)).isEmpty()?r=r.addWrites(fb.core.util.Path.Empty,i.children):(s=fb.util.obj.get(i.children,a.getFront()))&&(i=s.getChild(a.popFront()),r=r.addWrite(fb.core.util.Path.Empty,i)))}}}return r},fb.core.WriteTreeRef=function(e,t){this.treePath_=e,this.writeTree_=t},fb.core.WriteTreeRef.prototype.calcCompleteEventCache=function(e,t,o){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,o)},fb.core.WriteTreeRef.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},fb.core.WriteTreeRef.prototype.calcEventCacheAfterServerOverwrite=function(e,t,o){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,o)},fb.core.WriteTreeRef.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},fb.core.WriteTreeRef.prototype.calcIndexedSlice=function(e,t,o,r,n){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,o,r,n)},fb.core.WriteTreeRef.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},fb.core.WriteTreeRef.prototype.child=function(e){return new fb.core.WriteTreeRef(this.treePath_.child(e),this.writeTree_)},goog.provide("fb.core.SyncPoint"),goog.require("fb.core.util"),goog.require("fb.core.util.ImmutableTree"),goog.require("fb.core.view.ViewCache"),goog.require("fb.core.view.EventRegistration"),goog.require("fb.core.view.View"),goog.require("goog.array"),fb.core.SyncPoint=function(){this.views_={}},fb.core.SyncPoint.prototype.isEmpty=function(){return goog.object.isEmpty(this.views_)},fb.core.SyncPoint.prototype.applyOperation=function(t,o,r){var n,e=t.source.queryId;return null!==e?(e=fb.util.obj.get(this.views_,e),fb.core.util.assert(null!=e,"SyncTree gave us an op for an invalid query."),e.applyOperation(t,o,r)):(n=[],goog.object.forEach(this.views_,function(e){n=n.concat(e.applyOperation(t,o,r))}),n)},fb.core.SyncPoint.prototype.addEventRegistration=function(e,t,o,r,n){var i,a,s=e.queryIdentifier(),l=fb.util.obj.get(this.views_,s);return l||(a=!1,a=!!(i=o.calcCompleteEventCache(n?r:null))||(i=r instanceof fb.core.snap.ChildrenNode?o.calcCompleteEventChildren(r):fb.core.snap.EMPTY_NODE,!1),o=new fb.core.view.ViewCache(new fb.core.view.CacheNode(i,a,!1),new fb.core.view.CacheNode(r,n,!1)),l=new fb.core.view.View(e,o),this.views_[s]=l),l.addEventRegistration(t),l.getInitialEvents(t)},fb.core.SyncPoint.prototype.removeEventRegistration=function(e,o,r){var n,t,i=e.queryIdentifier(),a=[],s=[],l=this.hasCompleteView();return"default"===i?goog.object.forEach((n=this).views_,function(e,t){s=s.concat(e.removeEventRegistration(o,r)),e.isEmpty()&&(delete n.views_[t],e.getQuery().getQueryParams().loadsAllData()||a.push(e.getQuery()))}):(t=fb.util.obj.get(this.views_,i))&&(s=s.concat(t.removeEventRegistration(o,r)),t.isEmpty()&&(delete this.views_[i],t.getQuery().getQueryParams().loadsAllData()||a.push(t.getQuery()))),l&&!this.hasCompleteView()&&a.push(new Firebase(e.repo,e.path)),{removed:a,events:s}},fb.core.SyncPoint.prototype.getQueryViews=function(){return goog.array.filter(goog.object.getValues(this.views_),function(e){return!e.getQuery().getQueryParams().loadsAllData()})},fb.core.SyncPoint.prototype.getCompleteServerCache=function(t){var o=null;return goog.object.forEach(this.views_,function(e){o=o||e.getCompleteServerCache(t)}),o},fb.core.SyncPoint.prototype.viewForQuery=function(e){return e.getQueryParams().loadsAllData()?this.getCompleteView():(e=e.queryIdentifier(),fb.util.obj.get(this.views_,e))},fb.core.SyncPoint.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},fb.core.SyncPoint.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},fb.core.SyncPoint.prototype.getCompleteView=function(){return goog.object.findValue(this.views_,function(e){return e.getQuery().getQueryParams().loadsAllData()})||null},goog.provide("fb.core.SyncTree"),goog.require("fb.core.Operation"),goog.require("fb.core.SyncPoint"),goog.require("fb.core.WriteTree"),goog.require("fb.core.util"),fb.core.ListenProvider,fb.core.SyncTree=function(e){this.syncPointTree_=fb.core.util.ImmutableTree.Empty,this.pendingWriteTree_=new fb.core.WriteTree,this.tagToQueryMap_={},this.queryToTagMap_={},this.listenProvider_=e},fb.core.SyncTree.prototype.applyUserOverwrite=function(e,t,o,r){return this.pendingWriteTree_.addOverwrite(e,t,o,r),r?this.applyOperationToSyncPoints_(new fb.core.operation.Overwrite(fb.core.OperationSource.User,e,t)):[]},fb.core.SyncTree.prototype.applyUserMerge=function(e,t,o){this.pendingWriteTree_.addMerge(e,t,o);o=fb.core.util.ImmutableTree.fromObject(t);return this.applyOperationToSyncPoints_(new fb.core.operation.Merge(fb.core.OperationSource.User,e,o))},fb.core.SyncTree.prototype.ackUserWrite=function(e,t){t=t||!1;var o,r=this.pendingWriteTree_.getWrite(e);return this.pendingWriteTree_.removeWrite(e)?(o=fb.core.util.ImmutableTree.Empty,null!=r.snap?o=o.set(fb.core.util.Path.Empty,!0):fb.util.obj.foreach(r.children,function(e,t){o=o.set(new fb.core.util.Path(e),t)}),this.applyOperationToSyncPoints_(new fb.core.operation.AckUserWrite(r.path,o,t))):[]},fb.core.SyncTree.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new fb.core.operation.Overwrite(fb.core.OperationSource.Server,e,t))},fb.core.SyncTree.prototype.applyServerMerge=function(e,t){t=fb.core.util.ImmutableTree.fromObject(t);return this.applyOperationToSyncPoints_(new fb.core.operation.Merge(fb.core.OperationSource.Server,e,t))},fb.core.SyncTree.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new fb.core.operation.ListenComplete(fb.core.OperationSource.Server,e))},fb.core.SyncTree.prototype.applyTaggedQueryOverwrite=function(e,t,o){var r,o=this.queryKeyForTag_(o);return null!=o?(r=(o=this.parseQueryKey_(o)).path,o=o.queryId,e=fb.core.util.Path.relativePath(r,e),e=new fb.core.operation.Overwrite(fb.core.OperationSource.forServerTaggedQuery(o),e,t),this.applyTaggedOperation_(r,o,e)):[]},fb.core.SyncTree.prototype.applyTaggedQueryMerge=function(e,t,o){var r,o=this.queryKeyForTag_(o);return o?(r=(o=this.parseQueryKey_(o)).path,o=o.queryId,e=fb.core.util.Path.relativePath(r,e),t=fb.core.util.ImmutableTree.fromObject(t),e=new fb.core.operation.Merge(fb.core.OperationSource.forServerTaggedQuery(o),e,t),this.applyTaggedOperation_(r,o,e)):[]},fb.core.SyncTree.prototype.applyTaggedListenComplete=function(e,t){var o,t=this.queryKeyForTag_(t);return t?(o=(t=this.parseQueryKey_(t)).path,t=t.queryId,e=fb.core.util.Path.relativePath(o,e),e=new fb.core.operation.ListenComplete(fb.core.OperationSource.forServerTaggedQuery(t),e),this.applyTaggedOperation_(o,t,e)):[]},fb.core.SyncTree.prototype.addEventRegistration=function(e,t){var o,r=e.path,n=null,i=!1,a=(this.syncPointTree_.foreachOnPath(r,function(e,t){e=fb.core.util.Path.relativePath(e,r);n=n||t.getCompleteServerCache(e),i=i||t.hasCompleteView()}),this.syncPointTree_.get(r)),s=(a?(i=i||a.hasCompleteView(),n=n||a.getCompleteServerCache(fb.core.util.Path.Empty)):(a=new fb.core.SyncPoint,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=n?o=!0:(o=!1,n=fb.core.snap.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(e,t){t=t.getCompleteServerCache(fb.core.util.Path.Empty);t&&(n=n.updateImmediateChild(e,t))})),a.viewExistsForQuery(e)),l=(s||e.getQueryParams().loadsAllData()||(c=this.makeQueryKey_(e),fb.core.util.assert(!goog.object.containsKey(this.queryToTagMap_,c),"View does not exist, but we have a tag"),l=fb.core.SyncTree.getNextQueryTag_(),this.queryToTagMap_[c]=l,this.tagToQueryMap_["_"+l]=c),this.pendingWriteTree_.childWrites(r)),c=a.addEventRegistration(e,t,l,n,o);return s||i||(t=a.viewForQuery(e),c=c.concat(this.setupListener_(e,t))),c},fb.core.SyncTree.prototype.removeEventRegistration=function(e,t,o){var r=e.path,n=this.syncPointTree_.get(r),i=[];if(n&&("default"===e.queryIdentifier()||n.viewExistsForQuery(e))){var a,t=n.removeEventRegistration(e,t,o),n=(n.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(r)),t.removed),i=t.events,t=-1!==goog.array.findIndex(n,function(e){return e.getQueryParams().loadsAllData()}),s=this.syncPointTree_.findOnPath(r,function(e,t){return t.hasCompleteView()});if(t&&!s){r=this.syncPointTree_.subtree(r);if(!r.isEmpty())for(var l=this.collectDistinctViewsForSubTree_(r),c=0;c<l.length;++c){var g=l[c],u=g.getQuery(),g=this.createListenerForView_(g);this.listenProvider_.startListening(this.queryForListening_(u),this.tagForQuery_(u),g.hashFn,g.onComplete)}}!s&&0<n.length&&!o&&(t?this.listenProvider_.stopListening(this.queryForListening_(e),null):(a=this,goog.array.forEach(n,function(e){e.queryIdentifier();var t=a.queryToTagMap_[a.makeQueryKey_(e)];a.listenProvider_.stopListening(a.queryForListening_(e),t)}))),this.removeTags_(n)}return i},fb.core.SyncTree.prototype.calcCompleteEventCache=function(o,e){var t=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(o,function(e,t){e=fb.core.util.Path.relativePath(e,o),t=t.getCompleteServerCache(e);if(t)return t});return t.calcCompleteEventCache(o,r,e,!0)},fb.core.SyncTree.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(e,t,o){var r;return t&&t.hasCompleteView()?[t.getCompleteView()]:(r=[],t&&(r=t.getQueryViews()),goog.object.forEach(o,function(e){r=r.concat(e)}),r)})},fb.core.SyncTree.prototype.removeTags_=function(e){for(var t=0;t<e.length;++t){var o,r=e[t];r.getQueryParams().loadsAllData()||(r=this.makeQueryKey_(r),o=this.queryToTagMap_[r],delete this.queryToTagMap_[r],delete this.tagToQueryMap_["_"+o])}},fb.core.SyncTree.prototype.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.ref():e},fb.core.SyncTree.prototype.setupListener_=function(e,t){var o=e.path,r=this.tagForQuery_(e),t=this.createListenerForView_(t),e=this.listenProvider_.startListening(this.queryForListening_(e),r,t.hashFn,t.onComplete),t=this.syncPointTree_.subtree(o);if(r)fb.core.util.assert(!t.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var n=t.fold(function(e,t,o){var r;return!e.isEmpty()&&t&&t.hasCompleteView()?[t.getCompleteView().getQuery()]:(r=[],t&&(r=r.concat(goog.array.map(t.getQueryViews(),function(e){return e.getQuery()}))),goog.object.forEach(o,function(e){r=r.concat(e)}),r)}),i=0;i<n.length;++i){var a=n[i];this.listenProvider_.stopListening(this.queryForListening_(a),this.tagForQuery_(a))}return e},fb.core.SyncTree.prototype.createListenerForView_=function(e){var o=this,r=e.getQuery(),n=this.tagForQuery_(r);return{hashFn:function(){return(e.getServerCache()||fb.core.snap.EMPTY_NODE).hash()},onComplete:function(e,t){return"ok"===e?n?o.applyTaggedListenComplete(r.path,n):o.applyListenComplete(r.path):(e=fb.core.util.errorForServerCode(e),o.removeEventRegistration(r,null,e))}}},fb.core.SyncTree.prototype.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},fb.core.SyncTree.prototype.parseQueryKey_=function(e){var t=e.indexOf("$");return fb.core.util.assert(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new fb.core.util.Path(e.substr(0,t))}},fb.core.SyncTree.prototype.queryKeyForTag_=function(e){return goog.object.get(this.tagToQueryMap_,"_"+e)},fb.core.SyncTree.prototype.tagForQuery_=function(e){e=this.makeQueryKey_(e);return fb.util.obj.get(this.queryToTagMap_,e)},fb.core.SyncTree.nextQueryTag_=1,fb.core.SyncTree.getNextQueryTag_=function(){return fb.core.SyncTree.nextQueryTag_++},fb.core.SyncTree.prototype.applyTaggedOperation_=function(e,t,o){var r=this.syncPointTree_.get(e),e=(fb.core.util.assert(r,"Missing sync point for query tag that we're tracking"),this.pendingWriteTree_.childWrites(e));return r.applyOperation(o,e,null)},fb.core.SyncTree.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(fb.core.util.Path.Empty))},fb.core.SyncTree.prototype.applyOperationHelper_=function(e,t,o,r){var n,i,a,s,l;return e.path.isEmpty()?this.applyOperationDescendantsHelper_(e,t,o,r):(n=t.get(fb.core.util.Path.Empty),null==o&&null!=n&&(o=n.getCompleteServerCache(fb.core.util.Path.Empty)),l=[],s=e.path.getFront(),i=e.operationForChild(s),(t=t.children.get(s))&&i&&(a=o?o.getImmediateChild(s):null,s=r.child(s),l=l.concat(this.applyOperationHelper_(i,t,a,s))),n?l.concat(n.applyOperation(e,r,o)):l)},fb.core.SyncTree.prototype.applyOperationDescendantsHelper_=function(n,e,i,a){var t=e.get(fb.core.util.Path.Empty),s=(null==i&&null!=t&&(i=t.getCompleteServerCache(fb.core.util.Path.Empty)),[]),l=this;return e.children.inorderTraversal(function(e,t){var o=i?i.getImmediateChild(e):null,r=a.child(e),e=n.operationForChild(e);e&&(s=s.concat(l.applyOperationDescendantsHelper_(e,t,o,r)))}),s=t?s.concat(t.applyOperation(n,a,i)):s},goog.provide("fb.core.util.Tree"),goog.require("fb.core.util"),goog.require("fb.core.util.Path"),goog.require("fb.util.obj"),goog.require("goog.object"),fb.core.util.TreeNode=goog.defineClass(null,{constructor:function(){this.children={},this.childCount=0,this.value=null}}),fb.core.util.Tree=goog.defineClass(null,{constructor:function(e,t,o){this.name_=e||"",this.parent_=t||null,this.node_=o||new fb.core.util.TreeNode},subTree:function(e){for(var t,o=e instanceof fb.core.util.Path?e:new fb.core.util.Path(e),r=this;null!==(t=o.getFront());)var n=fb.util.obj.get(r.node_.children,t)||new fb.core.util.TreeNode,r=new fb.core.util.Tree(t,r,n),o=o.popFront();return r},getValue:function(){return this.node_.value},setValue:function(e){fb.core.util.assert(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},clear:function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},hasChildren:function(){return 0<this.node_.childCount},isEmpty:function(){return null===this.getValue()&&!this.hasChildren()},forEachChild:function(o){var r=this;goog.object.forEach(this.node_.children,function(e,t){o(new fb.core.util.Tree(t,r,e))})},forEachDescendant:function(t,e,o){e&&!o&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,o)}),e&&o&&t(this)},forEachAncestor:function(e,t){for(var o=t?this:this.parent();null!==o;){if(e(o))return!0;o=o.parent()}return!1},forEachImmediateDescendantWithValue:function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},path:function(){return new fb.core.util.Path(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},name:function(){return this.name_},parent:function(){return this.parent_},updateParents_:function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},updateChild_:function(e,t){var o=t.isEmpty(),r=fb.util.obj.contains(this.node_.children,e);o&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):o||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())}}),goog.provide("fb.core.util.validation"),goog.require("fb.core.util"),goog.require("fb.core.util.Path"),goog.require("fb.core.util.ValidationPath"),goog.require("fb.util.obj"),goog.require("fb.util.utf8"),goog.require("fb.util.validation"),fb.core.util.validation={INVALID_KEY_REGEX_:/[\[\].#$\/\u0000-\u001F\u007F]/,INVALID_PATH_REGEX_:/[\[\].#$\u0000-\u001F\u007F]/,VALID_AUTH_PROVIDER:/^[a-zA-Z][a-zA-Z._\-+]+$/,MAX_LEAF_SIZE_:10485760,isValidKey:function(e){return goog.isString(e)&&0!==e.length&&!fb.core.util.validation.INVALID_KEY_REGEX_.test(e)},isValidPathString:function(e){return goog.isString(e)&&0!==e.length&&!fb.core.util.validation.INVALID_PATH_REGEX_.test(e)},isValidRootPathString:function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),fb.core.util.validation.isValidPathString(e)},isValidPriority:function(e){return null===e||goog.isString(e)||goog.isNumber(e)&&!fb.core.util.isInvalidJSONNumber(e)||goog.isObject(e)&&fb.util.obj.contains(e,".sv")},validateFirebaseDataArg:function(e,t,o,r,n){n&&!goog.isDef(o)||fb.core.util.validation.validateFirebaseData(fb.util.validation.errorPrefix(e,t,n),o,r)},validateFirebaseData:function(o,e,r){if(r instanceof fb.core.util.Path&&(r=new fb.core.util.ValidationPath(r,o)),!goog.isDef(e))throw new Error(o+"contains undefined "+r.toErrorString());if(goog.isFunction(e))throw new Error(o+"contains a function "+r.toErrorString()+" with contents: "+e.toString());if(fb.core.util.isInvalidJSONNumber(e))throw new Error(o+"contains "+e.toString()+" "+r.toErrorString());if(goog.isString(e)&&e.length>fb.core.util.validation.MAX_LEAF_SIZE_/3&&fb.util.utf8.stringLength(e)>fb.core.util.validation.MAX_LEAF_SIZE_)throw new Error(o+"contains a string greater than "+fb.core.util.validation.MAX_LEAF_SIZE_+" utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(goog.isObject(e)){var n=!1,i=!1;if(fb.util.obj.foreach(e,function(e,t){if(".value"===e)n=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!fb.core.util.validation.isValidKey(e)))throw new Error(o+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),fb.core.util.validation.validateFirebaseData(o,t,r),r.pop()}),n&&i)throw new Error(o+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},validateFirebaseMergePaths:function(e,t){for(var o=0;o<t.length;o++)for(var r,n=(r=t[o]).slice(),i=0;i<n.length;i++)if((".priority"!==n[i]||i!==n.length-1)&&!fb.core.util.validation.isValidKey(n[i]))throw new Error(e+"contains an invalid key ("+n[i]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(fb.core.util.Path.comparePaths);var a=null;for(o=0;o<t.length;o++){if(r=t[o],null!==a&&a.contains(r))throw new Error(e+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}},validateFirebaseMergeDataArg:function(e,t,o,r,n){if(!n||goog.isDef(o)){var i=fb.util.validation.errorPrefix(e,t,n);if(!goog.isObject(o)||goog.isArray(o))throw new Error(i+" must be an object containing the children to replace.");var a=[];fb.util.obj.foreach(o,function(e,t){e=new fb.core.util.Path(e);if(fb.core.util.validation.validateFirebaseData(i,t,r.child(e)),".priority"===e.getBack()&&!fb.core.util.validation.isValidPriority(t))throw new Error(i+"contains an invalid value for '"+e.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(e)}),fb.core.util.validation.validateFirebaseMergePaths(i,a)}},validatePriority:function(e,t,o,r){if(!r||goog.isDef(o)){if(fb.core.util.isInvalidJSONNumber(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"is "+o.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!fb.core.util.validation.isValidPriority(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},validateEventType:function(e,t,o,r){if(!r||goog.isDef(o))switch(o){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(fb.util.validation.errorPrefix(e,t,r)+'must be a valid event type: "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},validateKey:function(e,t,o,r){if((!r||goog.isDef(o))&&!fb.core.util.validation.isValidKey(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+'was an invalid key: "'+o+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},validatePathString:function(e,t,o,r){if((!r||goog.isDef(o))&&!fb.core.util.validation.isValidPathString(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+'was an invalid path: "'+o+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},validateRootPathString:function(e,t,o,r){o=o&&o.replace(/^\/*\.info(\/|$)/,"/"),fb.core.util.validation.validatePathString(e,t,o,r)},validateWritablePath:function(e,t){if(".info"===t.getFront())throw new Error(e+" failed: Can't modify data under /.info/")},validateUrl:function(e,t,o){var r=o.path.toString();if(!goog.isString(o.repoInfo.host)||0===o.repoInfo.host.length||!fb.core.util.validation.isValidKey(o.repoInfo.namespace)||0!==r.length&&!fb.core.util.validation.isValidRootPathString(r))throw new Error(fb.util.validation.errorPrefix(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},validateCredential:function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isString(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid credential (a string).")},validateBoolean:function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isBoolean(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a boolean.")},validateString:function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isString(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid string.")},validateAuthProvider:function(e,t,o,r){if((!r||goog.isDef(o))&&(fb.core.util.validation.validateString(e,t,o,r),!fb.core.util.validation.VALID_AUTH_PROVIDER.test(o)))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"'"+o+"' is not a valid authentication provider.")},validateObject:function(e,t,o,r){if((!r||goog.isDef(o))&&(!goog.isObject(o)||null===o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid object.")},validateObjectContainsKey:function(e,t,o,r,n,i){if(!(goog.isObject(o)&&fb.util.obj.contains(o,r))){if(n)return;throw new Error(fb.util.validation.errorPrefix(e,t,n)+'must contain the key "'+r+'"')}if(i){o=fb.util.obj.get(o,r);if("number"===i&&!goog.isNumber(o)||"string"===i&&!goog.isString(o)||"boolean"===i&&!goog.isBoolean(o)||"function"===i&&!goog.isFunction(o)||"object"===i&&!goog.isObject(o))throw n?new Error(fb.util.validation.errorPrefix(e,t,n)+'contains invalid value for key "'+r+'" (must be of type "'+i+'")'):new Error(fb.util.validation.errorPrefix(e,t,n)+'must contain the key "'+r+'" with type "'+i+'"')}}},goog.provide("fb.core.util.CountedSet"),goog.require("fb.core.util"),goog.require("fb.util.obj"),goog.require("goog.object"),fb.core.util.CountedSet=goog.defineClass(null,{constructor:function(){this.set={}},add:function(e,t){this.set[e]=null===t||t},contains:function(e){return fb.util.obj.contains(this.set,e)},get:function(e){return this.contains(e)?this.set[e]:void 0},remove:function(e){delete this.set[e]},clear:function(){this.set={}},isEmpty:function(){return goog.object.isEmpty(this.set)},count:function(){return goog.object.getCount(this.set)},each:function(o){goog.object.forEach(this.set,function(e,t){o(t,e)})},keys:function(){var o=[];return goog.object.forEach(this.set,function(e,t){o.push(t)}),o}}),goog.provide("fb.core.SparseSnapshotTree"),goog.require("fb.core.snap.Node"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.util.CountedSet"),goog.require("fb.core.util.Path"),fb.core.SparseSnapshotTree=function(){this.value_=null,this.children_=null},fb.core.SparseSnapshotTree.prototype.find=function(e){var t;return null!=this.value_?this.value_.getChild(e):!e.isEmpty()&&null!=this.children_&&(t=e.getFront(),e=e.popFront(),this.children_.contains(t))?this.children_.get(t).find(e):null},fb.core.SparseSnapshotTree.prototype.remember=function(e,t){var o;e.isEmpty()?(this.value_=t,this.children_=null):null!==this.value_?this.value_=this.value_.updateChild(e,t):(null==this.children_&&(this.children_=new fb.core.util.CountedSet),o=e.getFront(),this.children_.contains(o)||this.children_.add(o,new fb.core.SparseSnapshotTree),o=this.children_.get(o),e=e.popFront(),o.remember(e,t))},fb.core.SparseSnapshotTree.prototype.forget=function(e){var o,t;return e.isEmpty()?(this.value_=null,!(this.children_=null)):null!==this.value_?!this.value_.isLeafNode()&&(t=this.value_,this.value_=null,o=this,t.forEachChild(fb.core.snap.PriorityIndex,function(e,t){o.remember(new fb.core.util.Path(e),t)}),this.forget(e)):null===this.children_||(t=e.getFront(),e=e.popFront(),this.children_.contains(t)&&this.children_.get(t).forget(e)&&this.children_.remove(t),!!this.children_.isEmpty()&&!(this.children_=null))},fb.core.SparseSnapshotTree.prototype.forEachTree=function(o,r){null!==this.value_?r(o,this.value_):this.forEachChild(function(e,t){e=new fb.core.util.Path(o.toString()+"/"+e);t.forEachTree(e,r)})},fb.core.SparseSnapshotTree.prototype.forEachChild=function(o){null!==this.children_&&this.children_.each(function(e,t){o(e,t)})},goog.provide("fb.login.Constants"),fb.login.Constants={SESSION_PERSISTENCE_KEY_PREFIX:"session",DEFAULT_SERVER_HOST:"auth.firebase.com",SERVER_HOST:"auth.firebase.com",API_VERSION:"v2",POPUP_PATH_TO_CHANNEL:"/auth/channel",POPUP_RELAY_FRAME_NAME:"__winchan_relay_frame",POPUP_CLOSE_CMD:"die",JSONP_CALLBACK_NAMESPACE:"__firebase_auth_jsonp",REDIR_REQUEST_ID_KEY:"redirect_request_id",REDIR_REQUEST_COMPLETION_KEY:"__firebase_request_key",REDIR_CLIENT_OPTIONS_KEY:"redirect_client_options",INTERNAL_REDIRECT_SENTINAL_PATH:"/blank/page.html",CLIENT_OPTION_SESSION_PERSISTENCE:"remember",CLIENT_OPTION_REDIRECT_TO:"redirectTo"},goog.provide("fb.login.RequestInfo"),goog.require("fb.login.Constants"),fb.login.RequestInfo=function(e,t,o){this.clientOptions=e||{},this.transportOptions=t||{},this.serverParams=o||{},this.clientOptions[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]||(this.clientOptions[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]="default")},fb.login.RequestInfo.CLIENT_OPTIONS=[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE,fb.login.Constants.CLIENT_OPTION_REDIRECT_TO],fb.login.RequestInfo.fromParams=function(e){var o={},r={};return fb.util.obj.foreach(e||{},function(e,t){goog.array.contains(fb.login.RequestInfo.CLIENT_OPTIONS,e)?o[e]=t:r[e]=t}),new fb.login.RequestInfo(o,{},r)},goog.provide("fb.login.SessionManager"),goog.require("fb.core.storage"),goog.require("fb.login.Constants"),goog.require("fb.util.json"),goog.require("fb.util.jwt"),fb.login.SessionManager=function(e,t){this.persistenceKey_=[fb.login.Constants.SESSION_PERSISTENCE_KEY_PREFIX,e.persistenceKey,e.namespace].join(":"),this.stores_=t},fb.login.SessionManager.prototype.set=function(e,t){if(!t){if(!this.stores_.length)throw new Error("fb.login.SessionManager : No storage options available!");t=this.stores_[0]}t.set(this.persistenceKey_,e)},fb.login.SessionManager.prototype.get=function(){var e=goog.array.map(this.stores_,goog.bind(this.getFromStore_,this)),e=goog.array.filter(e,function(e){return null!==e});return goog.array.sort(e,function(e,t){return fb.util.jwt.issuedAtTime(t.token)-fb.util.jwt.issuedAtTime(e.token)}),0<e.length?e.shift():null},fb.login.SessionManager.prototype.getFromStore_=function(e){try{var t=e.get(this.persistenceKey_);if(t&&t.token)return t}catch(e){}return null},fb.login.SessionManager.prototype.clear=function(e){e||this.stores_;var t=this;goog.array.forEach(this.stores_,function(e){e.remove(t.persistenceKey_)})},goog.provide("fb.login.util.environment"),fb.login.util.environment.getUA=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""},fb.login.util.environment.isMobileWrapper=function(){return fb.login.util.environment.isMobileCordova()||fb.login.util.environment.isMobileWindows()||fb.login.util.environment.isIosWebview()},fb.login.util.environment.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fb.login.util.environment.getUA())},fb.login.util.environment.isMobileWindows=function(){return"undefined"!=typeof navigator&&(!!fb.login.util.environment.getUA().match(/Windows Phone/)||!!window.Windows&&/^ms-appx:/.test(location.href))},fb.login.util.environment.isMobileFirefox=function(){var e=fb.login.util.environment.getUA();return-1!==e.indexOf("Fennec/")||-1!==e.indexOf("Firefox/")&&-1!==e.indexOf("Android")},fb.login.util.environment.isIosWebview=function(){var e=fb.login.util.environment.getUA();return"undefined"!=typeof navigator&&"undefined"!=typeof window&&!!(e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i)||e.match(/CriOS/)||e.match(/Twitter for iPhone/)||e.match(/FBAN\/FBIOS/)||window.navigator.standalone)},fb.login.util.environment.isHeadlessBrowser=function(){return!!fb.login.util.environment.getUA().match(/PhantomJS/)},fb.login.util.environment.isLocalFile=function(){return"undefined"!=typeof location&&/^file:\//.test(location.href)},fb.login.util.environment.isIE=function(){var e=fb.login.util.environment.getUA();return!(!e.match(/MSIE/)&&!e.match(/Trident/))},fb.login.util.environment.isIEVersionAtLeast=function(e){var t,o=fb.login.util.environment.getUA();if(""!==o)if("Microsoft Internet Explorer"===navigator.appName){if((t=o.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/))&&1<t.length)return parseFloat(t[1])>=e}else if(-1<o.indexOf("Trident")&&(t=o.match(/rv:([0-9]{2,2}[\.0-9]{0,})/))&&1<t.length)return parseFloat(t[1])>=e;return!1},goog.provide("fb.login.transports.util"),goog.require("fb.login.Constants"),goog.require("fb.util"),fb.login.transports.util.findRelay=function(){window.location;for(var e=window.opener.frames,t=e.length-1;0<=t;t--)try{if(e[t].location.protocol===window.location.protocol&&e[t].location.host===window.location.host&&e[t].name===fb.login.Constants.POPUP_RELAY_FRAME_NAME)return e[t]}catch(e){}return null},fb.login.transports.util.addListener=function(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener&&e.addEventListener(t,o,!1)},fb.login.transports.util.removeListener=function(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener&&e.removeEventListener(t,o,!1)},fb.login.transports.util.extractOrigin=function(e){/^https?:\/\//.test(e)||(e=window.location.href);var t=/^(https?:\/\/[\-_a-zA-Z\.0-9:]+)/.exec(e);return t?t[1]:e},fb.login.transports.util.extractRedirectCompletionHash=function(e){var t="";try{e=e.replace("#","");var o=fb.util.querystringDecode(e);o&&fb.util.obj.contains(o,fb.login.Constants.REDIR_REQUEST_COMPLETION_KEY)&&(t=fb.util.obj.get(o,fb.login.Constants.REDIR_REQUEST_COMPLETION_KEY))}catch(e){}return t},fb.login.transports.util.replaceRedirectCompletionHash=function(){try{var e=new RegExp("&"+fb.login.Constants.REDIR_REQUEST_COMPLETION_KEY+"=([a-zA-z0-9]*)");document.location.hash=document.location.hash.replace(e,"")}catch(e){}},fb.login.transports.util.getBaseUrl=function(){var e=fb.core.util.parseURL(fb.login.Constants.SERVER_HOST);return e.scheme+"://"+e.host+"/"+fb.login.Constants.API_VERSION},fb.login.transports.util.getPopupChannelUrl=function(e){return fb.login.transports.util.getBaseUrl()+"/"+e+fb.login.Constants.POPUP_PATH_TO_CHANNEL},goog.provide("fb.login.Transport"),fb.login.Transport=function(e){},fb.login.Transport.isAvailable=function(){},fb.login.Transport.prototype.open=function(e,t,o){},fb.login.Transport.prototype.classification=function(){},goog.provide("fb.login.transports.PopupReceiver"),goog.require("fb.login.Constants"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util.json"),fb.login.transports.PopupReceiver=function(e){var t=this;if(this.cb=e,this.targetOrigin="*",fb.login.util.environment.isIEVersionAtLeast(8)?this.messageTarget=this.inboundTarget=fb.login.transports.util.findRelay():(this.messageTarget=window.opener,this.inboundTarget=window),!t.messageTarget)throw"Unable to find relay frame";fb.login.transports.util.addListener(this.inboundTarget,"message",goog.bind(this.onMessage_,this)),fb.login.transports.util.addListener(this.inboundTarget,"message",goog.bind(this.onDie_,this));try{this.doPost_({a:"ready"})}catch(e){fb.login.transports.util.addListener(this.messageTarget,"load",function(e){t.doPost_({a:"ready"})})}fb.login.transports.util.addListener(window,"unload",goog.bind(this.onUnload_,this))},fb.login.transports.PopupReceiver.prototype.doPost_=function(e){e=fb.util.json.stringify(e),fb.login.util.environment.isIEVersionAtLeast(8)?this.messageTarget.doPost(e,this.targetOrigin):this.messageTarget.postMessage(e,this.targetOrigin)},fb.login.transports.PopupReceiver.prototype.onMessage_=function(e){var t,o=this;try{t=fb.util.json.eval(e.data)}catch(e){}t&&"request"===t.a&&(fb.login.transports.util.removeListener(window,"message",this.onMessage_),this.targetOrigin=e.origin,this.cb&&setTimeout(function(){o.cb(o.targetOrigin,t.d,function(e,t){o.autoClose=!t,o.cb=void 0,o.doPost_({a:"response",d:e,forceKeepWindowOpen:t})})},0))},fb.login.transports.PopupReceiver.prototype.onUnload_=function(){try{fb.login.transports.util.removeListener(this.inboundTarget,"message",this.onDie_)}catch(e){}this.cb&&(this.doPost_({a:"error",d:"unknown closed window"}),this.cb=void 0);try{window.close()}catch(e){}},fb.login.transports.PopupReceiver.prototype.onDie_=function(e){if(this.autoClose&&e.data===fb.login.Constants.POPUP_CLOSE_CMD)try{window.close()}catch(e){}},goog.provide("fb.login.transports.Redirect"),goog.require("fb.constants"),goog.require("fb.core.storage"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.util"),fb.login.transports.Redirect=function(e){this.requestId_=goog.string.getRandomString()+goog.string.getRandomString()+goog.string.getRandomString(),this.options_=e},fb.login.transports.Redirect.prototype.open=function(e,t,o){fb.core.storage.SessionStorage.set(fb.login.Constants.REDIR_REQUEST_ID_KEY,this.requestId_),fb.core.storage.SessionStorage.set(fb.login.Constants.REDIR_REQUEST_ID_KEY,this.requestId_),t.requestId=this.requestId_,t.redirectTo=t.redirectTo||window.location.href,e+=(/\?/.test(e)?"":"?")+fb.util.querystring(t),window.location=e},fb.login.transports.Redirect.isAvailable=function(){return!NODE_CLIENT&&!fb.login.util.environment.isLocalFile()&&!fb.login.util.environment.isMobileCordova()},fb.login.transports.Redirect.prototype.classification=function(){return"redirect"},goog.provide("fb.login.Errors"),{NETWORK_ERROR:"Unable to contact the Firebase server.",SERVER_ERROR:"An unknown server error occurred.",TRANSPORT_UNAVAILABLE:"There are no login transports available for the requested method.",REQUEST_INTERRUPTED:"The browser redirected the page before the login request could complete.",USER_CANCELLED:"The user cancelled authentication."}),FIREBASE_LONGPOLL_START_PARAM=(fb.login.Errors.get=function(e){var t=fb.util.obj.get(errors,e),t=new Error(t,e);return t.code=e,t},goog.provide("fb.login.transports.Popup"),goog.require("fb.core.util"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.Popup=function(e){e.window_features&&!fb.login.util.environment.isMobileFirefox()||(e.window_features=void 0),e.window_name||(e.window_name="_blank"),this.options=e},fb.login.transports.Popup.prototype.open=function(e,t,o){var r,n=fb.login.util.environment.isIEVersionAtLeast(8);if(!this.options.relay_url)return o(new Error("invalid arguments: origin of url and relay_url must match"));var i,a,s,l,c=fb.login.transports.util.extractOrigin(e);function g(e){if(r&&(document.body.removeChild(r),r=void 0),s=s&&clearInterval(s),fb.login.transports.util.removeListener(window,"message",u),fb.login.transports.util.removeListener(window,"unload",g),i&&!e)try{i.close()}catch(e){a.postMessage(fb.login.Constants.POPUP_CLOSE_CMD,c)}i=a=void 0}function u(e){if(e.origin===c)try{var t=fb.util.json.eval(e.data);"ready"===t.a?a.postMessage(l,c):"error"===t.a?(g(!1),o&&(o(t.d),o=null)):"response"===t.a&&(g(t.forceKeepWindowOpen),o&&(o(null,t.d),o=null))}catch(e){}}c!==fb.login.transports.util.extractOrigin(this.options.relay_url)?o&&setTimeout(function(){o(new Error("invalid arguments: origin of url and relay_url must match"))},0):(n&&((r=document.createElement("iframe")).setAttribute("src",this.options.relay_url),r.style.display="none",r.setAttribute("name",fb.login.Constants.POPUP_RELAY_FRAME_NAME),document.body.appendChild(r),a=r.contentWindow),e+=(/\?/.test(e)?"":"?")+fb.util.querystring(t),i=window.open(e,this.options.window_name,this.options.window_features),a=a||i,s=setInterval(function(){i&&i.closed&&(g(!1),o&&(o(fb.login.Errors.get("USER_CANCELLED")),o=null))},500),l=fb.util.json.stringify({a:"request",d:t}),fb.login.transports.util.addListener(window,"unload",g),fb.login.transports.util.addListener(window,"message",u))},fb.login.transports.Popup.isAvailable=function(){return!NODE_CLIENT&&"postMessage"in window&&!fb.login.util.environment.isLocalFile()&&!fb.login.util.environment.isMobileWrapper()&&!fb.login.util.environment.isHeadlessBrowser()},fb.login.transports.Popup.prototype.classification=function(){return"popup"},goog.provide("fb.login.transports.NodeHttp"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.NodeHttp=function(e){e.method||(e.method="GET"),e.headers||(e.headers={}),e.headers.content_type||(e.headers.content_type="application/json"),e.headers.content_type=e.headers.content_type.toLowerCase(),this.options=e},fb.login.transports.NodeHttp.prototype.open=function(e,t,o){var r,e=fb.core.util.parseURL(e),n="http"===e.scheme?require("http"):require("https"),i=this.options.method,a={Accept:"application/json;text/plain"},e=(goog.object.extend(a,this.options.headers),{host:e.host.split(":")[0],port:e.port,path:e.pathString,method:this.options.method.toUpperCase()}),s=("GET"===i?(e.path+=(/\?/.test(e.path)?"":"?")+fb.util.querystring(t),r=null):("application/json"===(s=this.options.headers.content_type)&&(r=fb.util.json.stringify(t)),"application/x-www-form-urlencoded"===s&&(r=fb.util.querystring(t)),a["Content-Length"]=Buffer.byteLength(r,"utf8")),e.headers=a,n.request(e,function(e){var t="";e.setEncoding("utf8"),e.on("data",function(e){t+=e}),e.on("end",function(){try{t=fb.util.json.eval(t+"")}catch(e){}o&&(o(null,t),o=null)})}));"GET"!==i&&s.write(r),s.on("error",function(e){e&&e.code&&("ENOTFOUND"===e.code||"ENETDOWN"===e.code)?o(fb.login.Errors.get("NETWORK_ERROR")):o(fb.login.Errors.get("SERVER_ERROR")),o=null}),s.end()},fb.login.transports.NodeHttp.isAvailable=function(){return NODE_CLIENT},fb.login.transports.NodeHttp.prototype.classification=function(){return"json"},goog.provide("fb.login.transports.XHR"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.XHR=function(e){e.method||(e.method="GET"),e.headers||(e.headers={}),e.headers.content_type||(e.headers.content_type="application/json"),e.headers.content_type=e.headers.content_type.toLowerCase(),this.options=e},fb.login.transports.XHR.prototype.open=function(e,t,o){var r,n,i=new XMLHttpRequest,a=this.options.method.toUpperCase();function s(e){o&&(o(fb.login.Errors.get("REQUEST_INTERRUPTED")),o=null)}fb.login.transports.util.addListener(window,"beforeunload",s),i.onreadystatechange=function(){if(o&&4===i.readyState){var e;if(200<=i.status&&i.status<300){try{e=fb.util.json.eval(i.responseText)}catch(e){}o(null,e)}else 500<=i.status&&i.status<600?o(fb.login.Errors.get("SERVER_ERROR")):o(fb.login.Errors.get("NETWORK_ERROR"));o=null,fb.login.transports.util.removeListener(window,"beforeunload",s)}},"GET"===a?(e+=(/\?/.test(e)?"":"?")+fb.util.querystring(t),r=null):("application/json"===(n=this.options.headers.content_type)&&(r=fb.util.json.stringify(t)),"application/x-www-form-urlencoded"===n&&(r=fb.util.querystring(t))),i.open(a,e,!0);var l,c={"X-Requested-With":"XMLHttpRequest",Accept:"application/json;text/plain"};for(l in goog.object.extend(c,this.options.headers),c)i.setRequestHeader(l,c[l]);i.send(r)},fb.login.transports.XHR.isAvailable=function(){return!NODE_CLIENT&&!!window.XMLHttpRequest&&(!fb.login.util.environment.isIE()||fb.login.util.environment.isIEVersionAtLeast(10))},fb.login.transports.XHR.prototype.classification=function(){return"json"},goog.provide("fb.login.transports.CordovaInAppBrowser"),goog.require("fb.core.util"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.RequestInfo"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.XHR"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.CordovaInAppBrowser=function(e){this.requestId_=goog.string.getRandomString()+goog.string.getRandomString()+goog.string.getRandomString(),this.options_=e},fb.login.transports.CordovaInAppBrowser.prototype.open=function(e,t,o){var r,n=this,i=fb.core.util.parseURL(fb.login.Constants.SERVER_HOST);function a(e){o&&(o(fb.login.Errors.get("USER_CANCELLED")),o=null)}t.requestId=this.requestId_,t[fb.login.Constants.CLIENT_OPTION_REDIRECT_TO]=i.scheme+"://"+i.host+fb.login.Constants.INTERNAL_REDIRECT_SENTINAL_PATH,e=(e+=/\?/.test(e)?"":"?")+fb.util.querystring(t),(r=window.open(e,"_blank","location=no"))&&goog.isFunction(r.addEventListener)?(r.addEventListener("loadstart",function(e){e&&e.url&&function(e){try{var t=document.createElement("a");return t.href=e,t.host===i.host&&t.pathname===fb.login.Constants.INTERNAL_REDIRECT_SENTINAL_PATH}catch(e){}}(e.url)&&(e=fb.login.transports.util.extractRedirectCompletionHash(e.url),r.removeEventListener("exit",a),r.close(),e=new fb.login.RequestInfo(null,null,{requestId:n.requestId_,requestKey:e}),n.options_.requestWithCredential("/auth/session",e,o),o=null)}),r.addEventListener("exit",a)):o(fb.login.Errors.get("TRANSPORT_UNAVAILABLE"))},fb.login.transports.CordovaInAppBrowser.isAvailable=function(){return!NODE_CLIENT&&fb.login.util.environment.isMobileCordova()},fb.login.transports.CordovaInAppBrowser.prototype.classification=function(){return"redirect"},goog.provide("fb.login.transports.JSONP"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.JSONP=function(e){e.callback_parameter||(e.callback_parameter="callback"),this.options=e,window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE]=window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE]||{}},fb.login.transports.JSONP.prototype.open=function(e,t,o){var r="fn"+(new Date).getTime()+Math.floor(99999*Math.random());function n(e){o&&(o(fb.login.Errors.get("REQUEST_INTERRUPTED")),o=null)}t[this.options.callback_parameter]=fb.login.Constants.JSONP_CALLBACK_NAMESPACE+"."+r,e+=(/\?/.test(e)?"":"?")+fb.util.querystring(t),fb.login.transports.util.addListener(window,"beforeunload",n),window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE][r]=function(e){o&&(o(null,e),o=null),setTimeout(function(){window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE][r]=void 0,goog.object.isEmpty(window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE])&&(window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE]=void 0);try{var e=document.getElementById(r);e&&e.parentNode.removeChild(e)}catch(e){}},1),fb.login.transports.util.removeListener(window,"beforeunload",n)},this.writeScriptTag_(r,e,o)},fb.login.transports.JSONP.prototype.writeScriptTag_=function(r,n,i){setTimeout(function(){try{var e=document.createElement("script"),t=(e.type="text/javascript",e.id=r,e.async=!0,e.src=n,e.onerror=function(){var e=document.getElementById(r);null!==e&&e.parentNode.removeChild(e),i&&i(fb.login.Errors.get("NETWORK_ERROR"))},document.getElementsByTagName("head")),o=!t||goog.array.isEmpty(t)?document.documentElement:t[0];o.appendChild(e)}catch(e){i&&i(fb.login.Errors.get("NETWORK_ERROR"))}},0)},fb.login.transports.JSONP.isAvailable=function(){return"undefined"!=typeof document&&goog.isDefAndNotNull(document.createElement)},fb.login.transports.JSONP.prototype.classification=function(){return"json"},goog.provide("fb.login.AuthenticationManager"),goog.require("fb.constants"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.core.util.EventEmitter"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.RequestInfo"),goog.require("fb.login.SessionManager"),goog.require("fb.login.transports.CordovaInAppBrowser"),goog.require("fb.login.transports.JSONP"),goog.require("fb.login.transports.NodeHttp"),goog.require("fb.login.transports.Popup"),goog.require("fb.login.transports.Redirect"),goog.require("fb.login.transports.XHR"),fb.login.AuthenticationManager=function(e,t,o,r){fb.core.util.EventEmitter.call(this,["auth_status"]),this.repoInfo_=e,this.authConn_=t,this.unauthConn_=o,this.onAuthStatus_=r,this.sessionManager_=new fb.login.SessionManager(e,[fb.core.storage.PersistentStorage,fb.core.storage.SessionStorage]),this.authData_=null,this.redirectRestart_=!1,this.resumeSession()},goog.inherits(fb.login.AuthenticationManager,fb.core.util.EventEmitter),fb.login.AuthenticationManager.prototype.getAuth=function(){return this.authData_||null},fb.login.AuthenticationManager.prototype.resumeSession=function(){var e=fb.core.storage.SessionStorage.get(fb.login.Constants.REDIR_REQUEST_ID_KEY),o=this,r=(e&&this.finishOAuthRedirectLogin_(),this.sessionManager_.get());r&&r.token?(this.updateAuthStatus_(r),this.authConn_(r.token,function(e,t){o.authOnComplete_(e,t,!1,r.token,r)},function(e,t){o.authOnCancel_("resumeSession()",e,t)})):this.updateAuthStatus_(null)},fb.login.AuthenticationManager.prototype.authenticate=function(o,r,n,i,a){this.repoInfo_.isDemoHost()&&fb.core.util.warn("Firebase authentication is not supported on demo Firebases (*.firebaseio-demo.com). To secure your Firebase, create a production Firebase at https://www.firebase.com.");var s=this;this.authConn_(o,function(e,t){s.authOnComplete_(e,t,!0,o,r,n||{},i)},function(e,t){s.authOnCancel_("auth()",e,t,a)})},fb.login.AuthenticationManager.prototype.unauthenticate=function(r){this.sessionManager_.clear(),this.updateAuthStatus_(null),this.unauthConn_(function(e,t){var o;"ok"===e?fb.core.util.callUserCallback(r,null):(o=e=(e||"error").toUpperCase(),t&&(o+=": "+t),(t=new Error(o)).code=e,fb.core.util.callUserCallback(r,t))})},fb.login.AuthenticationManager.prototype.authOnComplete_=function(e,t,o,r,n,i,a){var s;"ok"===e?(o&&(o=t.auth,n.auth=o,n.expires=t.expires,n.token=fb.util.jwt.isValidFormat(r)?r:"",s=null,o&&fb.util.obj.contains(o,"uid")?s=fb.util.obj.get(o,"uid"):fb.util.obj.contains(n,"uid")&&(s=fb.util.obj.get(n,"uid")),n.uid=s,s="custom",o&&fb.util.obj.contains(o,"provider")?s=fb.util.obj.get(o,"provider"):fb.util.obj.contains(n,"provider")&&(s=fb.util.obj.get(n,"provider")),n.provider=s,this.sessionManager_.clear(),fb.util.jwt.isValidFormat(r)&&(o=fb.core.storage.PersistentStorage,"sessionOnly"===(i=i||{})[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]&&(o=fb.core.storage.SessionStorage),"none"!==i[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]&&this.sessionManager_.set(n,o)),this.updateAuthStatus_(n)),fb.core.util.callUserCallback(a,null,n)):(this.handleBadAuthStatus_(),r=s=(e||"error").toUpperCase(),t&&(r+=": "+t),(i=new Error(r)).code=s,fb.core.util.callUserCallback(a,i))},fb.login.AuthenticationManager.prototype.authOnCancel_=function(e,t,o,r){fb.core.util.warn(e+" was canceled: "+o),this.handleBadAuthStatus_();e=new Error(o);e.code=t.toUpperCase(),fb.core.util.callUserCallback(r,e)},fb.login.AuthenticationManager.prototype.handleBadAuthStatus_=function(){this.sessionManager_.clear(),this.updateAuthStatus_(null)},fb.login.AuthenticationManager.prototype.authWithCredential=function(e,t,o,r){this.checkServerSettingsOrThrow();o=new fb.login.RequestInfo(o||{},{},t||{}),t=NODE_CLIENT?[fb.login.transports.NodeHttp]:[fb.login.transports.XHR,fb.login.transports.JSONP];this.authWithTransports_(t,"/auth/"+e,o,r)},fb.login.AuthenticationManager.prototype.authWithPopup=function(e,t,o){this.checkServerSettingsOrThrow();var r=[fb.login.transports.Popup,fb.login.transports.CordovaInAppBrowser],t=fb.login.RequestInfo.fromParams(t);"anonymous"===e||"password"===e?setTimeout(function(){fb.core.util.callUserCallback(o,fb.login.Errors.get("TRANSPORT_UNAVAILABLE"))},0):(t.transportOptions.window_features="menubar=yes,modal=yes,alwaysRaised=yeslocation=yes,resizable=yes,scrollbars=yes,status=yes,height=625,width=625,top="+("object"==typeof screen?.5*(screen.height-625):0)+",left="+("object"==typeof screen?.5*(screen.width-625):0),t.transportOptions.relay_url=fb.login.transports.util.getPopupChannelUrl(this.repoInfo_.namespace),t.transportOptions.requestWithCredential=goog.bind(this.requestWithCredential,this),this.authWithTransports_(r,"/auth/"+e,t,o))},fb.login.AuthenticationManager.prototype.authWithRedirect=function(e,t,o){this.checkServerSettingsOrThrow();var r=[fb.login.transports.Redirect],t=fb.login.RequestInfo.fromParams(t);"anonymous"===e||"firebase"===e?fb.core.util.callUserCallback(o,fb.login.Errors.get("TRANSPORT_UNAVAILABLE")):(fb.core.storage.SessionStorage.set(fb.login.Constants.REDIR_CLIENT_OPTIONS_KEY,t.clientOptions),this.authWithTransports_(r,"/auth/"+e,t,o))},fb.login.AuthenticationManager.prototype.finishOAuthRedirectLogin_=function(){var e,t,o=fb.core.storage.SessionStorage.get(fb.login.Constants.REDIR_REQUEST_ID_KEY);o&&(t=fb.core.storage.SessionStorage.get(fb.login.Constants.REDIR_CLIENT_OPTIONS_KEY),fb.core.storage.SessionStorage.remove(fb.login.Constants.REDIR_REQUEST_ID_KEY),fb.core.storage.SessionStorage.remove(fb.login.Constants.REDIR_CLIENT_OPTIONS_KEY),e=[fb.login.transports.XHR,fb.login.transports.JSONP],o={requestId:o,requestKey:fb.login.transports.util.extractRedirectCompletionHash(document.location.hash)},t=new fb.login.RequestInfo(t,{},o),this.redirectRestart_=!0,fb.login.transports.util.replaceRedirectCompletionHash(),this.authWithTransports_(e,"/auth/session",t,function(e){this.redirectRestart_=!1}.bind(this)))},fb.login.AuthenticationManager.prototype.createUser=function(e,o){this.checkServerSettingsOrThrow();e=fb.login.RequestInfo.fromParams(e);e.serverParams._method="POST",this.requestWithCredential("/users",e,function(e,t){e?fb.core.util.callUserCallback(o,e):fb.core.util.callUserCallback(o,e,t)})},fb.login.AuthenticationManager.prototype.removeUser=function(e,o){var r=this,t=(this.checkServerSettingsOrThrow(),"/users/"+encodeURIComponent(e.email)),e=fb.login.RequestInfo.fromParams(e);e.serverParams._method="DELETE",this.requestWithCredential(t,e,function(e,t){!e&&t&&t.uid&&r.authData_&&r.authData_.uid&&r.authData_.uid===t.uid&&r.unauthenticate(),fb.core.util.callUserCallback(o,e)})},fb.login.AuthenticationManager.prototype.changePassword=function(e,o){this.checkServerSettingsOrThrow();var t="/users/"+encodeURIComponent(e.email)+"/password",r=fb.login.RequestInfo.fromParams(e);r.serverParams._method="PUT",r.serverParams.password=e.newPassword,this.requestWithCredential(t,r,function(e,t){fb.core.util.callUserCallback(o,e)})},fb.login.AuthenticationManager.prototype.changeEmail=function(e,o){this.checkServerSettingsOrThrow();var t="/users/"+encodeURIComponent(e.oldEmail)+"/email",r=fb.login.RequestInfo.fromParams(e);r.serverParams._method="PUT",r.serverParams.email=e.newEmail,r.serverParams.password=e.password,this.requestWithCredential(t,r,function(e,t){fb.core.util.callUserCallback(o,e)})},fb.login.AuthenticationManager.prototype.resetPassword=function(e,o){this.checkServerSettingsOrThrow();var t="/users/"+encodeURIComponent(e.email)+"/password",e=fb.login.RequestInfo.fromParams(e);e.serverParams._method="POST",this.requestWithCredential(t,e,function(e,t){fb.core.util.callUserCallback(o,e)})},fb.login.AuthenticationManager.prototype.requestWithCredential=function(e,t,o){var r=NODE_CLIENT?[fb.login.transports.NodeHttp]:[fb.login.transports.XHR,fb.login.transports.JSONP];this.requestWithTransports_(r,e,t,o)},fb.login.AuthenticationManager.prototype.authWithTransports_=function(e,t,o,r){var n=this;this.requestWithTransports_(e,t,o,function(e,t){e||!(t&&t.token&&t.uid)?fb.core.util.callUserCallback(r,e||fb.login.Errors.get("UNKNOWN_ERROR")):n.authenticate(t.token,t,o.clientOptions,function(e,t){e?fb.core.util.callUserCallback(r,e):fb.core.util.callUserCallback(r,null,t)})})},fb.login.AuthenticationManager.prototype.requestWithTransports_=function(e,t,o,r){var e=goog.array.filter(e,function(e){return"function"==typeof e.isAvailable&&e.isAvailable()});0===e.length?setTimeout(function(){fb.core.util.callUserCallback(r,fb.login.Errors.get("TRANSPORT_UNAVAILABLE"))},0):(e=new(e.shift())(o.transportOptions),(o=fb.util.obj.clone(o.serverParams)).v=this.versionString(),o.transport=e.classification(),o.suppress_status_codes=!0,t=fb.login.transports.util.getBaseUrl()+"/"+this.repoInfo_.namespace+t,e.open(t,o,function(e,t){e?fb.core.util.callUserCallback(r,e):t&&t.error?((e=new Error(t.error.message)).code=t.error.code,e.details=t.error.details,fb.core.util.callUserCallback(r,e)):fb.core.util.callUserCallback(r,null,t)}))},fb.login.AuthenticationManager.prototype.updateAuthStatus_=function(e){var t=null!==this.authData_||null!==e;this.authData_=e,t&&this.trigger("auth_status",e),this.onAuthStatus_(null!==e)},fb.login.AuthenticationManager.prototype.getInitialEvent=function(e){return fb.core.util.assert("auth_status"===e,'initial event must be of type "auth_status"'),this.redirectRestart_?null:[this.authData_]},fb.login.AuthenticationManager.prototype.versionString=function(){return(NODE_CLIENT?"node-":"js-")+CLIENT_VERSION},fb.login.AuthenticationManager.prototype.checkServerSettingsOrThrow=function(){if(this.repoInfo_.isCustomHost()&&fb.login.Constants.SERVER_HOST===fb.login.Constants.DEFAULT_SERVER_HOST)throw new Error("This custom Firebase server ('"+this.repoInfo_.domain+"') does not support delegated login.")},goog.provide("fb.realtime.Transport"),goog.require("fb.core.RepoInfo"),fb.realtime.Transport=function(e,t,o){},fb.realtime.Transport.prototype.open=function(e,t){},fb.realtime.Transport.prototype.start=function(){},fb.realtime.Transport.prototype.close=function(){},fb.realtime.Transport.prototype.send=function(e){},fb.realtime.Transport.prototype.bytesReceived,fb.realtime.Transport.prototype.bytesSent,goog.provide("fb.realtime.Constants"),fb.realtime.Constants={PROTOCOL_VERSION:"5",VERSION_PARAM:"v",TRANSPORT_SESSION_PARAM:"s",REFERER_PARAM:"r",FORGE_REF:"f",FORGE_DOMAIN:"firebaseio.com",LAST_SESSION_PARAM:"ls",WEBSOCKET:"websocket",LONG_POLLING:"long_polling"},goog.provide("fb.realtime.polling.PacketReceiver"),fb.realtime.polling.PacketReceiver=function(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null},fb.realtime.polling.PacketReceiver.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},fb.realtime.polling.PacketReceiver.prototype.handleResponse=function(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){var o=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(var r,n=0;n<o.length;++n)o[n]&&(r=this,fb.core.util.exceptionGuard(function(){r.onMessage_(o[n])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(clearTimeout(this.onClose),this.onClose(),this.onClose=null);break}this.currentResponseNum++}},goog.provide("fb.realtime.BrowserPollConnection"),goog.require("fb.constants"),goog.require("fb.core.stats.StatsManager"),goog.require("fb.core.util"),goog.require("fb.core.util.CountedSet"),goog.require("fb.realtime.Constants"),goog.require("fb.realtime.Transport"),goog.require("fb.realtime.polling.PacketReceiver"),goog.require("fb.util.json"),"start"),FIREBASE_LONGPOLL_CLOSE_COMMAND="close",FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand",FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB",FIREBASE_LONGPOLL_ID_PARAM="id",FIREBASE_LONGPOLL_PW_PARAM="pw",FIREBASE_LONGPOLL_SERIAL_PARAM="ser",FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb",FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg",FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts",FIREBASE_LONGPOLL_DATA_PARAM="d",FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM="disconn",FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe",MAX_URL_DATA_SIZE=1870,SEG_HEADER_SIZE=30,MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE,KEEPALIVE_REQUEST_INTERVAL=25e3,LP_CONNECT_TIMEOUT=3e4;function FirebaseIFrameScriptHolder(e,t,o,r){if(this.urlFn=r,this.onDisconnect=o,this.outstandingRequests=new fb.core.util.CountedSet,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,NODE_CLIENT)this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=fb.core.util.LUIDGenerator(),window[FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=e,window[FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=t,this.myIFrame=this.createIFrame_();r="",o="<html><body>"+(r=this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)?'<script>document.domain="'+document.domain+'";<\/script>':r)+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(e){fb.core.util.log("frame writing exception"),e.stack&&fb.core.util.log(e.stack),fb.core.util.log(e)}}}fb.realtime.BrowserPollConnection=function(e,t,o,r){this.connId=e,this.log_=fb.core.util.logWrapper(e),this.repoInfo=t,this.bytesSent=0,this.bytesReceived=0,this.stats_=fb.core.stats.StatsManager.getCollection(t),this.transportSessionId=o,this.everConnected_=!1,this.lastSessionId=r,this.urlFn=function(e){return t.connectionURL(fb.realtime.Constants.LONG_POLLING,e)}},fb.realtime.BrowserPollConnection.prototype.open=function(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new fb.realtime.polling.PacketReceiver(e),this.isClosed_=!1;var i=this;this.connectTimeoutTimer_=setTimeout(function(){i.log_("Timed out trying to connect."),i.onClosed_(),i.connectTimeoutTimer_=null},Math.floor(LP_CONNECT_TIMEOUT)),fb.core.util.executeWhenDOMReady(function(){var e;i.isClosed_||(i.scriptTagHolder=new FirebaseIFrameScriptHolder(function(e,t,o,r,n){if(i.incrementIncomingBytes_(arguments),i.scriptTagHolder)if(i.connectTimeoutTimer_&&(clearTimeout(i.connectTimeoutTimer_),i.connectTimeoutTimer_=null),i.everConnected_=!0,e==FIREBASE_LONGPOLL_START_PARAM)i.id=t,i.password=o;else{if(e!==FIREBASE_LONGPOLL_CLOSE_COMMAND)throw new Error("Unrecognized command received: "+e);t?(i.scriptTagHolder.sendNewPolls=!1,i.myPacketOrderer.closeAfter(t,function(){i.onClosed_()})):i.onClosed_()}},function(e,t){i.incrementIncomingBytes_(arguments),i.myPacketOrderer.handleResponse(e,t)},function(){i.onClosed_()},i.urlFn),(e={})[FIREBASE_LONGPOLL_START_PARAM]="t",e[FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(1e8*Math.random()),i.scriptTagHolder.uniqueCallbackIdentifier&&(e[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=i.scriptTagHolder.uniqueCallbackIdentifier),e[fb.realtime.Constants.VERSION_PARAM]=fb.realtime.Constants.PROTOCOL_VERSION,i.transportSessionId&&(e[fb.realtime.Constants.TRANSPORT_SESSION_PARAM]=i.transportSessionId),i.lastSessionId&&(e[fb.realtime.Constants.LAST_SESSION_PARAM]=i.lastSessionId),!NODE_CLIENT&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(fb.realtime.Constants.FORGE_DOMAIN)&&(e[fb.realtime.Constants.REFERER_PARAM]=fb.realtime.Constants.FORGE_REF),e=i.urlFn(e),i.log_("Connecting via long-poll to "+e),i.scriptTagHolder.addTag(e,function(){}))})},fb.realtime.BrowserPollConnection.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},fb.realtime.BrowserPollConnection.forceAllow=function(){fb.realtime.BrowserPollConnection.forceAllow_=!0},fb.realtime.BrowserPollConnection.forceDisallow=function(){fb.realtime.BrowserPollConnection.forceDisallow_=!0},fb.realtime.BrowserPollConnection.isAvailable=function(){return fb.realtime.BrowserPollConnection.forceAllow_||!fb.realtime.BrowserPollConnection.forceDisallow_&&"undefined"!=typeof document&&goog.isDefAndNotNull(document.createElement)&&!fb.core.util.isChromeExtensionContentScript()&&!fb.core.util.isWindowsStoreApp()&&!NODE_CLIENT},fb.realtime.BrowserPollConnection.prototype.markConnectionHealthy=function(){},fb.realtime.BrowserPollConnection.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},fb.realtime.BrowserPollConnection.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},fb.realtime.BrowserPollConnection.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},fb.realtime.BrowserPollConnection.prototype.send=function(e){for(var e=fb.util.json.stringify(e),e=(this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length),fb.core.util.base64Encode(e)),t=fb.core.util.splitStringBySize(e,MAX_PAYLOAD_SIZE),o=0;o<t.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,t.length,t[o]),this.curSegmentNum++},fb.realtime.BrowserPollConnection.prototype.addDisconnectPingFrame=function(e,t){var o;NODE_CLIENT||(this.myDisconnFrame=document.createElement("iframe"),(o={})[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t",o[FIREBASE_LONGPOLL_ID_PARAM]=e,o[FIREBASE_LONGPOLL_PW_PARAM]=t,this.myDisconnFrame.src=this.urlFn(o),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame))},fb.realtime.BrowserPollConnection.prototype.incrementIncomingBytes_=function(e){e=fb.util.json.stringify(e).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},FirebaseIFrameScriptHolder.prototype.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||fb.core.util.log("No IE domain setting required")}catch(e){var o=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+o+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},FirebaseIFrameScriptHolder.prototype.close=function(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",e=this,setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0))),NODE_CLIENT&&this.myID&&((t={})[FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM]="t",t[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,t[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,t=this.urlFn(t),FirebaseIFrameScriptHolder.nodeRestRequest(t));var e,t=this.onDisconnect;t&&(this.onDisconnect=null,t())},FirebaseIFrameScriptHolder.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},FirebaseIFrameScriptHolder.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(0<this.pendingSegs.length?2:1)){this.currentSerial++;for(var e={},e=(e[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,e[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,e[FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial,this.urlFn(e)),t="",o=0;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+SEG_HEADER_SIZE+t.length<=MAX_URL_DATA_SIZE))break;var r=this.pendingSegs.shift(),t=t+"&"+FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+o+"="+r.seg+"&"+FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+o+"="+r.ts+"&"+FIREBASE_LONGPOLL_DATA_PARAM+o+"="+r.d;o++}return this.addLongPollTag_(e+=t,this.currentSerial),!0}return!1},FirebaseIFrameScriptHolder.prototype.enqueueSegment=function(e,t,o){this.pendingSegs.push({seg:e,ts:t,d:o}),this.alive&&this.newRequest_()},FirebaseIFrameScriptHolder.prototype.addLongPollTag_=function(e,t){var o=this,r=(o.outstandingRequests.add(t,1),function(){o.outstandingRequests.remove(t),o.newRequest_()}),n=setTimeout(r,Math.floor(KEEPALIVE_REQUEST_INTERVAL));this.addTag(e,function(){clearTimeout(n),r()})},FirebaseIFrameScriptHolder.prototype.addTag=function(e,o){var r;NODE_CLIENT?this.doNodeLongPoll(e,o):(r=this,setTimeout(function(){try{var t;r.sendNewPolls&&((t=r.myIFrame.doc.createElement("script")).type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),o())},t.onerror=function(){fb.core.util.log("Long-poll script failed to load: "+e),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(t))}catch(e){}},Math.floor(1)))},void 0!==NODE_CLIENT&&NODE_CLIENT&&(FirebaseIFrameScriptHolder.request=null,FirebaseIFrameScriptHolder.nodeRestRequest=function(r,n){FirebaseIFrameScriptHolder.request||(FirebaseIFrameScriptHolder.request=require("request")),FirebaseIFrameScriptHolder.request(r,function(e,t,o){if(e)throw"Rest request for "+r.url+" failed.";n&&n(o)})},FirebaseIFrameScriptHolder.prototype.doNodeLongPoll=function(e,t){var o=this;FirebaseIFrameScriptHolder.nodeRestRequest({url:e,forever:!0},function(e){o.evalBody(e),t()})},FirebaseIFrameScriptHolder.prototype.evalBody=function(body){eval("var jsonpCB = function("+FIREBASE_LONGPOLL_COMMAND_CB_NAME+", "+FIREBASE_LONGPOLL_DATA_CB_NAME+") {"+body+"}"),jsonpCB(this.commandCB,this.onMessageCB)}),goog.provide("fb.realtime.WebSocketConnection"),goog.require("fb.constants"),goog.require("fb.core.stats.StatsManager"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.realtime.Constants"),goog.require("fb.realtime.Transport"),goog.require("fb.util.json");var WEBSOCKET_MAX_FRAME_SIZE=16384,WEBSOCKET_KEEPALIVE_INTERVAL=45e3,UPGRADE_TIMEOUT=(fb.WebSocket=null,NODE_CLIENT?(goog.require("fb.core.util.NodePatches"),fb.WebSocket=require("faye-websocket").Client):"undefined"!=typeof MozWebSocket?fb.WebSocket=MozWebSocket:"undefined"!=typeof WebSocket&&(fb.WebSocket=WebSocket),fb.realtime.WebSocketConnection=function(e,t,o,r){this.connId=e,this.log_=fb.core.util.logWrapper(this.connId),this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.stats_=fb.core.stats.StatsManager.getCollection(t),this.connURL=this.connectionURL_(t,o,r)},fb.realtime.WebSocketConnection.prototype.connectionURL_=function(e,t,o){var r={};return r[fb.realtime.Constants.VERSION_PARAM]=fb.realtime.Constants.PROTOCOL_VERSION,!NODE_CLIENT&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(fb.realtime.Constants.FORGE_DOMAIN)&&(r[fb.realtime.Constants.REFERER_PARAM]=fb.realtime.Constants.FORGE_REF),t&&(r[fb.realtime.Constants.TRANSPORT_SESSION_PARAM]=t),o&&(r[fb.realtime.Constants.LAST_SESSION_PARAM]=o),e.connectionURL(fb.realtime.Constants.WEBSOCKET,r)},fb.realtime.WebSocketConnection.prototype.open=function(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,fb.core.storage.PersistentStorage.set("previous_websocket_failure",!0);try{var o;NODE_CLIENT?(o={headers:{"User-Agent":"Firebase/"+fb.realtime.Constants.PROTOCOL_VERSION+"/"+CLIENT_VERSION+"/"+process.platform+"/Node"}},this.mySock=new fb.WebSocket(this.connURL,[],o)):this.mySock=new fb.WebSocket(this.connURL)}catch(e){this.log_("Error instantiating WebSocket.");t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}var r=this;this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(e){r.handleIncomingFrame(e)},this.mySock.onerror=function(e){r.log_("WebSocket error.  Closing connection.");e=e.message||e.data;e&&r.log_(e),r.onClosed_()}},fb.realtime.WebSocketConnection.prototype.start=function(){},fb.realtime.WebSocketConnection.forceDisallow=function(){fb.realtime.WebSocketConnection.forceDisallow_=!0},fb.realtime.WebSocketConnection.isAvailable=function(){var e,t=!1;return"undefined"!=typeof navigator&&navigator.userAgent&&((e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)),!t&&null!==fb.WebSocket&&!fb.realtime.WebSocketConnection.forceDisallow_},fb.realtime.WebSocketConnection.responsesRequiredToBeHealthy=2,fb.realtime.WebSocketConnection.healthyTimeout=3e4,fb.realtime.WebSocketConnection.previouslyFailed=function(){return fb.core.storage.PersistentStorage.isInMemoryStorage||!0===fb.core.storage.PersistentStorage.get("previous_websocket_failure")},fb.realtime.WebSocketConnection.prototype.markConnectionHealthy=function(){fb.core.storage.PersistentStorage.remove("previous_websocket_failure")},fb.realtime.WebSocketConnection.prototype.appendFrame_=function(e){this.frames.push(e),this.frames.length==this.totalFrames&&(e=this.frames.join(""),this.frames=null,e=fb.util.json.eval(e),this.onMessage(e))},fb.realtime.WebSocketConnection.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},fb.realtime.WebSocketConnection.prototype.extractFrameCount_=function(e){if(fb.core.util.assert(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},fb.realtime.WebSocketConnection.prototype.handleIncomingFrame=function(e){null!==this.mySock&&(e=e.data,this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(e):null!==(e=this.extractFrameCount_(e))&&this.appendFrame_(e))},fb.realtime.WebSocketConnection.prototype.send=function(e){this.resetKeepAlive();var e=fb.util.json.stringify(e),t=(this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length),fb.core.util.splitStringBySize(e,WEBSOCKET_MAX_FRAME_SIZE));1<t.length&&this.mySock.send(String(t.length));for(var o=0;o<t.length;o++)this.mySock.send(t[o])},fb.realtime.WebSocketConnection.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},fb.realtime.WebSocketConnection.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},fb.realtime.WebSocketConnection.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},fb.realtime.WebSocketConnection.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.mySock.send("0"),e.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))},goog.require("fb.constants"),goog.require("fb.realtime.BrowserPollConnection"),goog.require("fb.realtime.Transport"),goog.provide("fb.realtime.TransportManager"),goog.require("fb.realtime.WebSocketConnection"),fb.realtime.TransportManager=function(e){this.initTransports_(e)},fb.realtime.TransportManager.ALL_TRANSPORTS=[fb.realtime.BrowserPollConnection,fb.realtime.WebSocketConnection],fb.realtime.TransportManager.prototype.initTransports_=function(e){var o,t=fb.realtime.WebSocketConnection&&fb.realtime.WebSocketConnection.isAvailable(),r=t&&!fb.realtime.WebSocketConnection.previouslyFailed();e.webSocketOnly&&(t||fb.core.util.warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r?this.transports_=[fb.realtime.WebSocketConnection]:(o=this.transports_=[],fb.core.util.each(fb.realtime.TransportManager.ALL_TRANSPORTS,function(e,t){t&&t.isAvailable()&&o.push(t)}))},fb.realtime.TransportManager.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},fb.realtime.TransportManager.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},goog.provide("fb.realtime.Connection"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.realtime.Constants"),goog.require("fb.realtime.TransportManager"),6e4),DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10240,BYTES_RECEIVED_HEALTHY_OVERRIDE=102400,REALTIME_STATE_CONNECTING=0,REALTIME_STATE_CONNECTED=1,REALTIME_STATE_DISCONNECTED=2,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h",RECONNECT_MIN_DELAY=(fb.realtime.Connection=function(e,t,o,r,n,i,a){this.id=e,this.log_=fb.core.util.logWrapper("c:"+this.id+":"),this.onMessage_=o,this.onReady_=r,this.onDisconnect_=n,this.onKill_=i,this.repoInfo_=t,this.pendingDataMessages=[],this.connectionCount=0,this.transportManager_=new fb.realtime.TransportManager(t),this.state_=REALTIME_STATE_CONNECTING,this.lastSessionId=a,this.log_("Connection created"),this.start_()},fb.realtime.Connection.prototype.start_=function(){var e=this.transportManager_.initialTransport(),t=(this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0,this.connReceiver_(this.conn_)),o=this.disconnReceiver_(this.conn_),r=(this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,this),e=(setTimeout(function(){r.conn_&&r.conn_.open(t,o)},Math.floor(0)),e.healthyTimeout||0);0<e&&(this.healthyTimeout_=setTimeout(function(){r.healthyTimeout_=null,r.isHealthy_||(r.conn_&&r.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(r.log_("Connection exceeded healthy timeout but has received "+r.conn_.bytesReceived+" bytes.  Marking connection healthy."),r.isHealthy_=!0,r.conn_.markConnectionHealthy()):r.conn_&&r.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?r.log_("Connection exceeded healthy timeout but has sent "+r.conn_.bytesSent+" bytes.  Leaving connection alive."):(r.log_("Closing unhealthy connection after timeout."),r.close()))},Math.floor(e)))},fb.realtime.Connection.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},fb.realtime.Connection.prototype.disconnReceiver_=function(t){var o=this;return function(e){t===o.conn_?o.onConnectionLost_(e):t===o.secondaryConn_?(o.log_("Secondary connection lost."),o.onSecondaryConnectionLost_()):o.log_("closing an old connection")}},fb.realtime.Connection.prototype.connReceiver_=function(t){var o=this;return function(e){o.state_!=REALTIME_STATE_DISCONNECTED&&(t===o.rx_?o.onPrimaryMessageReceived_(e):t===o.secondaryConn_?o.onSecondaryMessageReceived_(e):o.log_("message on old connection"))}},fb.realtime.Connection.prototype.sendRequest=function(e){this.sendData_({t:"d",d:e})},fb.realtime.Connection.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},fb.realtime.Connection.prototype.onSecondaryControl_=function(e){MESSAGE_TYPE in e&&((e=e[MESSAGE_TYPE])===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():e===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):e===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))},fb.realtime.Connection.prototype.onSecondaryMessageReceived_=function(e){var t=fb.core.util.requireKey("t",e),e=fb.core.util.requireKey("d",e);if("c"==t)this.onSecondaryControl_(e);else{if("d"!=t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(e)}},fb.realtime.Connection.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))},fb.realtime.Connection.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},fb.realtime.Connection.prototype.onPrimaryMessageReceived_=function(e){var t=fb.core.util.requireKey("t",e),e=fb.core.util.requireKey("d",e);"c"==t?this.onControl_(e):"d"==t&&this.onDataMessage_(e)},fb.realtime.Connection.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},fb.realtime.Connection.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},fb.realtime.Connection.prototype.onControl_=function(e){var t=fb.core.util.requireKey(MESSAGE_TYPE,e);if(MESSAGE_DATA in e){e=e[MESSAGE_DATA];if(t===SERVER_HELLO)this.onHandshake_(e);else if(t===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var o=0;o<this.pendingDataMessages.length;++o)this.onDataMessage_(this.pendingDataMessages[o]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===CONTROL_SHUTDOWN?this.onConnectionShutdown_(e):t===CONTROL_RESET?this.onReset_(e):t===CONTROL_ERROR?fb.core.util.error("Server Error: "+e):t===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):fb.core.util.error("Unknown control packet command: "+t)}},fb.realtime.Connection.prototype.onHandshake_=function(e){var t=e.ts,o=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),this.state_==REALTIME_STATE_CONNECTING&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),fb.realtime.Constants.PROTOCOL_VERSION!==o&&fb.core.util.warn("Protocol version mismatch detected"),this.tryStartUpgrade_())},fb.realtime.Connection.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},fb.realtime.Connection.prototype.startUpgrade_=function(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var e=this.connReceiver_(this.secondaryConn_),t=this.disconnReceiver_(this.secondaryConn_),o=(this.secondaryConn_.open(e,t),this);setTimeout(function(){o.secondaryConn_&&(o.log_("Timed out trying to upgrade."),o.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))},fb.realtime.Connection.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),this.state_===REALTIME_STATE_CONNECTED?this.close():(this.closeConnections_(),this.start_())},fb.realtime.Connection.prototype.onConnectionEstablished_=function(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=REALTIME_STATE_CONNECTED,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null);var o=this;0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeout(function(){o.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))},fb.realtime.Connection.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||this.state_!==REALTIME_STATE_CONNECTED||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))},fb.realtime.Connection.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},fb.realtime.Connection.prototype.onConnectionLost_=function(e){this.conn_=null,e||this.state_!==REALTIME_STATE_CONNECTING?this.state_===REALTIME_STATE_CONNECTED&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(fb.core.storage.PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},fb.realtime.Connection.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},fb.realtime.Connection.prototype.sendData_=function(e){if(this.state_!==REALTIME_STATE_CONNECTED)throw"Connection is not connected";this.tx_.send(e)},fb.realtime.Connection.prototype.close=function(){this.state_!==REALTIME_STATE_DISCONNECTED&&(this.log_("Closing realtime connection."),this.state_=REALTIME_STATE_DISCONNECTED,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},fb.realtime.Connection.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},goog.provide("fb.core.PersistentConnection"),goog.require("fb.core.ServerActions"),goog.require("fb.core.util"),goog.require("fb.core.util.OnlineMonitor"),goog.require("fb.core.util.VisibilityMonitor"),goog.require("fb.login.util.environment"),goog.require("fb.realtime.Connection"),goog.require("fb.util.json"),goog.require("fb.util.jwt"),1e3),RECONNECT_MAX_DELAY_DEFAULT=3e5,RECONNECT_MAX_DELAY_FOR_ADMINS=3e4,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4;fb.core.PersistentConnection=goog.defineClass(null,{constructor:function(e,t,o,r){this.id=fb.core.PersistentConnection.nextPersistentConnectionId_++,this.log_=fb.core.util.logWrapper("p:"+this.id+":"),this.interrupted_=!1,this.killed_=!1,this.listens_={},this.outstandingPuts_=[],this.outstandingPutCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,this.onDataUpdate_=t,this.onConnectStatus_=o,this.onServerInfoUpdate_=r,this.repoInfo_=e,this.securityDebugCallback_=null,this.lastSessionId=null,this.realtime_=null,this.credential_=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,this.scheduleConnect_(0),fb.core.util.VisibilityMonitor.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&fb.core.util.OnlineMonitor.getInstance().on("online",this.onOnline_,this)},statics:{nextPersistentConnectionId_:0,nextConnectionId_:0},sendRequest:function(e,t,o){var r=++this.requestNumber_,e={r:r,a:e,b:t};this.log_(fb.util.json.stringify(e)),fb.core.util.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),o&&(this.requestCBHash_[r]=o)},listen:function(e,t,o,r){var n=e.queryIdentifier(),i=e.path.toString(),r=(this.log_("Listen called for "+i+" "+n),this.listens_[i]=this.listens_[i]||{},fb.core.util.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),fb.core.util.assert(!this.listens_[i][n],"listen() called twice for same path/queryId."),{onComplete:r,hashFn:t,query:e,tag:o});this.listens_[i][n]=r,this.connected_&&this.sendListen_(r)},sendListen_:function(r){var n=r.query,i=n.path.toString(),a=n.queryIdentifier(),s=this,e=(this.log_("Listen on "+i+" for "+a),{p:i});r.tag&&(e.q=n.queryObject(),e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,function(e){var t=e.d,o=e.s;s.warnOnListenWarnings_(t,n),(s.listens_[i]&&s.listens_[i][a])===r&&(s.log_("listen response",e),"ok"!==o&&s.removeListen_(i,a),r.onComplete&&r.onComplete(o,t))})},warnOnListenWarnings_:function(e,t){e&&"object"==typeof e&&fb.util.obj.contains(e,"w")&&(e=fb.util.obj.get(e,"w"),goog.isArray(e)&&goog.array.contains(e,"no_index")&&(e='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',t=t.path.toString(),fb.core.util.warn("Using an unspecified index. Consider adding "+e+" at "+t+" to your security rules for better performance")))},auth:function(e,t,o){this.credential_={cred:e,firstRequestSent:!1,callback:t,cancelCallback:o},this.log_("Authenticating using credential: "+e),this.tryAuth(),this.reduceReconnectDelayIfAdminCredential_(e)},reduceReconnectDelayIfAdminCredential_:function(e){40!=e.length&&!fb.util.jwt.isAdmin(e)||(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)},unauth:function(o){delete this.credential_,this.connected_&&this.sendRequest("unauth",{},function(e){var t=e.s,e=e.d;o(t,e)})},tryAuth:function(){var e,o=this.credential_,r=this;this.connected_&&o&&(e={cred:o.cred},this.sendRequest("auth",e,function(e){var t=e.s,e=e.d||"error";"ok"!==t&&r.credential_===o&&delete r.credential_,o.firstRequestSent?"ok"!==t&&o.cancelCallback&&o.cancelCallback(t,e):(o.firstRequestSent=!0,o.callback&&o.callback(t,e))}))},unlisten:function(e,t){var o=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+o+" "+r),fb.core.util.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,r)&&this.connected_&&this.sendUnlisten_(o,r,e.queryObject(),t)},sendUnlisten_:function(e,t,o,r){this.log_("Unlisten on "+e+" for "+t);t={p:e};r&&(t.q=o,t.t=r),this.sendRequest("n",t)},onDisconnectPut:function(e,t,o){this.connected_?this.sendOnDisconnect_("o",e,t,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:o})},onDisconnectMerge:function(e,t,o){this.connected_?this.sendOnDisconnect_("om",e,t,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:o})},onDisconnectCancel:function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},sendOnDisconnect_:function(e,t,o,r){t={p:t,d:o};this.log_("onDisconnect "+e,t),this.sendRequest(e,t,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},put:function(e,t,o,r){this.putInternal("p",e,t,o,r)},merge:function(e,t,o,r){this.putInternal("m",e,t,o,r)},putInternal:function(e,t,o,r,n){o={p:t,d:o},goog.isDef(n)&&(o.h=n),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++,n=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(n):this.log_("Buffering put: "+t)},sendPut_:function(t){var o=this,r=this.outstandingPuts_[t].action,e=this.outstandingPuts_[t].request,n=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,e,function(e){o.log_(r+" response",e),delete o.outstandingPuts_[t],o.outstandingPutCount_--,0===o.outstandingPutCount_&&(o.outstandingPuts_=[]),n&&n(e.s,e.d)})},reportStats:function(e){this.connected_&&(this.log_("reportStats",e={c:e}),this.sendRequest("s",e,function(e){"ok"!==e.s&&(e=e.d,this.log_("reportStats","Error sending stats: "+e))}))},onDataMessage_:function(e){if("r"in e){this.log_("from server: "+fb.util.json.stringify(e));var t=e.r,o=this.requestCBHash_[t];o&&(delete this.requestCBHash_[t],o(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},onDataPush_:function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):fb.core.util.error("Unrecognized action received from server: "+fb.util.json.stringify(e)+"\nAre you using the latest client?")},onReady_:function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},scheduleConnect_:function(e){fb.core.util.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_);var t=this;this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},onVisible_:function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},onOnline_:function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},onRealtimeDisconnect_:function(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(e=(new Date).getTime()-this.lastConnectionEstablishedTime_,RECONNECT_DELAY_RESET_TIMEOUT<e&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)),this.onConnectStatus_(!1)},establishConnection_:function(){var e,t,o,r,n,i;this.shouldReconnect_()&&(this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,e=goog.bind(this.onDataMessage_,this),t=goog.bind(this.onReady_,this),o=goog.bind(this.onRealtimeDisconnect_,this),r=this.id+":"+fb.core.PersistentConnection.nextConnectionId_++,i=(n=this).lastSessionId,this.realtime_=new fb.realtime.Connection(r,this.repoInfo_,e,t,o,function(e){fb.core.util.warn(e+" ("+n.repoInfo_.toString()+")"),n.killed_=!0},i))},interrupt:function(){this.interrupted_=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},resume:function(){this.interrupted_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)},handleTimestamp_:function(e){e-=(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},cancelSentTransactions_:function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},onListenRevoked_:function(e,t){t=t?goog.array.map(t,function(e){return fb.core.util.ObjectToUniqueKey(e)}).join("$"):"default",e=this.removeListen_(e,t);e&&e.onComplete&&e.onComplete("permission_denied")},removeListen_:function(e,t){var o,e=new fb.core.util.Path(e).toString();return goog.isDef(this.listens_[e])?(o=this.listens_[e][t],delete this.listens_[e][t],0===goog.object.getCount(this.listens_[e])&&delete this.listens_[e]):o=void 0,o},onAuthRevoked_:function(e,t){var o=this.credential_;delete this.credential_,o&&o.cancelCallback&&o.cancelCallback(e,t)},onSecurityDebugPacket_:function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&"undefined"!=typeof console&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},restoreState_:function(){this.tryAuth();var o=this;goog.object.forEach(this.listens_,function(e,t){goog.object.forEach(e,function(e){o.sendListen_(e)})});for(var e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}},sendConnectStats_:function(){var e={};e["sdk.js."+CLIENT_VERSION.replace(/\./g,"-")]=1,fb.login.util.environment.isMobileCordova()&&(e["framework.cordova"]=1),this.reportStats(e)},shouldReconnect_:function(){var e=fb.core.util.OnlineMonitor.getInstance().currentlyOnline();return!this.killed_&&!this.interrupted_&&e}}),goog.provide("fb.api.INTERNAL"),goog.require("fb.core.PersistentConnection"),goog.require("fb.realtime.Connection"),goog.require("fb.login.transports.PopupReceiver"),goog.require("fb.login.Constants"),fb.api.INTERNAL={},fb.api.INTERNAL.forceLongPolling=function(){fb.realtime.WebSocketConnection.forceDisallow(),fb.realtime.BrowserPollConnection.forceAllow()},goog.exportProperty(fb.api.INTERNAL,"forceLongPolling",fb.api.INTERNAL.forceLongPolling),fb.api.INTERNAL.forceWebSockets=function(){fb.realtime.BrowserPollConnection.forceDisallow()},goog.exportProperty(fb.api.INTERNAL,"forceWebSockets",fb.api.INTERNAL.forceWebSockets),fb.api.INTERNAL.setSecurityDebugCallback=function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},goog.exportProperty(fb.api.INTERNAL,"setSecurityDebugCallback",fb.api.INTERNAL.setSecurityDebugCallback),fb.api.INTERNAL.stats=function(e,t){e.repo.stats(t)},goog.exportProperty(fb.api.INTERNAL,"stats",fb.api.INTERNAL.stats),fb.api.INTERNAL.statsIncrementCounter=function(e,t){e.repo.statsIncrementCounter(t)},goog.exportProperty(fb.api.INTERNAL,"statsIncrementCounter",fb.api.INTERNAL.statsIncrementCounter),fb.api.INTERNAL.dataUpdateCount=function(e){return e.repo.dataUpdateCount},goog.exportProperty(fb.api.INTERNAL,"dataUpdateCount",fb.api.INTERNAL.dataUpdateCount),fb.api.INTERNAL.interceptServerData=function(e,t){return e.repo.interceptServerData_(t)},goog.exportProperty(fb.api.INTERNAL,"interceptServerData",fb.api.INTERNAL.interceptServerData),fb.api.INTERNAL.onLoginPopupOpen=function(e){new fb.login.transports.PopupReceiver(e)},goog.exportProperty(fb.api.INTERNAL,"onPopupOpen",fb.api.INTERNAL.onLoginPopupOpen),fb.api.INTERNAL.setAuthenticationServer=function(e){fb.login.Constants.SERVER_HOST=e},goog.exportProperty(fb.api.INTERNAL,"setAuthenticationServer",fb.api.INTERNAL.setAuthenticationServer),goog.provide("fb.api.DataSnapshot"),goog.require("fb.core.snap"),goog.require("fb.core.util.SortedMap"),goog.require("fb.core.util.validation"),fb.api.DataSnapshot=function(e,t,o){this.node_=e,this.query_=t,this.index_=o},fb.api.DataSnapshot.prototype.val=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.val",0,0,arguments.length),this.node_.val()},goog.exportProperty(fb.api.DataSnapshot.prototype,"val",fb.api.DataSnapshot.prototype.val),fb.api.DataSnapshot.prototype.exportVal=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},goog.exportProperty(fb.api.DataSnapshot.prototype,"exportVal",fb.api.DataSnapshot.prototype.exportVal),fb.api.DataSnapshot.prototype.exists=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},goog.exportProperty(fb.api.DataSnapshot.prototype,"exists",fb.api.DataSnapshot.prototype.exists),fb.api.DataSnapshot.prototype.child=function(e){fb.util.validation.validateArgCount("Firebase.DataSnapshot.child",0,1,arguments.length),goog.isNumber(e)&&(e=String(e)),fb.core.util.validation.validatePathString("Firebase.DataSnapshot.child",1,e,!1);var t=new fb.core.util.Path(e),o=this.query_.child(t);return new fb.api.DataSnapshot(this.node_.getChild(t),o,fb.core.snap.PriorityIndex)},goog.exportProperty(fb.api.DataSnapshot.prototype,"child",fb.api.DataSnapshot.prototype.child),fb.api.DataSnapshot.prototype.hasChild=function(e){fb.util.validation.validateArgCount("Firebase.DataSnapshot.hasChild",1,1,arguments.length),fb.core.util.validation.validatePathString("Firebase.DataSnapshot.hasChild",1,e,!1);var t=new fb.core.util.Path(e);return!this.node_.getChild(t).isEmpty()},goog.exportProperty(fb.api.DataSnapshot.prototype,"hasChild",fb.api.DataSnapshot.prototype.hasChild),fb.api.DataSnapshot.prototype.getPriority=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},goog.exportProperty(fb.api.DataSnapshot.prototype,"getPriority",fb.api.DataSnapshot.prototype.getPriority),fb.api.DataSnapshot.prototype.forEach=function(o){var r;return fb.util.validation.validateArgCount("Firebase.DataSnapshot.forEach",1,1,arguments.length),fb.util.validation.validateCallback("Firebase.DataSnapshot.forEach",1,o,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild((r=this).index_,function(e,t){return o(new fb.api.DataSnapshot(t,r.query_.child(e),fb.core.snap.PriorityIndex))})},goog.exportProperty(fb.api.DataSnapshot.prototype,"forEach",fb.api.DataSnapshot.prototype.forEach),fb.api.DataSnapshot.prototype.hasChildren=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},goog.exportProperty(fb.api.DataSnapshot.prototype,"hasChildren",fb.api.DataSnapshot.prototype.hasChildren),fb.api.DataSnapshot.prototype.name=function(){return fb.core.util.warn("Firebase.DataSnapshot.name() being deprecated. Please use Firebase.DataSnapshot.key() instead."),fb.util.validation.validateArgCount("Firebase.DataSnapshot.name",0,0,arguments.length),this.key()},goog.exportProperty(fb.api.DataSnapshot.prototype,"name",fb.api.DataSnapshot.prototype.name),fb.api.DataSnapshot.prototype.key=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.key",0,0,arguments.length),this.query_.key()},goog.exportProperty(fb.api.DataSnapshot.prototype,"key",fb.api.DataSnapshot.prototype.key),fb.api.DataSnapshot.prototype.numChildren=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},goog.exportProperty(fb.api.DataSnapshot.prototype,"numChildren",fb.api.DataSnapshot.prototype.numChildren),fb.api.DataSnapshot.prototype.ref=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.ref",0,0,arguments.length),this.query_},goog.exportProperty(fb.api.DataSnapshot.prototype,"ref",fb.api.DataSnapshot.prototype.ref),goog.provide("fb.core.Repo"),goog.require("fb.api.DataSnapshot"),goog.require("fb.core.PersistentConnection"),goog.require("fb.core.ReadonlyRestClient"),goog.require("fb.core.SnapshotHolder"),goog.require("fb.core.SparseSnapshotTree"),goog.require("fb.core.SyncTree"),goog.require("fb.core.stats.StatsCollection"),goog.require("fb.core.stats.StatsListener"),goog.require("fb.core.stats.StatsManager"),goog.require("fb.core.stats.StatsReporter"),goog.require("fb.core.util"),goog.require("fb.core.util.ServerValues"),goog.require("fb.core.util.Tree"),goog.require("fb.core.view.EventQueue"),goog.require("fb.login.AuthenticationManager"),goog.require("fb.util.json"),goog.require("fb.util.jwt"),goog.require("goog.string"),fb.core.Repo=goog.defineClass(null,{constructor:function(e,t){this.repoInfo_=e,this.stats_=fb.core.stats.StatsManager.getCollection(e),this.statsListener_=null,this.eventQueue_=new fb.core.view.EventQueue,this.nextWriteId_=1,this.persistentConnection_=null,this.server_,t||fb.core.util.beingCrawled()?(this.server_=new fb.core.ReadonlyRestClient(this.repoInfo_,goog.bind(this.onDataUpdate_,this)),setTimeout(goog.bind(this.onConnectStatus_,this,!0),0)):(this.persistentConnection_=new fb.core.PersistentConnection(this.repoInfo_,goog.bind(this.onDataUpdate_,this),goog.bind(this.onConnectStatus_,this),goog.bind(this.onServerInfoUpdate_,this)),this.server_=this.persistentConnection_),this.statsReporter_=fb.core.stats.StatsManager.getOrCreateReporter(e,goog.bind(function(){return new fb.core.stats.StatsReporter(this.stats_,this.server_)},this)),this.transactions_init_(),this.infoData_=new fb.core.SnapshotHolder;var a=this;this.infoSyncTree_=new fb.core.SyncTree({startListening:function(e,t,o,r){var n=[],i=a.infoData_.getNode(e.path);return i.isEmpty()||(n=a.infoSyncTree_.applyServerOverwrite(e.path,i),setTimeout(function(){r("ok")},0)),n},stopListening:goog.nullFunction}),this.updateInfo_("connected",!1),this.onDisconnect_=new fb.core.SparseSnapshotTree,this.auth=new fb.login.AuthenticationManager(e,goog.bind(this.server_.auth,this.server_),goog.bind(this.server_.unauth,this.server_),goog.bind(this.onAuthStatus_,this)),this.dataUpdateCount=0,this.interceptServerDataCallback_=null,this.serverSyncTree_=new fb.core.SyncTree({startListening:function(o,e,t,r){return a.server_.listen(o,t,e,function(e,t){e=r(e,t);a.eventQueue_.raiseEventsForChangedPath(o.path,e)}),[]},stopListening:function(e,t){a.server_.unlisten(e,t)}})},toString:function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},name:function(){return this.repoInfo_.namespace},serverTime:function(){var e=this.infoData_.getNode(new fb.core.util.Path(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},generateServerValues:function(){return fb.core.util.ServerValues.generateWithValues({timestamp:this.serverTime()})},onDataUpdate_:function(e,t,o,r){this.dataUpdateCount++;var n,i=new fb.core.util.Path(e),e=(t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t,[]),a=i;0<(e=r?o?(n=goog.object.map(t,function(e){return fb.core.snap.NodeFromJSON(e)}),this.serverSyncTree_.applyTaggedQueryMerge(i,n,r)):(n=fb.core.snap.NodeFromJSON(t),this.serverSyncTree_.applyTaggedQueryOverwrite(i,n,r)):o?(n=goog.object.map(t,function(e){return fb.core.snap.NodeFromJSON(e)}),this.serverSyncTree_.applyServerMerge(i,n)):(r=fb.core.snap.NodeFromJSON(t),this.serverSyncTree_.applyServerOverwrite(i,r))).length&&(a=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(a,e)},interceptServerData_:function(e){this.interceptServerDataCallback_=e},onConnectStatus_:function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},onServerInfoUpdate_:function(e){var o=this;fb.core.util.each(e,function(e,t){o.updateInfo_(t,e)})},onAuthStatus_:function(e){this.updateInfo_("authenticated",e)},updateInfo_:function(e,t){e=new fb.core.util.Path("/.info/"+e),t=fb.core.snap.NodeFromJSON(t),this.infoData_.updateSnapshot(e,t),t=this.infoSyncTree_.applyServerOverwrite(e,t);this.eventQueue_.raiseEventsForChangedPath(e,t)},getNextWriteId_:function(){return this.nextWriteId_++},setWithPriority:function(r,e,t,n){this.log_("set",{path:r.toString(),value:e,priority:t});var o=this.generateServerValues(),e=fb.core.snap.NodeFromJSON(e,t),t=fb.core.util.ServerValues.resolveDeferredValueSnapshot(e,o),i=this.getNextWriteId_(),o=this.serverSyncTree_.applyUserOverwrite(r,t,i,!0),a=(this.eventQueue_.queueEvents(o),this),t=(this.server_.put(r.toString(),e.val(!0),function(e,t){var o="ok"===e,o=(o||fb.core.util.warn("set at "+r+" failed: "+e),a.serverSyncTree_.ackUserWrite(i,!o));a.eventQueue_.raiseEventsForChangedPath(r,o),a.callOnCompleteCallback(n,e,t)}),this.abortTransactions_(r));this.rerunTransactions_(t),this.eventQueue_.raiseEventsForChangedPath(t,[])},update:function(n,e,i){this.log_("update",{path:n.toString(),value:e});var a,s,t,o=!0,r=this.generateServerValues(),l={};goog.object.forEach(e,function(e,t){o=!1;e=fb.core.snap.NodeFromJSON(e);l[t]=fb.core.util.ServerValues.resolveDeferredValueSnapshot(e,r)}),o?(fb.core.util.log("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(i,"ok")):(a=this.getNextWriteId_(),t=this.serverSyncTree_.applyUserMerge(n,l,a),this.eventQueue_.queueEvents(t),(s=this).server_.merge(n.toString(),e,function(e,t){var o="ok"===e,o=(o||fb.core.util.warn("update at "+n+" failed: "+e),s.serverSyncTree_.ackUserWrite(a,!o)),r=n;0<o.length&&(r=s.rerunTransactions_(n)),s.eventQueue_.raiseEventsForChangedPath(r,o),s.callOnCompleteCallback(i,e,t)}),t=this.abortTransactions_(n),this.rerunTransactions_(t),this.eventQueue_.raiseEventsForChangedPath(n,[]))},runOnDisconnectEvents_:function(){this.log_("onDisconnectEvents");var o=this,e=this.generateServerValues(),e=fb.core.util.ServerValues.resolveDeferredValueTree(this.onDisconnect_,e),r=[];e.forEachTree(fb.core.util.Path.Empty,function(e,t){r=r.concat(o.serverSyncTree_.applyServerOverwrite(e,t));t=o.abortTransactions_(e);o.rerunTransactions_(t)}),this.onDisconnect_=new fb.core.SparseSnapshotTree,this.eventQueue_.raiseEventsForChangedPath(fb.core.util.Path.Empty,r)},onDisconnectCancel:function(o,r){var n=this;this.server_.onDisconnectCancel(o.toString(),function(e,t){"ok"===e&&n.onDisconnect_.forget(o),n.callOnCompleteCallback(r,e,t)})},onDisconnectSet:function(o,e,r){var n=this,i=fb.core.snap.NodeFromJSON(e);this.server_.onDisconnectPut(o.toString(),i.val(!0),function(e,t){"ok"===e&&n.onDisconnect_.remember(o,i),n.callOnCompleteCallback(r,e,t)})},onDisconnectSetWithPriority:function(o,e,t,r){var n=this,i=fb.core.snap.NodeFromJSON(e,t);this.server_.onDisconnectPut(o.toString(),i.val(!0),function(e,t){"ok"===e&&n.onDisconnect_.remember(o,i),n.callOnCompleteCallback(r,e,t)})},onDisconnectUpdate:function(n,i,a){var e,s,t=!0;for(e in i)t=!1;t?(fb.core.util.log("onDisconnect().update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok")):(s=this).server_.onDisconnectMerge(n.toString(),i,function(e,t){if("ok"===e)for(var o in i){var r=fb.core.snap.NodeFromJSON(i[o]);s.onDisconnect_.remember(n.child(o),r)}s.callOnCompleteCallback(a,e,t)})},addEventCallbackForQuery:function(e,t){t=(".info"===e.path.getFront()?this.infoSyncTree_:this.serverSyncTree_).addEventRegistration(e,t);this.eventQueue_.raiseEventsAtPath(e.path,t)},removeEventCallbackForQuery:function(e,t){t=(".info"===e.path.getFront()?this.infoSyncTree_:this.serverSyncTree_).removeEventRegistration(e,t);this.eventQueue_.raiseEventsAtPath(e.path,t)},interrupt:function(){this.persistentConnection_&&this.persistentConnection_.interrupt()},resume:function(){this.persistentConnection_&&this.persistentConnection_.resume()},stats:function(e){if("undefined"!=typeof console){var t,o=(e?(this.statsListener_||(this.statsListener_=new fb.core.stats.StatsListener(this.stats_)),this.statsListener_):this.stats_).get(),r=goog.array.reduce(goog.object.getKeys(o),function(e,t,o,r){return Math.max(t.length,e)},0);for(t in o){for(var n=o[t],i=t.length;i<r+2;i++)t+=" ";console.log(t+n)}}},statsIncrementCounter:function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},log_:function(e){var t="";this.persistentConnection_&&(t=this.persistentConnection_.id+":"),fb.core.util.log(t,arguments)},callOnCompleteCallback:function(o,r,n){o&&fb.core.util.exceptionGuard(function(){var e,t;"ok"==r?o(null):(t=e=(r||"error").toUpperCase(),n&&(t+=": "+n),(t=new Error(t)).code=e,o(t))})}}),goog.provide("fb.core.Repo_transaction"),goog.require("fb.core.Repo"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.util"),fb.core.TransactionStatus={RUN:1,SENT:2,COMPLETED:3,SENT_NEEDS_ABORT:4,NEEDS_ABORT:5},fb.core.Repo.MAX_TRANSACTION_RETRIES_=25,fb.core.Transaction,fb.core.Repo.prototype.transactions_init_=function(){this.transactionQueueTree_=new fb.core.util.Tree},fb.core.Repo.prototype.startTransaction=function(e,t,o,r){this.log_("transaction on "+e);var n,i,a=function(){},s=new Firebase(this,e),t=(s.on("value",a),{path:e,update:t,onComplete:o,status:null,order:fb.core.util.LUIDGenerator(),applyLocally:r,retryCount:0,unwatcher:function(){s.off("value",a)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null}),o=this.getLatestState_(e),r=(t.currentInputSnapshot=o,t.update(o.val()));goog.isDef(r)?(fb.core.util.validation.validateFirebaseData("transaction failed: Data returned ",r,t.path),t.status=fb.core.TransactionStatus.RUN,(n=(o=this.transactionQueueTree_.subTree(e)).getValue()||[]).push(t),o.setValue(n),"object"==typeof r&&null!==r&&fb.util.obj.contains(r,".priority")?(i=fb.util.obj.get(r,".priority"),fb.core.util.assert(fb.core.util.validation.isValidPriority(i),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):i=(this.serverSyncTree_.calcCompleteEventCache(e)||fb.core.snap.EMPTY_NODE).getPriority().val(),o=this.generateServerValues(),n=fb.core.snap.NodeFromJSON(r,i),r=fb.core.util.ServerValues.resolveDeferredValueSnapshot(n,o),t.currentOutputSnapshotRaw=n,t.currentOutputSnapshotResolved=r,t.currentWriteId=this.getNextWriteId_(),i=this.serverSyncTree_.applyUserOverwrite(e,r,t.currentWriteId,t.applyLocally),this.eventQueue_.raiseEventsForChangedPath(e,i),this.sendReadyTransactions_()):(t.unwatcher(),t.currentOutputSnapshotRaw=null,t.currentOutputSnapshotResolved=null,t.onComplete&&(o=new fb.api.DataSnapshot(t.currentInputSnapshot,new Firebase(this,t.path),fb.core.snap.PriorityIndex),t.onComplete(null,!1,o)))},fb.core.Repo.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||fb.core.snap.EMPTY_NODE},fb.core.Repo.prototype.sendReadyTransactions_=function(e){var t,o=e||this.transactionQueueTree_;e||this.pruneCompletedTransactionsBelowNode_(o),null!==o.getValue()?(e=this.buildTransactionQueue_(o),fb.core.util.assert(0<e.length,"Sending zero length transaction queue"),goog.array.every(e,function(e){return e.status===fb.core.TransactionStatus.RUN})&&this.sendTransactionQueue_(o.path(),e)):o.hasChildren()&&(t=this,o.forEachChild(function(e){t.sendReadyTransactions_(e)}))},fb.core.Repo.prototype.sendTransactionQueue_=function(i,a){for(var e=goog.array.map(a,function(e){return e.currentWriteId}),e=this.getLatestState_(i,e),t=e,e=e.hash(),s=0;s<a.length;s++)var o=a[s],r=(fb.core.util.assert(o.status===fb.core.TransactionStatus.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=fb.core.TransactionStatus.SENT,o.retryCount++,fb.core.util.Path.relativePath(i,o.path)),t=t.updateChild(r,o.currentOutputSnapshotRaw);var n=t.val(!0),l=i,c=this;this.server_.put(l.toString(),n,function(e){c.log_("transaction put response",{path:l.toString(),status:e});var t=[];if("ok"===e){var o,r,n=[];for(s=0;s<a.length;s++)a[s].status=fb.core.TransactionStatus.COMPLETED,t=t.concat(c.serverSyncTree_.ackUserWrite(a[s].currentWriteId)),a[s].onComplete&&(r=a[s].currentOutputSnapshotResolved,o=new Firebase(c,a[s].path),r=new fb.api.DataSnapshot(r,o,fb.core.snap.PriorityIndex),n.push(goog.bind(a[s].onComplete,null,null,!0,r))),a[s].unwatcher();for(c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(i)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(i,t),s=0;s<n.length;s++)fb.core.util.exceptionGuard(n[s])}else{if("datastale"===e)for(s=0;s<a.length;s++)a[s].status===fb.core.TransactionStatus.SENT_NEEDS_ABORT?a[s].status=fb.core.TransactionStatus.NEEDS_ABORT:a[s].status=fb.core.TransactionStatus.RUN;else for(fb.core.util.warn("transaction at "+l.toString()+" failed: "+e),s=0;s<a.length;s++)a[s].status=fb.core.TransactionStatus.NEEDS_ABORT,a[s].abortReason=e;c.rerunTransactions_(i)}},e)},fb.core.Repo.prototype.rerunTransactions_=function(e){var e=this.getAncestorTransactionNode_(e),t=e.path(),e=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(e,t),t},fb.core.Repo.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var o=[],r=[],n=goog.array.map(e,function(e){return e.currentWriteId}),i=0;i<e.length;i++){var a,s,l,c=e[i],g=fb.core.util.Path.relativePath(t,c.path),u=!1;fb.core.util.assert(null!==g,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===fb.core.TransactionStatus.NEEDS_ABORT?(a=c.abortReason,r=r.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,u=!0))):c.status===fb.core.TransactionStatus.RUN&&(r=c.retryCount>=fb.core.Repo.MAX_TRANSACTION_RETRIES_?(a="maxretry",r.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,u=!0))):(g=this.getLatestState_(c.path,n),c.currentInputSnapshot=g,l=e[i].update(g.val()),goog.isDef(l)?(fb.core.util.validation.validateFirebaseData("transaction failed: Data returned ",l,c.path),s=fb.core.snap.NodeFromJSON(l),"object"==typeof l&&null!=l&&fb.util.obj.contains(l,".priority")||(s=s.updatePriority(g.getPriority())),l=c.currentWriteId,g=this.generateServerValues(),g=fb.core.util.ServerValues.resolveDeferredValueSnapshot(s,g),c.currentOutputSnapshotRaw=s,c.currentOutputSnapshotResolved=g,c.currentWriteId=this.getNextWriteId_(),goog.array.remove(n,l),(r=r.concat(this.serverSyncTree_.applyUserOverwrite(c.path,g,c.currentWriteId,c.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(l,!0))):(a="nodata",r.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,u=!0))))),this.eventQueue_.raiseEventsForChangedPath(t,r),r=[],u&&(e[i].status=fb.core.TransactionStatus.COMPLETED,s=e[i].unwatcher,setTimeout(s,Math.floor(0)),e[i].onComplete&&("nodata"===a?(g=new Firebase(this,e[i].path),l=e[i].currentInputSnapshot,c=new fb.api.DataSnapshot(l,g,fb.core.snap.PriorityIndex),o.push(goog.bind(e[i].onComplete,null,null,!1,c))):o.push(goog.bind(e[i].onComplete,null,new Error(a),!1,null))))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),i=0;i<o.length;i++)fb.core.util.exceptionGuard(o[i]);this.sendReadyTransactions_()}},fb.core.Repo.prototype.getAncestorTransactionNode_=function(e){for(var t,o=this.transactionQueueTree_;null!==(t=e.getFront())&&null===o.getValue();)o=o.subTree(t),e=e.popFront();return o},fb.core.Repo.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort(function(e,t){return e.order-t.order}),t},fb.core.Repo.prototype.aggregateTransactionQueuesForNode_=function(e,t){var o=e.getValue();if(null!==o)for(var r=0;r<o.length;r++)t.push(o[r]);var n=this;e.forEachChild(function(e){n.aggregateTransactionQueuesForNode_(e,t)})},fb.core.Repo.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=e.getValue();if(t){for(var o=0,r=0;r<t.length;r++)t[r].status!==fb.core.TransactionStatus.COMPLETED&&(t[o]=t[r],o++);t.length=o,e.setValue(0<t.length?t:null)}var n=this;e.forEachChild(function(e){n.pruneCompletedTransactionsBelowNode_(e)})},fb.core.Repo.prototype.abortTransactions_=function(e){var t=this.getAncestorTransactionNode_(e).path(),e=this.transactionQueueTree_.subTree(e),o=this;return e.forEachAncestor(function(e){o.abortTransactionsOnNode_(e)}),this.abortTransactionsOnNode_(e),e.forEachDescendant(function(e){o.abortTransactionsOnNode_(e)}),t},fb.core.Repo.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var o=[],r=[],n=-1,i=0;i<t.length;i++)t[i].status!==fb.core.TransactionStatus.SENT_NEEDS_ABORT&&(t[i].status===fb.core.TransactionStatus.SENT?(fb.core.util.assert(n===i-1,"All SENT items should be at beginning of queue."),t[n=i].status=fb.core.TransactionStatus.SENT_NEEDS_ABORT,t[i].abortReason="set"):(fb.core.util.assert(t[i].status===fb.core.TransactionStatus.RUN,"Unexpected transaction status in abort"),t[i].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[i].currentWriteId,!0)),t[i].onComplete&&o.push(goog.bind(t[i].onComplete,null,new Error("set"),!1,null))));for(-1===n?e.setValue(null):t.length=n+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),r),i=0;i<o.length;i++)fb.core.util.exceptionGuard(o[i])}},goog.provide("fb.core.RepoManager"),goog.require("fb.core.Repo"),goog.require("fb.core.Repo_transaction"),goog.require("fb.util.obj"),fb.core.RepoManager=goog.defineClass(null,{constructor:function(){this.repos_={},this.useRestClient_=!1},interrupt:function(){for(var e in this.repos_)this.repos_[e].interrupt()},resume:function(){for(var e in this.repos_)this.repos_[e].resume()},getRepo:function(e){var t=e.toString(),o=fb.util.obj.get(this.repos_,t);return o||(o=new fb.core.Repo(e,this.useRestClient_),this.repos_[t]=o),o},forceRestClient:function(){this.useRestClient_=!0}}),goog.addSingletonGetter(fb.core.RepoManager),goog.exportProperty(fb.core.RepoManager.prototype,"interrupt",fb.core.RepoManager.prototype.interrupt),goog.exportProperty(fb.core.RepoManager.prototype,"resume",fb.core.RepoManager.prototype.resume),goog.provide("fb.api.OnDisconnect"),goog.require("fb.constants"),goog.require("fb.core.Repo"),goog.require("fb.core.util.validation"),goog.require("fb.util.validation"),fb.api.OnDisconnect=function(e,t){this.repo_=e,this.path_=t},fb.api.OnDisconnect.prototype.cancel=function(e){fb.util.validation.validateArgCount("Firebase.onDisconnect().cancel",0,1,arguments.length),fb.util.validation.validateCallback("Firebase.onDisconnect().cancel",1,e,!0),this.repo_.onDisconnectCancel(this.path_,e||null)},goog.exportProperty(fb.api.OnDisconnect.prototype,"cancel",fb.api.OnDisconnect.prototype.cancel),fb.api.OnDisconnect.prototype.remove=function(e){fb.util.validation.validateArgCount("Firebase.onDisconnect().remove",0,1,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().remove",this.path_),fb.util.validation.validateCallback("Firebase.onDisconnect().remove",1,e,!0),this.repo_.onDisconnectSet(this.path_,null,e)},goog.exportProperty(fb.api.OnDisconnect.prototype,"remove",fb.api.OnDisconnect.prototype.remove),fb.api.OnDisconnect.prototype.set=function(e,t){fb.util.validation.validateArgCount("Firebase.onDisconnect().set",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().set",this.path_),fb.core.util.validation.validateFirebaseDataArg("Firebase.onDisconnect().set",1,e,this.path_,!1),fb.util.validation.validateCallback("Firebase.onDisconnect().set",2,t,!0),this.repo_.onDisconnectSet(this.path_,e,t)},goog.exportProperty(fb.api.OnDisconnect.prototype,"set",fb.api.OnDisconnect.prototype.set),fb.api.OnDisconnect.prototype.setWithPriority=function(e,t,o){fb.util.validation.validateArgCount("Firebase.onDisconnect().setWithPriority",2,3,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().setWithPriority",this.path_),fb.core.util.validation.validateFirebaseDataArg("Firebase.onDisconnect().setWithPriority",1,e,this.path_,!1),fb.core.util.validation.validatePriority("Firebase.onDisconnect().setWithPriority",2,t,!1),fb.util.validation.validateCallback("Firebase.onDisconnect().setWithPriority",3,o,!0),this.repo_.onDisconnectSetWithPriority(this.path_,e,t,o)},goog.exportProperty(fb.api.OnDisconnect.prototype,"setWithPriority",fb.api.OnDisconnect.prototype.setWithPriority),fb.api.OnDisconnect.prototype.update=function(e,t){if(fb.util.validation.validateArgCount("Firebase.onDisconnect().update",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().update",this.path_),goog.isArray(e)){for(var o={},r=0;r<e.length;++r)o[""+r]=e[r];e=o,fb.core.util.warn("Passing an Array to Firebase.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}fb.core.util.validation.validateFirebaseMergeDataArg("Firebase.onDisconnect().update",1,e,this.path_,!1),fb.util.validation.validateCallback("Firebase.onDisconnect().update",2,t,!0),this.repo_.onDisconnectUpdate(this.path_,e,t)},goog.exportProperty(fb.api.OnDisconnect.prototype,"update",fb.api.OnDisconnect.prototype.update),goog.provide("fb.api.Query"),goog.require("fb.api.DataSnapshot"),goog.require("fb.core.snap"),goog.require("fb.core.util"),goog.require("fb.core.util.validation"),goog.require("fb.core.view.EventRegistration"),goog.require("fb.core.view.QueryParams"),goog.require("fb.util.json"),goog.require("fb.util.validation"),fb.api.Query=goog.defineClass(null,{constructor:function(e,t,o,r){this.repo=e,this.path=t,this.queryParams_=o,this.orderByCalled_=r},validateQueryEndpoints_:function(e){var t=null,o=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(o=e.getIndexEndValue()),e.getIndex()===fb.core.snap.KeyIndex){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",n="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!=fb.core.util.MIN_NAME)throw new Error(r);if("string"!=typeof t)throw new Error(n)}if(e.hasEnd()){if(e.getIndexEndName()!=fb.core.util.MAX_NAME)throw new Error(r);if("string"!=typeof o)throw new Error(n)}}else if(e.getIndex()===fb.core.snap.PriorityIndex){if(null!=t&&!fb.core.util.validation.isValidPriority(t)||null!=o&&!fb.core.util.validation.isValidPriority(o))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(fb.core.util.assert(e.getIndex()instanceof fb.core.snap.PathIndex||e.getIndex()===fb.core.snap.ValueIndex,"unknown index type."),null!=t&&"object"==typeof t||null!=o&&"object"==typeof o)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},validateLimit_:function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},validateNoPreviousOrderByCall_:function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},getQueryParams:function(){return this.queryParams_},ref:function(){return fb.util.validation.validateArgCount("Query.ref",0,0,arguments.length),new Firebase(this.repo,this.path)},on:function(e,t,o,r){fb.util.validation.validateArgCount("Query.on",2,4,arguments.length),fb.core.util.validation.validateEventType("Query.on",1,e,!1),fb.util.validation.validateCallback("Query.on",2,t,!1);var n,i=this.getCancelAndContextArgs_("Query.on",o,r);return"value"===e?this.onValueEvent(t,i.cancel,i.context):((n={})[e]=t,this.onChildEvent(n,i.cancel,i.context)),t},onValueEvent:function(e,t,o){e=new fb.core.view.ValueEventRegistration(e,t||null,o||null);this.repo.addEventCallbackForQuery(this,e)},onChildEvent:function(e,t,o){e=new fb.core.view.ChildEventRegistration(e,t,o);this.repo.addEventCallbackForQuery(this,e)},off:function(e,t,o){fb.util.validation.validateArgCount("Query.off",0,3,arguments.length),fb.core.util.validation.validateEventType("Query.off",1,e,!0),fb.util.validation.validateCallback("Query.off",2,t,!0),fb.util.validation.validateContextObject("Query.off",3,o,!0);var r=null,n=null;"value"===e?r=new fb.core.view.ValueEventRegistration(t||null,null,o||null):e&&(t&&((n={})[e]=t),r=new fb.core.view.ChildEventRegistration(n,null,o||null)),this.repo.removeEventCallbackForQuery(this,r)},once:function(t,o){fb.util.validation.validateArgCount("Query.once",2,4,arguments.length),fb.core.util.validation.validateEventType("Query.once",1,t,!1),fb.util.validation.validateCallback("Query.once",2,o,!1);var r=this.getCancelAndContextArgs_("Query.once",arguments[2],arguments[3]),n=this,i=!0,a=function(e){i&&(i=!1,n.off(t,a),goog.bind(o,r.context)(e))};this.on(t,a,function(e){n.off(t,a),r.cancel&&goog.bind(r.cancel,r.context)(e)})},limit:function(e){if(fb.core.util.warn("Query.limit() being deprecated. Please use Query.limitToFirst() or Query.limitToLast() instead."),fb.util.validation.validateArgCount("Query.limit",1,1,arguments.length),!goog.isNumber(e)||Math.floor(e)!==e||e<=0)throw new Error("Query.limit: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limit: Limit was already set (by another call to limit, limitToFirst, orlimitToLast.");var t=this.queryParams_.limit(e);return this.validateLimit_(t),new fb.api.Query(this.repo,this.path,t,this.orderByCalled_)},limitToFirst:function(e){if(fb.util.validation.validateArgCount("Query.limitToFirst",1,1,arguments.length),!goog.isNumber(e)||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new fb.api.Query(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},limitToLast:function(e){if(fb.util.validation.validateArgCount("Query.limitToLast",1,1,arguments.length),!goog.isNumber(e)||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new fb.api.Query(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},orderByChild:function(e){if(fb.util.validation.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');fb.core.util.validation.validatePathString("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var t=new fb.core.util.Path(e);if(t.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");t=new fb.core.snap.PathIndex(t),t=this.queryParams_.orderBy(t);return this.validateQueryEndpoints_(t),new fb.api.Query(this.repo,this.path,t,!0)},orderByKey:function(){fb.util.validation.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(fb.core.snap.KeyIndex);return this.validateQueryEndpoints_(e),new fb.api.Query(this.repo,this.path,e,!0)},orderByPriority:function(){fb.util.validation.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(fb.core.snap.PriorityIndex);return this.validateQueryEndpoints_(e),new fb.api.Query(this.repo,this.path,e,!0)},orderByValue:function(){fb.util.validation.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(fb.core.snap.ValueIndex);return this.validateQueryEndpoints_(e),new fb.api.Query(this.repo,this.path,e,!0)},startAt:function(e,t){fb.util.validation.validateArgCount("Query.startAt",0,2,arguments.length),fb.core.util.validation.validateFirebaseDataArg("Query.startAt",1,e,this.path,!0),fb.core.util.validation.validateKey("Query.startAt",2,t,!0);var o=this.queryParams_.startAt(e,t);if(this.validateLimit_(o),this.validateQueryEndpoints_(o),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return goog.isDef(e)||(t=e=null),new fb.api.Query(this.repo,this.path,o,this.orderByCalled_)},endAt:function(e,t){fb.util.validation.validateArgCount("Query.endAt",0,2,arguments.length),fb.core.util.validation.validateFirebaseDataArg("Query.endAt",1,e,this.path,!0),fb.core.util.validation.validateKey("Query.endAt",2,t,!0);var o=this.queryParams_.endAt(e,t);if(this.validateLimit_(o),this.validateQueryEndpoints_(o),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new fb.api.Query(this.repo,this.path,o,this.orderByCalled_)},equalTo:function(e,t){if(fb.util.validation.validateArgCount("Query.equalTo",1,2,arguments.length),fb.core.util.validation.validateFirebaseDataArg("Query.equalTo",1,e,this.path,!1),fb.core.util.validation.validateKey("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to endAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},toString:function(){return fb.util.validation.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},queryObject:function(){return this.queryParams_.getQueryObject()},queryIdentifier:function(){var e=this.queryObject(),e=fb.core.util.ObjectToUniqueKey(e);return"{}"===e?"default":e},getCancelAndContextArgs_:function(e,t,o){var r={cancel:null,context:null};if(t&&o)r.cancel=t,fb.util.validation.validateCallback(e,3,r.cancel,!0),r.context=o,fb.util.validation.validateContextObject(e,4,r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(fb.util.validation.errorPrefix(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r}}),goog.exportProperty(fb.api.Query.prototype,"ref",fb.api.Query.prototype.ref),goog.exportProperty(fb.api.Query.prototype,"on",fb.api.Query.prototype.on),goog.exportProperty(fb.api.Query.prototype,"off",fb.api.Query.prototype.off),goog.exportProperty(fb.api.Query.prototype,"once",fb.api.Query.prototype.once),goog.exportProperty(fb.api.Query.prototype,"limit",fb.api.Query.prototype.limit),goog.exportProperty(fb.api.Query.prototype,"limitToFirst",fb.api.Query.prototype.limitToFirst),goog.exportProperty(fb.api.Query.prototype,"limitToLast",fb.api.Query.prototype.limitToLast),goog.exportProperty(fb.api.Query.prototype,"orderByChild",fb.api.Query.prototype.orderByChild),goog.exportProperty(fb.api.Query.prototype,"orderByKey",fb.api.Query.prototype.orderByKey),goog.exportProperty(fb.api.Query.prototype,"orderByPriority",fb.api.Query.prototype.orderByPriority),goog.exportProperty(fb.api.Query.prototype,"orderByValue",fb.api.Query.prototype.orderByValue),goog.exportProperty(fb.api.Query.prototype,"startAt",fb.api.Query.prototype.startAt),goog.exportProperty(fb.api.Query.prototype,"endAt",fb.api.Query.prototype.endAt),goog.exportProperty(fb.api.Query.prototype,"equalTo",fb.api.Query.prototype.equalTo),goog.exportProperty(fb.api.Query.prototype,"toString",fb.api.Query.prototype.toString),goog.provide("fb.api.TEST_ACCESS"),goog.require("fb.core.PersistentConnection"),fb.api.TEST_ACCESS.DataConnection=fb.core.PersistentConnection,goog.exportProperty(fb.api.TEST_ACCESS,"DataConnection",fb.api.TEST_ACCESS.DataConnection),fb.core.PersistentConnection.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},goog.exportProperty(fb.api.TEST_ACCESS.DataConnection.prototype,"simpleListen",fb.api.TEST_ACCESS.DataConnection.prototype.simpleListen),fb.core.PersistentConnection.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},goog.exportProperty(fb.api.TEST_ACCESS.DataConnection.prototype,"echo",fb.api.TEST_ACCESS.DataConnection.prototype.echo),goog.exportProperty(fb.core.PersistentConnection.prototype,"interrupt",fb.core.PersistentConnection.prototype.interrupt),fb.api.TEST_ACCESS.RealTimeConnection=fb.realtime.Connection,goog.exportProperty(fb.api.TEST_ACCESS,"RealTimeConnection",fb.api.TEST_ACCESS.RealTimeConnection),goog.exportProperty(fb.realtime.Connection.prototype,"sendRequest",fb.realtime.Connection.prototype.sendRequest),goog.exportProperty(fb.realtime.Connection.prototype,"close",fb.realtime.Connection.prototype.close),fb.api.TEST_ACCESS.hijackHash=function(n){var i=fb.core.PersistentConnection.prototype.put;return fb.core.PersistentConnection.prototype.put=function(e,t,o,r){goog.isDef(r)&&(r=n()),i.call(this,e,t,o,r)},function(){fb.core.PersistentConnection.prototype.put=i}},goog.exportProperty(fb.api.TEST_ACCESS,"hijackHash",fb.api.TEST_ACCESS.hijackHash),fb.api.TEST_ACCESS.ConnectionTarget=fb.core.RepoInfo,goog.exportProperty(fb.api.TEST_ACCESS,"ConnectionTarget",fb.api.TEST_ACCESS.ConnectionTarget),fb.api.TEST_ACCESS.queryIdentifier=function(e){return e.queryIdentifier()},goog.exportProperty(fb.api.TEST_ACCESS,"queryIdentifier",fb.api.TEST_ACCESS.queryIdentifier),fb.api.TEST_ACCESS.listens=function(e){return e.repo.persistentConnection_.listens_},goog.exportProperty(fb.api.TEST_ACCESS,"listens",fb.api.TEST_ACCESS.listens),fb.api.TEST_ACCESS.forceRestClient=function(e){e.forceRestClient()},goog.exportProperty(fb.api.TEST_ACCESS,"forceRestClient",fb.api.TEST_ACCESS.forceRestClient),goog.provide("Firebase"),goog.require("fb.api.INTERNAL"),goog.require("fb.api.OnDisconnect"),goog.require("fb.api.Query"),goog.require("fb.api.TEST_ACCESS"),goog.require("fb.constants"),goog.require("fb.core.Repo"),goog.require("fb.core.RepoManager"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.core.util.nextPushId"),goog.require("fb.core.util.validation"),goog.require("goog.string"),Firebase=goog.defineClass(fb.api.Query,{constructor:function(e,t){var o,r,n;if(e instanceof fb.core.Repo)o=e,r=t;else{fb.util.validation.validateArgCount("new Firebase",1,2,arguments.length);var i=fb.core.util.parseRepoInfo(e),a=i.repoInfo;if(fb.core.util.validation.validateUrl("new Firebase",1,i),t)if(t instanceof fb.core.RepoManager)n=t;else{if(!goog.isString(t))throw new Error("Expected a valid Firebase.Context for second argument to new Firebase()");n=fb.core.RepoManager.getInstance(),a.persistenceKey=t}else n=fb.core.RepoManager.getInstance();o=n.getRepo(a),r=i.path}fb.api.Query.call(this,o,r,fb.core.view.QueryParams.DEFAULT,!1)},statics:{goOffline:function(){fb.util.validation.validateArgCount("Firebase.goOffline",0,0,arguments.length),fb.core.RepoManager.getInstance().interrupt()},goOnline:function(){fb.util.validation.validateArgCount("Firebase.goOnline",0,0,arguments.length),fb.core.RepoManager.getInstance().resume()},enableLogging:function(e,t){fb.core.util.assert(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?("undefined"!=typeof console&&("function"==typeof console.log?fb.core.util.logger=goog.bind(console.log,console):"object"==typeof console.log&&(fb.core.util.logger=function(e){console.log(e)})),t&&fb.core.storage.SessionStorage.set("logging_enabled",!0)):e?fb.core.util.logger=e:(fb.core.util.logger=null,fb.core.storage.SessionStorage.remove("logging_enabled"))},ServerValue:{TIMESTAMP:{".sv":"timestamp"}},SDK_VERSION:CLIENT_VERSION,INTERNAL:fb.api.INTERNAL,Context:fb.core.RepoManager,TEST_ACCESS:fb.api.TEST_ACCESS},name:function(){return fb.core.util.warn("Firebase.name() being deprecated. Please use Firebase.key() instead."),fb.util.validation.validateArgCount("Firebase.name",0,0,arguments.length),this.key()},key:function(){return fb.util.validation.validateArgCount("Firebase.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},child:function(e){return fb.util.validation.validateArgCount("Firebase.child",1,1,arguments.length),goog.isNumber(e)?e=String(e):e instanceof fb.core.util.Path||(null===this.path.getFront()?fb.core.util.validation.validateRootPathString("Firebase.child",1,e,!1):fb.core.util.validation.validatePathString("Firebase.child",1,e,!1)),new Firebase(this.repo,this.path.child(e))},parent:function(){fb.util.validation.validateArgCount("Firebase.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new Firebase(this.repo,e)},root:function(){fb.util.validation.validateArgCount("Firebase.ref",0,0,arguments.length);for(var e=this;null!==e.parent();)e=e.parent();return e},set:function(e,t){fb.util.validation.validateArgCount("Firebase.set",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.set",this.path),fb.core.util.validation.validateFirebaseDataArg("Firebase.set",1,e,this.path,!1),fb.util.validation.validateCallback("Firebase.set",2,t,!0),this.repo.setWithPriority(this.path,e,null,t||null)},update:function(e,t){if(fb.util.validation.validateArgCount("Firebase.update",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.update",this.path),goog.isArray(e)){for(var o={},r=0;r<e.length;++r)o[""+r]=e[r];e=o,fb.core.util.warn("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}fb.core.util.validation.validateFirebaseMergeDataArg("Firebase.update",1,e,this.path,!1),fb.util.validation.validateCallback("Firebase.update",2,t,!0),this.repo.update(this.path,e,t||null)},setWithPriority:function(e,t,o){if(fb.util.validation.validateArgCount("Firebase.setWithPriority",2,3,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.setWithPriority",this.path),fb.core.util.validation.validateFirebaseDataArg("Firebase.setWithPriority",1,e,this.path,!1),fb.core.util.validation.validatePriority("Firebase.setWithPriority",2,t,!1),fb.util.validation.validateCallback("Firebase.setWithPriority",3,o,!0),".length"===this.key()||".keys"===this.key())throw"Firebase.setWithPriority failed: "+this.key()+" is a read-only object.";this.repo.setWithPriority(this.path,e,t,o||null)},remove:function(e){fb.util.validation.validateArgCount("Firebase.remove",0,1,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.remove",this.path),fb.util.validation.validateCallback("Firebase.remove",1,e,!0),this.set(null,e)},transaction:function(e,t,o){if(fb.util.validation.validateArgCount("Firebase.transaction",1,3,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.transaction",this.path),fb.util.validation.validateCallback("Firebase.transaction",1,e,!1),fb.util.validation.validateCallback("Firebase.transaction",2,t,!0),fb.core.util.validation.validateBoolean("Firebase.transaction",3,o,!0),".length"===this.key()||".keys"===this.key())throw"Firebase.transaction failed: "+this.key()+" is a read-only object.";this.repo.startTransaction(this.path,e,t||null,o=void 0===o?!0:o)},setPriority:function(e,t){fb.util.validation.validateArgCount("Firebase.setPriority",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.setPriority",this.path),fb.core.util.validation.validatePriority("Firebase.setPriority",1,e,!1),fb.util.validation.validateCallback("Firebase.setPriority",2,t,!0),this.repo.setWithPriority(this.path.child(".priority"),e,null,t)},push:function(e,t){fb.util.validation.validateArgCount("Firebase.push",0,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.push",this.path),fb.core.util.validation.validateFirebaseDataArg("Firebase.push",1,e,this.path,!0),fb.util.validation.validateCallback("Firebase.push",2,t,!0);var o=this.repo.serverTime(),o=fb.core.util.nextPushId(o),o=this.child(o);return null!=e&&o.set(e,t),o},onDisconnect:function(){return fb.core.util.validation.validateWritablePath("Firebase.onDisconnect",this.path),new fb.api.OnDisconnect(this.repo,this.path)},auth:function(e,t,o){fb.core.util.warn("FirebaseRef.auth() being deprecated. Please use FirebaseRef.authWithCustomToken() instead."),fb.util.validation.validateArgCount("Firebase.auth",1,3,arguments.length),fb.core.util.validation.validateCredential("Firebase.auth",1,e,!1),fb.util.validation.validateCallback("Firebase.auth",2,t,!0),fb.util.validation.validateCallback("Firebase.auth",3,t,!0);var r={};r[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]="none",this.repo.auth.authenticate(e,{},r,t,o)},unauth:function(e){fb.util.validation.validateArgCount("Firebase.unauth",0,1,arguments.length),fb.util.validation.validateCallback("Firebase.unauth",1,e,!0),this.repo.auth.unauthenticate(e)},getAuth:function(){return fb.util.validation.validateArgCount("Firebase.getAuth",0,0,arguments.length),this.repo.auth.getAuth()},onAuth:function(e,t){fb.util.validation.validateArgCount("Firebase.onAuth",1,2,arguments.length),fb.util.validation.validateCallback("Firebase.onAuth",1,e,!1),fb.util.validation.validateContextObject("Firebase.onAuth",2,t,!0),this.repo.auth.on("auth_status",e,t)},offAuth:function(e,t){fb.util.validation.validateArgCount("Firebase.offAuth",1,2,arguments.length),fb.util.validation.validateCallback("Firebase.offAuth",1,e,!1),fb.util.validation.validateContextObject("Firebase.offAuth",2,t,!0),this.repo.auth.off("auth_status",e,t)},authWithCustomToken:function(e,t,o){fb.util.validation.validateArgCount("Firebase.authWithCustomToken",2,3,arguments.length),fb.core.util.validation.validateCredential("Firebase.authWithCustomToken",1,e,!1),fb.util.validation.validateCallback("Firebase.authWithCustomToken",2,t,!1),fb.core.util.validation.validateObject("Firebase.authWithCustomToken",3,o,!0),this.repo.auth.authenticate(e,{},o||{},t)},authWithOAuthPopup:function(e,t,o){fb.util.validation.validateArgCount("Firebase.authWithOAuthPopup",2,3,arguments.length),fb.core.util.validation.validateAuthProvider("Firebase.authWithOAuthPopup",1,e,!1),fb.util.validation.validateCallback("Firebase.authWithOAuthPopup",2,t,!1),fb.core.util.validation.validateObject("Firebase.authWithOAuthPopup",3,o,!0),this.repo.auth.authWithPopup(e,o,t)},authWithOAuthRedirect:function(e,t,o){fb.util.validation.validateArgCount("Firebase.authWithOAuthRedirect",2,3,arguments.length),fb.core.util.validation.validateAuthProvider("Firebase.authWithOAuthRedirect",1,e,!1),fb.util.validation.validateCallback("Firebase.authWithOAuthRedirect",2,t,!1),fb.core.util.validation.validateObject("Firebase.authWithOAuthRedirect",3,o,!0),this.repo.auth.authWithRedirect(e,o,t)},authWithOAuthToken:function(e,t,o,r){fb.util.validation.validateArgCount("Firebase.authWithOAuthToken",3,4,arguments.length),fb.core.util.validation.validateAuthProvider("Firebase.authWithOAuthToken",1,e,!1),fb.util.validation.validateCallback("Firebase.authWithOAuthToken",3,o,!1),fb.core.util.validation.validateObject("Firebase.authWithOAuthToken",4,r,!0),goog.isString(t)?(fb.core.util.validation.validateString("Firebase.authWithOAuthToken",2,t,!1),this.repo.auth.authWithCredential(e+"/token",{access_token:t},r,o)):(fb.core.util.validation.validateObject("Firebase.authWithOAuthToken",2,t,!1),this.repo.auth.authWithCredential(e+"/token",t,r,o))},authAnonymously:function(e,t){fb.util.validation.validateArgCount("Firebase.authAnonymously",1,2,arguments.length),fb.util.validation.validateCallback("Firebase.authAnonymously",1,e,!1),fb.core.util.validation.validateObject("Firebase.authAnonymously",2,t,!0),this.repo.auth.authWithCredential("anonymous",{},t,e)},authWithPassword:function(e,t,o){fb.util.validation.validateArgCount("Firebase.authWithPassword",2,3,arguments.length),fb.core.util.validation.validateObject("Firebase.authWithPassword",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.authWithPassword",1,e,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.authWithPassword",1,e,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.authWithPassword",2,t,!1),fb.core.util.validation.validateObject("Firebase.authWithPassword",3,o,!0),this.repo.auth.authWithCredential("password",e,o,t)},createUser:function(e,t){fb.util.validation.validateArgCount("Firebase.createUser",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.createUser",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.createUser",1,e,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.createUser",1,e,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.createUser",2,t,!1),this.repo.auth.createUser(e,t)},removeUser:function(e,t){fb.util.validation.validateArgCount("Firebase.removeUser",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.removeUser",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.removeUser",1,e,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.removeUser",1,e,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.removeUser",2,t,!1),this.repo.auth.removeUser(e,t)},changePassword:function(e,t){fb.util.validation.validateArgCount("Firebase.changePassword",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.changePassword",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.changePassword",1,e,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changePassword",1,e,"oldPassword",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changePassword",1,e,"newPassword",!1,"string"),fb.util.validation.validateCallback("Firebase.changePassword",2,t,!1),this.repo.auth.changePassword(e,t)},changeEmail:function(e,t){fb.util.validation.validateArgCount("Firebase.changeEmail",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.changeEmail",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.changeEmail",1,e,"oldEmail",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changeEmail",1,e,"newEmail",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changeEmail",1,e,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.changeEmail",2,t,!1),this.repo.auth.changeEmail(e,t)},resetPassword:function(e,t){fb.util.validation.validateArgCount("Firebase.resetPassword",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.resetPassword",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.resetPassword",1,e,"email",!1,"string"),fb.util.validation.validateCallback("Firebase.resetPassword",2,t,!1),this.repo.auth.resetPassword(e,t)}}),NODE_CLIENT&&(module.exports=Firebase)},ns.wrapper(ns.goog,ns.fb)}({goog:{},fb:{}});