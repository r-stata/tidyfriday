define(["./core","./deferred","./callbacks"],function(a){return a.extend({queue:function(e,u,t){var n;if(e)return n=a._data(e,u=(u||"fx")+"queue"),t&&(!n||a.isArray(t)?n=a._data(e,u,a.makeArray(t)):n.push(t)),n||[]},dequeue:function(e,u){u=u||"fx";var t=a.queue(e,u),n=t.length,r=t.shift(),i=a._queueHooks(e,u);"inprogress"===r&&(r=t.shift(),n--),r&&("fx"===u&&t.unshift("inprogress"),delete i.stop,r.call(e,function(){a.dequeue(e,u)},i)),!n&&i&&i.empty.fire()},_queueHooks:function(e,u){var t=u+"queueHooks";return a._data(e,t)||a._data(e,t,{empty:a.Callbacks("once memory").add(function(){a._removeData(e,u+"queue"),a._removeData(e,t)})})}}),a.fn.extend({queue:function(u,t){var e=2;return"string"!=typeof u&&(t=u,u="fx",e--),arguments.length<e?a.queue(this[0],u):void 0===t?this:this.each(function(){var e=a.queue(this,u,t);a._queueHooks(this,u),"fx"===u&&"inprogress"!==e[0]&&a.dequeue(this,u)})},dequeue:function(e){return this.each(function(){a.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,u){function t(){--r||i.resolveWith(o,[o])}var n,r=1,i=a.Deferred(),o=this,s=this.length;for("string"!=typeof e&&(u=e,e=void 0),e=e||"fx";s--;)(n=a._data(o[s],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(t));return t(),i.promise(u)}}),a});