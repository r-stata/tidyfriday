define(["../core","../var/support","../ajax"],function(u,e){u.ajaxSettings.xhr=void 0!==window.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&o()||function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:o;var n=0,p={},t=u.ajaxSettings.xhr();function o(){try{return new window.XMLHttpRequest}catch(e){}}window.attachEvent&&window.attachEvent("onunload",function(){for(var e in p)p[e](void 0,!0)}),e.cors=!!t&&"withCredentials"in t,(e.ajax=!!t)&&u.ajaxTransport(function(c){var d;if(!c.crossDomain||e.cors)return{send:function(e,i){var t,r=c.xhr(),s=++n;if(r.open(c.type,c.url,c.async,c.username,c.password),c.xhrFields)for(t in c.xhrFields)r[t]=c.xhrFields[t];for(t in c.mimeType&&r.overrideMimeType&&r.overrideMimeType(c.mimeType),c.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)void 0!==e[t]&&r.setRequestHeader(t,e[t]+"");r.send(c.hasContent&&c.data||null),d=function(e,t){var n,o,a;if(d&&(t||4===r.readyState))if(delete p[s],d=void 0,r.onreadystatechange=u.noop,t)4!==r.readyState&&r.abort();else{a={},n=r.status,"string"==typeof r.responseText&&(a.text=r.responseText);try{o=r.statusText}catch(e){o=""}n||!c.isLocal||c.crossDomain?1223===n&&(n=204):n=a.text?200:404}a&&i(n,o,a,r.getAllResponseHeaders())},c.async?4===r.readyState?setTimeout(d):r.onreadystatechange=p[s]=d:d()},abort:function(){d&&d(void 0,!0)}}})});