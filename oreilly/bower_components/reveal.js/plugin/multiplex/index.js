var http=require("http"),express=require("express"),fs=require("fs"),io=require("socket.io"),crypto=require("crypto"),app=express(),staticDir=express.static,server=http.createServer(app),io=io(server),opts={port:process.env.PORT||1948,baseDir:__dirname+"/../../"},createHash=(io.on("connection",function(t){t.on("multiplex-statechanged",function(e){void 0!==e.secret&&null!=e.secret&&""!==e.secret&&createHash(e.secret)===e.socketId&&(e.secret=null,t.broadcast.emit(e.socketId,e))})}),["css","js","plugin","lib"].forEach(function(e){app.use("/"+e,staticDir(opts.baseDir+e))}),app.get("/",function(e,t){t.writeHead(200,{"Content-Type":"text/html"}),fs.createReadStream(opts.baseDir+"/index.html").pipe(t)}),app.get("/token",function(e,t){var r=(new Date).getTime(),s=Math.floor(9999999*Math.random()),r=r.toString()+s.toString();t.send({secret:r,socketId:createHash(r)})}),function(e){return crypto.createCipher("blowfish",e).final("hex")}),brown=(server.listen(opts.port||null),"[33m"),green="[32m",reset="[0m";console.log(brown+"reveal.js:"+reset+" Multiplex running on port "+green+opts.port+reset);