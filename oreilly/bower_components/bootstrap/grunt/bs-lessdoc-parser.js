"use strict";var Markdown=require("markdown-it");function markdown2html(t){return(new Markdown).render(t.trim()).slice(3,-5)}var CUSTOMIZABLE_HEADING=/^[/]{2}={2}(.*)$/,UNCUSTOMIZABLE_HEADING=/^[/]{2}-{2}(.*)$/,SUBSECTION_HEADING=/^[/]{2}={3}(.*)$/,SECTION_DOCSTRING=/^[/]{2}#{2}(.+)$/,VAR_ASSIGNMENT=/^(@[a-zA-Z0-9_-]+):[ ]*([^ ;][^;]*);[ ]*$/,VAR_DOCSTRING=/^[/]{2}[*]{2}(.+)$/;function Section(t,e){this.heading=t.trim(),this.id=this.heading.replace(/\s+/g,"-").toLowerCase(),this.customizable=e,this.docstring=null,this.subsections=[]}function SubSection(t){this.heading=t.trim(),this.id=this.heading.replace(/\s+/g,"-").toLowerCase(),this.variables=[]}function VarDocstring(t){this.html=markdown2html(t)}function SectionDocstring(t){this.html=markdown2html(t)}function Variable(t,e){this.name=t,this.defaultValue=e,this.docstring=null}function Tokenizer(t){this._lines=t.split("\n"),this._next=void 0}function Parser(t){this._tokenizer=new Tokenizer(t)}Section.prototype.addSubSection=function(t){this.subsections.push(t)},SubSection.prototype.addVar=function(t){this.variables.push(t)},Tokenizer.prototype.unshift=function(t){if(void 0!==this._next)throw new Error("Attempted to unshift twice!");this._next=t},Tokenizer.prototype._shift=function(){var t,e,i;return void 0!==this._next?(i=this._next,this._next=void 0,i):this._lines.length<=0?null:(i=this._lines.shift(),(t=null)!==(t=SUBSECTION_HEADING.exec(i))?new SubSection(t[1]):null!==(t=CUSTOMIZABLE_HEADING.exec(i))?new Section(t[1],!0):null!==(t=UNCUSTOMIZABLE_HEADING.exec(i))?new Section(t[1],!1):null!==(t=SECTION_DOCSTRING.exec(i))?new SectionDocstring(t[1]):null!==(t=VAR_DOCSTRING.exec(i))?new VarDocstring(t[1]):(i=-1===(e=i.lastIndexOf("//"))?i:i.slice(0,e),null!==(t=VAR_ASSIGNMENT.exec(i))?new Variable(t[1],t[2]):void 0))},Tokenizer.prototype.shift=function(){for(;;){var t=this._shift();if(void 0!==t)return t}},Parser.prototype.parseFile=function(){for(var t=[];;){var e=this.parseSection();if(null===e){if(null!==this._tokenizer.shift())throw new Error("Unexpected unparsed section of file remains!");return t}t.push(e)}},Parser.prototype.parseSection=function(){var t,e=this._tokenizer.shift();if(null===e)return null;if(e instanceof Section)return(t=this._tokenizer.shift())instanceof SectionDocstring?e.docstring=t:this._tokenizer.unshift(t),this.parseSubSections(e),e;throw new Error("Expected section heading; got: "+JSON.stringify(e))},Parser.prototype.parseSubSections=function(t){for(;;){var e=this.parseSubSection();if(null===e){if(0!==t.subsections.length)break;e=new SubSection(""),this.parseVars(e)}t.addSubSection(e)}1!==t.subsections.length||t.subsections[0].heading||0!==t.subsections[0].variables.length||(t.subsections=[])},Parser.prototype.parseSubSection=function(){var t=this._tokenizer.shift();return t instanceof SubSection?(this.parseVars(t),t):(this._tokenizer.unshift(t),null)},Parser.prototype.parseVars=function(t){for(;;){var e=this.parseVar();if(null===e)return;t.addVar(e)}},Parser.prototype.parseVar=function(){var t=this._tokenizer.shift(),e=(t instanceof VarDocstring||(this._tokenizer.unshift(t),t=null),this._tokenizer.shift());return e instanceof Variable?(e.docstring=t,e):(this._tokenizer.unshift(e),null)},module.exports=Parser;