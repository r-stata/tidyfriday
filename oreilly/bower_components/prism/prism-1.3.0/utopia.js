function $(e,t){return"string"==typeof e?(t||document).querySelector(e):e}function $$(e,t){var r=(t||document).querySelectorAll(e);try{return Array.prototype.slice.call(r)}catch(e){for(var n=Array(r.length),o=r.length;0<o--;)n[o]=r[o];return n}}Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var r=0,n=this.length;r<n;++r)e.call(t||this,this[r],r,this)}),$$("[id]").forEach(function(e){window[e.id]=e}),String.prototype.splice=function(e,t,r){return t=+t||0,r=r||"",this.slice(0,e)+r+this.slice(e+t)},function(){var c=window.Utopia={type:function(e){var t;return null===e?"null":void 0===e?"undefined":"number"==(t=(t=Object.prototype.toString.call(e).match(/^\[object\s+(.*?)\]$/)[1])?t.toLowerCase():"")&&isNaN(e)?"NaN":t},each:function(e,t,r){if("function"==!c.type(t))throw Error("The second argument in Utopia.each() must be a function");for(var n in r=r||e,e)if(e.hasOwnProperty&&e.hasOwnProperty(n)){n=t.call(r,e[n],n);if(n||0===n||""===n)return n}return null},merge:function(e){for(var t={},r=0;r<arguments.length;r++){var n,o=arguments[r];for(n in o)t[n]=o[n]}return t},attach:function(e,t){for(var r=0;r<arguments.length;r++){var n,o=arguments[r];for(n in o)n in e||(e[n]=o[n])}return e},element:{create:function(){"string"===c.type(arguments[0])?"object"===c.type(arguments[1])?(e=arguments[1]).tag=arguments[0]:(e={tag:arguments[0]},"array"===c.type(arguments[1])?e.contents=arguments[1]:"string"!==c.type(arguments[1])&&"number"!==c.type(arguments[1])||(e.contents=[""+arguments[1]])):e=arguments[0];var e,t,r=e.namespace||"",r=r?document.createElementNS(r,e.tag):document.createElement(e.tag);return(e.className||e.id)&&(e.properties=e.properties||{},e.properties.className=e.className,e.properties.id=e.id),c.element.set(r,e),e.before&&(t=$(e.before))&&t.parentNode&&t.parentNode.insertBefore(r,t),e.after&&null===r.parentNode&&(t=$(e.after))&&t.parentNode&&t.parentNode.insertBefore(r,t.nextSibling),e.inside&&null===r.parentNode&&$(e.inside).appendChild(r),r},set:function(e,t){return c.element.prop(e,t.properties||t.prop),c.element.attr(e,t.attributes||t.attr),c.element.contents(e,t.contents),e},prop:function(e,t){if(t)for(var r in t)e[r]=t[r];return e},attr:function(e,t){if(t)for(attr in t)e.setAttribute(attr,t[attr]);return e},contents:function(e,t,r){if(t||0===t){"array"!==c.type(t)&&(t=[t]);for(var n=e.firstChild,o=0;o<t.length;o++){var a,i=t[o];switch(c.type(i)){case"string":if(""===i)continue;case"number":a=document.createTextNode(i);break;case"object":a=c.element.create(i);break;default:a=i}a&&(r&&"end"!==r?"start"===r&&e.insertBefore(a,n):e.appendChild(a))}}return e}},elements:{},event:{bind:function(e,t,r,n){if("string"===c.type(e)||"array"===c.type(e))("string"===c.type(e)?$$(e):e).forEach(function(e){c.event.bind(e,t,r,n)});else if("string"===c.type(t))n?e["on"+t]=r:e.addEventListener(t,r,!1);else if("array"===c.type(t))for(var o=0;o<t.length;o++)c.event.bind(e,t[o],r,r);else for(var a in t)c.event.bind(e,a,t[a],r)},fire:function(e,t,r){var n;"string"===c.type(e)||"array"===c.type(e)?("string"===c.type(e)?$$(e):e).forEach(function(e){c.event.fire(e,t,r)}):document.createEvent&&((n=document.createEvent("HTMLEvents")).initEvent(t,!0,!0),n.custom=!0,r&&c.attach(n,r),e.dispatchEvent(n))}},xhr:function(e){document.body.setAttribute("data-loading","");var t,r=new XMLHttpRequest,n=e.method||"GET",o=e.data||"";for(t in r.open(n,e.url+("GET"===n&&o?"?"+o:""),!0),e.headers=e.headers||{},"GET"===n||e.headers["Content-type"]||e.headers["Content-Type"]||r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.headers)r.setRequestHeader(t,e.headers[t]);return r.onreadystatechange=function(){4===r.readyState&&(document.body.removeAttribute("data-loading"),e.callback(r))},r.send("GET"===n?null:o),r},script:function(e,t,r){return r=r||document,c.element.create({tag:"script",properties:{src:e,async:!0,onload:t},inside:r.documentElement})},offset:function(e){var t=0,r=0,n=e;if(n.parentNode){for(;t+=n.offsetLeft,r+=n.offsetTop,(n=n.offsetParent)&&n.nodeType<9;);for(n=e;t-=n.scrollLeft,r-=n.scrollTop,(n=n.parentNode)&&!/body/i.test(n.nodeName););}return{top:r,right:innerWidth-t-e.offsetWidth,bottom:innerHeight-r-e.offsetHeight,left:t}}};["set","prop","attr","contents"].forEach(function(r){c.elements[r]=function(e){e="string"===c.type(e)?$$(e):Array.prototype.slice.call(e);var t=Array.prototype.slice.call(arguments);return t.shift(),e=e.map(function(e){return c.element[r](e,t)})}})}(),window.$u=window.$u||Utopia;