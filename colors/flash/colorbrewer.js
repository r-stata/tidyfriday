var visibleMap,schemeNames={sequential:["BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","YlGnBu","YlOrBr","YlOrRd"],singlehue:["Blues","Greens","Greys","Oranges","Purples","Reds"],diverging:["BrBG","PiYG","PRGn","PuOr","RdBu","RdGy","RdYlBu","RdYlGn","Spectral"],qualitative:["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"]},selectedScheme="BuGn",numClasses=3;function setNumClasses(e){$("#county-map g").removeClass("q"+numClasses).addClass("q"+e),numClasses=e,drawColorChips(),applyColors()}function setSchemeType(e){for(var s in $("#ramps").empty(),schemeNames[e]){for(var t=$("<div class='ramp "+schemeNames[e][s]+"'></div>"),c="<svg width='15' height='75'>",r=0;r<5;r++)c+="<rect fill="+colorbrewer[schemeNames[e][s]][5][r]+" width='15' height='15' y='"+15*r+"'/>";c+="</svg>",$("#ramps").append(t.append(c).click(function(){setScheme($(this).attr("class").substr(5))}))}if("sequential"==e){for(s in $("#ramps").css("width","160px").append("<p>multihue</p>"),$("#singlehue").empty().css("display","inline-block"),schemeNames.singlehue){for(t=$("<div class='ramp "+schemeNames.singlehue[s]+"'></div>"),c="<svg width='15' height='75'>",r=0;r<5;r++)c+="<rect fill="+colorbrewer[schemeNames.singlehue[s]][5][r]+" width='15' height='15' y='"+15*r+"'/>";c+="</svg>",$("#singlehue").append(t.append(c).click(function(){setScheme($(this).attr("class").substr(5))}))}$("#singlehue").append("<p>single hue</p>")}else $("#ramps").css("width","100%"),$("#singlehue").hide();setScheme(schemeNames[e][0])}function setScheme(e){$("#county-map g").removeClass(selectedScheme).addClass(e),$(".ramp.selected").removeClass("selected"),selectedScheme=e,$(".ramp."+selectedScheme).addClass("selected"),$("#scheme-name").html(selectedScheme),applyColors(),drawColorChips()}function applyColors(){colorbrewer[selectedScheme][numClasses];for(var e=0;e<numClasses;e++)$("#borderscheck").is(":checked")||$("#county-map g .q"+e+"-"+numClasses).css("stroke",colorbrewer[selectedScheme][numClasses][e]),$(".q"+e+"-"+numClasses).css("fill",colorbrewer[selectedScheme][numClasses][e])}function drawColorChips(){for(var e="<svg width='25' height='200' class='"+selectedScheme+" q"+numClasses+"'>",s=0;s<numClasses;s++)e+="<rect fill="+colorbrewer[selectedScheme][numClasses][s]+" width='25' height='"+Math.min(25,parseInt(200/numClasses))+"' y='"+s*Math.min(25,parseInt(200/numClasses))+"'/>";$("#color-chips").empty().append(e),updateValues()}function updateValues(){$("#color-values").empty();var e="";$("#color-chips rect").each(function(){e+=getColorDisplay($(this).css("fill"))+"<br/>"}),$("#color-values").append("<p style='line-height:"+Math.min(25,parseInt(200/numClasses))+"px'>"+e+"</p>")}function getColorDisplay(e,s){var t;return 0!=e.indexOf("#")&&(t={r:(t=e.replace(/[a-z()\s]/g,"").split(","))[0],g:t[1],b:t[2]}),"hex"==(s=s||($("#hex").is(":checked")?"hex":$("#rgb").is(":checked")?"rgb":"cmyk"))?t?rgbToHex(t.r,t.g,t.b):e:"rgb"==s?(t=t||hexToRgb(e)).r+","+t.g+","+t.b:"cmyk"==s?(s=rgb2cmyk((t=t||hexToRgb(e)).r,t.g,t.b))[0]+","+s[1]+","+s[2]+","+s[3]:void 0}function layerChange(){switch($(this).attr("id")){case"roadscheck":$(this).is(":checked")?$("#overlays").children().length?$("#roads").show():loadOverlays("roads"):$("#roads").hide();break;case"citiescheck":$(this).is(":checked")?$("#overlays").children().length?$("#cities").show():loadOverlays("cities"):$("#cities").hide();break;case"borderscheck":if($(this).is(":checked"))$("#county-map g").children().css("stroke","inherit");else for(var e=numClasses;e--;)$("#county-map g .q"+e+"-"+numClasses).css("stroke",colorbrewer[selectedScheme][numClasses][e])}}function loadOverlays(e){$("#overlays").svg({loadURL:"overlays.svg",onLoad:function(){$("#overlays svg").attr("width","100%").attr("height","100%"),("cities"==e?$("#roads"):$("#cities")).hide(),$("#cities").css("fill",$("#city-color").spectrum("get").toHexString()),$("#road-lines").css("stroke",$("#road-color").spectrum("get").toHexString())}})}function rgb2cmyk(e,s,t){var c=0,r=0,a=0,n=0;return 0==e&&0==s&&0==t?(n=1,[0,0,0,100]):(c=1-e/255,a=1-t/255,r=((r=1-s/255)-(e=Math.min(c,Math.min(r,a))))/(1-e),a=(a-e)/(1-e),n=e,[Math.round(100*(c=(c-e)/(1-e))),Math.round(100*r),Math.round(100*a),Math.round(100*n)])}function rgbToHex(e,s,t){return"#"+(1<<24|e<<16|s<<8|t).toString(16).slice(1)}function hexToRgb(e){e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}$("#num-classes").change(function(){setNumClasses($(this).val())}),$("#scheme-type").change(function(){setSchemeType($(this).val())}),$("#system input").change(updateValues),$("#layers input").change(layerChange),$("#transparency-slider").mousedown(function(){var s=$("#transparency-track").width(),t=$(this);function c(e){e=Math.max(23,23+Math.min(e.pageX-$("#transparency-track").offset().left,s));t.css("left",e),$("#county-map g").css("opacity",1-(e-24)/s)}$(document).on("mousemove",c),$(document).on("mouseup",function e(){$(document).off("mousemove",c),$(document).off("mouseup",e)})}),$("#road-color").spectrum({color:"#f33",showInput:!0,change:function(e){$("#overlays").children().length&&$("#road-lines").css("stroke",e.toHexString())}}),$("#city-color").spectrum({color:"#000",showInput:!0,change:function(e){$("#overlays").children().length&&$("#cities").css("fill",e.toHexString())}}),$("#border-color").spectrum({color:"#000",showInput:!0,change:function(e){$("#county-map g").css("stroke",e.toHexString())}}),$("#bg-color").spectrum({color:"#fff",showInput:!0,change:function(e){$("#county-map rect").css("fill",e.toHexString())}}),$("#terrain, #solid-color").change(function(){$("#terrain").is(":checked")?($("#terrain-img").length||$("#map-container").prepend($("<img id='terrain-img'/>").attr("src","terrain.jpg").css("left",-31).css("top",-58)),$("#county-map rect").css("opacity",0),$("#transparency-slider").position().left<24&&($("#transparency-slider").css("left",$("#transparency-track").position().left+45),$("#county-map g").css("opacity",.5))):($("#county-map rect").css("opacity",1),$("#transparency-slider").position().left==$("#transparency-track").position().left+45&&($("#transparency-slider").css("left",23),$("#county-map g").css("opacity",1)))}),$("#counties").svg({loadURL:"map.svg",onLoad:function(){$("#counties svg").attr("id","county-map").attr("width","100%").attr("height","100%"),setSchemeType("sequential"),setNumClasses(numClasses),$("#counties path").mouseover(function(){var e=$(this).css("fill"),s=$(this).attr("class").match(new RegExp("q[0-9]+-"+numClasses))[0],s=parseInt(s.substring(s.indexOf("q")+1,s.indexOf("-")))+1;$("#probe").empty().append("<p>Class "+s+"<br/>RGB: "+getColorDisplay(e,"rgb")+"<br/>CMYK: "+getColorDisplay(e,"cmyk")+"<br/>HEX: "+getColorDisplay(e,"hex")+"</p>"),$("#probe").show()}),$("#counties path").mousemove(function(e){$("#probe").css({left:e.pageX+10,top:e.pageY-70})}),$("#counties path").mouseout(function(){$("#probe").hide()})}});