var visibleMap,selectedSchemeType,highlight,schemeNames={sequential:["BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","YlGnBu","YlOrBr","YlOrRd"],singlehue:["Blues","Greens","Greys","Oranges","Purples","Reds"],diverging:["BrBG","PiYG","PRGn","PuOr","RdBu","RdGy","RdYlBu","RdYlGn","Spectral"],qualitative:["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"],tidyquant:["Dark","Green","Light"],awtools:["ppalette","bpalette","mpalette","spalette","a_palette","names"],ggsci1:["nrc_npg","default_aaas","default_nejm","lanonc_lancet","default_jama","default_jco","default_ucscgb","category10_d3","category20_d3","category20b_d3","category20c_d3","default_igv","default_locuszoom","default_uchicago","light_uchicago","dark_uchicago","hallmarks_dark_cosmic","hallmarks_light_cosmic","signature_substitutions_cosmic","springfield_simpsons"],ggsci2:["planetexpress_futurama","schwifty_rickandmorty","uniform_startrek","legacy_tron","default_gsea","red_material","pink_material","deep_purple_material","indigo_material","blue_material","light_blue_material","teal_material","green_material","light_green_material","lime_material","amber_material","orange_material","deep_orange_material","brown_material","blue_grey_material"],scico1:["acton","bam","bamako","bamO","batlow","batlowK","batlowW","berlin","bilbao","broc","brocO","buda","bukavu","cork","corkO","davos","devon","fes","grayC","hawaii"],scico2:["imola","lajolla","lapaz","lisbon","nuuk","oleron","oslo","roma","romaO","tofino","tokyo","turku","vanimo","vik","vikO"],rcartocolor1:["ag_Sunset","ag_GrnYl","Tropic","Temps","TealRose","Geyser","Fall","Earth","ArmyRose","Vivid","Safe","Prism","Pastel","Bold","Antique","TealGrn","Teal","SunsetDark","Sunset","RedOr"],rcartocolor2:["PurpOr","Purp","PinkYl","Peach","OrYel","Mint","Magenta","Emrld","DarkMint","BurgYl","Burg","BrwnYl","BluYl","BluGrn"],yarrr:["basel","pony","xmen","decision","southpark","eternal","evildead","usualsuspects","ohbrother","appletv","brave","bugs","cars","nemo","rat","up","espresso","ipod","info","info2"],wesanderson:["BottleRocket1","BottleRocket2","Rushmore1","Rushmore","Royal2","Zissou1","Darjeeling1","Darjeeling2","FantasticFox1","Moonrise3","Cavalcanti1","IsleofDogs1","IsleofDogs2"],beyonce1:["X1","X2","X3","X5","X6","X11","X12","X18","X23","X28","X33","X35","X37","X38","X39","X40","X41","X43","X44","X46"],beyonce2:["X47","X48","X49","X50","X51","X52","X54","X55","X56","X58","X59","X70","X72","X74","X75","X79","X80","X90","X92","X93"],beyonce3:["X101","X102","X103","X104","X105","X108","X109","X111","X115","X117","X118","X121","X122","X123","X125","X126","X127","X128","X129","X130"]},selectedScheme="Set2",numClasses=5;function setNumClasses(e){numClasses=e,showSchemes()}function setSchemeType(e){switch(selectedSchemeType=e,$("#num-classes option").removeAttr("disabled"),selectedSchemeType){case"sequential":10<=$("#num-classes").val()&&($("#num-classes").val(9),numClasses=9),$("#num-classes option[name=10], #num-classes option[name=11], #num-classes option[name=12], #num-classes option[name=16], #num-classes option[name=31], #num-classes option[name=34], #num-classes option[name=51]").attr("disabled","disabled");break;case"diverging":12<=$("#num-classes").val()&&($("#num-classes").val(11),numClasses=11),$("#num-classes option[name=12], #num-classes option[name=16], #num-classes option[name=31], #num-classes option[name=34], #num-classes option[name=51]").attr("disabled","disabled").attr("disabled","disabled");break;case"qualitative":13<=$("#num-classes").val()&&($("#num-classes").val(12),numClasses=12),$(" #num-classes option[name=16], #num-classes option[name=31], #num-classes option[name=34], #num-classes option[name=51]").attr("disabled","disabled").attr("disabled","disabled");break;case"tidyquant":13<=$("#num-classes").val()&&($("#num-classes").val(12),numClasses=12),$("#num-classes option[name=16], #num-classes option[name=31], #num-classes option[name=34], #num-classes option[name=51]").attr("disabled","disabled").attr("disabled","disabled");break;case"awtools":17<=$("#num-classes").val()&&($("#num-classes").val(16),numClasses=16),$("#num-classes option[name=31], #num-classes option[name=34], #num-classes option[name=51]").attr("disabled","disabled").attr("disabled","disabled")}showSchemes()}function showSchemes(){for(var e in $("#ramps").empty(),schemeNames[selectedSchemeType])if(0!=checkFilters(schemeNames[selectedSchemeType][e])){for(var s=$("<div class='ramp "+schemeNames[selectedSchemeType][e]+"'></div>"),t="<svg width='15' height='75'>",a=0;a<5;a++)t+="<rect fill="+colorbrewer[schemeNames[selectedSchemeType][e]][5][a]+" width='15' height='15' y='"+15*a+"'/>";t+="</svg>",$("#ramps").append(s.append(t).click(function(){$(this).hasClass("selected")||setScheme($(this).attr("class").substr(5))}))}if("sequential"==selectedSchemeType){for(e in $("#scheme1").css("width","160px"),$("#multi").show().text("Multi-hue:"),$("#scheme2").css("width","90px"),$("#single").show().text("Single hue:"),$("#singlehue").empty().css("display","inline-block"),schemeNames.singlehue)if(0!=checkFilters(schemeNames.singlehue[e])){for(s=$("<div class='ramp "+schemeNames.singlehue[e]+"'></div>"),t="<svg width='15' height='75'>",a=0;a<5;a++)t+="<rect fill="+colorbrewer[schemeNames.singlehue[e]][5][a]+" width='15' height='15' y='"+15*a+"'/>";t+="</svg>",$("#singlehue").append(s.append(t).click(function(){$(this).hasClass("selected")||setScheme($(this).attr("class").substr(5))}))}}else $("#scheme1").css("width","100%"),$("#multi").hide(),$("#singlehue").empty(),$("#single").hide();$(".score-icon").show(),$("#color-system").show(),$(".ramp."+selectedScheme)[0]?setScheme(selectedScheme):$("#ramps").children().length?setScheme($("#ramps .ramp:first-child").attr("class").substr(5)):clearSchemes()}function clearSchemes(){$("#counties g path").css("fill","#ccc"),$("#color-chips").empty(),$("#color-values").empty(),$("#ramps").css("width","100%"),$("#scheme-name").html(""),$(".score-icon").hide(),$("#color-system").hide(),$("#ramps").append("<p>No color schemes match these criteria.</p><p>Please choose fewer data classes, a different data type, and/or fewer filtering options.</p>")}function setScheme(e){$("#county-map g").removeClass(selectedScheme).addClass(e),$(".ramp.selected").removeClass("selected"),selectedScheme=e,$(".ramp."+selectedScheme).addClass("selected"),$("#scheme-name").html(numClasses+"-class "+selectedScheme),applyColors(),drawColorChips(),$("#permalink").val("https://tidyfriday.cn/colors/?type="+selectedSchemeType+"&scheme="+selectedScheme+"&n="+numClasses),window.location.hash="type="+selectedSchemeType+"&scheme="+selectedScheme+"&n="+numClasses,updateValues();for(var s="",t=0;t<numClasses;t++)s+="."+selectedScheme+" .q"+t+"-"+numClasses+"{fill:"+colorbrewer[selectedScheme][numClasses][t]+"}",t<numClasses-1&&(s+=" ");$("#copy-css input").val(s),$(".score-icon").attr("class","score-icon");var a=checkColorblind(e);function r(e){return e?1==e?"":2==e?"possibly not ":void 0:"not "}$("#blind-icon").addClass(a?1==a?"ok":"maybe":"bad").attr("title",numClasses+"-class "+selectedScheme+" is "+r(a)+"color blind friendly"),a=checkCopy(e),$("#copy-icon").addClass(a?1==a?"ok":"maybe":"bad").attr("title",numClasses+"-class "+selectedScheme+" is "+r(a)+"photocopy friendly"),a=checkScreen(e),$("#screen-icon").addClass(a?1==a?"ok":"maybe":"bad").attr("title",numClasses+"-class "+selectedScheme+" is "+r(a)+"LCD friendly"),a=checkPrint(e),$("#print-icon").addClass(a?1==a?"ok":"maybe":"bad").attr("title",numClasses+"-class "+selectedScheme+" is "+r(a)+"print friendly")}function checkFilters(e,s){return!!colorbrewer[e][numClasses]&&((!$("#blindcheck").is(":checked")||1==checkColorblind(e))&&((!$("#printcheck").is(":checked")||1==checkPrint(e))&&(!$("#copycheck").is(":checked")||1==checkCopy(e))))}function checkColorblind(e){return 1<colorbrewer[e].properties.blind.length?colorbrewer[e].properties.blind[numClasses-3]:colorbrewer[e].properties.blind[0]}function checkPrint(e){return 1<colorbrewer[e].properties.print.length?colorbrewer[e].properties.print[numClasses-3]:colorbrewer[e].properties.print[0]}function checkCopy(e){return 1<colorbrewer[e].properties.copy.length?colorbrewer[e].properties.copy[numClasses-3]:colorbrewer[e].properties.copy[0]}function checkScreen(e){return 1<colorbrewer[e].properties.screen.length?colorbrewer[e].properties.screen[numClasses-3]:colorbrewer[e].properties.screen[0]}function applyColors(){if(colorbrewer[selectedScheme][numClasses])for(var e=0;e<numClasses;e++)$("#borderscheck").is(":checked")&&$("#county-map g .q"+e+"-"+numClasses).css("stroke",colorbrewer[selectedScheme][numClasses][e]),$(".q"+e+"-"+numClasses).css("fill",colorbrewer[selectedScheme][numClasses][e]);else $("#counties g path").css("fill","#ccc")}function drawColorChips(){for(var e="<svg width='20' height='270'>",s=0;s<numClasses;s++)e+="<rect fill="+colorbrewer[selectedScheme][numClasses][s]+" width='20' height='"+Math.min(24,parseInt(265/numClasses))+"' y='"+s*Math.min(24,parseInt(265/numClasses))+"'/>";$("#color-chips").empty().append(e),updateValues()}function updateValues(){$("#color-values").empty();var t="",a=$("#color-system").val().toLowerCase(),r="";$("#color-chips rect").each(function(e){var s="cmyk"==a?getCMYK(selectedScheme,numClasses,e):getColorDisplay($(this).css("fill")),s=(t+=s+"\n",getColorDisplay($(this).css("fill")).replace(/,/g," "));r+='"'+s+'"',"hex"==a?e<numClasses-1&&(r+=", "):e<numClasses-1&&(r+=" ")}),t=t.replace(/\n$/,""),$("#color-values").append("<textarea readonly style='line-height:"+Math.min(24,parseInt(265/numClasses))+"px; height:"+Math.min(24,parseInt(265/numClasses))*numClasses+"px'>"+t+"</textarea>"),$("#ase").attr("href","export/ase/"+selectedScheme+"_"+numClasses+".ase"),$("#gpl").attr("href","export/gpl/"+selectedScheme+"_"+numClasses+".gpl"),$("#copy-json input").val(r)}function getColorDisplay(e,s){var t;return 0!=e.indexOf("#")&&(t={r:(t=e.replace(/[a-z()\s]/g,"").split(","))[0],g:t[1],b:t[2]}),"hex"==(s=s||$("#color-system").val().toLowerCase())?t?rgbToHex(t.r,t.g,t.b):e:"rgb"==s||"cmyk"==s?(t=t||hexToRgb(e)).r+","+t.g+","+t.b:void 0}function getCMYK(e,s,t){return cmyk[e][s][t].toString()}function init(){var e=getParameterByName("type")||"qualitative",s=getParameterByName("scheme")||"Set2",t=getParameterByName("n")||5;$("#"+e).prop("checked",!0),$("#num-classes").val(t),setSchemeType(e),setNumClasses(t),setScheme(s)}function layerChange(){switch($(this).attr("id")){case"roadscheck":$(this).is(":checked")?$("#overlays").children().length?$("#roads").show():loadOverlays("roads"):$("#roads").hide();break;case"citiescheck":$(this).is(":checked")?$("#overlays").children().length?$("#cities").show():loadOverlays("cities"):$("#cities").hide();break;case"borderscheck":if($(this).is(":checked"))$("#county-map g").children().css({stroke:"inherit","stroke-width":"0.50"});else for(var e=numClasses;e--;)$("#county-map g .q"+e+"-"+numClasses).css({stroke:colorbrewer[selectedScheme][numClasses][e],"stroke-width":"1"})}}function loadOverlays(e){$("#overlays").svg({loadURL:"map/overlays.svg",onLoad:function(){$("#overlays svg").attr("width",756).attr("height",581),("cities"==e?$("#roads"):$("#cities")).hide(),$("#cities").css("fill",$("#city-color").spectrum("get").toHexString()),$("#road-lines").css("stroke",$("#road-color").spectrum("get").toHexString())}})}function rgb2cmyk(e,s,t){var a=0,r=0,c=0,l=0;return 0==e&&0==s&&0==t?(l=1,[0,0,0,100]):(a=1-e/255,c=1-t/255,r=((r=1-s/255)-(e=Math.min(a,Math.min(r,c))))/(1-e),c=(c-e)/(1-e),l=e,[Math.round(100*(a=(a-e)/(1-e))),Math.round(100*r),Math.round(100*c),Math.round(100*l)])}function rgbToHex(e,s,t){return"#"+(1<<24|e<<16|s<<8|t).toString(16).slice(1)}function hexToRgb(e){e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");e=new RegExp("[\\?&#]"+e+"=([^&#]*)").exec(window.location.href);return null==e?null:decodeURIComponent(e[1].replace(/\+/g," "))}$("#num-classes").change(function(){setNumClasses($(this).val())}),$(".scheme-type").change(function(){setSchemeType($(this).attr("id"))}),$("#color-system").change(updateValues),$("#layers input").change(layerChange),$("#filters input").change(showSchemes),$("#transparency-slider").mousedown(function(){var s=$("#transparency-track").width(),t=$(this);function a(e){e=Math.max(3,3+Math.min(e.pageX-$("#transparency-track").offset().left,s));t.css("left",e),$("#county-map g").css("opacity",1-(e-4)/s)}$(document).on("mousemove",a),$(document).on("mouseup",function e(){$(document).off("mousemove",a),$(document).off("mouseup",e)})}),$("#road-color").spectrum({color:"#f33",showInput:!0,change:function(e){$("#overlays").children().length&&$("#road-lines").css("stroke",e.toHexString())}}),$("#city-color").spectrum({color:"#000",showInput:!0,change:function(e){$("#overlays").children().length&&$("#cities").css("fill",e.toHexString())}}),$("#border-color").spectrum({color:"#000",showInput:!0,change:function(e){$("#county-map g").css("stroke",e.toHexString())}}),$("#bg-color").spectrum({color:"#fff",showInput:!0,change:function(e){$("#county-map rect").css("fill",e.toHexString())}}),$("#terrain, #solid-color").change(function(){$("#terrain").is(":checked")?($("#terrain-img").length||$("#map-container").prepend($("<img id='terrain-img' src='map/terrain.jpg' />").css("left",-31).css("top",-58)),$("#county-map rect").css("opacity",0),$("#transparency-slider").position().left<4&&($("#transparency-slider").css("left",$("#transparency-track").position().left+43),$("#county-map g").css("opacity",.5))):($("#county-map rect").css("opacity",1),$("#transparency-slider").position().left==$("#transparency-track").position().left+43&&($("#transparency-slider").css("left",3),$("#county-map g").css("opacity",1)))}),$("#counties").svg({loadURL:"map/map.svg",onLoad:function(){$("#counties svg").attr("id","county-map").attr("width",756).attr("height",581),$("#map-container").css("background-image","none"),init(),$("#counties path").mouseover(function(){var e=$(this).css("fill"),s=$(this).attr("class").match(new RegExp("q[0-9]+-"+numClasses))[0],s=parseInt(s.substring(s.indexOf("q")+1,s.indexOf("-")))+1;$("#probe").empty().append("<p>"+selectedScheme+" class "+s+"<br/>RGB: "+getColorDisplay(e,"rgb")+"<br/>CMYK: "+getCMYK(selectedScheme,numClasses,s-1)+"<br/>HEX: "+getColorDisplay(e,"hex")+"</p>"),highlight=$(this).clone().css({"pointer-events":"none",stroke:"#000","stroke-width":"2"}).appendTo("#county-map g"),$("#probe").show()}),$("#counties path").mousemove(function(e){$("#probe").css({left:Math.min(920,e.pageX-$("#wrapper").offset().left+10),top:e.pageY-$("#wrapper").offset().top-75})}),$("#counties path").mouseout(function(){$("#probe").hide(),highlight.remove()})}}),$(".learn-more, #how, #credits, #downloads").click(function(e){var s;switch(e.stopPropagation(),$(this).attr("id")){case"number-learn-more":$("#learnmore-title").html("NUMBER OF DATA CLASSES"),s="number.html";break;case"schemes-learn-more":$("#learnmore-title").html("TYPES OF COLOR SCHEMES"),s="schemes.html";break;case"filters-learn-more":$("#learnmore-title").html("USABILITY ICONS"),s="usability.html";break;case"how":$("#learnmore-title").html("HOW TO USE: MAP DIAGNOSTICS"),s="howtouse.html";break;case"credits":$("#learnmore-title").html("CREDITS"),s="credits.html";break;case"downloads":$("#learnmore-title").html("DOWNLOADS"),s="downloads.html";break;case"context-learn-more":$("#learnmore-title").html("MAP CONTEXT and BACKGROUND"),s="context.html"}s&&($("#learnmore #content").load("learnmore/"+s,function(){$("#learnmore").show().css("margin-top",$("#wrapper").height()/2-$("#learnmore").height()/2)}),$("#mask").show())}),$("#learnmore #close, #mask").click(function(){$("#learnmore #content").empty(),$("#learnmore, #mask").hide()}),$("#export #tab").toggle(function(){$("#export").animate({left:"265px"})},function(){$("#export").animate({left:"0px"})});