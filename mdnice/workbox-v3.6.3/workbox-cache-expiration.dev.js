this.workbox=this.workbox||{},this.workbox.expiration=function(e,a,t,o,n,r,s){"use strict";try{self.workbox.v["workbox:cache-expiration:3.6.3"]=1}catch(e){}const i="timestamp";class c{constructor(e){this._cacheName=e,this._storeName=e,this._db=new a.DBWrapper(this._cacheName,2,{onupgradeneeded:e=>this._handleUpgrade(e)})}_handleUpgrade(e){var a=e.target.result;e.oldVersion<2&&a.objectStoreNames.contains("workbox-cache-expiration")&&a.deleteObjectStore("workbox-cache-expiration"),a.createObjectStore(this._storeName,{keyPath:"url"}).createIndex(i,i,{unique:!1})}setTimestamp(e,a){var r=this;return babelHelpers.asyncToGenerator(function*(){yield r._db.put(r._storeName,{url:new URL(e,location).href,timestamp:a})})()}getAllTimestamps(){var e=this;return babelHelpers.asyncToGenerator(function*(){return yield e._db.getAllMatching(e._storeName,{index:i})})()}getTimestamp(e){var a=this;return babelHelpers.asyncToGenerator(function*(){return(yield a._db.get(a._storeName,e)).timestamp})()}deleteUrl(e){var a=this;return babelHelpers.asyncToGenerator(function*(){yield a._db.delete(a._storeName,new URL(e,location).href)})()}delete(){var e=this;return babelHelpers.asyncToGenerator(function*(){yield e._db.deleteDatabase(),e._db=null})()}}class m{constructor(e,a={}){if(o.assert.isType(e,"string",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor",paramName:"cacheName"}),!a.maxEntries&&!a.maxAgeSeconds)throw new t.WorkboxError("max-entries-or-age-required",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor"});a.maxEntries&&o.assert.isType(a.maxEntries,"number",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor",paramName:"config.maxEntries"}),a.maxAgeSeconds&&o.assert.isType(a.maxAgeSeconds,"number",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"constructor",paramName:"config.maxAgeSeconds"}),this._isRunning=!1,this._rerunRequested=!1,this._maxEntries=a.maxEntries,this._maxAgeSeconds=a.maxAgeSeconds,this._cacheName=e,this._timestampModel=new c(e)}expireEntries(){var r=this;return babelHelpers.asyncToGenerator(function*(){var e,a;r._isRunning?r._rerunRequested=!0:(r._isRunning=!0,a=Date.now(),a=yield r._findOldEntries(a),e=yield r._findExtraEntries(),a=[...new Set(a.concat(e))],yield Promise.all([r._deleteFromCache(a),r._deleteFromIDB(a)]),0<a.length?(n.logger.groupCollapsed(`Expired ${a.length} `+`${1===a.length?"entry":"entries"} and removed `+`${1===a.length?"it":"them"} from the `+`'${r._cacheName}' cache.`),n.logger.log(`Expired the following ${1===a.length?"URL":"URLs"}:`),a.forEach(function(e){return n.logger.log("    "+e)}),n.logger.groupEnd()):n.logger.debug("Cache expiration ran and found no entries to remove."),r._isRunning=!1,r._rerunRequested&&(r._rerunRequested=!1,r.expireEntries()))})()}_findOldEntries(t){var n=this;return babelHelpers.asyncToGenerator(function*(){if(o.assert.isType(t,"number",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"_findOldEntries",paramName:"expireFromTimestamp"}),!n._maxAgeSeconds)return[];const a=t-1e3*n._maxAgeSeconds;var e=yield n._timestampModel.getAllTimestamps();const r=[];return e.forEach(function(e){e.timestamp<a&&r.push(e.url)}),r})()}_findExtraEntries(){var t=this;return babelHelpers.asyncToGenerator(function*(){var e=[];if(!t._maxEntries)return[];for(var a=yield t._timestampModel.getAllTimestamps();a.length>t._maxEntries;){var r=a.shift();e.push(r.url)}return e})()}_deleteFromCache(r){var t=this;return babelHelpers.asyncToGenerator(function*(){var e=yield caches.open(t._cacheName);for(const a of r)yield e.delete(a)})()}_deleteFromIDB(a){var r=this;return babelHelpers.asyncToGenerator(function*(){for(const e of a)yield r._timestampModel.deleteUrl(e)})()}updateTimestamp(a){var r=this;return babelHelpers.asyncToGenerator(function*(){o.assert.isType(a,"string",{moduleName:"workbox-cache-expiration",className:"CacheExpiration",funcName:"updateTimestamp",paramName:"url"});var e=new URL(a,location);e.hash="",yield r._timestampModel.setTimestamp(e.href,Date.now())})()}isURLExpired(a){var r=this;return babelHelpers.asyncToGenerator(function*(){var e;if(r._maxAgeSeconds)return(e=new URL(a,location)).hash="",(yield r._timestampModel.getTimestamp(e.href))<Date.now()-1e3*r._maxAgeSeconds;throw new t.WorkboxError("expired-test-without-max-age",{methodName:"isURLExpired",paramName:"maxAgeSeconds"})})()}delete(){var e=this;return babelHelpers.asyncToGenerator(function*(){e._rerunRequested=!1,yield e._timestampModel.delete()})()}}return e.CacheExpiration=m,e.Plugin=class{constructor(e={}){if(!e.maxEntries&&!e.maxAgeSeconds)throw new t.WorkboxError("max-entries-or-age-required",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"constructor"});e.maxEntries&&o.assert.isType(e.maxEntries,"number",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"constructor",paramName:"config.maxEntries"}),e.maxAgeSeconds&&o.assert.isType(e.maxAgeSeconds,"number",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"constructor",paramName:"config.maxAgeSeconds"}),this._config=e,this._maxAgeSeconds=e.maxAgeSeconds,this._cacheExpirations=new Map,e.purgeOnQuotaError&&s.registerQuotaErrorCallback(()=>this.deleteCacheAndMetadata())}_getCacheExpiration(e){if(e===r.cacheNames.getRuntimeName())throw new t.WorkboxError("expire-custom-caches-only");let a=this._cacheExpirations.get(e);return a||(a=new m(e,this._config),this._cacheExpirations.set(e,a)),a}cachedResponseWillBeUsed({cacheName:e,cachedResponse:a}){var r;return a&&(r=this._isResponseDateFresh(a),this._getCacheExpiration(e).expireEntries(),r)?a:null}_isResponseDateFresh(e){return!this._maxAgeSeconds||(null===(e=this._getDateHeaderTimestamp(e))||e>=Date.now()-1e3*this._maxAgeSeconds)}_getDateHeaderTimestamp(e){return!e.headers.has("date")||(e=e.headers.get("date"),e=new Date(e).getTime(),isNaN(e))?null:e}cacheDidUpdate({cacheName:a,request:r}){var t=this;return babelHelpers.asyncToGenerator(function*(){o.assert.isType(a,"string",{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"cacheDidUpdate",paramName:"cacheName"}),o.assert.isInstance(r,Request,{moduleName:"workbox-cache-expiration",className:"Plugin",funcName:"cacheDidUpdate",paramName:"request"});var e=t._getCacheExpiration(a);yield e.updateTimestamp(r.url),yield e.expireEntries()})()}deleteCacheAndMetadata(){var r=this;return babelHelpers.asyncToGenerator(function*(){for(var[e,a]of r._cacheExpirations)yield caches.delete(e),yield a.delete();r._cacheExpirations=new Map})()}},e}({},workbox.core._private,workbox.core._private,workbox.core._private,workbox.core._private,workbox.core._private,workbox.core);